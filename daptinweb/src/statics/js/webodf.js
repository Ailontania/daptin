/*

 This is a generated file. DO NOT EDIT.

 Copyright (C) 2010-2015 KO GmbH <copyright@kogmbh.com>

 @licstart
 This file is the compiled version of the WebODF library.

 WebODF is free software: you can redistribute it and/or modify it
 under the terms of the GNU Affero General Public License (GNU AGPL)
 as published by the Free Software Foundation, either version 3 of
 the License, or (at your option) any later version.

 WebODF is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU Affero General Public License for more details.

 You should have received a copy of the GNU Affero General Public License
 along with WebODF.  If not, see <http://www.gnu.org/licenses/>.
 @licend

 @source: http://www.webodf.org/
 @source: https://github.com/kogmbh/WebODF/
*/
var webodf_version="0.5.10-20-g88dd410c-dirty";function Runtime(){}Runtime.prototype.getVariable=function(h){};Runtime.prototype.toJson=function(h){};Runtime.prototype.fromJson=function(h){};Runtime.prototype.byteArrayFromString=function(h,l){};Runtime.prototype.byteArrayToString=function(h,l){};Runtime.prototype.read=function(h,l,d,b){};Runtime.prototype.readFile=function(h,l,d){};Runtime.prototype.readFileSync=function(h,l){};Runtime.prototype.loadXML=function(h,l){};
Runtime.prototype.writeFile=function(h,l,d){};Runtime.prototype.deleteFile=function(h,l){};Runtime.prototype.log=function(h,l){};Runtime.prototype.setTimeout=function(h,l){};Runtime.prototype.clearTimeout=function(h){};Runtime.prototype.libraryPaths=function(){};Runtime.prototype.currentDirectory=function(){};Runtime.prototype.setCurrentDirectory=function(h){};Runtime.prototype.type=function(){};Runtime.prototype.getDOMImplementation=function(){};Runtime.prototype.parseXML=function(h){};
Runtime.prototype.exit=function(h){};Runtime.prototype.getWindow=function(){};Runtime.prototype.requestAnimationFrame=function(h){};Runtime.prototype.cancelAnimationFrame=function(h){};Runtime.prototype.assert=function(h,l){};var IS_COMPILED_CODE=!0;
Runtime.byteArrayToString=function(h,l){function d(b){var d="",p,q=b.length;for(p=0;p<q;p+=1)d+=String.fromCharCode(b[p]&255);return d}function b(b){var d="",p,q=b.length,e=[],n,a,c,k;for(p=3<=q&&239===b[0]&&187===b[1]&&191===b[2]?3:0;p<q;p+=1)n=b[p],128>n?e.push(n):(p+=1,a=b[p],194<=n&&224>n?e.push((n&31)<<6|a&63):(p+=1,c=b[p],224<=n&&240>n?e.push((n&15)<<12|(a&63)<<6|c&63):(p+=1,k=b[p],240<=n&&245>n&&(n=(n&7)<<18|(a&63)<<12|(c&63)<<6|k&63,n-=65536,e.push((n>>10)+55296,(n&1023)+56320))))),1E3<=e.length&&
(d+=String.fromCharCode.apply(null,e),e.length=0);return d+String.fromCharCode.apply(null,e)}var g;"utf8"===l?g=b(h):("binary"!==l&&this.log("Unsupported encoding: "+l),g=d(h));return g};Runtime.getVariable=function(h){try{return eval(h)}catch(l){}};Runtime.toJson=function(h){return JSON.stringify(h)};Runtime.fromJson=function(h){return JSON.parse(h)};Runtime.getFunctionName=function(h){return void 0===h.name?(h=/function\s+(\w+)/.exec(h))&&h[1]:h.name};
Runtime.assert=function(h,l){if(!h)throw this.log("alert","ASSERTION FAILED:\n"+l),Error(l);};
function BrowserRuntime(){function h(b){var e=b.length,n,a,c=0;for(n=0;n<e;n+=1)a=b.charCodeAt(n),c+=1+(128<a)+(2048<a),55040<a&&57344>a&&(c+=1,n+=1);return c}function l(b,e,n){var a=b.length,c,k;e=new Uint8Array(new ArrayBuffer(e));n?(e[0]=239,e[1]=187,e[2]=191,k=3):k=0;for(n=0;n<a;n+=1)c=b.charCodeAt(n),128>c?(e[k]=c,k+=1):2048>c?(e[k]=192|c>>>6,e[k+1]=128|c&63,k+=2):55040>=c||57344<=c?(e[k]=224|c>>>12&15,e[k+1]=128|c>>>6&63,e[k+2]=128|c&63,k+=3):(n+=1,c=(c-55296<<10|b.charCodeAt(n)-56320)+65536,
e[k]=240|c>>>18&7,e[k+1]=128|c>>>12&63,e[k+2]=128|c>>>6&63,e[k+3]=128|c&63,k+=4);return e}function d(b){var e=b.length,n=new Uint8Array(new ArrayBuffer(e)),a;for(a=0;a<e;a+=1)n[a]=b.charCodeAt(a)&255;return n}function b(b,e){var n;void 0!==e?n=b:e=b;console.log(e);p.enableAlerts&&"alert"===n&&alert(e)}function g(b,e,n){if(0!==n.status||n.responseText)if(200===n.status||0===n.status){if(n.response&&"string"!==typeof n.response)"binary"===e?(n=n.response,n=new Uint8Array(n)):n=String(n.response);else if("binary"===
e)if(null!==n.responseBody&&"undefined"!==String(typeof VBArray)){n=(new VBArray(n.responseBody)).toArray();var a=n.length;e=new Uint8Array(new ArrayBuffer(a));for(b=0;b<a;b+=1)e[b]=n[b];n=e}else{(b=n.getResponseHeader("Content-Length"))&&(b=parseInt(b,10));if(b&&b!==n.responseText.length)a:{a=n.responseText;e=!1;var c=h(a);if("number"===typeof b){if(b!==c&&b!==c+3){a=void 0;break a}e=c+3===b;c=b}a=l(a,c,e)}void 0===a&&(a=d(n.responseText));n=a}else n=n.responseText;n={err:null,data:n}}else n={err:n.responseText||
n.statusText,data:null};else n={err:"File "+b+" is empty.",data:null};return n}function m(b,e,n){var a=new XMLHttpRequest;a.open("GET",b,n);a.overrideMimeType&&("binary"!==e?a.overrideMimeType("text/plain; charset="+e):a.overrideMimeType("text/plain; charset=x-user-defined"));return a}function r(b,e,n){var a,c;c=window.atob;if(1<b.split(",")[0].length&&0<=b.split(",")[0].indexOf("base64"))return c=c(b.split(",")[1]),c=d(c),n(null,c);a=m(b,e,!0);a.onreadystatechange=function(){var c;4===a.readyState&&
(c=g(b,e,a),n(c.err,c.data))};try{a.send(null)}catch(k){n(k.message,null)}}var p=this;this.byteArrayFromString=function(b,e){var n;"utf8"===e?n=l(b,h(b),!1):("binary"!==e&&p.log("unknown encoding: "+e),n=d(b));return n};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=r;this.read=function(b,e,n,a){r(b,"binary",function(c,k){var f=null;if(k){if("string"===typeof k)throw"This should not happen.";
f=k.subarray(e,e+n)}a(c,f)})};this.readFileSync=function(b,e){var n=m(b,e,!1),a;try{n.send(null);a=g(b,e,n);if(a.err)throw a.err;if(null===a.data)throw"No data read from "+b+".";}catch(c){throw c;}return a.data};this.writeFile=function(b,e,n){var a=new XMLHttpRequest,c;a.open("PUT",b,!0);a.onreadystatechange=function(){4===a.readyState&&(0!==a.status||a.responseText?200<=a.status&&300>a.status||0===a.status?n(null):n("Status "+String(a.status)+": "+a.responseText||a.statusText):n("File "+b+" is empty."))};
c=e.buffer&&!a.sendAsBinary?e.buffer:p.byteArrayToString(e,"binary");try{a.sendAsBinary?a.sendAsBinary(c):a.send(c)}catch(k){p.log("HUH? "+k+" "+e),n(k.message)}};this.deleteFile=function(b,e){var n=new XMLHttpRequest;n.open("DELETE",b,!0);n.onreadystatechange=function(){4===n.readyState&&(200>n.status&&300<=n.status?e(n.responseText):e(null))};n.send(null)};this.loadXML=function(b,e){var n=new XMLHttpRequest;n.open("GET",b,!0);n.overrideMimeType&&n.overrideMimeType("text/xml");n.onreadystatechange=
function(){4===n.readyState&&(0!==n.status||n.responseText?200===n.status||0===n.status?e(null,n.responseXML):e(n.responseText,null):e("File "+b+" is empty.",null))};try{n.send(null)}catch(a){e(a.message,null)}};this.log=b;this.enableAlerts=!0;this.assert=Runtime.assert;this.setTimeout=function(b,e){return setTimeout(function(){b()},e)};this.clearTimeout=function(b){clearTimeout(b)};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(){};this.currentDirectory=function(){return""};
this.type=function(){return"BrowserRuntime"};this.getDOMImplementation=function(){return window.document.implementation};this.parseXML=function(b){return(new DOMParser).parseFromString(b,"text/xml")};this.exit=function(d){b("Calling exit with code "+String(d)+", but exit() is not implemented.")};this.getWindow=function(){return window};this.requestAnimationFrame=function(b){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame;
if(e)e.bind(window),b=e(b);else return setTimeout(b,15);return b};this.cancelAnimationFrame=function(b){var e=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame;e?(e.bind(window),e(b)):clearTimeout(b)}}
function NodeJSRuntime(){function h(b){var e=b.length,n,a=new Uint8Array(new ArrayBuffer(e));for(n=0;n<e;n+=1)a[n]=b[n];return a}function l(d,e,n){function a(a,k){if(a)return n(a,null);if(!k)return n("No data for "+d+".",null);if("string"===typeof k)return n(a,k);n(a,h(k))}d=g.resolve(m,d);"binary"!==e?b.readFile(d,e,a):b.readFile(d,null,a)}var d=this,b=require("fs"),g=require("path"),m="",r,p;this.byteArrayFromString=function(b,e){var n=new Buffer(b,e),a,c=n.length,k=new Uint8Array(new ArrayBuffer(c));
for(a=0;a<c;a+=1)k[a]=n[a];return k};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=l;this.loadXML=function(b,e){l(b,"utf-8",function(n,a){if(n)return e(n,null);if(!a)return e("No data for "+b+".",null);e(null,d.parseXML(a))})};this.writeFile=function(d,e,n){e=new Buffer(e);d=g.resolve(m,d);b.writeFile(d,e,"binary",function(a){n(a||null)})};this.deleteFile=function(d,e){d=g.resolve(m,d);
b.unlink(d,e)};this.read=function(d,e,n,a){d=g.resolve(m,d);b.open(d,"r+",666,function(c,k){if(c)a(c,null);else{var f=new Buffer(n);b.read(k,f,0,n,e,function(c){b.close(k);a(c,h(f))})}})};this.readFileSync=function(d,e){var n=b.readFileSync(d,"binary"===e?null:e);if(null===n)throw"File "+d+" could not be read.";return"binary"===e?h(n):n};this.log=function(b,d){var n;void 0!==d?n=b:d=b;"alert"===n&&process.stderr.write("\n!!!!! ALERT !!!!!\n");process.stderr.write(d+"\n");"alert"===n&&process.stderr.write("!!!!! ALERT !!!!!\n")};
this.assert=Runtime.assert;this.setTimeout=function(b,d){return setTimeout(function(){b()},d)};this.clearTimeout=function(b){clearTimeout(b)};this.libraryPaths=function(){return[__dirname]};this.setCurrentDirectory=function(b){m=b};this.currentDirectory=function(){return m};this.type=function(){return"NodeJSRuntime"};this.getDOMImplementation=function(){return p};this.parseXML=function(b){return r.parseFromString(b,"text/xml")};this.exit=process.exit;this.getWindow=function(){return null};this.requestAnimationFrame=
function(b){return setTimeout(b,15)};this.cancelAnimationFrame=function(b){clearTimeout(b)};r=new (require("xmldom").DOMParser);p=d.parseXML("<a/>").implementation}
function RhinoRuntime(){var h=this,l={},d=l.javax.xml.parsers.DocumentBuilderFactory.newInstance(),b,g,m="";d.setValidating(!1);d.setNamespaceAware(!0);d.setExpandEntityReferences(!1);d.setSchema(null);g=l.org.xml.sax.EntityResolver({resolveEntity:function(b,d){var p=new l.java.io.FileReader(d);return new l.org.xml.sax.InputSource(p)}});b=d.newDocumentBuilder();b.setEntityResolver(g);this.byteArrayFromString=function(b,d){var p,e=b.length,n=new Uint8Array(new ArrayBuffer(e));for(p=0;p<e;p+=1)n[p]=
b.charCodeAt(p)&255;return n};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.loadXML=function(d,p){var g=new l.java.io.File(d),e=null;try{e=b.parse(g)}catch(n){return print(n),p(n,null)}p(null,e)};this.readFile=function(b,d,g){m&&(b=m+"/"+b);var e=new l.java.io.File(b),n="binary"===d?"latin1":d;e.isFile()?((b=readFile(b,n))&&"binary"===d&&(b=h.byteArrayFromString(b,"binary")),g(null,b)):g(b+" is not a file.",
null)};this.writeFile=function(b,d,g){m&&(b=m+"/"+b);b=new l.java.io.FileOutputStream(b);var e,n=d.length;for(e=0;e<n;e+=1)b.write(d[e]);b.close();g(null)};this.deleteFile=function(b,d){m&&(b=m+"/"+b);var g=new l.java.io.File(b),e=new l.java.io.File(b+Math.random());g.rename(e)?(e.deleteOnExit(),d(null)):d("Could not delete "+b)};this.read=function(b,d,g,e){m&&(b=m+"/"+b);var n;n=b;var a="binary";(new l.java.io.File(n)).isFile()?("binary"===a&&(a="latin1"),n=readFile(n,a)):n=null;n?e(null,this.byteArrayFromString(n.substring(d,
d+g),"binary")):e("Cannot read "+b,null)};this.readFileSync=function(b,d){if(!d)return"";var g=readFile(b,d);if(null===g)throw"File could not be read.";return g};this.log=function(b,d){var g;void 0!==d?g=b:d=b;"alert"===g&&print("\n!!!!! ALERT !!!!!");print(d);"alert"===g&&print("!!!!! ALERT !!!!!")};this.assert=Runtime.assert;this.setTimeout=function(b){b();return 0};this.clearTimeout=function(){};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(b){m=b};this.currentDirectory=
function(){return m};this.type=function(){return"RhinoRuntime"};this.getDOMImplementation=function(){return b.getDOMImplementation()};this.parseXML=function(d){d=new l.java.io.StringReader(d);d=new l.org.xml.sax.InputSource(d);return b.parse(d)};this.exit=quit;this.getWindow=function(){return null};this.requestAnimationFrame=function(b){b();return 0};this.cancelAnimationFrame=function(){}}
Runtime.create=function(){return"undefined"!==String(typeof window)?new BrowserRuntime:"undefined"!==String(typeof require)?new NodeJSRuntime:new RhinoRuntime};var runtime=Runtime.create(),webodfcore={},gui={},xmldom={},odf={},ops={},webodf={};(function(){webodf.Version="undefined"!==String(typeof webodf_version)?webodf_version:"From Source"})();
(function(){function h(b,d,g){var e=b+"/manifest.json",n,a;runtime.log("Loading manifest: "+e);try{n=runtime.readFileSync(e,"utf-8")}catch(c){if(g)runtime.log("No loadable manifest found.");else throw console.log(String(c)),c;return}g=JSON.parse(n);for(a in g)g.hasOwnProperty(a)&&(d[a]={dir:b,deps:g[a]})}function l(b,d,g){function e(k){if(!c[k]&&!g(k)){if(a[k])throw"Circular dependency detected for "+k+".";a[k]=!0;if(!d[k])throw"Missing dependency information for class "+k+".";var f=d[k],b=f.deps,
m,p=b.length;for(m=0;m<p;m+=1)e(b[m]);a[k]=!1;c[k]=!0;n.push(f.dir+"/"+k.replace(".","/")+".js")}}var n=[],a={},c={};b.forEach(e);return n}function d(b){var d,g;for(d=0;d<b.length;d+=1)g=runtime.readFileSync(b[d],"utf-8"),g+="\n//# sourceURL="+b[d],eval(g)}function b(b){b=b.split(".");var d,g=m,e=b.length;for(d=0;d<e;d+=1){if(!g.hasOwnProperty(b[d]))return!1;g=g[b[d]]}return!0}var g,m={webodfcore:webodfcore,gui:gui,xmldom:xmldom,odf:odf,ops:ops};runtime.loadClasses=function(m,p){if(IS_COMPILED_CODE||
0===m.length)return p&&p();var r;if(!(r=g)){r=[];var e=runtime.libraryPaths(),n;runtime.currentDirectory()&&-1===e.indexOf(runtime.currentDirectory())&&h(runtime.currentDirectory(),r,!0);for(n=0;n<e.length;n+=1)h(e[n],r)}g=r;m=l(m,g,b);if(0===m.length)return p&&p();if("BrowserRuntime"===runtime.type()&&p){r=m;e=document.currentScript||document.documentElement.lastChild;n=document.createDocumentFragment();var a,c;for(c=0;c<r.length;c+=1)a=document.createElement("script"),a.type="text/javascript",a.charset=
"utf-8",a.async=!1,a.setAttribute("src",r[c]),n.appendChild(a);p&&(a.onload=p);e.parentNode.insertBefore(n,e)}else d(m),p&&p()};runtime.loadClass=function(b,d){runtime.loadClasses([b],d)}})();(function(){var h=function(h){return h};runtime.getTranslator=function(){return h};runtime.setTranslator=function(l){h=l};runtime.tr=function(l){var d=h(l);return d&&"string"===String(typeof d)?d:l}})();
(function(h){function l(d){if(d.length){var b=d[0];runtime.readFile(b,"utf8",function(g,m){function h(){var b=eval(l);b&&runtime.exit(b)}var p="",p=b.lastIndexOf("/"),l=m,p=-1!==p?b.substring(0,p):".";runtime.setCurrentDirectory(p);g?(runtime.log(g),runtime.exit(1)):null===l?(runtime.log("No code found for "+b),runtime.exit(1)):h.apply(null,d)})}}h=h?Array.prototype.slice.call(h):[];"NodeJSRuntime"===runtime.type()?l(process.argv.slice(2)):"RhinoRuntime"===runtime.type()?l(h):l(h.slice(1))})("undefined"!==
String(typeof arguments)&&arguments);gui.CommonConstraints={EDIT:{ANNOTATIONS:{ONLY_DELETE_OWN:"onlyDeleteOwn"},REVIEW_MODE:"reviewMode"}};webodfcore.EventSource=function(){};webodfcore.EventSource.prototype.subscribe=function(h,l){};webodfcore.EventSource.prototype.unsubscribe=function(h,l){};
webodfcore.EventNotifier=function(h){function l(b){runtime.assert(!d.hasOwnProperty(b),'Duplicated event ids: "'+b+'" registered more than once.');d[b]=[]}var d={};this.emit=function(b,g){var m,h;runtime.assert(d.hasOwnProperty(b),'unknown event fired "'+b+'"');h=d[b];for(m=0;m<h.length;m+=1)h[m](g)};this.subscribe=function(b,g){runtime.assert(d.hasOwnProperty(b),'tried to subscribe to unknown event "'+b+'"');d[b].push(g)};this.unsubscribe=function(b,g){var m;runtime.assert(d.hasOwnProperty(b),'tried to unsubscribe from unknown event "'+
b+'"');m=d[b].indexOf(g);runtime.assert(-1!==m,'tried to unsubscribe unknown callback from event "'+b+'"');-1!==m&&d[b].splice(m,1)};this.register=l;h&&h.forEach(l)};
gui.SessionConstraints=function(){function h(b){l.hasOwnProperty(b)||(l[b]=!1,d.register(b))}var l={},d=new webodfcore.EventNotifier;this.registerConstraint=h;this.subscribe=function(b,g){h(b);d.subscribe(b,g)};this.unsubscribe=function(b,g){d.unsubscribe(b,g)};this.setState=function(b,g){runtime.assert(!0===l.hasOwnProperty(b),"No such constraint");l[b]!==g&&(l[b]=g,d.emit(b,g))};this.getState=function(b){runtime.assert(!0===l.hasOwnProperty(b),"No such constraint");return l[b]}};
gui.BlacklistNamespaceNodeFilter=function(h){var l={},d=NodeFilter.FILTER_REJECT,b=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(g){return!g||l.hasOwnProperty(g.namespaceURI)?d:b};(function(){h.forEach(function(b){l[b]=!0})})()};
odf.Namespaces={namespaceMap:{config:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",db:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dc:"http://purl.org/dc/elements/1.1/",dr3d:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",draw:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chart:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fo:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",form:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",math:"http://www.w3.org/1998/Math/MathML",
meta:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",number:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",office:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentation:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",style:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svg:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",table:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",text:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xforms:"http://www.w3.org/2002/xforms",
xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},prefixMap:{},configns:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",dbns:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dcns:"http://purl.org/dc/elements/1.1/",dr3dns:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",drawns:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chartns:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fons:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",formns:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",
mathns:"http://www.w3.org/1998/Math/MathML",metans:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",numberns:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",officens:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentationns:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",stylens:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svgns:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",tablens:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",textns:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",
xformsns:"http://www.w3.org/2002/xforms",xlinkns:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/XML/1998/namespace"};(function(){var h=odf.Namespaces.namespaceMap,l=odf.Namespaces.prefixMap,d;for(d in h)h.hasOwnProperty(d)&&(l[h[d]]=d)})();odf.Namespaces.forEachPrefix=function(h){var l=odf.Namespaces.namespaceMap,d;for(d in l)l.hasOwnProperty(d)&&h(d,l[d])};
odf.Namespaces.lookupNamespaceURI=function(h){var l=null;odf.Namespaces.namespaceMap.hasOwnProperty(h)&&(l=odf.Namespaces.namespaceMap[h]);return l};odf.Namespaces.lookupPrefix=function(h){var l=odf.Namespaces.prefixMap;return l.hasOwnProperty(h)?l[h]:null};odf.Namespaces.lookupNamespaceURI.lookupNamespaceURI=odf.Namespaces.lookupNamespaceURI;
(function(){odf.OdfSchemaImpl=function(){var h=[["config:config-item","uncategorized"],["form:item","object"],["form:option","uncategorized"],["math:math","field"],["meta:user-defined","uncategorized"],["number:currency-symbol","uncategorized"],["number:embedded-text","uncategorized"],["number:text","uncategorized"],["presentation:date-time-decl","uncategorized"],["presentation:footer-decl","uncategorized"],["presentation:header-decl","uncategorized"],["svg:desc","text"],["svg:title","text"],["table:desc",
"uncategorized"],["table:title","uncategorized"],["text:a","text"],["text:author-initials","field"],["text:author-name","field"],["text:bibliography-mark","field"],["text:bookmark-ref","field"],["text:chapter","field"],["text:character-count","field"],["text:conditional-text","field"],["text:creation-date","field"],["text:creation-time","field"],["text:creator","field"],["text:database-display","field"],["text:database-name","field"],["text:database-row-number","field"],["text:date","field"],["text:dde-connection",
"field"],["text:description","field"],["text:editing-cycles","field"],["text:editing-duration","field"],["text:execute-macro","uncategorized"],["text:expression","uncategorized"],["text:file-name","field"],["text:h","text"],["text:hidden-paragraph","text"],["text:hidden-text","text"],["text:image-count","field"],["text:index-entry-span","uncategorized"],["text:index-title-template","uncategorized"],["text:initial-creator","field"],["text:keywords","field"],["text:linenumbering-separator","style"],
["text:measure","uncategorized"],["text:meta","uncategorized"],["text:meta-field","uncategorized"],["text:modification-date","field"],["text:modification-time","field"],["text:note-citation","field"],["text:note-continuation-notice-backward","style"],["text:note-continuation-notice-forward","style"],["text:note-ref","field"],["text:object-count","field"],["text:p","text"],["text:page-continuation","uncategorized"],["text:page-count","field"],["text:page-number","field"],["text:page-variable-get",
"field"],["text:page-variable-set","field"],["text:paragraph-count","field"],["text:placeholder","field"],["text:print-date","field"],["text:print-time","field"],["text:printed-by","field"],["text:reference-ref","field"],["text:ruby-base","text"],["text:ruby-text","text"],["text:script","text"],["text:sender-city","field"],["text:sender-company","field"],["text:sender-country","field"],["text:sender-email","field"],["text:sender-fax","field"],["text:sender-firstname","field"],["text:sender-initials",
"field"],["text:sender-lastname","field"],["text:sender-phone-private","field"],["text:sender-phone-work","field"],["text:sender-position","field"],["text:sender-postal-code","field"],["text:sender-state-or-province","field"],["text:sender-street","field"],["text:sender-title","field"],["text:sequence","uncategorized"],["text:sequence-ref","uncategorized"],["text:sheet-name","uncategorized"],["text:span","text"],["text:subject","field"],["text:table-count","field"],["text:table-formula","deprecated"],
["text:template-name","uncategorized"],["text:text-input","field"],["text:time","field"],["text:title","field"],["text:user-defined","field"],["text:user-field-get","field"],["text:user-field-input","field"],["text:variable-get","field"],["text:variable-input","field"],["text:variable-set","field"],["text:word-count","field"],["xforms:model","uncategorized"]],l={};this.isTextContainer=function(d,b){return"text"===l[d+":"+b]};this.isField=function(d,b){return"field"===l[d+":"+b]};this.getFields=function(){return h.filter(function(d){return"field"===
d[1]}).map(function(d){return d[0]})};(function(){h.forEach(function(d){var b=d[1],g=d[0].split(":");d=g[0];var g=g[1],m=odf.Namespaces.lookupNamespaceURI(d);m?l[m+":"+g]=b:runtime.log("DEBUG: OdfSchema - unknown prefix '"+d+"'")})})()};odf.OdfSchema=new odf.OdfSchemaImpl})();
(function(){function h(){var b,g,m,h,p,l,e,n,a;void 0===d&&(g=(b=runtime.getWindow())&&b.document,l=g.documentElement,e=g.body,d={rangeBCRIgnoresElementBCR:!1,unscaledRangeClientRects:!1,elementBCRIgnoresBodyScroll:!1},g&&(h=g.createElement("div"),h.style.position="absolute",h.style.left="-99999px",h.style.transform="scale(2)",h.style["-webkit-transform"]="scale(2)",p=g.createElement("div"),h.appendChild(p),e.appendChild(h),b=g.createRange(),b.selectNode(p),d.rangeBCRIgnoresElementBCR=0===b.getClientRects().length,
p.appendChild(g.createTextNode("Rect transform test")),g=p.getBoundingClientRect(),m=b.getBoundingClientRect(),d.unscaledRangeClientRects=2<Math.abs(g.height-m.height),h.style.transform="",h.style["-webkit-transform"]="",g=l.style.overflow,m=e.style.overflow,n=e.style.height,a=e.scrollTop,l.style.overflow="visible",e.style.overflow="visible",e.style.height="200%",e.scrollTop=e.scrollHeight,d.elementBCRIgnoresBodyScroll=b.getBoundingClientRect().top!==p.getBoundingClientRect().top,e.scrollTop=a,e.style.height=
n,e.style.overflow=m,l.style.overflow=g,b.detach(),e.removeChild(h),b=Object.keys(d).map(function(a){return a+":"+String(d[a])}).join(", "),runtime.log("Detected browser quirks - "+b)));return d}function l(b,d,m){for(b=b?b.firstElementChild:null;b;){if(b.localName===m&&b.namespaceURI===d)return b;b=b.nextElementSibling}return null}var d;webodfcore.DomUtilsImpl=function(){function b(a,c){for(var k=0,f;a.parentNode!==c;)runtime.assert(null!==a.parentNode,"parent is null"),a=a.parentNode;for(f=c.firstChild;f!==
a;)k+=1,f=f.nextSibling;return k}function d(a,c){return 0>=a.compareBoundaryPoints(Range.START_TO_START,c)&&0<=a.compareBoundaryPoints(Range.END_TO_END,c)}function m(a,c){return 0>=a.compareBoundaryPoints(Range.END_TO_START,c)&&0<=a.compareBoundaryPoints(Range.START_TO_END,c)}function r(a,c){var k=null;a.nodeType===Node.TEXT_NODE&&(0===a.length?(a.parentNode.removeChild(a),c.nodeType===Node.TEXT_NODE&&(k=c)):(c.nodeType===Node.TEXT_NODE&&(a.appendData(c.data),c.parentNode.removeChild(c)),k=a));return k}
function p(a){for(var c=a.parentNode;a.firstChild;)c.insertBefore(a.firstChild,a);c.removeChild(a);return c}function q(a,c){var k=a.parentNode,b=a.firstChild,f=c(a),d;if(f===NodeFilter.FILTER_SKIP)return k;for(;b;)d=b.nextSibling,q(b,c),b=d;k&&f===NodeFilter.FILTER_REJECT&&p(a);return k}function e(a,c){return a===c||!!(a.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_CONTAINED_BY)}function n(a,c){return h().unscaledRangeClientRects?a:a/c}function a(c,b,d){Object.keys(b).forEach(function(k){var f=
k.split(":"),n=f[1],e=d(f[0]),f=b[k],g=typeof f;"object"===g?Object.keys(f).length&&(k=e?c.getElementsByTagNameNS(e,n)[0]||c.ownerDocument.createElementNS(e,k):c.getElementsByTagName(n)[0]||c.ownerDocument.createElement(k),c.appendChild(k),a(k,f,d)):e&&(runtime.assert("number"===g||"string"===g,"attempting to map unsupported type '"+g+"' (key: "+k+")"),c.setAttributeNS(e,k,String(f)))})}var c=null;this.splitBoundaries=function(a){var c,k=[],d,n,e;if(a.startContainer.nodeType===Node.TEXT_NODE||a.endContainer.nodeType===
Node.TEXT_NODE){d=a.endContainer;n=a.endContainer.nodeType!==Node.TEXT_NODE?a.endOffset===a.endContainer.childNodes.length:!1;e=a.endOffset;c=a.endContainer;if(e<c.childNodes.length)for(c=c.childNodes.item(e),e=0;c.firstChild;)c=c.firstChild;else for(;c.lastChild;)c=c.lastChild,e=c.nodeType===Node.TEXT_NODE?c.textContent.length:c.childNodes.length;c===d&&(d=null);a.setEnd(c,e);e=a.endContainer;0!==a.endOffset&&e.nodeType===Node.TEXT_NODE&&(c=e,a.endOffset!==c.length&&(k.push(c.splitText(a.endOffset)),
k.push(c)));e=a.startContainer;0!==a.startOffset&&e.nodeType===Node.TEXT_NODE&&(c=e,a.startOffset!==c.length&&(e=c.splitText(a.startOffset),k.push(c),k.push(e),a.setStart(e,0)));if(null!==d){for(e=a.endContainer;e.parentNode&&e.parentNode!==d;)e=e.parentNode;n=n?d.childNodes.length:b(e,d);a.setEnd(d,n)}}return k};this.containsRange=d;this.rangesIntersect=m;this.rangeIntersection=function(a,c){var k;m(a,c)&&(k=a.cloneRange(),-1===a.compareBoundaryPoints(Range.START_TO_START,c)&&k.setStart(c.startContainer,
c.startOffset),1===a.compareBoundaryPoints(Range.END_TO_END,c)&&k.setEnd(c.endContainer,c.endOffset));return k};this.getNodesInRange=function(a,c,b){var k=[],f=a.commonAncestorContainer,f=f.nodeType===Node.TEXT_NODE?f.parentNode:f;b=a.startContainer.ownerDocument.createTreeWalker(f,b,c,!1);var d,e;a.endContainer.childNodes[a.endOffset-1]?(d=a.endContainer.childNodes[a.endOffset-1],e=Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINED_BY):(d=a.endContainer,e=Node.DOCUMENT_POSITION_PRECEDING);
if(a.startContainer.childNodes[a.startOffset])a=a.startContainer.childNodes[a.startOffset],b.currentNode=a;else{var n=a.startContainer;a.startOffset===(n.nodeType===Node.TEXT_NODE?n.length:n.childNodes.length)?(a=a.startContainer,b.currentNode=a,b.lastChild(),a=b.nextNode()):(a=a.startContainer,b.currentNode=a)}if(a){a=b.currentNode;if(a!==f)for(a=a.parentNode;a&&a!==f;)c(a)===NodeFilter.FILTER_REJECT&&(b.currentNode=a),a=a.parentNode;a=b.currentNode;switch(c(a)){case NodeFilter.FILTER_REJECT:for(a=
b.nextSibling();!a&&b.parentNode();)a=b.nextSibling();break;case NodeFilter.FILTER_SKIP:a=b.nextNode()}for(;a;){c=d.compareDocumentPosition(a);if(0!==c&&0===(c&e))break;k.push(a);a=b.nextNode()}}return k};this.normalizeTextNodes=function(a){a&&a.nextSibling&&(a=r(a,a.nextSibling));a&&a.previousSibling&&r(a.previousSibling,a)};this.rangeContainsNode=function(a,c){var b=c.ownerDocument.createRange(),f=c.ownerDocument.createRange(),k;b.setStart(a.startContainer,a.startOffset);b.setEnd(a.endContainer,
a.endOffset);f.selectNodeContents(c);k=d(b,f);b.detach();f.detach();return k};this.mergeIntoParent=p;this.removeUnwantedNodes=q;this.removeAllChildNodes=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)};this.getElementsByTagNameNS=function(a,c,b){var f=[];a=a.getElementsByTagNameNS(c,b);f.length=b=a.length;for(c=0;c<b;c+=1)f[c]=a.item(c);return f};this.getElementsByTagName=function(a,c){var b=[],f,k,d;f=a.getElementsByTagName(c);b.length=d=f.length;for(k=0;k<d;k+=1)b[k]=f.item(k);return b};
this.containsNode=function(a,c){return a===c||a.contains(c)};this.comparePoints=function(a,c,d,e){if(a===d)return e-c;var f=a.compareDocumentPosition(d);2===f?f=-1:4===f?f=1:10===f?(c=b(a,d),f=c<e?1:-1):(e=b(d,a),f=e<c?-1:1);return f};this.adaptRangeDifferenceToZoomLevel=n;this.translateRect=function(a,c,b){return{top:n(a.top-c.top,b),left:n(a.left-c.left,b),bottom:n(a.bottom-c.top,b),right:n(a.right-c.left,b),width:n(a.width,b),height:n(a.height,b)}};this.getBoundingClientRect=function(a){var b=
a.ownerDocument,k=h(),d=b.body;if((!1===k.unscaledRangeClientRects||k.rangeBCRIgnoresElementBCR)&&a.nodeType===Node.ELEMENT_NODE)return a=a.getBoundingClientRect(),k.elementBCRIgnoresBodyScroll?{left:a.left+d.scrollLeft,right:a.right+d.scrollLeft,top:a.top+d.scrollTop,bottom:a.bottom+d.scrollTop,width:a.width,height:a.height}:a;var e;c?e=c:c=e=b.createRange();k=e;k.selectNode(a);return k.getBoundingClientRect()};this.mapKeyValObjOntoNode=function(a,c,b){Object.keys(c).forEach(function(f){var k=f.split(":"),
d=k[1],k=b(k[0]),e=c[f];k?(d=a.getElementsByTagNameNS(k,d)[0],d||(d=a.ownerDocument.createElementNS(k,f),a.appendChild(d)),d.textContent=e):runtime.log("Key ignored: "+f)})};this.removeKeyElementsFromNode=function(a,c,b){c.forEach(function(c){var f=c.split(":"),k=f[1];(f=b(f[0]))?(k=a.getElementsByTagNameNS(f,k)[0])?k.parentNode.removeChild(k):runtime.log("Element for "+c+" not found."):runtime.log("Property Name ignored: "+c)})};this.getKeyValRepresentationOfNode=function(a,c){for(var b={},f=a.firstElementChild,
k;f;){if(k=c(f.namespaceURI))b[k+":"+f.localName]=f.textContent;f=f.nextElementSibling}return b};this.mapObjOntoNode=a;this.cloneEvent=function(a){var c=Object.create(null);Object.keys(a.constructor.prototype).forEach(function(b){c[b]=a[b]});c.prototype=a.constructor.prototype;return c};this.getDirectChild=l;(function(a){var c,b;b=runtime.getWindow();null!==b&&(c=b.navigator.appVersion.toLowerCase(),b=-1===c.indexOf("chrome")&&(-1!==c.indexOf("applewebkit")||-1!==c.indexOf("safari")),c=-1!==c.indexOf("msie")||
-1!==c.indexOf("trident"),b||c)&&(a.containsNode=e)})(this)};webodfcore.DomUtils=new webodfcore.DomUtilsImpl})();
odf.OdfUtilsImpl=function(){function h(a){return"image"===(a&&a.localName)&&a.namespaceURI===T}function l(a){return null!==a&&a.nodeType===Node.ELEMENT_NODE&&"frame"===a.localName&&a.namespaceURI===T&&"as-char"===a.getAttributeNS(M,"anchor-type")}function d(a){var c;(c="annotation"===(a&&a.localName)&&a.namespaceURI===odf.Namespaces.officens)||(c="div"===(a&&a.localName)&&"annotationWrapper"===a.className);return c}function b(a){return"a"===(a&&a.localName)&&a.namespaceURI===M}function g(a){var c=
a&&a.localName;return("p"===c||"h"===c)&&a.namespaceURI===M}function m(a,c){for(a&&void 0!==c&&!g(a)&&a.childNodes.item(c)&&(a=a.childNodes.item(c));a&&!g(a);)a=a.parentNode;return a}function r(a,c){for(;a&&a!==c;){if(a.namespaceURI===odf.Namespaces.officens&&"annotation"===a.localName)return a;a=a.parentNode}return null}function p(a){return/^[ \t\r\n]+$/.test(a)}function q(a){if(null===a||a.nodeType!==Node.ELEMENT_NODE)return!1;var c=a.localName;return ea.isTextContainer(a.namespaceURI,c)||"span"===
c&&"webodf-annotationHighlight"===a.className}function e(a){return null===a||a.nodeType!==Node.ELEMENT_NODE?!1:ea.isField(a.namespaceURI,a.localName)}function n(a){var c=a&&a.localName,b=!1;c&&(a=a.namespaceURI,a===M&&(b="s"===c||"tab"===c||"line-break"===c));return b}function a(a){return n(a)||e(a)||l(a)||d(a)}function c(a){var c=a&&a.localName,b=!1;c&&(a=a.namespaceURI,a===M&&(b="s"===c));return b}function k(a){return-1!==N.indexOf(a.namespaceURI)}function f(a){if(n(a)||e(a))return!1;if(q(a.parentNode)&&
a.nodeType===Node.TEXT_NODE)return 0===a.textContent.length;for(a=a.firstChild;a;){if(k(a)||!f(a))return!1;a=a.nextSibling}return!0}function v(a){for(;null!==a.firstChild&&q(a);)a=a.firstChild;return a}function u(a){for(;null!==a.lastChild&&q(a);)a=a.lastChild;return a}function x(a){for(;!g(a)&&null===a.previousSibling;)a=a.parentNode;return g(a)?null:u(a.previousSibling)}function w(a){for(;!g(a)&&null===a.nextSibling;)a=a.parentNode;return g(a)?null:v(a.nextSibling)}function z(b){for(var f=!1;b;)if(b.nodeType===
Node.TEXT_NODE)if(0===b.length)b=x(b);else return!p(b.data.substr(b.length-1,1));else a(b)?(f=!1===c(b),b=null):b=x(b);return f}function y(c){var b=!1,f;for(c=c&&v(c);c;){f=c.nodeType===Node.TEXT_NODE?c.length:0;if(0<f&&!p(c.data)){b=!0;break}if(a(c)){b=!0;break}c=w(c)}return b}function t(a,c){return p(a.data.substr(c))?!y(w(a)):!1}function B(c,b){var f=c.data,k;if(!p(f[b])||a(c.parentNode))return!1;0<b?p(f[b-1])||(k=!0):z(x(c))&&(k=!0);return!0===k?t(c,b)?!1:!0:!1}function J(a){return(a=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px)|(%))/.exec(a))?
{value:parseFloat(a[1]),unit:a[3]}:null}function H(a){return(a=J(a))&&(0>a.value||"%"===a.unit)?null:a}function K(a){return(a=J(a))&&"%"!==a.unit?null:a}function U(a){switch(a.namespaceURI){case odf.Namespaces.drawns:case odf.Namespaces.svgns:case odf.Namespaces.dr3dns:return!1;case odf.Namespaces.textns:switch(a.localName){case "note-body":case "ruby-text":return!1}break;case odf.Namespaces.officens:switch(a.localName){case "annotation":case "binary-data":case "event-listeners":return!1}break;default:switch(a.localName){case "cursor":case "editinfo":return!1}}return!0}
function L(a){return!(!m(a)||p(a.textContent)&&!B(a,0))}function Q(a,c){for(;0<c.length&&!aa.rangeContainsNode(a,c[0]);)c.shift();for(;0<c.length&&!aa.rangeContainsNode(a,c[c.length-1]);)c.pop()}function C(c,b,f){var k;k=aa.getNodesInRange(c,function(c){var b=NodeFilter.FILTER_REJECT;if(n(c.parentNode)||e(c.parentNode)||d(c))b=NodeFilter.FILTER_REJECT;else if(c.nodeType===Node.TEXT_NODE){if(f||L(c))b=NodeFilter.FILTER_ACCEPT}else if(a(c))b=NodeFilter.FILTER_ACCEPT;else if(U(c)||q(c))b=NodeFilter.FILTER_SKIP;
return b},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);b||Q(c,k);return k}function V(a,c,b){for(;a;){if(b(a)){c[0]!==a&&c.unshift(a);break}if(d(a))break;a=a.parentNode}}function O(a,c){var b=a;if(c<b.childNodes.length-1)b=b.childNodes[c+1];else{for(;!b.nextSibling;)b=b.parentNode;b=b.nextSibling}for(;b.firstChild;)b=b.firstChild;return b}var M=odf.Namespaces.textns,T=odf.Namespaces.drawns,F=odf.Namespaces.xlinkns,aa=webodfcore.DomUtils,N=[odf.Namespaces.dbns,odf.Namespaces.dcns,odf.Namespaces.dr3dns,
odf.Namespaces.drawns,odf.Namespaces.chartns,odf.Namespaces.formns,odf.Namespaces.numberns,odf.Namespaces.officens,odf.Namespaces.presentationns,odf.Namespaces.stylens,odf.Namespaces.svgns,odf.Namespaces.tablens,odf.Namespaces.textns],ea=odf.OdfSchema;this.isImage=h;this.isCharacterFrame=l;this.isInlineRoot=d;this.isTextSpan=function(a){return"span"===(a&&a.localName)&&a.namespaceURI===M};this.isHyperlink=b;this.getHyperlinkTarget=function(a){return a.getAttributeNS(F,"href")||""};this.isParagraph=
g;this.getParagraphElement=m;this.getParentAnnotation=r;this.isWithinAnnotation=function(a,c){return!!r(a,c)};this.getAnnotationCreator=function(a){return a.getElementsByTagNameNS(odf.Namespaces.dcns,"creator")[0].textContent};this.isListItem=function(a){return"list-item"===(a&&a.localName)&&a.namespaceURI===M};this.isLineBreak=function(a){return"line-break"===(a&&a.localName)&&a.namespaceURI===M};this.isODFWhitespace=p;this.isGroupingElement=q;this.isFieldElement=e;this.isCharacterElement=n;this.isAnchoredAsCharacterElement=
a;this.isSpaceElement=c;this.isODFNode=k;this.hasNoODFContent=f;this.firstChild=v;this.lastChild=u;this.previousNode=x;this.nextNode=w;this.scanLeftForNonSpace=z;this.lookLeftForCharacter=function(c){var b,f=b=0;c.nodeType===Node.TEXT_NODE&&(f=c.length);0<f?(b=c.data,b=p(b.substr(f-1,1))?1===f?z(x(c))?2:0:p(b.substr(f-2,1))?0:2:1):a(c)&&(b=1);return b};this.lookRightForCharacter=function(c){var b=!1,f=0;c&&c.nodeType===Node.TEXT_NODE&&(f=c.length);0<f?b=!p(c.data.substr(0,1)):a(c)&&(b=!0);return b};
this.scanLeftForAnyCharacter=function(c){var b=!1,f;for(c=c&&u(c);c;){f=c.nodeType===Node.TEXT_NODE?c.length:0;if(0<f&&!p(c.data)){b=!0;break}if(a(c)){b=!0;break}c=x(c)}return b};this.scanRightForAnyCharacter=y;this.isTrailingWhitespace=t;this.isSignificantWhitespace=B;this.isDowngradableSpaceElement=function(a){return c(a)?z(x(a))&&y(w(a)):!1};this.parseLength=J;this.parseNonNegativeLength=H;this.parseFoFontSize=function(a){var c;c=(c=J(a))&&(0>=c.value||"%"===c.unit)?null:c;return c||K(a)};this.parseFoLineHeight=
function(a){return H(a)||K(a)};this.isTextContentContainingNode=U;this.getTextNodes=function(a,c){var b;b=aa.getNodesInRange(a,function(a){var c=NodeFilter.FILTER_REJECT;a.nodeType===Node.TEXT_NODE?L(a)&&(c=NodeFilter.FILTER_ACCEPT):U(a)&&(c=NodeFilter.FILTER_SKIP);return c},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);c||Q(a,b);return b};this.getTextElements=C;this.getParagraphElements=function(a){var c;c=aa.getNodesInRange(a,function(a){var c=NodeFilter.FILTER_REJECT;if(g(a))c=NodeFilter.FILTER_ACCEPT;
else if(U(a)||q(a))c=NodeFilter.FILTER_SKIP;return c},NodeFilter.SHOW_ELEMENT);V(a.startContainer,c,g);return c};this.getImageElements=function(a){var c;c=aa.getNodesInRange(a,function(a){var c=NodeFilter.FILTER_SKIP;h(a)&&(c=NodeFilter.FILTER_ACCEPT);return c},NodeFilter.SHOW_ELEMENT);V(a.startContainer,c,h);return c};this.getHyperlinkElements=function(a){var c=[],f=a.cloneRange();a.collapsed&&a.endContainer.nodeType===Node.ELEMENT_NODE&&(a=O(a.endContainer,a.endOffset),a.nodeType===Node.TEXT_NODE&&
f.setEnd(a,1));C(f,!0,!1).forEach(function(a){for(a=a.parentNode;!g(a);){if(b(a)&&-1===c.indexOf(a)){c.push(a);break}a=a.parentNode}});f.detach();return c};this.getNormalizedFontFamilyName=function(a){/^(["'])(?:.|[\n\r])*?\1$/.test(a)||(a=a.replace(/^[ \t\r\n\f]*((?:.|[\n\r])*?)[ \t\r\n\f]*$/,"$1"),/[ \t\r\n\f]/.test(a)&&(a="'"+a.replace(/[ \t\r\n\f]+/g," ")+"'"));return a}};odf.OdfUtils=new odf.OdfUtilsImpl;
gui.OdfTextBodyNodeFilter=function(){var h=odf.OdfUtils,l=Node.TEXT_NODE,d=NodeFilter.FILTER_REJECT,b=NodeFilter.FILTER_ACCEPT,g=odf.Namespaces.textns;this.acceptNode=function(m){if(m.nodeType===l){if(!h.isGroupingElement(m.parentNode))return d}else if(m.namespaceURI===g&&"tracked-changes"===m.localName)return d;return b}};xmldom.LSSerializerFilter=function(){};xmldom.LSSerializerFilter.prototype.acceptNode=function(h){};
odf.OdfNodeFilter=function(){this.acceptNode=function(h){return"http://www.w3.org/1999/xhtml"===h.namespaceURI?NodeFilter.FILTER_SKIP:h.namespaceURI&&h.namespaceURI.match(/^urn:webodf:/)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}};xmldom.XPathIterator=function(){};xmldom.XPathIterator.prototype.next=function(){};xmldom.XPathIterator.prototype.reset=function(){};
function createXPathSingleton(){function h(b,a,c){return-1!==b&&(b<a||-1===a)&&(b<c||-1===c)}function l(b){for(var a=[],c=0,k=b.length,f;c<k;){var d=b,n=k,g=a,m,p=[],l=d.indexOf("[",c),r=d.indexOf("/",c),q=d.indexOf("=",c);h(r,l,q)?(m=d.substring(c,r),c=r+1):h(l,r,q)?(m=d.substring(c,l),c=e(d,l,p)):h(q,r,l)?(m=d.substring(c,q),c=q):(m=d.substring(c,n),c=n);g.push({location:m,predicates:p});if(c<k&&"="===b[c]){f=b.substring(c+1,k);if(2<f.length&&("'"===f[0]||'"'===f[0]))f=f.slice(1,f.length-1);else try{f=
parseInt(f,10)}catch(J){}c=k}}return{steps:a,value:f}}function d(){var b=null,a=!1;this.setNode=function(a){b=a};this.reset=function(){a=!1};this.next=function(){var c=a?null:b;a=!0;return c}}function b(b,a,c){this.reset=function(){b.reset()};this.next=function(){for(var k=b.next();k;){k.nodeType===Node.ELEMENT_NODE&&(k=k.getAttributeNodeNS(a,c));if(k)break;k=b.next()}return k}}function g(b,a){var c=b.next(),k=null;this.reset=function(){b.reset();c=b.next();k=null};this.next=function(){for(;c;){if(k)if(a&&
k.firstChild)k=k.firstChild;else{for(;!k.nextSibling&&k!==c;)k=k.parentNode;k===c?c=b.next():k=k.nextSibling}else{do(k=c.firstChild)||(c=b.next());while(c&&!k)}if(k&&k.nodeType===Node.ELEMENT_NODE)return k}return null}}function m(b,a){this.reset=function(){b.reset()};this.next=function(){for(var c=b.next();c&&!a(c);)c=b.next();return c}}function r(b,a,c){a=a.split(":",2);var k=c(a[0]),f=a[1];return new m(b,function(a){return a.localName===f&&a.namespaceURI===k})}function p(b,a,c){var k=new d,f=q(k,
a,c),e=a.value;return void 0===e?new m(b,function(a){k.setNode(a);f.reset();return null!==f.next()}):new m(b,function(a){k.setNode(a);f.reset();return(a=f.next())?a.nodeValue===e:!1})}var q,e;e=function(b,a,c){for(var k=a,f=b.length,d=0;k<f;)"]"===b[k]?(--d,0>=d&&c.push(l(b.substring(a,k)))):"["===b[k]&&(0>=d&&(a=k+1),d+=1),k+=1;return k};q=function(d,a,c){var k,f,e,n;for(k=0;k<a.steps.length;k+=1){e=a.steps[k];f=e.location;if(""===f)d=new g(d,!1);else if("@"===f[0]){f=f.substr(1).split(":",2);n=
c(f[0]);if(!n)throw"No namespace associated with the prefix "+f[0];d=new b(d,n,f[1])}else"."!==f&&(d=new g(d,!1),-1!==f.indexOf(":")&&(d=r(d,f,c)));for(f=0;f<e.predicates.length;f+=1)n=e.predicates[f],d=p(d,n,c)}return d};return{getODFElementsWithXPath:function(b,a,c){var k=b.ownerDocument,f=[];if(k&&"function"===typeof k.evaluate)for(c=k.evaluate(a,b,c,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null),b=c.iterateNext();null!==b;)b.nodeType===Node.ELEMENT_NODE&&f.push(b),b=c.iterateNext();else{f=new d;
f.setNode(b);b=l(a);f=q(f,b,c);b=[];for(c=f.next();c;)b.push(c),c=f.next();f=b}return f}}}xmldom.XPath=createXPathSingleton();
odf.StyleInfo=function(){function h(a,c){var b,f,d,k,e,n=0;if(b=H[a.localName])if(d=b[a.namespaceURI])n=d.length;for(b=0;b<n;b+=1)f=d[b],k=f.ns,e=f.localname,(f=a.getAttributeNS(k,e))&&a.setAttributeNS(k,B[k]+e,c+f);for(d=a.firstElementChild;d;)h(d,c),d=d.nextElementSibling}function l(a,c){var b,f,d,k,e,n=0;if(b=H[a.localName])if(d=b[a.namespaceURI])n=d.length;for(b=0;b<n;b+=1)if(f=d[b],k=f.ns,e=f.localname,f=a.getAttributeNS(k,e))f=f.replace(c,""),a.setAttributeNS(k,B[k]+e,f);for(d=a.firstElementChild;d;)l(d,
c),d=d.nextElementSibling}function d(a,c){var b,f,d,k,e,n=0;if(b=H[a.localName])if(d=b[a.namespaceURI])n=d.length;for(b=0;b<n;b+=1)if(k=d[b],f=k.ns,e=k.localname,f=a.getAttributeNS(f,e))c=c||{},k=k.keyname,c.hasOwnProperty(k)?c[k][f]=1:(e={},e[f]=1,c[k]=e);return c}function b(a,c){var f,k;d(a,c);for(f=a.firstChild;f;)f.nodeType===Node.ELEMENT_NODE&&(k=f,b(k,c)),f=f.nextSibling}function g(a,c,b){this.key=a;this.name=c;this.family=b;this.requires={}}function m(a,c,b){var f=a+'"'+c,d=b[f];d||(d=b[f]=
new g(f,a,c));return d}function r(a,c,b){var f,d,k,e,n,g=0;f=a.getAttributeNS(z,"name");e=a.getAttributeNS(z,"family");f&&e&&(c=m(f,e,b));if(c){if(f=H[a.localName])if(k=f[a.namespaceURI])g=k.length;for(f=0;f<g;f+=1)if(e=k[f],d=e.ns,n=e.localname,d=a.getAttributeNS(d,n))e=e.keyname,e=m(d,e,b),c.requires[e.key]=e}for(a=a.firstElementChild;a;)r(a,c,b),a=a.nextElementSibling;return b}function p(a,c){var b=c[a.family];b||(b=c[a.family]={});b[a.name]=1;Object.keys(a.requires).forEach(function(b){p(a.requires[b],
c)})}function q(a,c){var b=r(a,null,{});Object.keys(b).forEach(function(a){a=b[a];var f=c[a.family];f&&f.hasOwnProperty(a.name)&&p(a,c)})}function e(a,c){function b(c){(c=k.getAttributeNS(z,c))&&(a[c]=!0)}var f=["font-name","font-name-asian","font-name-complex"],d,k;for(d=c&&c.firstElementChild;d;)k=d,f.forEach(b),e(a,k),d=d.nextElementSibling}function n(a,c){function b(a){var b=k.getAttributeNS(z,a);b&&c.hasOwnProperty(b)&&k.setAttributeNS(z,"style:"+a,c[b])}var f=["font-name","font-name-asian",
"font-name-complex"],d,k;for(d=a&&a.firstElementChild;d;)k=d,f.forEach(b),n(k,c),d=d.nextElementSibling}var a=odf.Namespaces.chartns,c=odf.Namespaces.dbns,k=odf.Namespaces.dr3dns,f=odf.Namespaces.drawns,v=odf.Namespaces.formns,u=odf.Namespaces.numberns,x=odf.Namespaces.officens,w=odf.Namespaces.presentationns,z=odf.Namespaces.stylens,y=odf.Namespaces.tablens,t=odf.Namespaces.textns,B={"urn:oasis:names:tc:opendocument:xmlns:chart:1.0":"chart:","urn:oasis:names:tc:opendocument:xmlns:database:1.0":"db:",
"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0":"dr3d:","urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":"draw:","urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":"fo:","urn:oasis:names:tc:opendocument:xmlns:form:1.0":"form:","urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":"number:","urn:oasis:names:tc:opendocument:xmlns:office:1.0":"office:","urn:oasis:names:tc:opendocument:xmlns:presentation:1.0":"presentation:","urn:oasis:names:tc:opendocument:xmlns:style:1.0":"style:","urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0":"svg:",
"urn:oasis:names:tc:opendocument:xmlns:table:1.0":"table:","urn:oasis:names:tc:opendocument:xmlns:text:1.0":"chart:","http://www.w3.org/XML/1998/namespace":"xml:"},J={text:[{ens:z,en:"tab-stop",ans:z,a:"leader-text-style"},{ens:z,en:"drop-cap",ans:z,a:"style-name"},{ens:t,en:"notes-configuration",ans:t,a:"citation-body-style-name"},{ens:t,en:"notes-configuration",ans:t,a:"citation-style-name"},{ens:t,en:"a",ans:t,a:"style-name"},{ens:t,en:"alphabetical-index",ans:t,a:"style-name"},{ens:t,en:"linenumbering-configuration",
ans:t,a:"style-name"},{ens:t,en:"list-level-style-number",ans:t,a:"style-name"},{ens:t,en:"ruby-text",ans:t,a:"style-name"},{ens:t,en:"span",ans:t,a:"style-name"},{ens:t,en:"a",ans:t,a:"visited-style-name"},{ens:z,en:"text-properties",ans:z,a:"text-line-through-text-style"},{ens:t,en:"alphabetical-index-source",ans:t,a:"main-entry-style-name"},{ens:t,en:"index-entry-bibliography",ans:t,a:"style-name"},{ens:t,en:"index-entry-chapter",ans:t,a:"style-name"},{ens:t,en:"index-entry-link-end",ans:t,a:"style-name"},
{ens:t,en:"index-entry-link-start",ans:t,a:"style-name"},{ens:t,en:"index-entry-page-number",ans:t,a:"style-name"},{ens:t,en:"index-entry-span",ans:t,a:"style-name"},{ens:t,en:"index-entry-tab-stop",ans:t,a:"style-name"},{ens:t,en:"index-entry-text",ans:t,a:"style-name"},{ens:t,en:"index-title-template",ans:t,a:"style-name"},{ens:t,en:"list-level-style-bullet",ans:t,a:"style-name"},{ens:t,en:"outline-level-style",ans:t,a:"style-name"}],paragraph:[{ens:f,en:"caption",ans:f,a:"text-style-name"},{ens:f,
en:"circle",ans:f,a:"text-style-name"},{ens:f,en:"connector",ans:f,a:"text-style-name"},{ens:f,en:"control",ans:f,a:"text-style-name"},{ens:f,en:"custom-shape",ans:f,a:"text-style-name"},{ens:f,en:"ellipse",ans:f,a:"text-style-name"},{ens:f,en:"frame",ans:f,a:"text-style-name"},{ens:f,en:"line",ans:f,a:"text-style-name"},{ens:f,en:"measure",ans:f,a:"text-style-name"},{ens:f,en:"path",ans:f,a:"text-style-name"},{ens:f,en:"polygon",ans:f,a:"text-style-name"},{ens:f,en:"polyline",ans:f,a:"text-style-name"},
{ens:f,en:"rect",ans:f,a:"text-style-name"},{ens:f,en:"regular-polygon",ans:f,a:"text-style-name"},{ens:x,en:"annotation",ans:f,a:"text-style-name"},{ens:v,en:"column",ans:v,a:"text-style-name"},{ens:z,en:"style",ans:z,a:"next-style-name"},{ens:y,en:"body",ans:y,a:"paragraph-style-name"},{ens:y,en:"even-columns",ans:y,a:"paragraph-style-name"},{ens:y,en:"even-rows",ans:y,a:"paragraph-style-name"},{ens:y,en:"first-column",ans:y,a:"paragraph-style-name"},{ens:y,en:"first-row",ans:y,a:"paragraph-style-name"},
{ens:y,en:"last-column",ans:y,a:"paragraph-style-name"},{ens:y,en:"last-row",ans:y,a:"paragraph-style-name"},{ens:y,en:"odd-columns",ans:y,a:"paragraph-style-name"},{ens:y,en:"odd-rows",ans:y,a:"paragraph-style-name"},{ens:t,en:"notes-configuration",ans:t,a:"default-style-name"},{ens:t,en:"alphabetical-index-entry-template",ans:t,a:"style-name"},{ens:t,en:"bibliography-entry-template",ans:t,a:"style-name"},{ens:t,en:"h",ans:t,a:"style-name"},{ens:t,en:"illustration-index-entry-template",ans:t,a:"style-name"},
{ens:t,en:"index-source-style",ans:t,a:"style-name"},{ens:t,en:"object-index-entry-template",ans:t,a:"style-name"},{ens:t,en:"p",ans:t,a:"style-name"},{ens:t,en:"table-index-entry-template",ans:t,a:"style-name"},{ens:t,en:"table-of-content-entry-template",ans:t,a:"style-name"},{ens:t,en:"table-index-entry-template",ans:t,a:"style-name"},{ens:t,en:"user-index-entry-template",ans:t,a:"style-name"},{ens:z,en:"page-layout-properties",ans:z,a:"register-truth-ref-style-name"}],chart:[{ens:a,en:"axis",ans:a,
a:"style-name"},{ens:a,en:"chart",ans:a,a:"style-name"},{ens:a,en:"data-label",ans:a,a:"style-name"},{ens:a,en:"data-point",ans:a,a:"style-name"},{ens:a,en:"equation",ans:a,a:"style-name"},{ens:a,en:"error-indicator",ans:a,a:"style-name"},{ens:a,en:"floor",ans:a,a:"style-name"},{ens:a,en:"footer",ans:a,a:"style-name"},{ens:a,en:"grid",ans:a,a:"style-name"},{ens:a,en:"legend",ans:a,a:"style-name"},{ens:a,en:"mean-value",ans:a,a:"style-name"},{ens:a,en:"plot-area",ans:a,a:"style-name"},{ens:a,en:"regression-curve",
ans:a,a:"style-name"},{ens:a,en:"series",ans:a,a:"style-name"},{ens:a,en:"stock-gain-marker",ans:a,a:"style-name"},{ens:a,en:"stock-loss-marker",ans:a,a:"style-name"},{ens:a,en:"stock-range-line",ans:a,a:"style-name"},{ens:a,en:"subtitle",ans:a,a:"style-name"},{ens:a,en:"title",ans:a,a:"style-name"},{ens:a,en:"wall",ans:a,a:"style-name"}],section:[{ens:t,en:"alphabetical-index",ans:t,a:"style-name"},{ens:t,en:"bibliography",ans:t,a:"style-name"},{ens:t,en:"illustration-index",ans:t,a:"style-name"},
{ens:t,en:"index-title",ans:t,a:"style-name"},{ens:t,en:"object-index",ans:t,a:"style-name"},{ens:t,en:"section",ans:t,a:"style-name"},{ens:t,en:"table-of-content",ans:t,a:"style-name"},{ens:t,en:"table-index",ans:t,a:"style-name"},{ens:t,en:"user-index",ans:t,a:"style-name"}],ruby:[{ens:t,en:"ruby",ans:t,a:"style-name"}],table:[{ens:c,en:"query",ans:c,a:"style-name"},{ens:c,en:"table-representation",ans:c,a:"style-name"},{ens:y,en:"background",ans:y,a:"style-name"},{ens:y,en:"table",ans:y,a:"style-name"}],
"table-column":[{ens:c,en:"column",ans:c,a:"style-name"},{ens:y,en:"table-column",ans:y,a:"style-name"}],"table-row":[{ens:c,en:"query",ans:c,a:"default-row-style-name"},{ens:c,en:"table-representation",ans:c,a:"default-row-style-name"},{ens:y,en:"table-row",ans:y,a:"style-name"}],"table-cell":[{ens:c,en:"column",ans:c,a:"default-cell-style-name"},{ens:y,en:"table-column",ans:y,a:"default-cell-style-name"},{ens:y,en:"table-row",ans:y,a:"default-cell-style-name"},{ens:y,en:"body",ans:y,a:"style-name"},
{ens:y,en:"covered-table-cell",ans:y,a:"style-name"},{ens:y,en:"even-columns",ans:y,a:"style-name"},{ens:y,en:"covered-table-cell",ans:y,a:"style-name"},{ens:y,en:"even-columns",ans:y,a:"style-name"},{ens:y,en:"even-rows",ans:y,a:"style-name"},{ens:y,en:"first-column",ans:y,a:"style-name"},{ens:y,en:"first-row",ans:y,a:"style-name"},{ens:y,en:"last-column",ans:y,a:"style-name"},{ens:y,en:"last-row",ans:y,a:"style-name"},{ens:y,en:"odd-columns",ans:y,a:"style-name"},{ens:y,en:"odd-rows",ans:y,a:"style-name"},
{ens:y,en:"table-cell",ans:y,a:"style-name"}],graphic:[{ens:k,en:"cube",ans:f,a:"style-name"},{ens:k,en:"extrude",ans:f,a:"style-name"},{ens:k,en:"rotate",ans:f,a:"style-name"},{ens:k,en:"scene",ans:f,a:"style-name"},{ens:k,en:"sphere",ans:f,a:"style-name"},{ens:f,en:"caption",ans:f,a:"style-name"},{ens:f,en:"circle",ans:f,a:"style-name"},{ens:f,en:"connector",ans:f,a:"style-name"},{ens:f,en:"control",ans:f,a:"style-name"},{ens:f,en:"custom-shape",ans:f,a:"style-name"},{ens:f,en:"ellipse",ans:f,a:"style-name"},
{ens:f,en:"frame",ans:f,a:"style-name"},{ens:f,en:"g",ans:f,a:"style-name"},{ens:f,en:"line",ans:f,a:"style-name"},{ens:f,en:"measure",ans:f,a:"style-name"},{ens:f,en:"page-thumbnail",ans:f,a:"style-name"},{ens:f,en:"path",ans:f,a:"style-name"},{ens:f,en:"polygon",ans:f,a:"style-name"},{ens:f,en:"polyline",ans:f,a:"style-name"},{ens:f,en:"rect",ans:f,a:"style-name"},{ens:f,en:"regular-polygon",ans:f,a:"style-name"},{ens:x,en:"annotation",ans:f,a:"style-name"}],presentation:[{ens:k,en:"cube",ans:w,
a:"style-name"},{ens:k,en:"extrude",ans:w,a:"style-name"},{ens:k,en:"rotate",ans:w,a:"style-name"},{ens:k,en:"scene",ans:w,a:"style-name"},{ens:k,en:"sphere",ans:w,a:"style-name"},{ens:f,en:"caption",ans:w,a:"style-name"},{ens:f,en:"circle",ans:w,a:"style-name"},{ens:f,en:"connector",ans:w,a:"style-name"},{ens:f,en:"control",ans:w,a:"style-name"},{ens:f,en:"custom-shape",ans:w,a:"style-name"},{ens:f,en:"ellipse",ans:w,a:"style-name"},{ens:f,en:"frame",ans:w,a:"style-name"},{ens:f,en:"g",ans:w,a:"style-name"},
{ens:f,en:"line",ans:w,a:"style-name"},{ens:f,en:"measure",ans:w,a:"style-name"},{ens:f,en:"page-thumbnail",ans:w,a:"style-name"},{ens:f,en:"path",ans:w,a:"style-name"},{ens:f,en:"polygon",ans:w,a:"style-name"},{ens:f,en:"polyline",ans:w,a:"style-name"},{ens:f,en:"rect",ans:w,a:"style-name"},{ens:f,en:"regular-polygon",ans:w,a:"style-name"},{ens:x,en:"annotation",ans:w,a:"style-name"}],"drawing-page":[{ens:f,en:"page",ans:f,a:"style-name"},{ens:w,en:"notes",ans:f,a:"style-name"},{ens:z,en:"handout-master",
ans:f,a:"style-name"},{ens:z,en:"master-page",ans:f,a:"style-name"}],"list-style":[{ens:t,en:"list",ans:t,a:"style-name"},{ens:t,en:"numbered-paragraph",ans:t,a:"style-name"},{ens:t,en:"list-item",ans:t,a:"style-override"},{ens:z,en:"style",ans:z,a:"list-style-name"}],data:[{ens:z,en:"style",ans:z,a:"data-style-name"},{ens:z,en:"style",ans:z,a:"percentage-data-style-name"},{ens:w,en:"date-time-decl",ans:z,a:"data-style-name"},{ens:t,en:"creation-date",ans:z,a:"data-style-name"},{ens:t,en:"creation-time",
ans:z,a:"data-style-name"},{ens:t,en:"database-display",ans:z,a:"data-style-name"},{ens:t,en:"date",ans:z,a:"data-style-name"},{ens:t,en:"editing-duration",ans:z,a:"data-style-name"},{ens:t,en:"expression",ans:z,a:"data-style-name"},{ens:t,en:"meta-field",ans:z,a:"data-style-name"},{ens:t,en:"modification-date",ans:z,a:"data-style-name"},{ens:t,en:"modification-time",ans:z,a:"data-style-name"},{ens:t,en:"print-date",ans:z,a:"data-style-name"},{ens:t,en:"print-time",ans:z,a:"data-style-name"},{ens:t,
en:"table-formula",ans:z,a:"data-style-name"},{ens:t,en:"time",ans:z,a:"data-style-name"},{ens:t,en:"user-defined",ans:z,a:"data-style-name"},{ens:t,en:"user-field-get",ans:z,a:"data-style-name"},{ens:t,en:"user-field-input",ans:z,a:"data-style-name"},{ens:t,en:"variable-get",ans:z,a:"data-style-name"},{ens:t,en:"variable-input",ans:z,a:"data-style-name"},{ens:t,en:"variable-set",ans:z,a:"data-style-name"}],"page-layout":[{ens:w,en:"notes",ans:z,a:"page-layout-name"},{ens:z,en:"handout-master",ans:z,
a:"page-layout-name"},{ens:z,en:"master-page",ans:z,a:"page-layout-name"}]},H,K=xmldom.XPath;this.collectUsedFontFaces=e;this.changeFontFaceNames=n;this.UsedStyleList=function(a,c){var d={};this.uses=function(a){var c=a.localName,b=a.getAttributeNS(f,"name")||a.getAttributeNS(z,"name");a="style"===c?a.getAttributeNS(z,"family"):a.namespaceURI===u?"data":c;return(a=d[a])?0<a[b]:!1};b(a,d);c&&q(c,d)};this.getStyleName=function(a,c){var b,f,d=H[c.localName];if(d&&(d=d[c.namespaceURI]))for(f=0;f<d.length;f+=
1)if(d[f].keyname===a&&(d=d[f],c.hasAttributeNS(d.ns,d.localname))){b=c.getAttributeNS(d.ns,d.localname);break}return b};this.hasDerivedStyles=function(a,c,b){var f=b.getAttributeNS(z,"name");b=b.getAttributeNS(z,"family");return K.getODFElementsWithXPath(a,'//style:*[@style:parent-style-name="'+f+'"][@style:family="'+b+'"]',c).length?!0:!1};this.prefixStyleNames=function(a,c,b){var d;if(a){for(d=a.firstChild;d;){if(d.nodeType===Node.ELEMENT_NODE){var k=d,e=c,n=k.getAttributeNS(f,"name"),g=void 0;
n?g=f:(n=k.getAttributeNS(z,"name"))&&(g=z);g&&k.setAttributeNS(g,B[g]+"name",e+n)}d=d.nextSibling}h(a,c);b&&h(b,c)}};this.removePrefixFromStyleNames=function(a,c,b){var d=new RegExp("^"+c);if(a){for(c=a.firstChild;c;){if(c.nodeType===Node.ELEMENT_NODE){var k=c,e=d,n=k.getAttributeNS(f,"name"),g=void 0;n?g=f:(n=k.getAttributeNS(z,"name"))&&(g=z);g&&(n=n.replace(e,""),k.setAttributeNS(g,B[g]+"name",n))}c=c.nextSibling}l(a,d);b&&l(b,d)}};this.determineStylesForNode=d;H=function(){var a,c,b,f,d,k={},
e,n,g,m;for(b in J)if(J.hasOwnProperty(b))for(f=J[b],c=f.length,a=0;a<c;a+=1)d=f[a],g=d.en,m=d.ens,k.hasOwnProperty(g)?e=k[g]:k[g]=e={},e.hasOwnProperty(m)?n=e[m]:e[m]=n=[],n.push({ns:d.ans,localname:d.a,keyname:b});return k}()};
function makeBase64(){function h(a){var c,b=a.length,f=new Uint8Array(new ArrayBuffer(b));for(c=0;c<b;c+=1)f[c]=a.charCodeAt(c)&255;return f}function l(a){var c,b="",f,d=a.length-2;for(f=0;f<d;f+=3)c=a[f]<<16|a[f+1]<<8|a[f+2],b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>18],b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>12&63],b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>6&63],b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c&
63];f===d+1?(c=a[f]<<4,b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>6],b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c&63],b+="=="):f===d&&(c=a[f]<<10|a[f+1]<<2,b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>12],b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>>6&63],b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c&63],b+="=");return b}function d(a){a=a.replace(/[^A-Za-z0-9+\/]+/g,
"");var c=a.length,b=new Uint8Array(new ArrayBuffer(3*c)),d=a.length%4,k=0,e,n;for(e=0;e<c;e+=4)n=(f[a.charAt(e)]||0)<<18|(f[a.charAt(e+1)]||0)<<12|(f[a.charAt(e+2)]||0)<<6|(f[a.charAt(e+3)]||0),b[k]=n>>16,b[k+1]=n>>8&255,b[k+2]=n&255,k+=3;c=3*c-[0,0,2,1][d];return b.subarray(0,c)}function b(a){var c,b,f=a.length,d=0,k=new Uint8Array(new ArrayBuffer(3*f));for(c=0;c<f;c+=1)b=a[c],128>b?k[d++]=b:(2048>b?k[d++]=192|b>>>6:(k[d++]=224|b>>>12&15,k[d++]=128|b>>>6&63),k[d++]=128|b&63);return k.subarray(0,
d)}function g(a){var c,b,f,d,k=a.length,e=new Uint8Array(new ArrayBuffer(k)),n=0;for(c=0;c<k;c+=1)b=a[c],128>b?e[n++]=b:(c+=1,f=a[c],224>b?e[n++]=(b&31)<<6|f&63:(c+=1,d=a[c],e[n++]=(b&15)<<12|(f&63)<<6|d&63));return e.subarray(0,n)}function m(a){return l(h(a))}function r(a){return String.fromCharCode.apply(String,d(a))}function p(a){return g(h(a))}function q(a){a=g(a);for(var c="",b=0;b<a.length;)c+=String.fromCharCode.apply(String,a.subarray(b,b+45E3)),b+=45E3;return c}function e(a,c,b){var f,d,
k,e="";for(k=c;k<b;k+=1)c=a.charCodeAt(k)&255,128>c?e+=String.fromCharCode(c):(k+=1,f=a.charCodeAt(k)&255,224>c?e+=String.fromCharCode((c&31)<<6|f&63):(k+=1,d=a.charCodeAt(k)&255,e+=String.fromCharCode((c&15)<<12|(f&63)<<6|d&63)));return e}function n(a,c){function b(){var k=d+1E5;k>a.length&&(k=a.length);f+=e(a,d,k);d=k;k=d===a.length;c(f,k)&&!k&&runtime.setTimeout(b,0)}var f="",d=0;1E5>a.length?c(e(a,0,a.length),!0):("string"!==typeof a&&(a=a.slice()),b())}function a(a){return b(h(a))}function c(a){return String.fromCharCode.apply(String,
b(a))}function k(a){return String.fromCharCode.apply(String,b(h(a)))}var f=function(a){var c={},b,f;b=0;for(f=a.length;b<f;b+=1)c[a.charAt(b)]=b;return c}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),v,u,x=runtime.getWindow(),w,z;x&&x.btoa?(w=x.btoa,v=function(a){return w(k(a))}):(w=m,v=function(c){return l(a(c))});x&&x.atob?(z=x.atob,u=function(a){a=z(a);return e(a,0,a.length)}):(z=r,u=function(a){return q(d(a))});webodfcore.Base64=function(){this.convertByteArrayToBase64=
this.convertUTF8ArrayToBase64=l;this.convertBase64ToByteArray=this.convertBase64ToUTF8Array=d;this.convertUTF16ArrayToByteArray=this.convertUTF16ArrayToUTF8Array=b;this.convertByteArrayToUTF16Array=this.convertUTF8ArrayToUTF16Array=g;this.convertUTF8StringToBase64=m;this.convertBase64ToUTF8String=r;this.convertUTF8StringToUTF16Array=p;this.convertByteArrayToUTF16String=this.convertUTF8ArrayToUTF16String=q;this.convertUTF8StringToUTF16String=n;this.convertUTF16StringToByteArray=this.convertUTF16StringToUTF8Array=
a;this.convertUTF16ArrayToUTF8String=c;this.convertUTF16StringToUTF8String=k;this.convertUTF16StringToBase64=v;this.convertBase64ToUTF16String=u;this.fromBase64=r;this.toBase64=m;this.atob=z;this.btoa=w;this.utob=k;this.btou=n;this.encode=v;this.encodeURI=function(a){return v(a).replace(/[+\/]/g,function(a){return"+"===a?"-":"_"}).replace(/\\=+$/,"")};this.decode=function(a){return u(a.replace(/[\-_]/g,function(a){return"-"===a?"+":"/"}))};return this};return webodfcore.Base64}webodfcore.Base64=makeBase64();
webodfcore.Zip=function(h,l){function d(b,d){var a=p.file(b);a?d(null,a.asUint8Array()):d(b+" not found.",null)}function b(b,n){d(b,function(a,c){if(a||null===c)return n(a,null);var b=runtime.byteArrayToString(c,"utf8");n(null,b)})}function g(b,d){try{b(p.generate({type:"uint8array",compression:"STORE"}))}catch(a){d(a.message)}}function m(b,d){g(function(a){runtime.writeFile(b,a,d)},d)}var r=this,p,q=new webodfcore.Base64;this.load=d;this.save=function(b,d,a,c){p.file(b,d,{date:c,compression:a?"DEFLATE":
"STORE"})};this.remove=function(b){var d=null!==p.file(b);p.remove(b);return d};this.write=function(b){m(h,b)};this.writeAs=m;this.createByteArray=g;this.loadContentXmlAsFragments=function(d,n){b(d,function(a,c){if(a)return n.rootElementReady(a);n.rootElementReady(null,c,!0)})};this.loadAsString=b;this.loadAsDOM=function(d,n){b(d,function(a,c){if(a||null===c)n(a,null);else{var b=(new DOMParser).parseFromString(c,"text/xml");n(null,b)}})};this.loadAsDataURL=function(b,n,a){d(b,function(c,b){if(c||
!b)return a(c,null);var f=0,d;n||(n=80===b[1]&&78===b[2]&&71===b[3]?"image/png":255===b[0]&&216===b[1]&&255===b[2]?"image/jpeg":71===b[0]&&73===b[1]&&70===b[2]?"image/gif":"");for(d="data:"+n+";base64,";f<b.length;)d+=q.convertUTF8ArrayToBase64(b.subarray(f,Math.min(f+45E3,b.length))),f+=45E3;a(null,d)})};this.getEntries=function(){return Object.keys(p.files).map(function(b){return{filename:b,date:p.files[b].date}})};p=new externs.JSZip;null!==l&&runtime.readFile(h,"binary",function(b,d){"string"===
typeof d&&(b="file was read as a string. Should be Uint8Array.");if(b||!d||0===d.length)l("File '"+h+"' cannot be read. Err: "+(b||"[none]"),r);else try{p.load(d,{checkCRC32:!1}),l(null,r)}catch(a){l(a.message,r)}})};"function"!==typeof Object.create&&(Object.create=function(h){var l=function(){};l.prototype=h;return new l});
xmldom.LSSerializer=function(){function h(b){var d=b||{},g=function(b){var a={},c;for(c in b)b.hasOwnProperty(c)&&(a[b[c]]=c);return a}(b),h=[d],l=[g],e=0;this.push=function(){e+=1;d=h[e]=Object.create(d);g=l[e]=Object.create(g)};this.pop=function(){h.pop();l.pop();--e;d=h[e];g=l[e]};this.getLocalNamespaceDefinitions=function(){return g};this.getQName=function(b){var a=b.namespaceURI,c=0,k;if(!a)return b.localName;if(k=g[a])return k+":"+b.localName;do{k||!b.prefix?(k="ns"+c,c+=1):k=b.prefix;if(d[k]===
a)break;if(!d[k]){d[k]=a;g[a]=k;break}k=null}while(null===k);return k+":"+b.localName}}function l(b){return b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}function d(g,m){var h="",p=b.filter?b.filter.acceptNode(m):NodeFilter.FILTER_ACCEPT,q;if(p===NodeFilter.FILTER_ACCEPT&&m.nodeType===Node.ELEMENT_NODE){g.push();q=g.getQName(m);var e,n=m.attributes,a,c,k,f="",v;e="<"+q;a=n.length;for(c=0;c<a;c+=1)k=n.item(c),"http://www.w3.org/2000/xmlns/"!==
k.namespaceURI&&(v=b.filter?b.filter.acceptNode(k):NodeFilter.FILTER_ACCEPT,v===NodeFilter.FILTER_ACCEPT&&(v=g.getQName(k),k="string"===typeof k.value?l(k.value):k.value,f+=" "+(v+'="'+k+'"')));a=g.getLocalNamespaceDefinitions();for(c in a)a.hasOwnProperty(c)&&((n=a[c])?"xmlns"!==n&&(e+=" xmlns:"+a[c]+'="'+c+'"'):e+=' xmlns="'+c+'"');h+=e+(f+">")}if(p===NodeFilter.FILTER_ACCEPT||p===NodeFilter.FILTER_SKIP){for(p=m.firstChild;p;)h+=d(g,p),p=p.nextSibling;m.nodeValue&&(h+=l(m.nodeValue))}q&&(h+="</"+
q+">",g.pop());return h}var b=this;this.filter=null;this.writeToString=function(b,m){if(!b)return"";var g=new h(m);return d(g,b)}};
(function(){function h(b){var a,c=p.length;for(a=0;a<c;a+=1)if("urn:oasis:names:tc:opendocument:xmlns:office:1.0"===b.namespaceURI&&b.localName===p[a])return a;return-1}function l(b,a){var c=new g.UsedStyleList(b,a),d=new odf.OdfNodeFilter;this.acceptNode=function(b){var f=d.acceptNode(b);f===NodeFilter.FILTER_ACCEPT&&b.parentNode===a&&b.nodeType===Node.ELEMENT_NODE&&(f=c.uses(b)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);return f}}function d(b,a){var c=new l(b,a);this.acceptNode=function(a){var b=
c.acceptNode(a);b!==NodeFilter.FILTER_ACCEPT||!a.parentNode||a.parentNode.namespaceURI!==odf.Namespaces.textns||"s"!==a.parentNode.localName&&"tab"!==a.parentNode.localName||(b=NodeFilter.FILTER_REJECT);return b}}function b(b,a){if(a){var c=h(a),d,f=b.firstChild;if(-1!==c){for(;f;){d=h(f);if(-1!==d&&d>c)break;f=f.nextSibling}b.insertBefore(a,f)}}}var g=new odf.StyleInfo,m=webodfcore.DomUtils,r=odf.Namespaces.stylens,p="meta settings scripts font-face-decls styles automatic-styles master-styles body".split(" "),
q=Date.now()+"_webodf_",e=new webodfcore.Base64;odf.ODFElement=function(){};odf.ODFDocumentElement=function(){};odf.ODFDocumentElement.prototype=new odf.ODFElement;odf.ODFDocumentElement.prototype.constructor=odf.ODFDocumentElement;odf.ODFDocumentElement.prototype.fontFaceDecls=null;odf.ODFDocumentElement.prototype.manifest=null;odf.ODFDocumentElement.prototype.settings=null;odf.ODFDocumentElement.namespaceURI="urn:oasis:names:tc:opendocument:xmlns:office:1.0";odf.ODFDocumentElement.localName="document";
odf.AnnotationElement=function(){};odf.OdfPart=function(b,a,c,d){var f=this;this.size=0;this.type=null;this.name=b;this.container=c;this.url=null;this.mimetype=a;this.onstatereadychange=this.document=null;this.EMPTY=0;this.LOADING=1;this.DONE=2;this.state=this.EMPTY;this.data="";this.load=function(){null!==d&&(this.mimetype=a,d.loadAsDataURL(b,a,function(a,c){a&&runtime.log(a);f.url=c;if(f.onchange)f.onchange(f);if(f.onstatereadychange)f.onstatereadychange(f)}))}};odf.OdfPart.prototype.load=function(){};
odf.OdfPart.prototype.getUrl=function(){return this.data?"data:;base64,"+e.toBase64(this.data):null};odf.OdfContainer=function a(c,k){function f(a){for(var c=a.firstChild,b;c;)b=c.nextSibling,c.nodeType===Node.ELEMENT_NODE?f(c):c.nodeType===Node.PROCESSING_INSTRUCTION_NODE&&a.removeChild(c),c=b}function h(a){var c={},b,d,f=a.ownerDocument.createNodeIterator(a,NodeFilter.SHOW_ELEMENT,null,!1);for(a=f.nextNode();a;)"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&("annotation"===
a.localName?(b=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))&&(c.hasOwnProperty(b)?runtime.log("Warning: annotation name used more than once with <office:annotation/>: '"+b+"'"):c[b]=a):"annotation-end"===a.localName&&((b=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))?c.hasOwnProperty(b)?(d=c[b],d.annotationEndElement?runtime.log("Warning: annotation name used more than once with <office:annotation-end/>: '"+b+"'"):d.annotationEndElement=
a):runtime.log("Warning: annotation end without an annotation start, name: '"+b+"'"):runtime.log("Warning: annotation end without a name found"))),a=f.nextNode()}function p(a,c){for(var b=a&&a.firstChild;b;)b.nodeType===Node.ELEMENT_NODE&&b.setAttributeNS("urn:webodf:names:scope","scope",c),b=b.nextSibling}function x(a,c){for(var b=D.rootElement.meta,b=b&&b.firstChild;b&&(b.namespaceURI!==a||b.localName!==c);)b=b.nextSibling;for(b=b&&b.firstChild;b&&b.nodeType!==Node.TEXT_NODE;)b=b.nextSibling;return b?
b.data:null}function w(a){var c={},b;for(a=a.firstChild;a;)a.nodeType===Node.ELEMENT_NODE&&a.namespaceURI===r&&"font-face"===a.localName&&(b=a.getAttributeNS(r,"name"),c[b]=a),a=a.nextSibling;return c}function z(a,c){var b=null,d,f,k;if(a)for(b=a.cloneNode(!0),d=b.firstElementChild;d;)f=d.nextElementSibling,(k=d.getAttributeNS("urn:webodf:names:scope","scope"))&&k!==c&&b.removeChild(d),d=f;return b}function y(a,c){var b,d,f,k=null,e={};if(a)for(c.forEach(function(a){g.collectUsedFontFaces(e,a)}),
k=a.cloneNode(!0),b=k.firstElementChild;b;)d=b.nextElementSibling,f=b.getAttributeNS(r,"name"),e[f]||k.removeChild(b),b=d;return k}function t(a){var c=D.rootElement.ownerDocument,b;if(a){f(a.documentElement);try{b=c.importNode(a.documentElement,!0)}catch(da){}}return b}function B(a){D.state=a;if(D.onchange)D.onchange(D);if(D.onstatereadychange)D.onstatereadychange(D)}function J(a){P=null;D.rootElement=a;a.fontFaceDecls=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");
a.styles=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles");a.automaticStyles=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");a.masterStyles=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles");a.body=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");a.meta=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta");a.settings=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"settings");a.scripts=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","scripts");h(a)}function H(c){var d=t(c),f=D.rootElement,k;d&&"document-styles"===d.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===d.namespaceURI?(f.fontFaceDecls=m.getDirectChild(d,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),b(f,f.fontFaceDecls),k=m.getDirectChild(d,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),f.styles=k||c.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"styles"),b(f,f.styles),k=m.getDirectChild(d,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),f.automaticStyles=k||c.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),p(f.automaticStyles,"document-styles"),b(f,f.automaticStyles),d=m.getDirectChild(d,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),f.masterStyles=d||c.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),b(f,f.masterStyles),
g.prefixStyleNames(f.automaticStyles,q,f.masterStyles)):B(a.INVALID)}function K(c){c=t(c);var d,f,k,e;if(c&&"document-content"===c.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===c.namespaceURI){d=D.rootElement;k=m.getDirectChild(c,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");if(d.fontFaceDecls&&k){e=d.fontFaceDecls;var h,l,Q,q,C={};f=w(e);q=w(k);for(k=k.firstElementChild;k;){h=k.nextElementSibling;if(k.namespaceURI===r&&"font-face"===k.localName)if(l=k.getAttributeNS(r,
"name"),f.hasOwnProperty(l)){if(!k.isEqualNode(f[l])){Q=l;var v=f,U=q,x=0,u;for(u=Q=Q.replace(/\d+$/,"");v.hasOwnProperty(u)||U.hasOwnProperty(u);)x+=1,u=Q+x;Q=u;k.setAttributeNS(r,"style:name",Q);e.appendChild(k);f[Q]=k;delete q[l];C[l]=Q}}else e.appendChild(k),f[l]=k,delete q[l];k=h}e=C}else k&&(d.fontFaceDecls=k,b(d,k));f=m.getDirectChild(c,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");p(f,"document-content");e&&g.changeFontFaceNames(f,e);if(d.automaticStyles&&f)for(e=
f.firstChild;e;)d.automaticStyles.appendChild(e),e=f.firstChild;else f&&(d.automaticStyles=f,b(d,f));c=m.getDirectChild(c,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");if(null===c)throw"<office:body/> tag is mising.";d.body=c;b(d,d.body)}else B(a.INVALID)}function U(a){a=t(a);var c;a&&"document-meta"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&(c=D.rootElement,c.meta=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),
b(c,c.meta))}function L(a){a=t(a);var c;a&&"document-settings"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&(c=D.rootElement,c.settings=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),b(c,c.settings))}function Q(a){a=t(a);var c;if(a&&"manifest"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===a.namespaceURI)for(c=D.rootElement,c.manifest=a,a=c.manifest.firstElementChild;a;)"file-entry"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===
a.namespaceURI&&(W[a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","full-path")]=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","media-type")),a=a.nextElementSibling}function C(a,c,b){a=m.getElementsByTagName(a,c);var d;for(d=0;d<a.length;d+=1)c=a[d],b.hasOwnProperty(c.namespaceURI)||c.parentNode.removeChild(c)}function V(a){C(a,"script",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:office:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:table:1.0":!0,
"urn:oasis:names:tc:opendocument:xmlns:text:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":!0});C(a,"style",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:style:1.0":!0})}function O(a){var c=a.firstElementChild,b=[],d,f,k,e=a.attributes,g=e.length;for(d=0;d<g;d+=1)k=e.item(d),f=k.localName.substr(0,2).toLowerCase(),null===k.namespaceURI&&"on"===f&&b.push(k);g=b.length;for(d=
0;d<g;d+=1)a.removeAttributeNode(b[d]);for(;c;)O(c),c=c.nextElementSibling}function M(c){var b=c.shift();b?Y.loadAsDOM(b.path,function(d,f){f&&(V(f),O(f.documentElement));b.handler(f);D.state===a.INVALID?d?runtime.log("ERROR: Unable to load "+b.path+" - "+d):runtime.log("ERROR: Unable to load "+b.path):(d&&runtime.log("DEBUG: Unable to load "+b.path+" - "+d),M(c))}):(h(D.rootElement),B(a.DONE))}function T(a){var c="";odf.Namespaces.forEachPrefix(function(a,b){c+=" xmlns:"+a+'="'+b+'"'});return'<?xml version="1.0" encoding="UTF-8"?><office:'+
a+" "+c+' office:version="1.2">'}function F(){var a=new xmldom.LSSerializer,c=T("document-meta");a.filter=new odf.OdfNodeFilter;c+=a.writeToString(D.rootElement.meta,odf.Namespaces.namespaceMap);return c+"</office:document-meta>"}function aa(a,c){var b=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:file-entry");b.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:full-path",a);b.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0",
"manifest:media-type",c);return b}function N(){var a=runtime.parseXML('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2"></manifest:manifest>'),c=a.documentElement,b=new xmldom.LSSerializer,d;for(d in W)W.hasOwnProperty(d)&&c.appendChild(aa(d,W[d]));b.filter=new odf.OdfNodeFilter;return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+b.writeToString(a,odf.Namespaces.namespaceMap)}function ea(){var a,c,b,d=odf.Namespaces.namespaceMap,
f=new xmldom.LSSerializer,k=T("document-styles");c=z(D.rootElement.automaticStyles,"document-styles");b=D.rootElement.masterStyles.cloneNode(!0);a=y(D.rootElement.fontFaceDecls,[b,D.rootElement.styles,c]);g.removePrefixFromStyleNames(c,q,b);f.filter=new l(b,c);k+=f.writeToString(a,d);k+=f.writeToString(D.rootElement.styles,d);k+=f.writeToString(c,d);k+=f.writeToString(b,d);return k+"</office:document-styles>"}function ba(){var a,c,b=odf.Namespaces.namespaceMap,f=new xmldom.LSSerializer,k=T("document-content");
c=z(D.rootElement.automaticStyles,"document-content");a=y(D.rootElement.fontFaceDecls,[c]);f.filter=new d(D.rootElement.body,c);k+=f.writeToString(a,b);k+=f.writeToString(c,b);k+=f.writeToString(D.rootElement.body,b);return k+"</office:document-content>"}function A(c,b){runtime.loadXML(c,function(c,d){if(c)b(c);else if(d){V(d);O(d.documentElement);var f=t(d);f&&"document"===f.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===f.namespaceURI?(J(f),B(a.DONE)):B(a.INVALID)}else b("No DOM was loaded.")})}
function X(a,c){var d;d=D.rootElement;var f=d.meta;f||(d.meta=f=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),b(d,f));d=f;a&&m.mapKeyValObjOntoNode(d,a,odf.Namespaces.lookupNamespaceURI);c&&m.removeKeyElementsFromNode(d,c,odf.Namespaces.lookupNamespaceURI)}function ca(c,b){function d(a,c){var b;c||(c=a);b=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",c);g[a]=b;g.appendChild(b)}var f=new webodfcore.Zip("",null),k="application/vnd.oasis.opendocument."+
c+(!0===b?"-template":""),e=runtime.byteArrayFromString(k,"utf8"),g=D.rootElement,h=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",c);f.save("mimetype",e,!1,new Date);d("meta");d("settings");d("scripts");d("fontFaceDecls","font-face-decls");d("styles");d("automaticStyles","automatic-styles");d("masterStyles","master-styles");d("body");g.body.appendChild(h);W["/"]=k;W["settings.xml"]="text/xml";W["meta.xml"]="text/xml";W["styles.xml"]="text/xml";W["content.xml"]="text/xml";
B(a.DONE);return f}function S(){var a,c=new Date;if(W["settings.xml"]){a=new xmldom.LSSerializer;var b=T("document-settings");D.rootElement.settings&&D.rootElement.settings.firstElementChild&&(a.filter=new odf.OdfNodeFilter,b+=a.writeToString(D.rootElement.settings,odf.Namespaces.namespaceMap));a=runtime.byteArrayFromString(b+"</office:document-settings>","utf8");Y.save("settings.xml",a,!0,c)}else Y.remove("settings.xml");b=runtime.getWindow();a="WebODF/"+webodf.Version;b&&(a=a+" "+b.navigator.userAgent);
X({"meta:generator":a},null);a=runtime.byteArrayFromString(F(),"utf8");Y.save("meta.xml",a,!0,c);a=runtime.byteArrayFromString(ea(),"utf8");Y.save("styles.xml",a,!0,c);a=runtime.byteArrayFromString(ba(),"utf8");Y.save("content.xml",a,!0,c);a=runtime.byteArrayFromString(N(),"utf8");Y.save("META-INF/manifest.xml",a,!0,c)}function ga(a,c){S();Y.writeAs(a,function(a){c(a)})}var D=this,Y,W={},P,I="";this.onstatereadychange=k;this.state=this.onchange=null;this.getMetadata=x;this.setRootElement=J;this.getContentElement=
function(){var a;P||(a=D.rootElement.body,P=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","text")||m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","presentation")||m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","spreadsheet"));if(!P)throw"Could not find content element in <office:body/>.";return P};this.getDocumentType=function(){var a=D.getContentElement();return a&&a.localName};this.isTemplate=function(){return"-template"===W["/"].substr(-9)};
this.setIsTemplate=function(a){var c=W["/"],b="-template"===c.substr(-9);a!==b&&(c=a?c+"-template":c.substr(0,c.length-9),W["/"]=c,a=runtime.byteArrayFromString(c,"utf8"),Y.save("mimetype",a,!1,new Date))};this.getPart=function(a){return new odf.OdfPart(a,W[a],D,Y)};this.getPartData=function(a,c){Y.load(a,c)};this.setMetadata=X;this.incrementEditingCycles=function(){var a=x(odf.Namespaces.metans,"editing-cycles"),a=a?parseInt(a,10):0;isNaN(a)&&(a=0);X({"meta:editing-cycles":a+1},null);return a+1};
this.createByteArray=function(a,c){S();Y.createByteArray(a,c)};this.saveAs=ga;this.save=function(a){ga(I,a)};this.getUrl=function(){return I};this.setBlob=function(a,c,b){b=e.convertBase64ToByteArray(b);Y.save(a,b,!1,new Date);W.hasOwnProperty(a)&&runtime.log(a+" has been overwritten.");W[a]=c};this.removeBlob=function(a){var c=Y.remove(a);runtime.assert(c,"file is not found: "+a);delete W[a]};this.state=a.LOADING;this.rootElement=function(a){var c=document.createElementNS(a.namespaceURI,a.localName),
b;a=new a.Type;for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c}({Type:odf.ODFDocumentElement,namespaceURI:odf.ODFDocumentElement.namespaceURI,localName:odf.ODFDocumentElement.localName});c===odf.OdfContainer.DocumentType.TEXT?Y=ca("text"):c===odf.OdfContainer.DocumentType.TEXT_TEMPLATE?Y=ca("text",!0):c===odf.OdfContainer.DocumentType.PRESENTATION?Y=ca("presentation"):c===odf.OdfContainer.DocumentType.PRESENTATION_TEMPLATE?Y=ca("presentation",!0):c===odf.OdfContainer.DocumentType.SPREADSHEET?
Y=ca("spreadsheet"):c===odf.OdfContainer.DocumentType.SPREADSHEET_TEMPLATE?Y=ca("spreadsheet",!0):(I=c,Y=new webodfcore.Zip(I,function(c,b){Y=b;c?A(I,function(b){c&&(Y.error=c+"\n"+b,B(a.INVALID))}):M([{path:"styles.xml",handler:H},{path:"content.xml",handler:K},{path:"meta.xml",handler:U},{path:"settings.xml",handler:L},{path:"META-INF/manifest.xml",handler:Q}])}))};odf.OdfContainer.EMPTY=0;odf.OdfContainer.LOADING=1;odf.OdfContainer.DONE=2;odf.OdfContainer.INVALID=3;odf.OdfContainer.SAVING=4;odf.OdfContainer.MODIFIED=
5;odf.OdfContainer.getContainer=function(a){return new odf.OdfContainer(a,null)}})();odf.OdfContainer.DocumentType={TEXT:1,TEXT_TEMPLATE:2,PRESENTATION:3,PRESENTATION_TEMPLATE:4,SPREADSHEET:5,SPREADSHEET_TEMPLATE:6};gui.AnnotatableCanvas=function(){};gui.AnnotatableCanvas.prototype.refreshSize=function(){};gui.AnnotatableCanvas.prototype.getZoomLevel=function(){};gui.AnnotatableCanvas.prototype.getSizer=function(){};
gui.AnnotationViewManager=function(h,l,d,b){function g(c){var b=c.annotationEndElement,d=n.createRange(),k=c.getAttributeNS(odf.Namespaces.officens,"name");b&&(d.setStart(c,c.childNodes.length),d.setEnd(b,0),c=a.getTextNodes(d,!1),c.forEach(function(a){var c;a:{for(c=a.parentNode;c.namespaceURI!==odf.Namespaces.officens||"body"!==c.localName;){if("http://www.w3.org/1999/xhtml"===c.namespaceURI&&"webodf-annotationHighlight"===c.className&&c.getAttribute("annotation")===k){c=!0;break a}c=c.parentNode}c=
!1}c||(c=n.createElement("span"),c.className="webodf-annotationHighlight",c.setAttribute("annotation",k),a.parentNode.replaceChild(c,a),c.appendChild(a))}));d.detach()}function m(a){var b=h.getSizer();a?(d.style.display="inline-block",b.style.paddingRight=c.getComputedStyle(d).width):(d.style.display="none",b.style.paddingRight=0);h.refreshSize()}function r(){e.sort(function(a,c){return 0!==(a.compareDocumentPosition(c)&Node.DOCUMENT_POSITION_FOLLOWING)?-1:1})}function p(){var a;for(a=0;a<e.length;a+=
1){var c=e[a],b=c.parentNode,g=b.nextElementSibling,n=g.nextElementSibling,m=b.parentNode,l=e[e.indexOf(c)-1],c=h.getZoomLevel();b.style.left=(d.getBoundingClientRect().left-m.getBoundingClientRect().left)/c+"px";b.style.width=d.getBoundingClientRect().width/c+"px";g.style.width=parseFloat(b.style.left)-30+"px";l?(l=l.parentNode.getBoundingClientRect(),20>=(m.getBoundingClientRect().top-l.bottom)/c?b.style.top=Math.abs(m.getBoundingClientRect().top-l.bottom)/c+20+"px":b.style.top="0px"):b.style.top=
"0px";n.style.left=g.getBoundingClientRect().width/c+"px";var g=n.style,p=n.getBoundingClientRect().left/c,m=n.getBoundingClientRect().top/c,r=b.getBoundingClientRect().left/c,l=b.getBoundingClientRect().top/c,p=r-p,m=l-m;g.width=Math.sqrt(p*p+m*m)+"px";b=Math.asin((b.getBoundingClientRect().top-n.getBoundingClientRect().top)/(c*parseFloat(n.style.width)));n.style.transform="rotate("+b+"rad)";n.style.MozTransform="rotate("+b+"rad)";n.style.WebkitTransform="rotate("+b+"rad)";n.style.msTransform="rotate("+
b+"rad)"}}function q(a){var c=e.indexOf(a),b=a.parentNode.parentNode;"div"===b.localName&&(b.parentNode.insertBefore(a,b),b.parentNode.removeChild(b));a=a.getAttributeNS(odf.Namespaces.officens,"name");a=n.querySelectorAll('span.webodf-annotationHighlight[annotation="'+a+'"]');for(var d,b=0;b<a.length;b+=1){for(d=a.item(b);d.firstChild;)d.parentNode.insertBefore(d.firstChild,d);d.parentNode.removeChild(d)}-1!==c&&e.splice(c,1);0===e.length&&m(!1)}var e=[],n=l.ownerDocument,a=odf.OdfUtils,c=runtime.getWindow();
runtime.assert(!!c,"Expected to be run in an environment which has a global window, like a browser.");this.rerenderAnnotations=p;this.rehighlightAnnotations=function(){e.forEach(function(a){g(a)})};this.getMinimumHeightForAnnotationPane=function(){return"none"!==d.style.display&&0<e.length?(e[e.length-1].parentNode.getBoundingClientRect().bottom-d.getBoundingClientRect().top)/h.getZoomLevel()+"px":null};this.addAnnotations=function(c){0!==c.length&&(m(!0),c.forEach(function(c){e.push(c);var d=n.createElement("div"),
f=n.createElement("div"),k=n.createElement("div"),m=n.createElement("div"),h;d.className="annotationWrapper";d.setAttribute("creator",a.getAnnotationCreator(c));c.parentNode.insertBefore(d,c);f.className="annotationNote";f.appendChild(c);b&&(h=n.createElement("div"),h.className="annotationRemoveButton",f.appendChild(h));k.className="annotationConnector horizontal";m.className="annotationConnector angular";d.appendChild(f);d.appendChild(k);d.appendChild(m);c.annotationEndElement&&g(c)}),r(),p())};
this.forgetAnnotation=q;this.forgetAnnotations=function(){for(;e.length;)q(e[0])}};webodfcore.SimpleClientRect=null;gui.Viewport=function(){};gui.Viewport.prototype.scrollIntoView=function(h,l){};
gui.SingleScrollViewport=function(h){this.scrollIntoView=function(l,d){var b,g,m,r;r=h.offsetHeight-h.clientHeight;m=h.offsetWidth-h.clientWidth;var p=h.getBoundingClientRect();if(l&&p){b=p.left+5;g=p.top+5;m=p.right-(m+5);r=p.bottom-(r+5);if(d||l.top<g)h.scrollTop-=g-l.top;else if(l.top>r||l.bottom>r)h.scrollTop=l.bottom-l.top<=r-g?h.scrollTop+(l.bottom-r):h.scrollTop+(l.top-g);l.left<b?h.scrollLeft-=b-l.left:l.right>m&&(h.scrollLeft=l.right-l.left<=m-b?h.scrollLeft+(l.right-m):h.scrollLeft-(b-l.left))}}};
(function(){function h(d,m,l,p,q){var e,g=0,a;for(a in d)if(d.hasOwnProperty(a)){if(g===l){e=a;break}g+=1}e?m.getPartData(d[e].href,function(a,k){if(a)runtime.log(a);else if(k){var c="@font-face { font-family: "+(d[e].family||e)+"; src: url(data:application/x-font-ttf;charset=binary;base64,"+b.convertUTF8ArrayToBase64(k)+') format("truetype"); }';try{p.insertRule(c,p.cssRules.length)}catch(v){runtime.log("Problem inserting rule in CSS: "+runtime.toJson(v)+"\nRule: "+c)}}else runtime.log("missing font data for "+
d[e].href);h(d,m,l+1,p,q)}):q&&q()}var l=xmldom.XPath,d=odf.OdfUtils,b=new webodfcore.Base64;odf.FontLoader=function(){this.loadFonts=function(b,m){for(var g=b.rootElement.fontFaceDecls;m.cssRules.length;)m.deleteRule(m.cssRules.length-1);if(g){var p={},q,e,n,a;if(g)for(g=l.getODFElementsWithXPath(g,"style:font-face[svg:font-face-src]",odf.Namespaces.lookupNamespaceURI),q=0;q<g.length;q+=1)e=g[q],n=e.getAttributeNS(odf.Namespaces.stylens,"name"),a=d.getNormalizedFontFamilyName(e.getAttributeNS(odf.Namespaces.svgns,
"font-family")),e=l.getODFElementsWithXPath(e,"svg:font-face-src/svg:font-face-uri",odf.Namespaces.lookupNamespaceURI),0<e.length&&(e=e[0].getAttributeNS(odf.Namespaces.xlinkns,"href"),p[n]={href:e,family:a});h(p,b,0,m)}}}})();
webodfcore.CSSUnits=function(){var h=this,l={"in":1,cm:2.54,mm:25.4,pt:72,pc:12,px:96};this.convert=function(d,b,g){return d*l[g]/l[b]};this.convertMeasure=function(d,b){var g,m;d&&b&&(g=parseFloat(d),m=d.replace(g.toString(),""),g=h.convert(g,m,b));return g};this.getUnits=function(d){return d.substr(d.length-2,d.length)}};
webodfcore.Utils=function(){function h(l,d){if(d&&Array.isArray(d)){l=l||[];if(!Array.isArray(l))throw"Destination is not an array.";l=l.concat(d.map(function(b){return h(null,b)}))}else if(d&&"object"===typeof d){l=l||{};if("object"!==typeof l)throw"Destination is not an object.";Object.keys(d).forEach(function(b){l[b]=h(l[b],d[b])})}else l=d;return l}this.hashString=function(h){var d=0,b,g;b=0;for(g=h.length;b<g;b+=1)d=(d<<5)-d+h.charCodeAt(b),d|=0;return d};this.mergeObjects=function(l,d){Object.keys(d).forEach(function(b){l[b]=
h(l[b],d[b])});return l}};
odf.Formatting=function(){function h(a){return(a=B[a])?y.mergeObjects({},a):{}}function l(){for(var c=a.rootElement.fontFaceDecls,b={},d,e,c=c&&c.firstElementChild;c;){if(d=c.getAttributeNS(f,"name"))if((e=c.getAttributeNS(k,"font-family"))||0<c.getElementsByTagNameNS(k,"font-face-uri").length)b[d]=e;c=c.nextElementSibling}return b}function d(c){for(var b=a.rootElement.styles.firstElementChild;b;){if(b.namespaceURI===f&&"default-style"===b.localName&&b.getAttributeNS(f,"family")===c)return b;b=b.nextElementSibling}return null}
function b(c,b,d){var k,e,g;d=d||[a.rootElement.automaticStyles,a.rootElement.styles];for(g=0;g<d.length;g+=1)for(k=d[g],k=k.firstElementChild;k;){e=k.getAttributeNS(f,"name");if(k.namespaceURI===f&&"style"===k.localName&&k.getAttributeNS(f,"family")===b&&e===c||"list-style"===b&&k.namespaceURI===v&&"list-style"===k.localName&&e===c||"data"===b&&k.namespaceURI===u&&e===c)return k;k=k.nextElementSibling}return null}function g(a){for(var c,b,d,k,e={},g=a.firstElementChild;g;){if(g.namespaceURI===f)for(d=
e[g.nodeName]={},b=g.attributes,c=0;c<b.length;c+=1)k=b.item(c),d[k.name]=k.value;g=g.nextElementSibling}b=a.attributes;for(c=0;c<b.length;c+=1)k=b.item(c),e[k.name]=k.value;return e}function m(c,k){for(var e=a.rootElement.styles,n,m={},l=c.getAttributeNS(f,"family"),p=c;p;)n=g(p),m=y.mergeObjects(n,m),p=(n=p.getAttributeNS(f,"parent-style-name"))?b(n,l,[e]):null;if(p=d(l))n=g(p),m=y.mergeObjects(n,m);!1!==k&&(n=h(l),m=y.mergeObjects(n,m));return m}function r(b,d){function f(a){Object.keys(a).forEach(function(c){Object.keys(a[c]).forEach(function(a){n+=
"|"+c+":"+a+"|"})})}for(var k=b.nodeType===Node.TEXT_NODE?b.parentNode:b,e,g=[],n="",m=!1;k&&!w.isInlineRoot(k)&&k.parentNode!==a.rootElement;)!m&&w.isGroupingElement(k)&&(m=!0),(e=c.determineStylesForNode(k))&&g.push(e),k=k.parentNode;m&&(g.forEach(f),d&&(d[n]=g));return m?g:void 0}function p(c){var d={orderedStyles:[],styleProperties:{}};c.forEach(function(c){Object.keys(c).forEach(function(k){var e=Object.keys(c[k])[0],g={name:e,family:k,displayName:void 0,isCommonStyle:!1},n;(n=b(e,k))?(k=m(n),
d.styleProperties=y.mergeObjects(k,d.styleProperties),g.displayName=n.getAttributeNS(f,"display-name")||void 0,g.isCommonStyle=n.parentNode===a.rootElement.styles):runtime.log("No style element found for '"+e+"' of family '"+k+"'");d.orderedStyles.push(g)})});return d}function q(a,c){var b={},d=[];c||(c={});a.forEach(function(a){r(a,b)});Object.keys(b).forEach(function(a){c[a]||(c[a]=p(b[a]));d.push(c[a])});return d}function e(c){for(var b=a.rootElement.masterStyles.firstElementChild;b&&(b.namespaceURI!==
f||"master-page"!==b.localName||b.getAttributeNS(f,"name")!==c);)b=b.nextElementSibling;return b}function n(a,c){var b;a&&(b=t.convertMeasure(a,"px"));void 0===b&&c&&(b=t.convertMeasure(c,"px"));return b}var a,c=new odf.StyleInfo,k=odf.Namespaces.svgns,f=odf.Namespaces.stylens,v=odf.Namespaces.textns,u=odf.Namespaces.numberns,x=odf.Namespaces.fons,w=odf.OdfUtils,z=webodfcore.DomUtils,y=new webodfcore.Utils,t=new webodfcore.CSSUnits,B={paragraph:{"style:paragraph-properties":{"fo:text-align":"left"}}};
this.getSystemDefaultStyleAttributes=h;this.setOdfContainer=function(c){a=c};this.getFontMap=l;this.getAvailableParagraphStyles=function(){for(var c=a.rootElement.styles,b,d,k=[],c=c&&c.firstElementChild;c;)"style"===c.localName&&c.namespaceURI===f&&(b=c.getAttributeNS(f,"family"),"paragraph"===b&&(b=c.getAttributeNS(f,"name"),d=c.getAttributeNS(f,"display-name")||b,b&&d&&k.push({name:b,displayName:d}))),c=c.nextElementSibling;return k};this.isStyleUsed=function(b){var d,f=a.rootElement;d=c.hasDerivedStyles(f,
odf.Namespaces.lookupNamespaceURI,b);b=(new c.UsedStyleList(f.styles)).uses(b)||(new c.UsedStyleList(f.automaticStyles)).uses(b)||(new c.UsedStyleList(f.body)).uses(b);return d||b};this.getDefaultStyleElement=d;this.getStyleElement=b;this.getStyleAttributes=g;this.getInheritedStyleAttributes=m;this.getFirstCommonParentStyleNameOrSelf=function(c){var d=a.rootElement.styles,k;if(k=b(c,"paragraph",[a.rootElement.automaticStyles]))if(c=k.getAttributeNS(f,"parent-style-name"),!c)return null;return(k=b(c,
"paragraph",[d]))?c:null};this.hasParagraphStyle=function(a){return!!b(a,"paragraph")};this.getAppliedStyles=q;this.getAppliedStylesForElement=function(a,c){return q([a],c)[0]};this.updateStyle=function(c,b){var d,e;z.mapObjOntoNode(c,b,odf.Namespaces.lookupNamespaceURI);(d=(d=b["style:text-properties"])&&d["style:font-name"])&&!l().hasOwnProperty(d)&&(e=c.ownerDocument.createElementNS(f,"style:font-face"),e.setAttributeNS(f,"style:name",d),e.setAttributeNS(k,"svg:font-family",d),a.rootElement.fontFaceDecls.appendChild(e))};
this.createDerivedStyleObject=function(c,d,f){var k=b(c,d);runtime.assert(!!k,"No style element found for '"+c+"' of family '"+d+"'");c=k.parentNode===a.rootElement.styles?{"style:parent-style-name":c}:g(k);c["style:family"]=d;y.mergeObjects(c,f);return c};this.getDefaultTabStopDistance=function(){for(var a=d("paragraph"),a=a&&a.firstElementChild,c;a;)a.namespaceURI===f&&"paragraph-properties"===a.localName&&(c=a.getAttributeNS(f,"tab-stop-distance")),a=a.nextElementSibling;c||(c="1.25cm");return w.parseNonNegativeLength(c)};
this.getMasterPageElement=e;this.getContentSize=function(c,d){var k,g,m,h,l,p,r,q,v,u;a:{g=b(c,d);runtime.assert("paragraph"===d||"table"===d,"styleFamily must be either paragraph or table");if(g){if(g=g.getAttributeNS(f,"master-page-name"))(k=e(g))||runtime.log("WARN: No master page definition found for "+g);k||(k=e("Standard"));k||(k=a.rootElement.masterStyles.getElementsByTagNameNS(f,"master-page")[0])||runtime.log("WARN: Document has no master pages defined");if(k)for(g=k.getAttributeNS(f,"page-layout-name"),
m=a.rootElement.automaticStyles.getElementsByTagNameNS(f,"page-layout"),h=0;h<m.length;h+=1)if(k=m.item(h),k.getAttributeNS(f,"name")===g)break a}k=null}k||(k=z.getDirectChild(a.rootElement.styles,f,"default-page-layout"));(k=z.getDirectChild(k,f,"page-layout-properties"))?("landscape"===k.getAttributeNS(f,"print-orientation")?(g="29.7cm",m="21.001cm"):(g="21.001cm",m="29.7cm"),g=n(k.getAttributeNS(x,"page-width"),g),m=n(k.getAttributeNS(x,"page-height"),m),h=n(k.getAttributeNS(x,"margin")),void 0===
h?(h=n(k.getAttributeNS(x,"margin-left"),"2cm"),l=n(k.getAttributeNS(x,"margin-right"),"2cm"),p=n(k.getAttributeNS(x,"margin-top"),"2cm"),r=n(k.getAttributeNS(x,"margin-bottom"),"2cm")):h=l=p=r=h,q=n(k.getAttributeNS(x,"padding")),void 0===q?(q=n(k.getAttributeNS(x,"padding-left"),"0cm"),v=n(k.getAttributeNS(x,"padding-right"),"0cm"),u=n(k.getAttributeNS(x,"padding-top"),"0cm"),k=n(k.getAttributeNS(x,"padding-bottom"),"0cm")):q=v=u=k=q):(g=n("21.001cm"),m=n("29.7cm"),h=l=p=r=h=n("2cm"),q=v=u=k=q=
n("0cm"));return{width:g-h-l-q-v,height:m-p-r-u-k}}};
(function(){var h=odf.Namespaces.stylens,l=odf.Namespaces.textns,d={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"};odf.StyleTreeNode=function(b){this.derivedStyles={};this.element=b};odf.StyleTree=function(b,g){function m(b){var a,c,d,f={};if(!b)return f;for(b=b.firstElementChild;b;){if(c=b.namespaceURI!==h||"style"!==b.localName&&
"default-style"!==b.localName?b.namespaceURI===l&&"list-style"===b.localName?"list":b.namespaceURI!==h||"page-layout"!==b.localName&&"default-page-layout"!==b.localName?void 0:"page":b.getAttributeNS(h,"family"))(a=b.getAttributeNS(h,"name"))||(a=""),f.hasOwnProperty(c)?d=f[c]:f[c]=d={},d[a]=b;b=b.nextElementSibling}return f}function r(b,a){if(b.hasOwnProperty(a))return b[a];var c=null,d=Object.keys(b),f;for(f=0;f<d.length&&!(c=r(b[d[f]].derivedStyles,a));f+=1);return c}function p(b,a,c){var d,f,
e;if(!a.hasOwnProperty(b))return null;d=new odf.StyleTreeNode(a[b]);f=d.element.getAttributeNS(h,"parent-style-name");e=null;f&&(e=r(c,f)||p(f,a,c));e?e.derivedStyles[b]=d:c[b]=d;delete a[b];return d}function q(b,a){b&&Object.keys(b).forEach(function(c){p(c,b,a)})}var e={};this.getStyleTree=function(){return e};(function(){var h,a,c;a=m(b);c=m(g);Object.keys(d).forEach(function(b){h=e[b]={};q(a[b],h);q(c[b],h)})})()}})();
(function(){function h(b,d){try{b.insertRule(d,b.cssRules.length)}catch(n){runtime.log("cannot load rule: "+d+" - "+n)}}function l(b,d){this.listCounterCount=0;this.contentRules=b;this.counterIdStack=[];this.continuedCounterIdStack=d}function d(b){function d(c,f,e,g){var k=f.namespaceURI===m&&"list"===f.localName,n=f.namespaceURI===m&&"list-item"===f.localName;if(k||n){if(k){var k=e+=1,l,p,r;g.listCounterCount+=1;n=c+"-level"+k+"-"+g.listCounterCount;f.setAttributeNS("urn:webodf:names:helper","counter-id",
n);l=g.continuedCounterIdStack.shift();l||(l=n,a+=n+" 1 ",p='text|list[webodfhelper|counter-id="'+n+'"] > text|list-item:first-child > :not(text|list):first-child:before{',p+="counter-increment: "+l+" 0;",p+="}",h(b,p));for(;g.counterIdStack.length>=k;)g.counterIdStack.pop();g.counterIdStack.push(l);r=g.contentRules[k.toString()]||"";for(p=1;p<=k;p+=1)r=r.replace(p+"webodf-listLevel",g.counterIdStack[p-1]);p='text|list[webodfhelper|counter-id="'+n+'"] > text|list-item > :not(text|list):first-child:before{';
p+=r;p+="counter-increment: "+l+";";p+="}";h(b,p)}for(f=f.firstElementChild;f;)d(c,f,e,g),f=f.nextElementSibling}else g.continuedCounterIdStack=[]}var g=0,a="",c={};this.createCounterRules=function(a,b,e){var f=b.getAttributeNS(r,"id"),k=[];e&&(e=e.getAttributeNS("urn:webodf:names:helper","counter-id"),k=c[e].slice(0));a=new l(a,k);f?f="Y"+f:(g+=1,f="X"+g);d(f,b,0,a);c[f+"-level1-1"]=a.counterIdStack};this.initialiseCreatedCounters=function(){h(b,"office|document{"+("counter-reset: "+a+";")+"}")}}
var b=odf.Namespaces.fons,g=odf.Namespaces.stylens,m=odf.Namespaces.textns,r=odf.Namespaces.xmlns,p={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"};odf.ListStyleToCss=function(){function l(a){var b=k.parseLength(a);return b?c.convert(b.value,b.unit,"px"):(runtime.log("Could not parse value '"+a+"'."),0)}function e(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function n(a,c){var b;a&&(b=a.getAttributeNS(m,"style-name"));return b===c}function a(a,c,b){c=c.getElementsByTagNameNS(m,
"list");a=new d(a);var f,k,h,l,q,v,u={},H;for(H=0;H<c.length;H+=1)if(f=c.item(H),v=f.getAttributeNS(m,"style-name")){h=f.getAttributeNS(m,"continue-numbering");l=f.getAttributeNS(m,"continue-list");(q=f.getAttributeNS(r,"id"))&&(u[q]=f);q=b[v].element.firstElementChild;for(var K,U={};q;){K=(K=q.getAttributeNS(m,"level"))&&parseInt(K,10);var L=q,Q="",C,V=void 0;if("list-level-style-number"===L.localName){var O=L,Q=O.getAttributeNS(g,"num-format");C=O.getAttributeNS(g,"num-suffix")||"";var M=O.getAttributeNS(g,
"num-prefix")||"",T="",F=O.getAttributeNS(m,"level"),O=O.getAttributeNS(m,"display-levels");M&&(T+='"'+e(M)+'"\n');if(p.hasOwnProperty(Q))for(F=F?parseInt(F,10):1,O=O?parseInt(O,10):1;0<O;)T+=" counter("+(F-O+1)+"webodf-listLevel,"+p[Q]+")",1<O&&(T+='"."'),--O;else T=Q?T+(' "'+Q+'"'):T+' ""';Q="content:"+T+' "'+e(C)+'"'}else"list-level-style-image"===L.localName?Q="content: none":"list-level-style-bullet"===L.localName&&(Q=L.getAttributeNS(m,"bullet-char"),Q='content: "'+e(Q)+'"');if(L=L.getElementsByTagNameNS(g,
"list-level-properties")[0])C=L.getAttributeNS(m,"list-level-position-and-space-mode"),"label-alignment"===C&&((L=L.getElementsByTagNameNS(g,"list-level-label-alignment")[0])&&(V=L.getAttributeNS(m,"label-followed-by")),"space"===V&&(Q+=' "\\a0"'));U[K]="\n"+Q+";\n";q=q.nextElementSibling}q=U;h&&!l&&n(k,v)?a.createCounterRules(q,f,k):l&&n(u[l],v)?a.createCounterRules(q,f,u[l]):a.createCounterRules(q,f);k=f}a.initialiseCreatedCounters()}var c=new webodfcore.CSSUnits,k=odf.OdfUtils;this.applyListStyles=
function(c,d,k){var f,e;(f=d.list)&&Object.keys(f).forEach(function(a){e=f[a];for(var d=e.element.firstElementChild;d;){if(d.namespaceURI===m){var k=c,n=d,p='text|list[text|style-name="'+a+'"]',r=n.getAttributeNS(m,"level"),q,v,x,Q=void 0,C=void 0,u=void 0,O=void 0,n=(q=n.getElementsByTagNameNS(g,"list-level-properties")[0])&&q.getAttributeNS(m,"list-level-position-and-space-mode");v=q&&q.getElementsByTagNameNS(g,"list-level-label-alignment")[0];for(r=r&&parseInt(r,10);1<r;)p+=" > text|list-item > text|list",
--r;r=q&&q.getAttributeNS(b,"text-align")||"left";switch(r){case "end":r="right";break;case "start":r="left"}"label-alignment"===n?(x=v&&v.getAttributeNS(b,"margin-left")||"0px",u=v&&v.getAttributeNS(b,"text-indent")||"0px",O=v&&v.getAttributeNS(m,"label-followed-by"),v=l(x)):(x=q&&q.getAttributeNS(m,"space-before")||"0px",Q=q&&q.getAttributeNS(m,"min-label-width")||"0px",C=q&&q.getAttributeNS(m,"min-label-distance")||"0px",v=l(x)+l(Q));q=p+" > text|list-item{";q+="margin-left: "+v+"px;";q+="}";h(k,
q);q=p+" > text|list-item > text|list{";q+="margin-left: "+-v+"px;";q+="}";h(k,q);q=p+" > text|list-item > :not(text|list):first-child:before{";q+="text-align: "+r+";";q+="display: inline-block;";"label-alignment"===n?(q+="margin-left: "+u+";","listtab"===O&&(q+="padding-right: 0.2cm;")):(q+="min-width: "+Q+";",q+="margin-left: "+(0===parseFloat(Q)?"":"-")+Q+";",q+="padding-right: "+C+";");q+="}";h(k,q)}d=d.nextElementSibling}});a(c,k,f)}}})();
odf.LazyStyleProperties=function(h,l){var d={};this.value=function(b){var g;d.hasOwnProperty(b)?g=d[b]:(g=l[b](),void 0===g&&h&&(g=h.value(b)),d[b]=g);return g};this.reset=function(b){h=b;d={}}};
odf.StyleParseUtils=function(){function h(d){var b,g;d=(d=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px))/.exec(d))?{value:parseFloat(d[1]),unit:d[3]}:null;g=d&&d.unit;"px"===g?b=d.value:"cm"===g?b=d.value/2.54*96:"mm"===g?b=d.value/25.4*96:"in"===g?b=96*d.value:"pt"===g?b=d.value/.75:"pc"===g&&(b=16*d.value);return b}var l=odf.Namespaces.stylens;this.parseLength=h;this.parsePositiveLengthOrPercent=function(d,b,g){var m;d&&(m=parseFloat(d.substr(0,
d.indexOf("%"))),isNaN(m)&&(m=void 0));var l;void 0!==m?(g&&(l=g.value(b)),m=void 0===l?void 0:l/100*m):m=h(d);return m};this.getPropertiesElement=function(d,b,g){for(b=g?g.nextElementSibling:b.firstElementChild;null!==b&&(b.localName!==d||b.namespaceURI!==l);)b=b.nextElementSibling;return b};this.parseAttributeList=function(d){d&&(d=d.replace(/^\s*(.*?)\s*$/g,"$1"));return d&&0<d.length?d.split(/\s+/):[]}};
odf.Style2CSS=function(){function h(a,c,b){var d=[];b=b.derivedStyles;var f;var k=x[a],e;void 0===k?c=null:(e=c?"["+k+'|style-name="'+c+'"]':"","presentation"===k&&(k="draw",e=c?'[presentation|style-name="'+c+'"]':""),c=k+"|"+w[a].join(e+","+k+"|")+e);null!==c&&d.push(c);for(f in b)b.hasOwnProperty(f)&&(c=h(a,f,b[f]),d=d.concat(c));return d}function l(a){var c;if("default-style"===a.localName)return null;c=a.getAttributeNS(n,"parent-style-name");a=a.getAttributeNS(n,"family");return N.getODFElementsWithXPath(F,
c?"//style:*[@style:name='"+c+"'][@style:family='"+a+"']":"//style:default-style[@style:family='"+a+"']",odf.Namespaces.lookupNamespaceURI)[0]}function d(a,c){var b="",d,f,k;for(d=0;d<c.length;d+=1)if(f=c[d],k=a.getAttributeNS(f[0],f[1])){k=k.trim();if(C.hasOwnProperty(f[1])){var e=k;k=e.indexOf(" ");var g;-1!==k?(g=e.substring(0,k),k=e.substring(k)):(g=e,k="");(g=M.parseLength(g))&&"pt"===g.unit&&.75>g.value&&(e="0.75pt"+k);k=e}else if(V.hasOwnProperty(f[1])){var m=a,e=f[0];g=f[1];var h=M.parseLength(k),
p;if(h&&"%"===h.unit){k=h.value/100;m=l(m.parentNode);for(h="0";m;){if(p=v.getDirectChild(m,n,"paragraph-properties"))if(p=M.parseLength(p.getAttributeNS(e,g))){if("%"!==p.unit){h=p.value*k+p.unit;break}k*=p.value/100}m=l(m)}k=h}}f[2]&&(b+=f[2]+":"+k+";")}return b}function b(a,c,b,d){return c+c+b+b+d+d}function g(a,c){var b=[a],d=c.derivedStyles;Object.keys(d).forEach(function(a){a=g(a,d[a]);b=b.concat(a)});return b}function m(a,c,b,d){function k(c,b){var d=[],f;c.forEach(function(a){e.forEach(function(c){d.push('draw|page[webodfhelper|page-style-name="'+
c+'"] draw|frame[presentation|class="'+a+'"]')})});0<d.length&&(f=d.join(",")+"{visibility:"+b+";}",a.insertRule(f,a.cssRules.length))}var e=g(c,d),m=[],h=[];["page-number","date-time","header","footer"].forEach(function(a){var c;c=b.getAttributeNS(f,"display-"+a);"true"===c?m.push(a):"false"===c&&h.push(a)});k(m,"visible");k(h,"hidden")}function r(a,g,C,x){var V,w;if("page"===g){var D=x.element,A="",F,P;C=v.getDirectChild(D,n,"page-layout-properties");var I;if(C)if(I=D.getAttributeNS(n,"name"),A+=
d(C,L),(F=v.getDirectChild(C,n,"background-image"))&&(P=F.getAttributeNS(k,"href"))&&(A=A+("background-image: url('odfkit:"+P+"');")+d(F,y)),"presentation"===T)for(F=(D=v.getDirectChild(D.parentNode.parentNode,e,"master-styles"))&&D.firstElementChild;F;)F.namespaceURI===n&&"master-page"===F.localName&&F.getAttributeNS(n,"page-layout-name")===I&&(P=F.getAttributeNS(n,"name"),D='draw|page[draw|master-page-name="'+P+'"] {'+A+"}",P='office|body, draw|page[draw|master-page-name="'+P+'"] {'+d(C,Q)+" }",
a.insertRule(D,a.cssRules.length),a.insertRule(P,a.cssRules.length)),F=F.nextElementSibling;else"text"===T&&(D="office|text {"+A+"}",P="office|body {width: "+C.getAttributeNS(q,"page-width")+";}",a.insertRule(D,a.cssRules.length),a.insertRule(P,a.cssRules.length))}else{A=h(g,C,x).join(",");I="";if(D=v.getDirectChild(x.element,n,"text-properties")){var N=D,ba=w="";F="";P=1;D=""+d(N,z);V=N.getAttributeNS(n,"text-underline-style");"solid"===V&&(w+=" underline");V=N.getAttributeNS(n,"text-line-through-style");
"solid"===V&&(w+=" line-through");w.length&&(D=D+("text-decoration:"+w+";\n")+("text-decoration-line:"+w+";\n")+("-moz-text-decoration-line:"+w+";\n"));V=N.getAttributeNS(n,"text-line-through-type");switch(V){case "double":ba+=" double";break;case "single":ba+=" single"}ba&&(D=D+("text-decoration-style:"+ba+";\n")+("-moz-text-decoration-style:"+ba+";\n"));if(w=N.getAttributeNS(n,"font-name")||N.getAttributeNS(q,"font-family"))V=O[w],D+="font-family: "+(V||w)+";";if(V=N.getAttributeNS(n,"text-position"))w=
u.parseAttributeList(V),V=w[0],w=w[1],D+="vertical-align: "+V+"\n; ",w&&(P=parseFloat(w)/100);if(N.hasAttributeNS(q,"font-size")||1!==P){for(N=N.parentNode;N;){if(V=(V=v.getDirectChild(N,n,"text-properties"))?M.parseFoFontSize(V.getAttributeNS(q,"font-size")):null){if("%"!==V.unit){F="font-size: "+V.value*P+V.unit+";";break}P*=V.value/100}N=l(N)}F||(F="font-size: "+parseFloat(aa)*P+ea.getUnits(aa)+";")}D+=F;I+=D}if(D=v.getDirectChild(x.element,n,"paragraph-properties"))F=D,D=""+d(F,t),(P=v.getDirectChild(F,
n,"background-image"))&&(N=P.getAttributeNS(k,"href"))&&(D=D+("background-image: url('odfkit:"+N+"');")+d(P,y)),(F=F.getAttributeNS(q,"line-height"))&&"normal"!==F&&(F=M.parseFoLineHeight(F),D="%"!==F.unit?D+("line-height: "+F.value+F.unit+";"):D+("line-height: "+F.value/100+";")),I+=D;if(D=v.getDirectChild(x.element,n,"graphic-properties"))N=D,D=""+d(N,B),F=N.getAttributeNS(p,"opacity"),P=N.getAttributeNS(p,"fill"),N=N.getAttributeNS(p,"fill-color"),"solid"===P||"hatch"===P?N&&"none"!==N?(F=isNaN(parseFloat(F))?
1:parseFloat(F)/100,P=N.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,b),(N=(P=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(P))?{r:parseInt(P[1],16),g:parseInt(P[2],16),b:parseInt(P[3],16)}:null)&&(D+="background-color: rgba("+N.r+","+N.g+","+N.b+","+F+");")):D+="background: none;":"none"===P&&(D+="background: none;"),I+=D;if(D=v.getDirectChild(x.element,n,"drawing-page-properties"))F=D,P=""+d(F,B),"true"===F.getAttributeNS(f,"background-visible")&&(P+="background: none;"),I+=P,m(a,C,D,x);(D=v.getDirectChild(x.element,
n,"table-cell-properties"))&&(I+=""+d(D,J));(D=v.getDirectChild(x.element,n,"table-row-properties"))&&(I+=""+d(D,K));(D=v.getDirectChild(x.element,n,"table-column-properties"))&&(I+=""+d(D,H));if(D=v.getDirectChild(x.element,n,"table-properties"))C=I,I=""+d(D,U),D=D.getAttributeNS(c,"border-model"),"collapsing"===D?I+="border-collapse:collapse;":"separating"===D&&(I+="border-collapse:separate;"),I=C+I;0!==I.length&&a.insertRule(A+"{"+I+"}",a.cssRules.length)}for(var X in x.derivedStyles)x.derivedStyles.hasOwnProperty(X)&&
r(a,g,X,x.derivedStyles[X])}var p=odf.Namespaces.drawns,q=odf.Namespaces.fons,e=odf.Namespaces.officens,n=odf.Namespaces.stylens,a=odf.Namespaces.svgns,c=odf.Namespaces.tablens,k=odf.Namespaces.xlinkns,f=odf.Namespaces.presentationns,v=webodfcore.DomUtils,u=new odf.StyleParseUtils,x={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"},
w={graphic:"circle connected control custom-shape ellipse frame g line measure page page-thumbnail path polygon polyline rect regular-polygon".split(" "),paragraph:"alphabetical-index-entry-template h illustration-index-entry-template index-source-style object-index-entry-template p table-index-entry-template table-of-content-entry-template user-index-entry-template".split(" "),presentation:"caption circle connector control custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),
"drawing-page":"caption circle connector control page custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),ruby:["ruby","ruby-text"],section:"alphabetical-index bibliography illustration-index index-title object-index section table-of-content table-index user-index".split(" "),table:["background","table"],"table-cell":"body covered-table-cell even-columns even-rows first-column first-row last-column last-row odd-columns odd-rows table-cell".split(" "),
"table-column":["table-column"],"table-row":["table-row"],text:"a index-entry-chapter index-entry-link-end index-entry-link-start index-entry-page-number index-entry-span index-entry-tab-stop index-entry-text index-title-template linenumbering-configuration list-level-style-number list-level-style-bullet outline-level-style span".split(" "),list:["list-item"]},z=[[q,"color","color"],[q,"background-color","background-color"],[q,"font-weight","font-weight"],[q,"font-style","font-style"],[q,"font-variant",
"font-variant"],[q,"letter-spacing","letter-spacing"],[q,"text-transform","text-transform"],[q,"text-shadow","text-shadow"]],y=[[n,"repeat","background-repeat"]],t=[[q,"background-color","background-color"],[q,"text-align","text-align"],[q,"text-indent","text-indent"],[q,"padding","padding"],[q,"padding-left","padding-left"],[q,"padding-right","padding-right"],[q,"padding-top","padding-top"],[q,"padding-bottom","padding-bottom"],[q,"border-left","border-left"],[q,"border-right","border-right"],[q,
"border-top","border-top"],[q,"border-bottom","border-bottom"],[q,"margin","margin"],[q,"margin-left","margin-left"],[q,"margin-right","margin-right"],[q,"margin-top","margin-top"],[q,"margin-bottom","margin-bottom"],[q,"border","border"]],B=[[q,"background-color","background-color"],[q,"min-height","min-height"],[p,"stroke","border"],[a,"stroke-color","border-color"],[a,"stroke-width","border-width"],[q,"border","border"],[q,"border-left","border-left"],[q,"border-right","border-right"],[q,"border-top",
"border-top"],[q,"border-bottom","border-bottom"]],J=[[q,"background-color","background-color"],[q,"border-left","border-left"],[q,"border-right","border-right"],[q,"border-top","border-top"],[q,"border-bottom","border-bottom"],[q,"border","border"]],H=[[n,"column-width","width"]],K=[[n,"row-height","height"],[q,"keep-together",null]],U=[[n,"width","width"],[q,"margin-left","margin-left"],[q,"margin-right","margin-right"],[q,"margin-top","margin-top"],[q,"margin-bottom","margin-bottom"]],L=[[q,"background-color",
"background-color"],[q,"padding","padding"],[q,"padding-left","padding-left"],[q,"padding-right","padding-right"],[q,"padding-top","padding-top"],[q,"padding-bottom","padding-bottom"],[q,"border","border"],[q,"border-left","border-left"],[q,"border-right","border-right"],[q,"border-top","border-top"],[q,"border-bottom","border-bottom"],[q,"margin","margin"],[q,"margin-left","margin-left"],[q,"margin-right","margin-right"],[q,"margin-top","margin-top"],[q,"margin-bottom","margin-bottom"]],Q=[[q,"page-width",
"width"],[q,"page-height","height"]],C={border:!0,"border-left":!0,"border-right":!0,"border-top":!0,"border-bottom":!0,"stroke-width":!0},V={margin:!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"margin-bottom":!0},O={},M=odf.OdfUtils,T,F,aa,N=xmldom.XPath,ea=new webodfcore.CSSUnits;this.style2css=function(a,c,b,d,f){function k(a,c){e="@namespace "+a+" url("+c+");";try{b.insertRule(e,b.cssRules.length)}catch(ha){}}var e,g,m;for(F=c;b.cssRules.length;)b.deleteRule(b.cssRules.length-1);odf.Namespaces.forEachPrefix(k);
k("webodfhelper","urn:webodf:names:helper");O=d;T=a;aa=runtime.getWindow().getComputedStyle(document.body,null).getPropertyValue("font-size")||"12pt";for(m in x)if(x.hasOwnProperty(m))for(g in a=f[m],a)a.hasOwnProperty(g)&&r(b,m,g,a[g])}};webodfcore.Destroyable=function(){};webodfcore.Destroyable.prototype.destroy=function(h){};
(function(){function h(l,d){var b=this;this.getDistance=function(d){var g=b.x-d.x;d=b.y-d.y;return Math.sqrt(g*g+d*d)};this.getCenter=function(d){return new h((b.x+d.x)/2,(b.y+d.y)/2)};b.x=l;b.y=d}gui.ZoomHelper=function(){function l(a,b,d,f){a=f?"translate3d("+a+"px, "+b+"px, 0) scale3d("+d+", "+d+", 1)":"translate("+a+"px, "+b+"px) scale("+d+")";c.style.WebkitTransform=a;c.style.MozTransform=a;c.style.msTransform=a;c.style.OTransform=a;c.style.transform=a}function d(a){a?l(-k.x,-k.y,u,!0):(l(0,
0,u,!0),l(0,0,u,!1))}function b(a){if(w&&J){var c=w.style.overflow,b=w.classList.contains("webodf-customScrollbars");a&&b||!a&&!b||(a?(w.classList.add("webodf-customScrollbars"),w.style.overflow="hidden",runtime.requestAnimationFrame(function(){w.style.overflow=c})):w.classList.remove("webodf-customScrollbars"))}}function g(){l(-k.x,-k.y,u,!0);w.scrollLeft=0;w.scrollTop=0;H=z.style.overflow;z.style.overflow="visible";b(!1)}function m(){l(0,0,u,!0);w.scrollLeft=k.x;w.scrollTop=k.y;z.style.overflow=
H||"";b(!0)}function r(a){return new h(a.pageX-c.offsetLeft,a.pageY-c.offsetTop)}function p(a){f&&(k.x-=a.x-f.x,k.y-=a.y-f.y,k=new h(Math.min(Math.max(k.x,c.offsetLeft),(c.offsetLeft+c.offsetWidth)*u-w.clientWidth),Math.min(Math.max(k.y,c.offsetTop),(c.offsetTop+c.offsetHeight)*u-w.clientHeight)));f=a}function q(a){var c=a.touches.length,b=0<c?r(a.touches[0]):null;a=1<c?r(a.touches[1]):null;b&&a?(v=b.getDistance(a),x=u,f=b.getCenter(a),g(),B=t.PINCH):b&&(f=b,B=t.SCROLL)}function e(a){var b=a.touches.length,
f=0<b?r(a.touches[0]):null,b=1<b?r(a.touches[1]):null;if(f&&b)if(a.preventDefault(),B===t.SCROLL)B=t.PINCH,g(),v=f.getDistance(b);else{a=f.getCenter(b);f=f.getDistance(b)/v;p(a);var b=u,e=Math.min(4,c.offsetParent.clientWidth/c.offsetWidth);u=x*f;u=Math.min(Math.max(u,e),4);f=u/b;k.x+=(f-1)*(a.x+k.x);k.y+=(f-1)*(a.y+k.y);d(!0)}else f&&(B===t.PINCH?(B=t.SCROLL,m()):p(f))}function n(){B===t.PINCH&&(y.emit(gui.ZoomHelper.signalZoomChanged,u),m(),d(!1));B=t.NONE}function a(){w&&(w.removeEventListener("touchstart",
q,!1),w.removeEventListener("touchmove",e,!1),w.removeEventListener("touchend",n,!1))}var c,k,f,v,u,x,w,z,y=new webodfcore.EventNotifier([gui.ZoomHelper.signalZoomChanged]),t={NONE:0,SCROLL:1,PINCH:2},B=t.NONE,J=runtime.getWindow().hasOwnProperty("ontouchstart"),H="";this.subscribe=function(a,c){y.subscribe(a,c)};this.unsubscribe=function(a,c){y.unsubscribe(a,c)};this.getZoomLevel=function(){return u};this.setZoomLevel=function(a){c&&(u=a,d(!1),y.emit(gui.ZoomHelper.signalZoomChanged,u))};this.destroy=
function(c){a();b(!1);c()};this.setZoomableElement=function(f){a();c=f;w=c.offsetParent;z=c.parentNode;d(!1);w&&(w.addEventListener("touchstart",q,!1),w.addEventListener("touchmove",e,!1),w.addEventListener("touchend",n,!1));b(!0)};x=u=1;k=new h(0,0)};gui.ZoomHelper.signalZoomChanged="zoomChanged"})();ops.Canvas=function(){};ops.Canvas.prototype.getZoomLevel=function(){};ops.Canvas.prototype.getElement=function(){};ops.Canvas.prototype.getSizer=function(){};ops.Canvas.prototype.getZoomHelper=function(){};
(function(){webodfcore.Async=function(){return{forEach:function(h,l,d){function b(b){r!==m&&(b?(r=m,d(b)):(r+=1,r===m&&d(null)))}var g,m=h.length,r=0;for(g=0;g<m;g+=1)l(h[g],b)},destroyAll:function(h,l){function d(b,g){if(g)l(g);else if(b<h.length)h[b](function(g){d(b+1,g)});else l()}d(0,void 0)}}}()})();
webodfcore.ScheduledTask=function(h,l,d){function b(){r&&(d(m),r=!1)}function g(){b();h.apply(void 0,p);p=null}var m,r=!1,p=[],q=!1;this.trigger=function(){runtime.assert(!1===q,"Can't trigger destroyed ScheduledTask instance");p=Array.prototype.slice.call(arguments);r||(r=!0,m=l(g))};this.triggerImmediate=function(){runtime.assert(!1===q,"Can't trigger destroyed ScheduledTask instance");p=Array.prototype.slice.call(arguments);g()};this.processRequests=function(){r&&g()};this.cancel=b;this.restart=
function(){runtime.assert(!1===q,"Can't trigger destroyed ScheduledTask instance");b();r=!0;m=l(g)};this.destroy=function(d){b();q=!0;d()}};
(function(){var h;webodfcore.Task={};webodfcore.Task.SUPPRESS_MANUAL_PROCESSING=!1;webodfcore.Task.processTasks=function(){webodfcore.Task.SUPPRESS_MANUAL_PROCESSING||h.performRedraw()};webodfcore.Task.createRedrawTask=function(l){return new webodfcore.ScheduledTask(l,h.requestRedrawTask,h.cancelRedrawTask)};webodfcore.Task.createTimeoutTask=function(h,d){return new webodfcore.ScheduledTask(h,function(b){return runtime.setTimeout(b,d)},runtime.clearTimeout)};h=new function(){var h={};this.requestRedrawTask=
function(d){var b=runtime.requestAnimationFrame(function(){d();delete h[b]});h[b]=d;return b};this.performRedraw=function(){Object.keys(h).forEach(function(d){h[d]();runtime.cancelAnimationFrame(parseInt(d,10))});h={}};this.cancelRedrawTask=function(d){runtime.cancelAnimationFrame(d);delete h[d]}}})();
(function(){function h(){function a(d){b=!0;runtime.setTimeout(function(){try{d()}catch(M){runtime.log(String(M)+"\n"+M.stack)}b=!1;0<c.length&&a(c.pop())},10)}var c=[],b=!1;this.clearQueue=function(){c.length=0};this.addToQueue=function(d){if(0===c.length&&!b)return a(d);c.push(d)}}function l(a){function c(){for(;0<b.cssRules.length;)b.deleteRule(0);b.insertRule("#shadowContent draw|page {display:none;}",0);b.insertRule("office|presentation draw|page {display:none;}",1);b.insertRule("#shadowContent draw|page:nth-of-type("+
d+") {display:block;}",2);b.insertRule("office|presentation draw|page:nth-of-type("+d+") {display:block;}",3)}var b=a.sheet,d=1;this.showFirstPage=function(){d=1;c()};this.showNextPage=function(){d+=1;c()};this.showPreviousPage=function(){1<d&&(--d,c())};this.showPage=function(a){0<a&&(d=a,c())};this.css=a;this.destroy=function(c){a.parentNode.removeChild(a);c()}}function d(a){a=a.sheet;for(var c=a.cssRules;c.length;)a.deleteRule(c.length-1)}function b(a,c,b){var d=new odf.Style2CSS,f=new odf.ListStyleToCss;
b=b.sheet;var k=(new odf.StyleTree(a.rootElement.styles,a.rootElement.automaticStyles)).getStyleTree();d.style2css(a.getDocumentType(),a.rootElement,b,c.getFontMap(),k);f.applyListStyles(b,k,a.rootElement.body)}function g(a,c){(new odf.FontLoader).loadFonts(a,c.sheet)}function m(a,c,b){var d=null;a=a.rootElement.body.getElementsByTagNameNS(K,b+"-decl");b=c.getAttributeNS(K,"use-"+b+"-name");var f;if(b&&0<a.length)for(c=0;c<a.length;c+=1)if(f=a[c],f.getAttributeNS(K,"name")===b){d=f.textContent;break}return d}
function r(a,c,b,d){var f=a.ownerDocument;c=L.getElementsByTagNameNS(a,c,b);for(a=0;a<c.length;a+=1)L.removeAllChildNodes(c[a]),d&&(b=c[a],b.appendChild(f.createTextNode(d)))}function p(a,c,b){c.setAttributeNS("urn:webodf:names:helper","styleid",a);var d,f=c.getAttributeNS(J,"anchor-type"),k=c.getAttributeNS(t,"x"),e=c.getAttributeNS(t,"y"),g=c.getAttributeNS(t,"width"),h=c.getAttributeNS(t,"height"),m=c.getAttributeNS(w,"min-height"),n=c.getAttributeNS(w,"min-width");if("as-char"===f)d="display: inline-block;";
else if(f||k||e)d="position: absolute;";else if(g||h||m||n)d="display: block;";k&&(d+="left: "+k+";");e&&(d+="top: "+e+";");g&&(d+="width: "+g+";");h&&(d+="height: "+h+";");m&&(d+="min-height: "+m+";");n&&(d+="min-width: "+n+";");d&&(d="draw|"+c.localName+'[webodfhelper|styleid="'+a+'"] {'+d+"}",b.insertRule(d,b.cssRules.length))}function q(a){for(a=a.firstChild;a;){if(a.namespaceURI===z&&"binary-data"===a.localName)return"data:image/png;base64,"+a.textContent.replace(/[\r\n\s]/g,"");a=a.nextSibling}return""}
function e(a,c,b,d){function f(c){c&&(c='draw|image[webodfhelper|styleid="'+a+'"] {'+("background-image: url("+c+");")+"}",d.insertRule(c,d.cssRules.length))}function k(a){f(a.url)}b.setAttributeNS("urn:webodf:names:helper","styleid",a);var e=b.getAttributeNS(H,"href"),g;if(e)try{g=c.getPart(e),g.onchange=k,g.load()}catch(N){runtime.log("slight problem: "+String(N))}else e=q(b),f(e)}function n(a){var c=a.ownerDocument;L.getElementsByTagNameNS(a,J,"line-break").forEach(function(a){a.hasChildNodes()||
a.appendChild(c.createElement("br"))})}function a(a){var c=a.ownerDocument;L.getElementsByTagNameNS(a,J,"s").forEach(function(a){var b,d;L.removeAllChildNodes(a);a.appendChild(c.createTextNode(" "));d=parseInt(a.getAttributeNS(J,"c"),10);if(1<d)for(a.removeAttributeNS(J,"c"),b=1;b<d;b+=1)a.parentNode.insertBefore(a.cloneNode(!0),a)})}function c(a){L.getElementsByTagNameNS(a,J,"tab").forEach(function(a){a.textContent="\t"})}function k(a,c){function b(a,b){var d=g.documentElement.namespaceURI;"video/"===
b.substr(0,6)?(f=g.createElementNS(d,"video"),f.setAttribute("controls","controls"),k=g.createElementNS(d,"source"),a&&k.setAttribute("src",a),k.setAttribute("type",b),f.appendChild(k),c.parentNode.appendChild(f)):c.innerHtml="Unrecognised Plugin"}function d(a){b(a.url,a.mimetype)}var f,k,e,g=c.ownerDocument,h;if(e=c.getAttributeNS(H,"href"))try{h=a.getPart(e),h.onchange=d,h.load()}catch(ea){runtime.log("slight problem: "+String(ea))}else runtime.log("using MP4 data fallback"),e=q(c),b(e,"video/mp4")}
function f(a){var c=a.getElementsByTagName("head")[0],b,d;for(d=c.firstElementChild;d&&("style"!==d.localName||!d.hasAttribute("webodfcss"));)d=d.nextElementSibling;if(d)return a=parseInt(d.getAttribute("webodfcss"),10),d.setAttribute("webodfcss",a+1),d;"string"===String(typeof webodf_css)?b=webodf_css:(d="webodf.css",runtime.currentDirectory&&(d=runtime.currentDirectory(),0<d.length&&"/"!==d.substr(-1)&&(d+="/"),d+="../webodf.css"),b=runtime.readFileSync(d,"utf-8"));d=a.createElementNS(c.namespaceURI,
"style");d.setAttribute("media","screen, print, handheld, projection");d.setAttribute("type","text/css");d.setAttribute("webodfcss","1");d.appendChild(a.createTextNode(b));c.appendChild(d);return d}function v(a){var c=parseInt(a.getAttribute("webodfcss"),10);1===c?a.parentNode.removeChild(a):a.setAttribute("count",c-1)}function u(a){var c=a.getElementsByTagName("head")[0],b=a.createElementNS(c.namespaceURI,"style"),d="";b.setAttribute("type","text/css");b.setAttribute("media","screen, print, handheld, projection");
odf.Namespaces.forEachPrefix(function(a,c){d+="@namespace "+a+" url("+c+");\n"});d+="@namespace webodfhelper url(urn:webodf:names:helper);\n";b.appendChild(a.createTextNode(d));c.appendChild(b);return b}var x=odf.Namespaces.drawns,w=odf.Namespaces.fons,z=odf.Namespaces.officens,y=odf.Namespaces.stylens,t=odf.Namespaces.svgns,B=odf.Namespaces.tablens,J=odf.Namespaces.textns,H=odf.Namespaces.xlinkns,K=odf.Namespaces.presentationns,U=xmldom.XPath,L=webodfcore.DomUtils;odf.OdfCanvas=function(q,C){function Q(a,
c,b){function d(a,c,b,d){na.addToQueue(function(){e(a,c,b,d)})}var f,k;f=c.getElementsByTagNameNS(x,"image");for(c=0;c<f.length;c+=1)k=f.item(c),d("image"+String(c),a,k,b)}function w(a,c){function b(a,c){na.addToQueue(function(){k(a,c)})}var d,f,e;f=c.getElementsByTagNameNS(x,"plugin");for(d=0;d<f.length;d+=1)e=f.item(d),b(a,e)}function t(){var a;a=S.firstChild;var c=fa.getZoomLevel();a&&(S.style.WebkitTransformOrigin="0% 0%",S.style.MozTransformOrigin="0% 0%",S.style.msTransformOrigin="0% 0%",S.style.OTransformOrigin=
"0% 0%",S.style.transformOrigin="0% 0%",W&&((a=W.getMinimumHeightForAnnotationPane())?S.style.minHeight=a:S.style.removeProperty("min-height")),q.style.width=Math.round(c*S.offsetWidth)+"px",q.style.height=Math.round(c*S.offsetHeight)+"px",q.style.display="inline-block")}function H(b,d){var f=ja.sheet;L.removeAllChildNodes(q);S=ba.createElementNS(q.namespaceURI,"div");S.style.display="inline-block";S.style.background="white";S.style.setProperty("float","left","important");S.appendChild(d);q.appendChild(S);
ga=ba.createElementNS(q.namespaceURI,"div");ga.id="annotationsPane";Z=ba.createElementNS(q.namespaceURI,"div");Z.id="shadowContent";Z.style.position="absolute";Z.style.top=0;Z.style.left=0;b.getContentElement().appendChild(Z);var k=d.body,e,g=[],h;for(e=k.firstElementChild;e&&e!==k;)if(e.namespaceURI===x&&(g[g.length]=e),e.firstElementChild)e=e.firstElementChild;else{for(;e&&e!==k&&!e.nextElementSibling;)e=e.parentNode;e&&e.nextElementSibling&&(e=e.nextElementSibling)}for(h=0;h<g.length;h+=1)e=g[h],
p("frame"+String(h),e,f);g=U.getODFElementsWithXPath(k,".//*[*[@text:anchor-type='paragraph']]",odf.Namespaces.lookupNamespaceURI);for(e=0;e<g.length;e+=1)k=g[e],k.setAttributeNS&&k.setAttributeNS("urn:webodf:names:helper","containsparagraphanchor",!0);k=X;e=Z;var l,v,C,u,t,O;h=b.rootElement.ownerDocument;if((g=d.body.firstElementChild)&&g.namespaceURI===z&&("presentation"===g.localName||"drawing"===g.localName))for(g=g.firstElementChild;g;){if(l=(l=g.getAttributeNS(x,"master-page-name"))?k.getMasterPageElement(l):
null){v=g.getAttributeNS("urn:webodf:names:helper","styleid");C=h.createElementNS(x,"draw:page");O=l.firstElementChild;for(t=0;O;)"true"!==O.getAttributeNS(K,"placeholder")&&(u=O.cloneNode(!0),C.appendChild(u)),O=O.nextElementSibling,t+=1;var V=L.getElementsByTagNameNS(C,x,"frame");for(t=0;t<V.length;t+=1)u=V[t],(O=u.getAttributeNS(K,"class"))&&!/^(date-time|footer|header|page-number)$/.test(O)&&u.parentNode.removeChild(u);u=L.getElementsByTagNameNS(C,x,"*");for(t=0;t<u.length;t+=1)p(v+"_"+t,u[t],
f);e.appendChild(C);t=String(e.getElementsByTagNameNS(x,"page").length);r(C,J,"page-number",t);r(C,K,"header",m(b,g,"header"));r(C,K,"footer",m(b,g,"footer"));p(v,C,f);C.setAttributeNS("urn:webodf:names:helper","page-style-name",g.getAttributeNS(x,"style-name"));C.setAttributeNS(x,"draw:master-page-name",l.getAttributeNS(y,"name"))}g=g.nextElementSibling}k=q.namespaceURI;g=L.getElementsByTagNameNS(d.body,B,"table-cell");for(e=0;e<g.length;e+=1)h=g[e],h.hasAttributeNS(B,"number-columns-spanned")&&
h.setAttributeNS(k,"colspan",h.getAttributeNS(B,"number-columns-spanned")),h.hasAttributeNS(B,"number-rows-spanned")&&h.setAttributeNS(k,"rowspan",h.getAttributeNS(B,"number-rows-spanned"));n(d.body);a(d.body);c(d.body);Q(b,d.body,f);w(b,d.body);S.insertBefore(Z,S.firstChild);fa.setZoomableElement(S)}function F(a){D?(ga.parentNode||S.appendChild(ga),W&&W.forgetAnnotations(),W=new gui.AnnotationViewManager(ea,a.body,ga,Y),a=L.getElementsByTagNameNS(a.body,z,"annotation"),W.addAnnotations(a),t()):ga.parentNode&&
(S.removeChild(ga),W.forgetAnnotations(),t())}function aa(a){function c(){d(I);d(ha);d(ja);L.removeAllChildNodes(q);q.style.display="inline-block";var c=A.rootElement;q.ownerDocument.importNode(c,!0);X.setOdfContainer(A);g(A,I);b(A,X,ha);H(A,c);F(c);a||na.addToQueue(function(){var a=[A];if(da.hasOwnProperty("statereadychange")){var c=da.statereadychange,b;for(b=0;b<c.length;b+=1)c[b].apply(null,a)}})}A.state===odf.OdfContainer.DONE?c():(runtime.log("WARNING: refreshOdf called but ODF was not DONE."),
qa=runtime.setTimeout(function R(){A.state===odf.OdfContainer.DONE?c():(runtime.log("will be back later..."),qa=runtime.setTimeout(R,500))},100))}function N(a){na.clearQueue();L.removeAllChildNodes(q);q.appendChild(q.ownerDocument.createTextNode(runtime.tr("Loading")+a+"..."));q.removeAttribute("style");A=new odf.OdfContainer(a,function(a){A=a;aa(!1)})}runtime.assert(null!==q&&void 0!==q,"odf.OdfCanvas constructor needs DOM element");runtime.assert(null!==q.ownerDocument&&void 0!==q.ownerDocument,
"odf.OdfCanvas constructor needs DOM");var ea=this,ba=q.ownerDocument,A,X=new odf.Formatting,ca,S=null,ga=null,D=!1,Y=!1,W=null,P,I,ha,ja,Z,da={},qa,la,ia=!1,ma=!1,na=new h,fa=new gui.ZoomHelper,ka=C||new gui.SingleScrollViewport(q.parentNode);this.refreshCSS=function(){ia=!0;la.trigger()};this.refreshSize=function(){la.trigger()};this.odfContainer=function(){return A};this.setOdfContainer=function(a,c){A=a;aa(!0===c)};this.load=this.load=N;this.save=function(a){A.save(a)};this.addListener=function(a,
c){switch(a){case "click":q.addEventListener?q.addEventListener(a,c,!1):q.attachEvent?q.attachEvent("on"+a,c):q["on"+a]=c;break;default:var b;b=da.hasOwnProperty(a)?da[a]:da[a]=[];c&&-1===b.indexOf(c)&&b.push(c)}};this.getFormatting=function(){return X};this.getAnnotationViewManager=function(){return W};this.refreshAnnotations=function(){F(A.rootElement)};this.rerenderAnnotations=function(){W&&(ma=!0,la.trigger())};this.getSizer=function(){return S};this.enableAnnotations=function(a,c){a!==D&&(D=
a,Y=c,A&&F(A.rootElement))};this.addAnnotation=function(a){W&&(W.addAnnotations([a]),t())};this.forgetAnnotation=function(a){W&&(W.forgetAnnotation(a),t())};this.getZoomHelper=function(){return fa};this.setZoomLevel=function(a){fa.setZoomLevel(a)};this.getZoomLevel=function(){return fa.getZoomLevel()};this.fitToContainingElement=function(a,c){var b=fa.getZoomLevel(),d=q.offsetHeight/b,b=a/(q.offsetWidth/b);c/d<b&&(b=c/d);fa.setZoomLevel(b)};this.fitToWidth=function(a){var c=q.offsetWidth/fa.getZoomLevel();
fa.setZoomLevel(a/c)};this.fitSmart=function(a,c){var b,d;d=fa.getZoomLevel();b=q.offsetWidth/d;d=q.offsetHeight/d;b=a/b;void 0!==c&&c/d<b&&(b=c/d);fa.setZoomLevel(Math.min(1,b))};this.fitToHeight=function(a){var c=q.offsetHeight/fa.getZoomLevel();fa.setZoomLevel(a/c)};this.showFirstPage=function(){ca.showFirstPage()};this.showNextPage=function(){ca.showNextPage()};this.showPreviousPage=function(){ca.showPreviousPage()};this.showPage=function(a){ca.showPage(a);t()};this.getElement=function(){return q};
this.getViewport=function(){return ka};this.addCssForFrameWithImage=function(a){var c=a.getAttributeNS(x,"name"),b=a.firstElementChild;p(c,a,ja.sheet);b&&e(c+"img",A,b,ja.sheet)};this.destroy=function(a){var c=ba.getElementsByTagName("head")[0],b=[ca.destroy,la.destroy];runtime.clearTimeout(qa);ga&&ga.parentNode&&ga.parentNode.removeChild(ga);fa.destroy(function(){S&&(q.removeChild(S),S=null)});v(P);c.removeChild(I);c.removeChild(ha);c.removeChild(ja);webodfcore.Async.destroyAll(b,a)};P=f(ba);ca=
new l(u(ba));I=u(ba);ha=u(ba);ja=u(ba);la=webodfcore.Task.createRedrawTask(function(){ia&&(b(A,X,ha),ia=!1);ma&&(W&&W.rerenderAnnotations(),ma=!1);t()});fa.subscribe(gui.ZoomHelper.signalZoomChanged,t)}})();
webodfcore.PositionIterator=function(h,l,d,b){function g(){this.acceptNode=function(a){return!a||a.nodeType===k&&0===a.length?u:v}}function m(a){this.acceptNode=function(c){return!c||c.nodeType===k&&0===c.length?u:a.acceptNode(c)}}function r(){var c=n.currentNode,b=c.nodeType;a=b===k?c.length-1:b===f?1:0}function p(){if(null===n.previousSibling()){if(!n.parentNode()||n.currentNode===h)return n.firstChild(),!1;a=0}else r();return!0}function q(){var b=n.currentNode,d;d=c(b);if(b!==h)for(b=b.parentNode;b&&
b!==h;)c(b)===u&&(n.currentNode=b,d=u),b=b.parentNode;d===u?(a=n.currentNode.nodeType===k?b.length:1,b=e.nextPosition()):b=d===v?!0:e.nextPosition();b&&runtime.assert(c(n.currentNode)===v,"moveToAcceptedNode did not result in walker being on an accepted node");return b}var e=this,n,a,c,k=Node.TEXT_NODE,f=Node.ELEMENT_NODE,v=NodeFilter.FILTER_ACCEPT,u=NodeFilter.FILTER_REJECT;this.nextPosition=function(){var c=n.currentNode,b=c.nodeType;if(c===h)return!1;if(0===a&&b===f)null===n.firstChild()&&(a=1);
else if(b===k&&a+1<c.length)a+=1;else if(null!==n.nextSibling())a=0;else if(n.parentNode())a=1;else return!1;return!0};this.previousPosition=function(){var c=!0,b=n.currentNode;0===a?c=p():b.nodeType===k?--a:null!==n.lastChild()?r():b===h?c=!1:a=0;return c};this.previousNode=p;this.container=function(){var c=n.currentNode,b=c.nodeType;0===a&&b!==k&&(c=c.parentNode);return c};this.rightNode=function(){var b=n.currentNode,d=b.nodeType;if(d===k&&a===b.length)for(b=b.nextSibling;b&&c(b)!==v;)b=b.nextSibling;
else d===f&&1===a&&(b=null);return b};this.leftNode=function(){var b=n.currentNode;if(0===a)for(b=b.previousSibling;b&&c(b)!==v;)b=b.previousSibling;else if(b.nodeType===f)for(b=b.lastChild;b&&c(b)!==v;)b=b.previousSibling;return b};this.getCurrentNode=function(){return n.currentNode};this.unfilteredDomOffset=function(){if(n.currentNode.nodeType===k)return a;for(var c=0,b=n.currentNode,b=1===a?b.lastChild:b.previousSibling;b;)c+=1,b=b.previousSibling;return c};this.getPreviousSibling=function(){var a=
n.currentNode,c=n.previousSibling();n.currentNode=a;return c};this.getNextSibling=function(){var a=n.currentNode,c=n.nextSibling();n.currentNode=a;return c};this.setPositionBeforeElement=function(c){runtime.assert(!!c,"setPositionBeforeElement called without element");n.currentNode=c;a=0;return q()};this.setUnfilteredPosition=function(c,b){runtime.assert(!!c,"PositionIterator.setUnfilteredPosition called without container");n.currentNode=c;c.nodeType===k?(a=b,runtime.assert(b<=c.length,"Error in setPosition: "+
b+" > "+c.length),runtime.assert(0<=b,"Error in setPosition: "+b+" < 0"),b===c.length&&(n.nextSibling()?a=0:n.parentNode()?a=1:runtime.assert(!1,"Error in setUnfilteredPosition: position not valid."))):b<c.childNodes.length?(n.currentNode=c.childNodes.item(b),a=0):a=1;return q()};this.moveToEnd=function(){n.currentNode=h;a=1};this.moveToEndOfNode=function(c){c.nodeType===k?e.setUnfilteredPosition(c,c.length):(n.currentNode=c,a=1)};this.isBeforeNode=function(){return 0===a};this.getNodeFilter=function(){return c};
c=(d?new m(d):new g).acceptNode;c.acceptNode=c;l=l||NodeFilter.SHOW_ALL;runtime.assert(h.nodeType!==Node.TEXT_NODE,"Internet Explorer doesn't allow tree walker roots to be text nodes");n=h.ownerDocument.createTreeWalker(h,l,c,b);a=0;null===n.firstChild()&&(a=1)};webodfcore.PositionFilter=function(){};webodfcore.PositionFilter.FilterResult={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3};webodfcore.PositionFilter.prototype.acceptPosition=function(h){};webodfcore.StepDirection={PREVIOUS:1,NEXT:2};
webodfcore.StepIterator=function(h,l){function d(){a=null;k=c=void 0}function b(){void 0===k&&(k=h.acceptPosition(l)===e);return k}function g(a,c){d();return l.setUnfilteredPosition(a,c)}function m(){a||(a=l.container());return a}function r(){void 0===c&&(c=l.unfilteredDomOffset());return c}function p(){for(d();l.nextPosition();)if(d(),b())return!0;return!1}function q(){for(d();l.previousPosition();)if(d(),b())return!0;return!1}var e=webodfcore.PositionFilter.FilterResult.FILTER_ACCEPT,n=webodfcore.StepDirection.NEXT,
a,c,k;this.isStep=b;this.setPosition=g;this.container=m;this.offset=r;this.nextStep=p;this.previousStep=q;this.advanceStep=function(a){return a===n?p():q()};this.roundToClosestStep=function(){var a,c,d=b();d||(a=m(),c=r(),d=q(),d||(g(a,c),d=p()));return d};this.roundToPreviousStep=function(){var a=b();a||(a=q());return a};this.roundToNextStep=function(){var a=b();a||(a=p());return a};this.leftNode=function(){return l.leftNode()};this.snapshot=function(){return new webodfcore.StepIterator.StepSnapshot(m(),
r())};this.restore=function(a){g(a.container,a.offset)}};webodfcore.StepIterator.StepSnapshot=function(h,l){this.container=h;this.offset=l};
odf.StepUtils=function(){this.getContentBounds=function(h){var l=h.container(),d,b;runtime.assert(h.isStep(),"Step iterator must be on a step");l.nodeType===Node.TEXT_NODE&&0<h.offset()?d=h.offset():(l=h.leftNode())&&l.nodeType===Node.TEXT_NODE&&(d=l.length);l&&(l.nodeType===Node.TEXT_NODE?(runtime.assert(0<d,"Empty text node found"),b={container:l,startOffset:d-1,endOffset:d}):b={container:l,startOffset:0,endOffset:l.childNodes.length});return b}};ops.MemberProperties=function(){};
ops.Member=function(h,l){var d=new ops.MemberProperties;this.getMemberId=function(){return h};this.getProperties=function(){return d};this.setProperties=function(b){Object.keys(b).forEach(function(g){d[g]=b[g]})};this.removeProperties=function(b){Object.keys(b).forEach(function(b){"fullName"!==b&&"color"!==b&&"imageUrl"!==b&&d.hasOwnProperty(b)&&delete d[b]})};runtime.assert(!!h,"No memberId was supplied!");l.fullName||(l.fullName=runtime.tr("Unknown Author"));l.color||(l.color="black");l.imageUrl||
(l.imageUrl="avatar-joe.png");d=l};ops.Document=function(){};ops.Document.prototype.getMemberIds=function(){};ops.Document.prototype.removeCursor=function(h){};ops.Document.prototype.getDocumentElement=function(){};ops.Document.prototype.getRootNode=function(){};ops.Document.prototype.getDOMDocument=function(){};ops.Document.prototype.cloneDocumentElement=function(){};ops.Document.prototype.setDocumentElement=function(h){};ops.Document.prototype.subscribe=function(h,l){};
ops.Document.prototype.unsubscribe=function(h,l){};ops.Document.prototype.getCanvas=function(){};ops.Document.prototype.createRootFilter=function(h){};ops.Document.prototype.createPositionIterator=function(h){};ops.Document.prototype.hasCursor=function(h){};ops.Document.signalCursorAdded="cursor/added";ops.Document.signalCursorRemoved="cursor/removed";ops.Document.signalCursorMoved="cursor/moved";ops.Document.signalMemberAdded="member/added";ops.Document.signalMemberUpdated="member/updated";
ops.Document.signalMemberRemoved="member/removed";
webodfcore.Cursor=function(h,l){function d(a){a.parentNode&&(p.push(a.previousSibling),p.push(a.nextSibling),a.parentNode.removeChild(a))}function b(a,c,b){if(c.nodeType===Node.TEXT_NODE){runtime.assert(!!c,"putCursorIntoTextNode: invalid container");var d=c.parentNode;runtime.assert(!!d,"putCursorIntoTextNode: container without parent");runtime.assert(0<=b&&b<=c.length,"putCursorIntoTextNode: offset is out of bounds");0===b?d.insertBefore(a,c):(b!==c.length&&c.splitText(b),d.insertBefore(a,c.nextSibling))}else c.nodeType===
Node.ELEMENT_NODE&&c.insertBefore(a,c.childNodes.item(b));p.push(a.previousSibling);p.push(a.nextSibling)}var g=h.createElementNS("urn:webodf:names:cursor","cursor"),m=h.createElementNS("urn:webodf:names:cursor","anchor"),r,p=[],q=h.createRange(),e,n=webodfcore.DomUtils;this.getNode=function(){return g};this.getAnchorNode=function(){return m.parentNode?m:g};this.getSelectedRange=function(){e?(q.setStartBefore(g),q.collapse(!0)):(q.setStartAfter(r?m:g),q.setEndBefore(r?g:m));return q};this.setSelectedRange=
function(a,c){q&&q!==a&&q.detach();q=a;r=!1!==c;(e=a.collapsed)?(d(m),d(g),b(g,a.startContainer,a.startOffset)):(d(m),d(g),b(r?g:m,a.endContainer,a.endOffset),b(r?m:g,a.startContainer,a.startOffset));p.forEach(n.normalizeTextNodes);p.length=0};this.hasForwardSelection=function(){return r};this.remove=function(){d(g);p.forEach(n.normalizeTextNodes);p.length=0};g.setAttributeNS("urn:webodf:names:cursor","memberId",l);m.setAttributeNS("urn:webodf:names:cursor","memberId",l)};
ops.OdtCursor=function(h,l){var d=this,b={},g,m,r=new webodfcore.EventNotifier([ops.OdtCursor.signalCursorUpdated]);this.removeFromDocument=function(){m.remove()};this.subscribe=function(b,d){r.subscribe(b,d)};this.unsubscribe=function(b,d){r.unsubscribe(b,d)};this.getMemberId=function(){return h};this.getNode=function(){return m.getNode()};this.getAnchorNode=function(){return m.getAnchorNode()};this.getSelectedRange=function(){return m.getSelectedRange()};this.setSelectedRange=function(b,g){m.setSelectedRange(b,
g);r.emit(ops.OdtCursor.signalCursorUpdated,d)};this.hasForwardSelection=function(){return m.hasForwardSelection()};this.getDocument=function(){return l};this.getSelectionType=function(){return g};this.setSelectionType=function(d){b.hasOwnProperty(d)?g=d:runtime.log("Invalid selection type: "+d)};this.resetSelectionType=function(){d.setSelectionType(ops.OdtCursor.RangeSelection)};m=new webodfcore.Cursor(l.getDOMDocument(),h);b[ops.OdtCursor.RangeSelection]=!0;b[ops.OdtCursor.RegionSelection]=!0;d.resetSelectionType()};
ops.OdtCursor.RangeSelection="Range";ops.OdtCursor.RegionSelection="Region";ops.OdtCursor.signalCursorUpdated="cursorUpdated";webodfcore.LoopWatchDog=function(h,l){var d=Date.now(),b=0;this.check=function(){var g;if(h&&(g=Date.now(),g-d>h))throw runtime.log("alert","watchdog timeout"),"timeout!";if(0<l&&(b+=1,b>l))throw runtime.log("alert","watchdog loop overflow"),"loop overflow";}};
(function(){var h=0;ops.StepsCache=function(l,d,b){function g(a,c){var d=this;this.nodeId=a;this.steps=-1;this.node=c;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(a){a.setPositionBeforeElement(c);b(d.steps,a)}}function m(a,c,d){var f=this;this.nodeId=a;this.steps=c;this.node=d;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(a){a.setUnfilteredPosition(d,0);b(f.steps,a)}}function r(a,c){var b="["+a.nodeId;c&&(b+=" => "+c.nodeId);return b+
"]"}function p(){if(!0===ops.StepsCache.ENABLE_CACHE_VERIFICATION){for(var a=u,c,b,d,f=new webodfcore.LoopWatchDog(0,1E5),e={};a;){f.check();(c=a.previousBookmark)?runtime.assert(c.nextBookmark===a,"Broken bookmark link to previous @"+r(c,a)):(runtime.assert(a===u,"Broken bookmark link @"+r(a)),runtime.assert(void 0===x||u===u||u.steps<=x,"Base point is damaged @"+r(a)));(b=a.nextBookmark)&&runtime.assert(b.previousBookmark===a,"Broken bookmark link to next @"+r(a,b));if(void 0===x||a===u||a.steps<=
x)runtime.assert(v.containsNode(l,a.node),"Disconnected node is being reported as undamaged @"+r(a)),c&&(d=a.node.compareDocumentPosition(c.node),runtime.assert(0===d||0!==(d&z),"Bookmark order with previous does not reflect DOM order @"+r(c,a))),b&&v.containsNode(l,b.node)&&(d=a.node.compareDocumentPosition(b.node),runtime.assert(0===d||0!==(d&w),"Bookmark order with next does not reflect DOM order @"+r(a,b)));a=a.nextBookmark}Object.keys(k).forEach(function(a){var c=k[a];(void 0===x||a<=x)&&runtime.assert(c.steps<=
a,"Bookmark step of "+c.steps+" exceeds cached step lookup for "+a+" @"+r(c));runtime.assert(!1===e.hasOwnProperty(c.nodeId),"Bookmark "+r(c)+" appears twice in cached step lookup at steps "+e[c.nodeId]+" and "+a);e[c.nodeId]=a})}}function q(a){var c="";a.nodeType===Node.ELEMENT_NODE&&(c=a.getAttributeNS("urn:webodf:names:steps","nodeId")||"");return c}function e(a){var c=h.toString();a.setAttributeNS("urn:webodf:names:steps","nodeId",c);h+=1;return c}function n(a){var c,b,f=new webodfcore.LoopWatchDog(0,
1E4);void 0!==x&&a>x&&(a=x);for(c=Math.floor(a/d)*d;!b&&0<=c;)b=k[c],c-=d;for(b=b||u;b.nextBookmark&&b.nextBookmark.steps<=a;)f.check(),b=b.nextBookmark;runtime.assert(-1===a||b.steps<=a,"Bookmark @"+r(b)+" at step "+b.steps+" exceeds requested step of "+a);return b}function a(a){a.previousBookmark&&(a.previousBookmark.nextBookmark=a.nextBookmark);a.nextBookmark&&(a.nextBookmark.previousBookmark=a.previousBookmark)}function c(a){for(var c,b=null;!b&&a&&a!==l;)(c=q(a))&&(b=f[c])&&b.node!==a&&(runtime.log("Cloned node detected. Creating new bookmark"),
b=null,a.removeAttributeNS("urn:webodf:names:steps","nodeId")),a=a.parentNode;return b}var k={},f={},v=webodfcore.DomUtils,u,x,w=Node.DOCUMENT_POSITION_FOLLOWING,z=Node.DOCUMENT_POSITION_PRECEDING;this.updateBookmark=function(c,b){var h,m=Math.ceil(c/d)*d,r,t,U;if(void 0!==x&&x<c){r=n(x);for(t=r.nextBookmark;t&&t.steps<=c;)h=t.nextBookmark,U=Math.ceil(t.steps/d)*d,k[U]===t&&delete k[U],v.containsNode(l,t.node)?t.steps=c+1:(a(t),delete f[t.nodeId]),t=h;x=c}else r=n(c);t=q(b)||e(b);h=f[t];h?h.node!==
b&&(runtime.log("Cloned node detected. Creating new bookmark"),t=e(b),h=f[t]=new g(t,b)):h=f[t]=new g(t,b);t=h;t.steps!==c&&(h=Math.ceil(t.steps/d)*d,h!==m&&k[h]===t&&delete k[h],t.steps=c);if(r!==t&&r.nextBookmark!==t){if(r.steps===t.steps)for(;0!==(t.node.compareDocumentPosition(r.node)&w)&&r!==u;)r=r.previousBookmark;r!==t&&r.nextBookmark!==t&&(a(t),h=r.nextBookmark,t.nextBookmark=r.nextBookmark,t.previousBookmark=r,r.nextBookmark=t,h&&(h.previousBookmark=t))}r=k[m];if(!r||t.steps>r.steps)k[m]=
t;p()};this.setToClosestStep=function(a,c){var b;p();b=n(a);b.setIteratorPosition(c);return b.steps};this.setToClosestDomPoint=function(a,b,d){var f,e;p();if(a===l&&0===b)f=u;else if(a===l&&b===l.childNodes.length)for(e in f=u,k)k.hasOwnProperty(e)&&(a=k[e],a.steps>f.steps&&(f=a));else if(f=c(a.childNodes.item(b)||a),!f)for(d.setUnfilteredPosition(a,b);!f&&d.previousNode();)f=c(d.getCurrentNode());f=f||u;void 0!==x&&f.steps>x&&(f=n(x));f.setIteratorPosition(d);return f.steps};this.damageCacheAfterStep=
function(a){0>a&&(a=-1);void 0===x?x=a:a<x&&(x=a);p()};(function(){var a=q(l)||e(l);u=new m(a,0,l)})()};ops.StepsCache.ENABLE_CACHE_VERIFICATION=!1;ops.StepsCache.Bookmark=function(){};ops.StepsCache.Bookmark.prototype.setIteratorPosition=function(h){}})();
(function(){ops.OdtStepsTranslator=function(h,l,d,b){function g(a,b,d){var c=b.getCurrentNode();b.isBeforeNode()&&p.isParagraph(c)&&(d||(a+=1),r.updateBookmark(a,c))}function m(c,b){if(!b||d.acceptPosition(c)===e)return!0;for(;c.previousPosition();)if(d.acceptPosition(c)===e){if(b(n,c.container(),c.unfilteredDomOffset()))return!0;break}for(;c.nextPosition();)if(d.acceptPosition(c)===e){if(b(a,c.container(),c.unfilteredDomOffset()))return!0;break}return!1}var r,p=odf.OdfUtils,q=webodfcore.DomUtils,
e=webodfcore.PositionFilter.FilterResult.FILTER_ACCEPT,n=webodfcore.StepDirection.PREVIOUS,a=webodfcore.StepDirection.NEXT;this.convertStepsToDomPoint=function(a){var c,b;if(isNaN(a))throw new TypeError("Requested steps is not numeric ("+a+")");if(0>a)throw new RangeError("Requested steps is negative ("+a+")");for(c=r.setToClosestStep(a,l);c<a&&l.nextPosition();)(b=d.acceptPosition(l)===e)&&(c+=1),g(c,l,b);if(c!==a)throw new RangeError("Requested steps ("+a+") exceeds available steps ("+c+")");return{node:l.container(),
offset:l.unfilteredDomOffset()}};this.convertDomPointToSteps=function(a,b,f){var c;q.containsNode(h,a)||(b=0>q.comparePoints(h,0,a,b),a=h,b=b?0:h.childNodes.length);l.setUnfilteredPosition(a,b);m(l,f)||l.setUnfilteredPosition(a,b);f=l.container();b=l.unfilteredDomOffset();a=r.setToClosestDomPoint(f,b,l);if(0>q.comparePoints(l.container(),l.unfilteredDomOffset(),f,b))return 0<a?a-1:a;for(;(l.container()!==f||l.unfilteredDomOffset()!==b)&&l.nextPosition();)(c=d.acceptPosition(l)===e)&&(a+=1),g(a,l,
c);return a+0};this.prime=function(){var a,b;for(a=r.setToClosestStep(0,l);l.nextPosition();)(b=d.acceptPosition(l)===e)&&(a+=1),g(a,l,b)};this.handleStepsInserted=function(a){r.damageCacheAfterStep(a.position)};this.handleStepsRemoved=function(a){r.damageCacheAfterStep(a.position-1)};r=new ops.StepsCache(h,b,function(a,b){do{if(d.acceptPosition(b)===e){g(a,b,!0);break}g(a-1,b,!1)}while(b.nextPosition())})}})();ops.Operation=function(){};ops.Operation.prototype.init=function(h){};
ops.Operation.prototype.execute=function(h){};ops.Operation.prototype.spec=function(){};
ops.TextPositionFilter=function(){function h(b,d){for(;b&&d(b)!==m;)b=b.previousSibling;return b}function l(b,g,e,n){var a;if(g){if(d.isInlineRoot(g)&&d.isGroupingElement(e))return r;n=d.lookLeftForCharacter(g);if(1===n||2===n&&(d.scanRightForAnyCharacter(e)||d.scanRightForAnyCharacter(d.nextNode(b))))return m}else if(d.isGroupingElement(b)&&d.isInlineRoot(h(b.previousSibling,n)))return m;n=null===g&&d.isParagraph(b);a=d.lookRightForCharacter(e);if(n)return a?m:d.scanRightForAnyCharacter(e)?r:m;if(!a)return r;
g=g||d.previousNode(b);return d.scanLeftForAnyCharacter(g)?r:m}var d=odf.OdfUtils,b=Node.ELEMENT_NODE,g=Node.TEXT_NODE,m=webodfcore.PositionFilter.FilterResult.FILTER_ACCEPT,r=webodfcore.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(h){var p=h.container(),e=p.nodeType,n,a,c;if(e!==b&&e!==g)return r;if(e===g){e=h.unfilteredDomOffset();n=p.data;runtime.assert(e!==n.length,"Unexpected offset.");if(0<e){h=n[e-1];if(!d.isODFWhitespace(h))return m;if(1<e)if(h=n[e-2],!d.isODFWhitespace(h))c=
m;else{if(!d.isODFWhitespace(n.substr(0,e)))return r}else a=d.previousNode(p),d.scanLeftForNonSpace(a)&&(c=m);if(c===m)return d.isTrailingWhitespace(p,e)?r:m;h=n[e];return d.isODFWhitespace(h)?r:d.scanLeftForAnyCharacter(d.previousNode(p))?r:m}a=h.leftNode();c=p;p=p.parentNode;c=l(p,a,c,h.getNodeFilter())}else d.isGroupingElement(p)?(a=h.leftNode(),c=h.rightNode(),c=l(p,a,c,h.getNodeFilter())):c=r;return c}};
webodfcore.NodeFilterChain=function(h){var l=NodeFilter.FILTER_REJECT,d=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(b){var g;for(g=0;g<h.length;g+=1)if(h[g].acceptNode(b)===l)return l;return d}};webodfcore.PositionFilterChain=function(){var h=[],l=webodfcore.PositionFilter.FilterResult.FILTER_ACCEPT,d=webodfcore.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(b){var g;for(g=0;g<h.length;g+=1)if(h[g].acceptPosition(b)===d)return d;return l};this.addFilter=function(b){h.push(b)}};
function RootFilter(h,l,d){var b=webodfcore.PositionFilter.FilterResult.FILTER_ACCEPT,g=webodfcore.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(m){m=m.container();var r;r="string"===typeof h?l[h].getNode():h;return d(m)===d(r)?b:g}}
ops.OdtDocument=function(h){function l(a){return new webodfcore.PositionIterator(a,B,K,!1)}function d(){var a=h.odfContainer().getContentElement(),c=a&&a.localName;runtime.assert("text"===c,"Unsupported content element type '"+c+"' for OdtDocument");return a}function b(){return a.getDocumentElement().ownerDocument}function g(a){for(;a&&!(a.namespaceURI===odf.Namespaces.officens&&"text"===a.localName||a.namespaceURI===odf.Namespaces.officens&&"annotation"===a.localName);)a=a.parentNode;return a}function m(a,
c,b,d){d=l(d);var f;1===b.length?f=b[0]:(f=new webodfcore.PositionFilterChain,b.forEach(f.addFilter));b=new webodfcore.StepIterator(f,d);b.setPosition(a,c);return b}function r(a){var c=l(d());a=y.convertStepsToDomPoint(a);c.setUnfilteredPosition(a.node,a.offset);return c}function p(a){return a===w}function q(c){var b=c.spec(),d=b.memberid,f=(new Date(b.timestamp)).toISOString(),b=h.odfContainer();c.isEdit&&(d=a.getMember(d).getProperties().fullName,b.setMetadata({"dc:creator":d,"dc:date":f},null),
d={setProperties:{"dc:creator":d,"dc:date":f},removedProperties:[]},t||(d.setProperties["meta:editing-cycles"]=b.incrementEditingCycles(),b.setMetadata(null,["meta:editing-duration","meta:document-statistic"])),t=c,a.emit(ops.OdtDocument.signalMetadataUpdated,d))}function e(a){var b,d=[],e,g=2;runtime.assert(a.isStep(),"positionIterator is not at a step");do{if(b=c.getContentBounds(a))if(b=b.container,k.isDowngradableSpaceElement(b)){for(e=b.lastChild;b.firstChild;)d.push(b.firstChild),b.parentNode.insertBefore(b.firstChild,
b);b.parentNode.removeChild(b);a.setPosition(e,e.nodeType===Node.TEXT_NODE?e.length:e.childNodes.length);a.roundToPreviousStep()}--g}while(0<g&&a.nextStep());d.forEach(f.normalizeTextNodes)}function n(a,c,b){a=a.childNodes.item(c)||a;return(a=k.getParagraphElement(a))&&f.containsNode(b,a)?a:b}var a=this,c,k=odf.OdfUtils,f=webodfcore.DomUtils,v={},u={},x=new webodfcore.EventNotifier([ops.Document.signalMemberAdded,ops.Document.signalMemberUpdated,ops.Document.signalMemberRemoved,ops.Document.signalCursorAdded,
ops.Document.signalCursorRemoved,ops.Document.signalCursorMoved,ops.OdtDocument.signalParagraphChanged,ops.OdtDocument.signalParagraphStyleModified,ops.OdtDocument.signalCommonStyleCreated,ops.OdtDocument.signalCommonStyleDeleted,ops.OdtDocument.signalTableAdded,ops.OdtDocument.signalOperationStart,ops.OdtDocument.signalOperationEnd,ops.OdtDocument.signalProcessingBatchStart,ops.OdtDocument.signalProcessingBatchEnd,ops.OdtDocument.signalUndoStackChanged,ops.OdtDocument.signalStepsInserted,ops.OdtDocument.signalStepsRemoved,
ops.OdtDocument.signalMetadataUpdated,ops.OdtDocument.signalAnnotationAdded]),w=webodfcore.StepDirection.NEXT,z,y,t,B=NodeFilter.SHOW_ALL,J=new gui.BlacklistNamespaceNodeFilter(["urn:webodf:names:cursor","urn:webodf:names:editinfo"]),H=new gui.OdfTextBodyNodeFilter,K=new webodfcore.NodeFilterChain([J,H]);this.createPositionIterator=l;this.getDocumentElement=function(){return h.odfContainer().rootElement};this.cloneDocumentElement=function(){var c=a.getDocumentElement(),b=h.getAnnotationViewManager();
b&&b.forgetAnnotations();c=c.cloneNode(!0);h.refreshAnnotations();a.fixCursorPositions();return c};this.setDocumentElement=function(a){var c=h.odfContainer();x.unsubscribe(ops.OdtDocument.signalStepsInserted,y.handleStepsInserted);x.unsubscribe(ops.OdtDocument.signalStepsRemoved,y.handleStepsRemoved);c.setRootElement(a);h.setOdfContainer(c,!0);h.refreshCSS();a=d();y=new ops.OdtStepsTranslator(a,l(a),z,500);x.subscribe(ops.OdtDocument.signalStepsInserted,y.handleStepsInserted);x.subscribe(ops.OdtDocument.signalStepsRemoved,
y.handleStepsRemoved)};this.getDOMDocument=b;this.getRootElement=g;this.createStepIterator=m;this.getIteratorAtPosition=r;this.convertCursorStepToDomPoint=function(a){return y.convertStepsToDomPoint(a)};this.convertDomPointToCursorStep=function(a,c,b){var d;b===w&&(d=p);return y.convertDomPointToSteps(a,c,d)};this.convertDomToCursorRange=function(a){var c;c=y.convertDomPointToSteps(a.anchorNode,a.anchorOffset);a=a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset?c:y.convertDomPointToSteps(a.focusNode,
a.focusOffset);return{position:c,length:a-c}};this.convertCursorToDomRange=function(a,c){var d=b().createRange(),f,k;f=y.convertStepsToDomPoint(a);c?(k=y.convertStepsToDomPoint(a+c),0<c?(d.setStart(f.node,f.offset),d.setEnd(k.node,k.offset)):(d.setStart(k.node,k.offset),d.setEnd(f.node,f.offset))):d.setStart(f.node,f.offset);return d};this.upgradeWhitespacesAtPosition=function(a){var b=r(a),b=new webodfcore.StepIterator(z,b),d,f=2;runtime.assert(b.isStep(),"positionIterator is not at a step (requested step: "+
a+")");do{if(d=c.getContentBounds(b))if(a=d.container,d=d.startOffset,a.nodeType===Node.TEXT_NODE&&k.isSignificantWhitespace(a,d)){runtime.assert(" "===a.data[d],"upgradeWhitespaceToElement: textNode.data[offset] should be a literal space");var e=a.ownerDocument.createElementNS(odf.Namespaces.textns,"text:s"),g=a.parentNode,h=a;e.appendChild(a.ownerDocument.createTextNode(" "));1===a.length?g.replaceChild(e,a):(a.deleteData(d,1),0<d&&(d<a.length&&a.splitText(d),h=a.nextSibling),g.insertBefore(e,h));
a=e;b.setPosition(a,a.childNodes.length);b.roundToPreviousStep()}--f}while(0<f&&b.nextStep())};this.downgradeWhitespaces=e;this.downgradeWhitespacesAtPosition=function(a){a=r(a);a=new webodfcore.StepIterator(z,a);e(a)};this.getTextNodeAtStep=function(c,d){var f=r(c),k=f.container(),e,g;k.nodeType===Node.TEXT_NODE?(e=k,g=f.unfilteredDomOffset(),0<e.length&&(0<g&&(e=e.splitText(g)),e.parentNode.insertBefore(b().createTextNode(""),e),e=e.previousSibling,g=0)):(e=b().createTextNode(""),g=0,k.insertBefore(e,
f.rightNode()));if(d){if(v[d]&&a.getCursorPosition(d)===c){for(f=v[d].getNode();f.nextSibling&&"cursor"===f.nextSibling.localName;)f.parentNode.insertBefore(f.nextSibling,f);0<e.length&&e.nextSibling!==f&&(e=b().createTextNode(""),g=0);f.parentNode.insertBefore(e,f)}}else for(;e.nextSibling&&"cursor"===e.nextSibling.localName;)e.parentNode.insertBefore(e.nextSibling,e);for(;e.previousSibling&&e.previousSibling.nodeType===Node.TEXT_NODE;)f=e.previousSibling,f.appendData(e.data),g=f.length,e=f,e.parentNode.removeChild(e.nextSibling);
for(;e.nextSibling&&e.nextSibling.nodeType===Node.TEXT_NODE;)f=e.nextSibling,e.appendData(f.data),e.parentNode.removeChild(f);return{textNode:e,offset:g}};this.fixCursorPositions=function(){Object.keys(v).forEach(function(c){var b=v[c],d=g(b.getNode()),f=a.createRootFilter(d),k,e,h,l=!1;h=b.getSelectedRange();k=n(h.startContainer,h.startOffset,d);e=m(h.startContainer,h.startOffset,[z,f],k);h.collapsed?d=e:(k=n(h.endContainer,h.endOffset,d),d=m(h.endContainer,h.endOffset,[z,f],k));e.isStep()&&d.isStep()?
e.container()!==d.container()||e.offset()!==d.offset()||h.collapsed&&b.getAnchorNode()===b.getNode()||(l=!0,h.setStart(e.container(),e.offset()),h.collapse(!0)):(l=!0,runtime.assert(e.roundToClosestStep(),"No walkable step found for cursor owned by "+c),h.setStart(e.container(),e.offset()),runtime.assert(d.roundToClosestStep(),"No walkable step found for cursor owned by "+c),h.setEnd(d.container(),d.offset()));l&&(b.setSelectedRange(h,b.hasForwardSelection()),a.emit(ops.Document.signalCursorMoved,
b))})};this.getCursorPosition=function(a){return(a=v[a])?y.convertDomPointToSteps(a.getNode(),0):0};this.getCursorSelection=function(a){a=v[a];var c=0,b=0;a&&(c=y.convertDomPointToSteps(a.getNode(),0),b=y.convertDomPointToSteps(a.getAnchorNode(),0));return{position:b,length:c-b}};this.getPositionFilter=function(){return z};this.getOdfCanvas=function(){return h};this.getCanvas=function(){return h};this.getRootNode=d;this.addMember=function(a){runtime.assert(void 0===u[a.getMemberId()],"This member already exists");
u[a.getMemberId()]=a};this.getMember=function(a){return u.hasOwnProperty(a)?u[a]:null};this.removeMember=function(a){delete u[a]};this.getCursor=function(a){return v[a]};this.hasCursor=function(a){return v.hasOwnProperty(a)};this.getMemberIds=function(){return Object.keys(u)};this.addCursor=function(c){runtime.assert(!!c,"OdtDocument::addCursor without cursor");var b=c.getMemberId(),d=a.convertCursorToDomRange(0,0);runtime.assert("string"===typeof b,"OdtDocument::addCursor has cursor without memberid");
runtime.assert(!v[b],"OdtDocument::addCursor is adding a duplicate cursor with memberid "+b);c.setSelectedRange(d,!0);v[b]=c};this.removeCursor=function(c){var b=v[c];return b?(b.removeFromDocument(),delete v[c],a.emit(ops.Document.signalCursorRemoved,c),!0):!1};this.moveCursor=function(c,b,d,f){c=v[c];b=a.convertCursorToDomRange(b,d);c&&(c.setSelectedRange(b,0<=d),c.setSelectionType(f||ops.OdtCursor.RangeSelection))};this.getFormatting=function(){return h.getFormatting()};this.emit=function(a,c){x.emit(a,
c)};this.subscribe=function(a,c){x.subscribe(a,c)};this.unsubscribe=function(a,c){x.unsubscribe(a,c)};this.createRootFilter=function(a){return new RootFilter(a,v,g)};this.close=function(a){a()};this.destroy=function(a){a()};(function(){var a=d();z=new ops.TextPositionFilter;c=new odf.StepUtils;y=new ops.OdtStepsTranslator(a,l(a),z,500);x.subscribe(ops.OdtDocument.signalStepsInserted,y.handleStepsInserted);x.subscribe(ops.OdtDocument.signalStepsRemoved,y.handleStepsRemoved);x.subscribe(ops.OdtDocument.signalOperationEnd,
q);x.subscribe(ops.OdtDocument.signalProcessingBatchEnd,webodfcore.Task.processTasks)})()};ops.OdtDocument.signalParagraphChanged="paragraph/changed";ops.OdtDocument.signalTableAdded="table/added";ops.OdtDocument.signalCommonStyleCreated="style/created";ops.OdtDocument.signalCommonStyleDeleted="style/deleted";ops.OdtDocument.signalParagraphStyleModified="paragraphstyle/modified";ops.OdtDocument.signalOperationStart="operation/start";ops.OdtDocument.signalOperationEnd="operation/end";
ops.OdtDocument.signalProcessingBatchStart="router/batchstart";ops.OdtDocument.signalProcessingBatchEnd="router/batchend";ops.OdtDocument.signalUndoStackChanged="undo/changed";ops.OdtDocument.signalStepsInserted="steps/inserted";ops.OdtDocument.signalStepsRemoved="steps/removed";ops.OdtDocument.signalMetadataUpdated="metadata/updated";ops.OdtDocument.signalAnnotationAdded="annotation/added";
ops.OpAddAnnotation=function(){function h(b,d,e){var g=b.getTextNodeAtStep(e,l);g&&(b=g.textNode,e=b.parentNode,g.offset!==b.length&&b.splitText(g.offset),e.insertBefore(d,b.nextSibling),0===b.length&&e.removeChild(b))}var l,d,b,g,m,r;this.init=function(h){l=h.memberid;d=parseInt(h.timestamp,10);b=parseInt(h.position,10);g=void 0!==h.length?parseInt(h.length,10)||0:void 0;m=h.name};this.isEdit=!0;this.group=void 0;this.execute=function(p){var q=p.getCursor(l),e,n;r=p.getDOMDocument();var a=new Date(d),
c,k,f;c=r.createElementNS(odf.Namespaces.officens,"office:annotation");c.setAttributeNS(odf.Namespaces.officens,"office:name",m);e=r.createElementNS(odf.Namespaces.dcns,"dc:creator");e.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",l);e.textContent=p.getMember(l).getProperties().fullName;n=r.createElementNS(odf.Namespaces.dcns,"dc:date");n.appendChild(r.createTextNode(a.toISOString()));a=r.createElementNS(odf.Namespaces.textns,"text:list");k=r.createElementNS(odf.Namespaces.textns,
"text:list-item");f=r.createElementNS(odf.Namespaces.textns,"text:p");k.appendChild(f);a.appendChild(k);c.appendChild(e);c.appendChild(n);c.appendChild(a);void 0!==g&&(e=r.createElementNS(odf.Namespaces.officens,"office:annotation-end"),e.setAttributeNS(odf.Namespaces.officens,"office:name",m),c.annotationEndElement=e,h(p,e,b+g));h(p,c,b);p.emit(ops.OdtDocument.signalStepsInserted,{position:b});q&&(e=r.createRange(),n=c.getElementsByTagNameNS(odf.Namespaces.textns,"p")[0],e.selectNodeContents(n),
q.setSelectedRange(e,!1),q.setSelectionType(ops.OdtCursor.RangeSelection),p.emit(ops.Document.signalCursorMoved,q));p.getOdfCanvas().addAnnotation(c);p.fixCursorPositions();p.emit(ops.OdtDocument.signalAnnotationAdded,{memberId:l,annotation:c});return!0};this.spec=function(){return{optype:"AddAnnotation",memberid:l,timestamp:d,position:b,length:g,name:m}}};
ops.OpAddCursor=function(){var h,l;this.init=function(d){h=d.memberid;l=d.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(d){var b=d.getCursor(h);if(b)return!1;b=new ops.OdtCursor(h,d);d.addCursor(b);d.emit(ops.Document.signalCursorAdded,b);return!0};this.spec=function(){return{optype:"AddCursor",memberid:h,timestamp:l}}};
ops.OpAddMember=function(){var h,l,d;this.init=function(b){h=b.memberid;l=parseInt(b.timestamp,10);d=b.setProperties};this.isEdit=!1;this.group=void 0;this.execute=function(b){var g;if(b.getMember(h))return!1;g=new ops.Member(h,d);b.addMember(g);b.emit(ops.Document.signalMemberAdded,g);return!0};this.spec=function(){return{optype:"AddMember",memberid:h,timestamp:l,setProperties:d}}};
ops.OpAddStyle=function(){var h,l,d,b,g,m,r=odf.Namespaces.stylens;this.init=function(p){h=p.memberid;l=p.timestamp;d=p.styleName;b=p.styleFamily;g="true"===p.isAutomaticStyle||!0===p.isAutomaticStyle;m=p.setProperties};this.isEdit=!0;this.group=void 0;this.execute=function(h){var l=h.getOdfCanvas().odfContainer(),e=h.getFormatting(),n=h.getDOMDocument().createElementNS(r,"style:style");if(!n)return!1;m&&e.updateStyle(n,m);n.setAttributeNS(r,"style:family",b);n.setAttributeNS(r,"style:name",d);g?
l.rootElement.automaticStyles.appendChild(n):l.rootElement.styles.appendChild(n);h.getOdfCanvas().refreshCSS();g||h.emit(ops.OdtDocument.signalCommonStyleCreated,{name:d,family:b});return!0};this.spec=function(){return{optype:"AddStyle",memberid:h,timestamp:l,styleName:d,styleFamily:b,isAutomaticStyle:g,setProperties:m}}};
odf.ObjectNameGenerator=function(h,l){function d(a,c){var b={};this.generateName=function(){var d=c(),f=0,k;do k=a+f,f+=1;while(b[k]||d[k]);b[k]=!0;return k}}function b(){var a={};[h.rootElement.automaticStyles,h.rootElement.styles].forEach(function(c){for(c=c.firstElementChild;c;)c.namespaceURI===g&&"style"===c.localName&&(a[c.getAttributeNS(g,"name")]=!0),c=c.nextElementSibling});return a}var g=odf.Namespaces.stylens,m=odf.Namespaces.drawns,r=odf.Namespaces.xlinkns,p=(new webodfcore.Utils).hashString(l),
q=null,e=null,n=null,a={},c={};this.generateStyleName=function(){null===q&&(q=new d("auto"+p+"_",function(){return b()}));return q.generateName()};this.generateFrameName=function(){var c,b,g;if(null===e){b=h.rootElement.body.getElementsByTagNameNS(m,"frame");for(c=0;c<b.length;c+=1)g=b.item(c),a[g.getAttributeNS(m,"name")]=!0;e=new d("fr"+p+"_",function(){return a})}return e.generateName()};this.generateImageName=function(){var a,b,e;if(null===n){e=h.rootElement.body.getElementsByTagNameNS(m,"image");
for(a=0;a<e.length;a+=1)b=e.item(a),b=b.getAttributeNS(r,"href"),b=b.substring(9,b.lastIndexOf(".")),c[b]=!0;n=new d("img"+p+"_",function(){return c})}return n.generateName()}};
odf.TextStyleApplicator=function(h,l,d){function b(b){function d(a,b){return"object"===typeof a&&"object"===typeof b?Object.keys(a).every(function(c){return d(a[c],b[c])}):a===b}var a={};this.isStyleApplied=function(c){c=l.getAppliedStylesForElement(c,a).styleProperties;return d(b,c)}}function g(b){var e={};this.applyStyleToContainer=function(a){var c;c=a.getAttributeNS(p,"style-name");var k=a.ownerDocument;c=c||"";if(!e.hasOwnProperty(c)){var f=c,g;g=c?l.createDerivedStyleObject(c,"text",b):b;k=
k.createElementNS(q,"style:style");l.updateStyle(k,g);k.setAttributeNS(q,"style:name",h.generateStyleName());k.setAttributeNS(q,"style:family","text");k.setAttributeNS("urn:webodf:names:scope","scope","document-content");d.appendChild(k);e[f]=k}c=e[c].getAttributeNS(q,"name");a.setAttributeNS(p,"text:style-name",c)}}function m(b,d){var a=b.ownerDocument,c=b.parentNode,k,f,e,g=new webodfcore.LoopWatchDog(1E4);f=[];f.push(b);for(e=b.nextSibling;e&&r.rangeContainsNode(d,e);)g.check(),f.push(e),e=e.nextSibling;
"span"!==c.localName||c.namespaceURI!==p?(k=a.createElementNS(p,"text:span"),c.insertBefore(k,b),a=!1):(b.previousSibling&&!r.rangeContainsNode(d,c.firstChild)?(k=c.cloneNode(!1),c.parentNode.insertBefore(k,c.nextSibling)):k=c,a=!0);f.forEach(function(a){a.parentNode!==k&&k.appendChild(a)});if(e&&a)for(f=k.cloneNode(!1),k.parentNode.insertBefore(f,k.nextSibling);e;)g.check(),a=e.nextSibling,f.appendChild(e),e=a;return k}var r=webodfcore.DomUtils,p=odf.Namespaces.textns,q=odf.Namespaces.stylens;this.applyStyle=
function(d,h,a){var c={},k,f,e,l;runtime.assert(a&&a.hasOwnProperty("style:text-properties"),"applyStyle without any text properties");c["style:text-properties"]=a["style:text-properties"];e=new g(c);l=new b(c);d.forEach(function(a){k=l.isStyleApplied(a);!1===k&&(f=m(a,h),e.applyStyleToContainer(f))})}};
ops.OpApplyDirectStyling=function(){function h(b,d,g){var a=b.getOdfCanvas().odfContainer(),c=p.splitBoundaries(d),k=r.getTextNodes(d,!1);(new odf.TextStyleApplicator(new odf.ObjectNameGenerator(a,l),b.getFormatting(),a.rootElement.automaticStyles)).applyStyle(k,d,g);c.forEach(p.normalizeTextNodes)}var l,d,b,g,m,r=odf.OdfUtils,p=webodfcore.DomUtils;this.init=function(h){l=h.memberid;d=h.timestamp;b=parseInt(h.position,10);g=parseInt(h.length,10);m=h.setProperties};this.isEdit=!0;this.group=void 0;
this.execute=function(p){var e=p.convertCursorToDomRange(b,g),n=r.getParagraphElements(e);h(p,e,m);e.detach();p.getOdfCanvas().refreshCSS();p.fixCursorPositions();n.forEach(function(a){p.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:a,memberId:l,timeStamp:d})});p.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"ApplyDirectStyling",memberid:l,timestamp:d,position:b,length:g,setProperties:m}}};
ops.OpApplyHyperlink=function(){function h(b){for(;b;){if(p.isHyperlink(b))return!0;b=b.parentNode}return!1}var l,d,b,g,m,r=webodfcore.DomUtils,p=odf.OdfUtils;this.init=function(h){l=h.memberid;d=h.timestamp;b=h.position;g=h.length;m=h.hyperlink};this.isEdit=!0;this.group=void 0;this.execute=function(q){var e=q.getDOMDocument(),n=q.convertCursorToDomRange(b,g),a=r.splitBoundaries(n),c=[],k=p.getTextNodes(n,!1);if(0===k.length)return!1;k.forEach(function(a){var b=p.getParagraphElement(a);runtime.assert(!1===
h(a),"The given range should not contain any link.");var d=m,f=e.createElementNS(odf.Namespaces.textns,"text:a");f.setAttributeNS(odf.Namespaces.xlinkns,"xlink:type","simple");f.setAttributeNS(odf.Namespaces.xlinkns,"xlink:href",d);a.parentNode.insertBefore(f,a);f.appendChild(a);null!==b&&-1===c.indexOf(b)&&c.push(b)});a.forEach(r.normalizeTextNodes);n.detach();q.fixCursorPositions();q.getOdfCanvas().refreshSize();q.getOdfCanvas().rerenderAnnotations();c.forEach(function(a){q.emit(ops.OdtDocument.signalParagraphChanged,
{paragraphElement:a,memberId:l,timeStamp:d})});return!0};this.spec=function(){return{optype:"ApplyHyperlink",memberid:l,timestamp:d,position:b,length:g,hyperlink:m}}};
ops.OpInsertImage=function(){var h,l,d,b,g,m,r,p,q=odf.Namespaces.drawns,e=odf.Namespaces.svgns,n=odf.Namespaces.textns,a=odf.Namespaces.xlinkns,c=odf.OdfUtils;this.init=function(a){h=a.memberid;l=a.timestamp;d=a.position;b=a.filename;g=a.frameWidth;m=a.frameHeight;r=a.frameStyleName;p=a.frameName};this.isEdit=!0;this.group=void 0;this.execute=function(k){var f=k.getOdfCanvas(),v=k.getTextNodeAtStep(d,h),u,x;if(!v)return!1;u=v.textNode;x=c.getParagraphElement(u);var v=v.offset!==u.length?u.splitText(v.offset):
u.nextSibling,w=k.getDOMDocument(),z=w.createElementNS(q,"draw:image"),w=w.createElementNS(q,"draw:frame");z.setAttributeNS(a,"xlink:href",b);z.setAttributeNS(a,"xlink:type","simple");z.setAttributeNS(a,"xlink:show","embed");z.setAttributeNS(a,"xlink:actuate","onLoad");w.setAttributeNS(q,"draw:style-name",r);w.setAttributeNS(q,"draw:name",p);w.setAttributeNS(n,"text:anchor-type","as-char");w.setAttributeNS(e,"svg:width",g);w.setAttributeNS(e,"svg:height",m);w.appendChild(z);u.parentNode.insertBefore(w,
v);k.emit(ops.OdtDocument.signalStepsInserted,{position:d});0===u.length&&u.parentNode.removeChild(u);f.addCssForFrameWithImage(w);f.refreshCSS();k.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:x,memberId:h,timeStamp:l});f.rerenderAnnotations();return!0};this.spec=function(){return{optype:"InsertImage",memberid:h,timestamp:l,filename:b,position:d,frameWidth:g,frameHeight:m,frameStyleName:r,frameName:p}}};
ops.OpInsertTable=function(){function h(a,c){var d;if(1===e.length)d=e[0];else if(3===e.length)switch(a){case 0:d=e[0];break;case b-1:d=e[2];break;default:d=e[1]}else d=e[a];if(1===d.length)return d[0];if(3===d.length)switch(c){case 0:return d[0];case g-1:return d[2];default:return d[1]}return d[c]}var l,d,b,g,m,r,p,q,e,n=odf.OdfUtils;this.init=function(a){l=a.memberid;d=a.timestamp;m=a.position;b=a.initialRows;g=a.initialColumns;r=a.tableName;p=a.tableStyleName;q=a.tableColumnStyleName;e=a.tableCellStyleMatrix};
this.isEdit=!0;this.group=void 0;this.execute=function(a){var c=a.getTextNodeAtStep(m),k=a.getRootNode();if(c){var f=a.getDOMDocument(),e=f.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table"),u=f.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-column"),x,w,z,y;p&&e.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",p);r&&e.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:name",r);u.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0",
"table:number-columns-repeated",g);q&&u.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",q);e.appendChild(u);for(z=0;z<b;z+=1){u=f.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-row");for(y=0;y<g;y+=1)x=f.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-cell"),(w=h(z,y))&&x.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",w),w=f.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0",
"text:p"),x.appendChild(w),u.appendChild(x);e.appendChild(u)}c=n.getParagraphElement(c.textNode);k.insertBefore(e,c.nextSibling);a.emit(ops.OdtDocument.signalStepsInserted,{position:m});a.getOdfCanvas().refreshSize();a.emit(ops.OdtDocument.signalTableAdded,{tableElement:e,memberId:l,timeStamp:d});a.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertTable",memberid:l,timestamp:d,position:m,initialRows:b,initialColumns:g,tableName:r,tableStyleName:p,tableColumnStyleName:q,
tableCellStyleMatrix:e}}};
ops.OpInsertText=function(){function h(b){return"\t"!==b&&r.isODFWhitespace(b)}var l,d,b,g,m,r=odf.OdfUtils;this.init=function(h){l=h.memberid;d=h.timestamp;b=h.position;m=h.text;g="true"===h.moveCursor||!0===h.moveCursor};this.isEdit=!0;this.group=void 0;this.execute=function(p){var q,e,n,a,c=p.getDOMDocument(),k,f=0,v,u=p.getCursor(l),x;p.upgradeWhitespacesAtPosition(b);if(q=p.getTextNodeAtStep(b)){e=q.textNode;a=e.nextSibling;n=e.parentNode;k=r.getParagraphElement(e);for(x=0;x<m.length;x+=1){if(!(v=
"\t"===m[x])){v=m;var w=x;v=h(v[w])&&(0===w||w===v.length-1||h(v[w-1]))}v&&(0===f?(q.offset!==e.length&&(a=e.splitText(q.offset)),0<x&&e.appendData(m.substring(0,x))):f<x&&n.insertBefore(c.createTextNode(m.substring(f,x)),a),f=x+1,"\t"===m[x]?(v=c.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:tab"),v.appendChild(c.createTextNode("\t"))):(" "!==m[x]&&runtime.log("WARN: InsertText operation contains non-tab, non-space whitespace character (character code "+m.charCodeAt(x)+")"),
v=c.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:s"),v.appendChild(c.createTextNode(" "))),n.insertBefore(v,a))}0===f?e.insertData(q.offset,m):f<m.length&&n.insertBefore(c.createTextNode(m.substring(f)),a);q=e.parentNode;n=e.nextSibling;q.removeChild(e);q.insertBefore(e,n);0===e.length&&e.parentNode.removeChild(e);p.emit(ops.OdtDocument.signalStepsInserted,{position:b});u&&g&&(p.moveCursor(l,b+m.length,0),p.emit(ops.Document.signalCursorMoved,u));p.downgradeWhitespacesAtPosition(b);
p.downgradeWhitespacesAtPosition(b+m.length);p.getOdfCanvas().refreshSize();p.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:k,memberId:l,timeStamp:d});p.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertText",memberid:l,timestamp:d,position:b,text:m,moveCursor:g}}};
odf.CollapsingRules=function(h){function l(d){return b.isODFNode(d)||"br"===d.localName&&b.isLineBreak(d.parentNode)||d.nodeType===Node.TEXT_NODE&&b.isODFNode(d.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}function d(m){var r;m.nodeType===Node.TEXT_NODE?(r=m.parentNode,r.removeChild(m)):r=g.removeUnwantedNodes(m,l);if(m=r)m=r,m=!b.isParagraph(m)&&m!==h&&b.hasNoODFContent(m);return m?d(r):r}var b=odf.OdfUtils,g=webodfcore.DomUtils;this.mergeChildrenIntoParent=d};
ops.OpMergeParagraph=function(){function h(a){return odf.OdfUtils.isInlineRoot(a)?NodeFilter.FILTER_SKIP:n.isGroupingElement(a)&&n.hasNoODFContent(a)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}function l(a){if(a.nodeType===Node.TEXT_NODE){if(0===a.length)return runtime.log("WARN: Empty text node found during merge operation"),!0;if(n.isODFWhitespace(a.data)&&!1===n.isSignificantWhitespace(a,0))return!0;a="#text"}else a=(a.prefix?a.prefix+":":"")+a.localName;runtime.log("WARN: Unexpected text element found near paragraph boundary ["+
a+"]");return!1}function d(c){c.collapsed||(a.splitBoundaries(c),n.getTextElements(c,!1,!0).filter(l).forEach(function(a){a.parentNode.removeChild(a)}))}function b(a,c,b){a=a.convertCursorStepToDomPoint(c);var d=n.getParagraphElement(a.node,a.offset);runtime.assert(!!d,"Paragraph not found at step "+c);b&&b.setPosition(a.node,a.offset);return d}var g,m,r,p,q,e,n=odf.OdfUtils,a=webodfcore.DomUtils,c=odf.Namespaces.textns;this.init=function(a){g=a.memberid;m=a.timestamp;r=a.moveCursor;p=a.paragraphStyleName;
q=parseInt(a.sourceStartPosition,10);e=parseInt(a.destinationStartPosition,10)};this.isEdit=!0;this.group=void 0;this.execute=function(k){var f,l,n=k.getCursor(g);f=k.getRootNode();var x=new odf.CollapsingRules(f),w=k.createStepIterator(f,0,[k.getPositionFilter()],f),z;runtime.assert(e<q,"Destination paragraph ("+e+") must be before source paragraph ("+q+")");l=b(k,e);f=b(k,q,w);w.previousStep();runtime.assert(a.containsNode(l,w.container()),"Destination paragraph must be adjacent to the source paragraph");
z=l.ownerDocument.createRange();w.setPosition(l,l.childNodes.length);w.roundToPreviousStep();z.setStart(w.container(),w.offset());z.setEnd(l,l.childNodes.length);d(z);z=l.childNodes.length;var y=f.ownerDocument.createRange();w.setPosition(f,0);w.roundToNextStep();y.setStart(f,0);y.setEnd(w.container(),w.offset());d(y);for(y=f.firstChild;y;)"editinfo"===y.localName?f.removeChild(y):(l.appendChild(y),a.removeUnwantedNodes(y,h)),y=f.firstChild;runtime.assert(0===f.childNodes.length,"Source paragraph should be empty before it is removed");
x.mergeChildrenIntoParent(f);k.emit(ops.OdtDocument.signalStepsRemoved,{position:q-1});w.setPosition(l,z);w.roundToClosestStep();w.previousStep()||w.roundToNextStep();k.downgradeWhitespaces(w);p?l.setAttributeNS(c,"text:style-name",p):l.removeAttributeNS(c,"style-name");n&&r&&(k.moveCursor(g,q-1,0),k.emit(ops.Document.signalCursorMoved,n));k.fixCursorPositions();k.getOdfCanvas().refreshSize();k.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:l,memberId:g,timeStamp:m});k.getOdfCanvas().rerenderAnnotations();
return!0};this.spec=function(){return{optype:"MergeParagraph",memberid:g,timestamp:m,moveCursor:r,paragraphStyleName:p,sourceStartPosition:q,destinationStartPosition:e}}};
ops.OpMoveCursor=function(){var h,l,d,b,g;this.init=function(m){h=m.memberid;l=m.timestamp;d=m.position;b=m.length||0;g=m.selectionType||ops.OdtCursor.RangeSelection};this.isEdit=!1;this.group=void 0;this.execute=function(m){var l=m.getCursor(h),p;if(!l)return!1;p=m.convertCursorToDomRange(d,b);l.setSelectedRange(p,0<=b);l.setSelectionType(g);m.emit(ops.Document.signalCursorMoved,l);return!0};this.spec=function(){return{optype:"MoveCursor",memberid:h,timestamp:l,position:d,length:b,selectionType:g}}};
ops.OpRemoveAnnotation=function(){var h,l,d,b,g=webodfcore.DomUtils;this.init=function(g){h=g.memberid;l=g.timestamp;d=parseInt(g.position,10);b=parseInt(g.length,10)};this.isEdit=!0;this.group=void 0;this.execute=function(b){function h(b){m.parentNode.insertBefore(b,m)}for(var l=b.getIteratorAtPosition(d).container(),m;l.namespaceURI!==odf.Namespaces.officens||"annotation"!==l.localName;)l=l.parentNode;if(null===l)return!1;m=l;l=m.annotationEndElement;b.getOdfCanvas().forgetAnnotation(m);g.getElementsByTagNameNS(m,
"urn:webodf:names:cursor","cursor").forEach(h);g.getElementsByTagNameNS(m,"urn:webodf:names:cursor","anchor").forEach(h);m.parentNode.removeChild(m);l&&l.parentNode.removeChild(l);b.emit(ops.OdtDocument.signalStepsRemoved,{position:0<d?d-1:d});b.getOdfCanvas().rerenderAnnotations();b.fixCursorPositions();return!0};this.spec=function(){return{optype:"RemoveAnnotation",memberid:h,timestamp:l,position:d,length:b}}};
ops.OpRemoveBlob=function(){var h,l,d;this.init=function(b){h=b.memberid;l=b.timestamp;d=b.filename};this.isEdit=!0;this.group=void 0;this.execute=function(b){b.getOdfCanvas().odfContainer().removeBlob(d);return!0};this.spec=function(){return{optype:"RemoveBlob",memberid:h,timestamp:l,filename:d}}};
ops.OpRemoveCursor=function(){var h,l;this.init=function(d){h=d.memberid;l=d.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(d){return d.removeCursor(h)?!0:!1};this.spec=function(){return{optype:"RemoveCursor",memberid:h,timestamp:l}}};
ops.OpRemoveHyperlink=function(){var h,l,d,b,g=webodfcore.DomUtils,m=odf.OdfUtils;this.init=function(g){h=g.memberid;l=g.timestamp;d=g.position;b=g.length};this.isEdit=!0;this.group=void 0;this.execute=function(r){var p=r.convertCursorToDomRange(d,b),q=m.getHyperlinkElements(p);runtime.assert(1===q.length,"The given range should only contain a single link.");q=g.mergeIntoParent(q[0]);p.detach();r.fixCursorPositions();r.getOdfCanvas().refreshSize();r.getOdfCanvas().rerenderAnnotations();r.emit(ops.OdtDocument.signalParagraphChanged,
{paragraphElement:m.getParagraphElement(q),memberId:h,timeStamp:l});return!0};this.spec=function(){return{optype:"RemoveHyperlink",memberid:h,timestamp:l,position:d,length:b}}};ops.OpRemoveMember=function(){var h,l;this.init=function(d){h=d.memberid;l=parseInt(d.timestamp,10)};this.isEdit=!1;this.group=void 0;this.execute=function(d){if(!d.getMember(h))return!1;d.removeMember(h);d.emit(ops.Document.signalMemberRemoved,h);return!0};this.spec=function(){return{optype:"RemoveMember",memberid:h,timestamp:l}}};
ops.OpRemoveStyle=function(){var h,l,d,b;this.init=function(g){h=g.memberid;l=g.timestamp;d=g.styleName;b=g.styleFamily};this.isEdit=!0;this.group=void 0;this.execute=function(g){var h=g.getFormatting().getStyleElement(d,b);if(!h)return!1;h.parentNode.removeChild(h);g.getOdfCanvas().refreshCSS();g.emit(ops.OdtDocument.signalCommonStyleDeleted,{name:d,family:b});return!0};this.spec=function(){return{optype:"RemoveStyle",memberid:h,timestamp:l,styleName:d,styleFamily:b}}};
ops.OpRemoveText=function(){var h,l,d,b,g=odf.OdfUtils,m=webodfcore.DomUtils;this.init=function(g){runtime.assert(0<=g.length,"OpRemoveText only supports positive lengths");h=g.memberid;l=g.timestamp;d=parseInt(g.position,10);b=parseInt(g.length,10)};this.isEdit=!0;this.group=void 0;this.execute=function(r){var p,q,e,n=r.getCursor(h),a=new odf.CollapsingRules(r.getRootNode());r.upgradeWhitespacesAtPosition(d);r.upgradeWhitespacesAtPosition(d+b);p=r.convertCursorToDomRange(d,b);m.splitBoundaries(p);
q=g.getTextElements(p,!1,!0);e=g.getParagraphElement(p.startContainer,p.startOffset);runtime.assert(void 0!==e,"Attempting to remove text outside a paragraph element");p.detach();q.forEach(function(c){c.parentNode?(runtime.assert(m.containsNode(e,c),"RemoveText only supports removing elements within the same paragraph"),a.mergeChildrenIntoParent(c)):runtime.log("WARN: text element has already been removed from it's container")});r.emit(ops.OdtDocument.signalStepsRemoved,{position:d});r.downgradeWhitespacesAtPosition(d);
r.fixCursorPositions();r.getOdfCanvas().refreshSize();r.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:e,memberId:h,timeStamp:l});n&&(n.resetSelectionType(),r.emit(ops.Document.signalCursorMoved,n));r.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"RemoveText",memberid:h,timestamp:l,position:d,length:b}}};
ops.OpSetBlob=function(){var h,l,d,b,g;this.init=function(m){h=m.memberid;l=m.timestamp;d=m.filename;b=m.mimetype;g=m.content};this.isEdit=!0;this.group=void 0;this.execute=function(h){h.getOdfCanvas().odfContainer().setBlob(d,b,g);return!0};this.spec=function(){return{optype:"SetBlob",memberid:h,timestamp:l,filename:d,mimetype:b,content:g}}};
ops.OpSetParagraphStyle=function(){function h(b,d,g){var e=[b.getPositionFilter()],h=g.container();g=g.unfilteredDomOffset();return!1===b.createStepIterator(h,g,e,d).previousStep()}var l,d,b,g,m=odf.OdfUtils;this.init=function(h){l=h.memberid;d=h.timestamp;b=h.position;g=h.styleName};this.isEdit=!0;this.group=void 0;this.execute=function(r){var p,q;p=r.getIteratorAtPosition(b);return(q=m.getParagraphElement(p.container()))?(runtime.assert(h(r,q,p),"SetParagraphStyle position should be the first position in the paragraph"),
g?q.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:style-name",g):q.removeAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","style-name"),r.getOdfCanvas().refreshSize(),r.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:q,timeStamp:d,memberId:l}),r.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=function(){return{optype:"SetParagraphStyle",memberid:l,timestamp:d,position:b,styleName:g}}};
ops.OpSplitParagraph=function(){var h,l,d,b,g,m,r=odf.OdfUtils,p=odf.Namespaces.textns;this.init=function(p){h=p.memberid;l=p.timestamp;b=p.position;d=p.sourceParagraphPosition;m=p.paragraphStyleName;g="true"===p.moveCursor||!0===p.moveCursor};this.isEdit=!0;this.group=void 0;this.execute=function(d){var e,n,a,c,k,f,q,u=d.getCursor(h);d.upgradeWhitespacesAtPosition(b);e=d.getTextNodeAtStep(b);if(!e)return!1;n=r.getParagraphElement(e.textNode);if(!n)return!1;a=r.isListItem(n.parentNode)?n.parentNode:
n;0===e.offset?(q=e.textNode.previousSibling,f=null):(q=e.textNode,f=e.offset>=e.textNode.length?null:e.textNode.splitText(e.offset));for(c=e.textNode;c!==a;){c=c.parentNode;k=c.cloneNode(!1);f&&k.appendChild(f);if(q)for(;q&&q.nextSibling;)k.appendChild(q.nextSibling);else for(;c.firstChild;)k.appendChild(c.firstChild);c.parentNode.insertBefore(k,c.nextSibling);q=c;f=k}r.isListItem(f)&&(f=f.childNodes.item(0));m?f.setAttributeNS(p,"text:style-name",m):f.removeAttributeNS(p,"style-name");0===e.textNode.length&&
e.textNode.parentNode.removeChild(e.textNode);d.emit(ops.OdtDocument.signalStepsInserted,{position:b});u&&g&&(d.moveCursor(h,b+1,0),d.emit(ops.Document.signalCursorMoved,u));d.fixCursorPositions();d.getOdfCanvas().refreshSize();d.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:n,memberId:h,timeStamp:l});d.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:f,memberId:h,timeStamp:l});d.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"SplitParagraph",
memberid:h,timestamp:l,position:b,sourceParagraphPosition:d,paragraphStyleName:m,moveCursor:g}}};
ops.OpUpdateMember=function(){function h(d){var g="//dc:creator[@editinfo:memberid='"+l+"']";d=xmldom.XPath.getODFElementsWithXPath(d.getRootNode(),g,function(b){return"editinfo"===b?"urn:webodf:names:editinfo":odf.Namespaces.lookupNamespaceURI(b)});for(g=0;g<d.length;g+=1)d[g].textContent=b.fullName}var l,d,b,g;this.init=function(h){l=h.memberid;d=parseInt(h.timestamp,10);b=h.setProperties;g=h.removedProperties};this.isEdit=!1;this.group=void 0;this.execute=function(d){var m=d.getMember(l);if(!m)return!1;
g&&m.removeProperties(g);b&&(m.setProperties(b),b.fullName&&h(d));d.emit(ops.Document.signalMemberUpdated,m);return!0};this.spec=function(){return{optype:"UpdateMember",memberid:l,timestamp:d,setProperties:b,removedProperties:g}}};
ops.OpUpdateMetadata=function(){var h,l,d,b;this.init=function(g){h=g.memberid;l=parseInt(g.timestamp,10);d=g.setProperties;b=g.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(g){var h=g.getOdfCanvas().odfContainer(),l=null;b&&(l=b.attributes.split(","));h.setMetadata(d,l);g.emit(ops.OdtDocument.signalMetadataUpdated,{setProperties:null!==d?d:{},removedProperties:null!==l?l:[]});return!0};this.spec=function(){return{optype:"UpdateMetadata",memberid:h,timestamp:l,setProperties:d,
removedProperties:b}}};
ops.OpUpdateParagraphStyle=function(){function h(b,d){var e,g,a=d?d.split(","):[];for(e=0;e<a.length;e+=1)g=a[e].split(":"),b.removeAttributeNS(odf.Namespaces.lookupNamespaceURI(g[0]),g[1])}var l,d,b,g,m,r=odf.Namespaces.stylens;this.init=function(h){l=h.memberid;d=h.timestamp;b=h.styleName;g=h.setProperties;m=h.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(d){var l=d.getFormatting(),e,n,a;return(e=""!==b?l.getStyleElement(b,"paragraph"):l.getDefaultStyleElement("paragraph"))?(n=
e.getElementsByTagNameNS(r,"paragraph-properties").item(0),a=e.getElementsByTagNameNS(r,"text-properties").item(0),g&&l.updateStyle(e,g),m&&(l=m["style:paragraph-properties"],n&&l&&(h(n,l.attributes),0===n.attributes.length&&e.removeChild(n)),l=m["style:text-properties"],a&&l&&(h(a,l.attributes),0===a.attributes.length&&e.removeChild(a)),h(e,m.attributes)),d.getOdfCanvas().refreshCSS(),d.emit(ops.OdtDocument.signalParagraphStyleModified,b),d.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=
function(){return{optype:"UpdateParagraphStyle",memberid:l,timestamp:d,styleName:b,setProperties:g,removedProperties:m}}};
ops.OperationFactory=function(){function h(d){return function(b){return new d}}var l;this.register=function(d,b){l[d]=b};this.create=function(d){var b=null,g=l[d.optype];g&&(b=g(d),b.init(d));return b};l={AddMember:h(ops.OpAddMember),UpdateMember:h(ops.OpUpdateMember),RemoveMember:h(ops.OpRemoveMember),AddCursor:h(ops.OpAddCursor),ApplyDirectStyling:h(ops.OpApplyDirectStyling),SetBlob:h(ops.OpSetBlob),RemoveBlob:h(ops.OpRemoveBlob),InsertImage:h(ops.OpInsertImage),InsertTable:h(ops.OpInsertTable),
InsertText:h(ops.OpInsertText),RemoveText:h(ops.OpRemoveText),MergeParagraph:h(ops.OpMergeParagraph),SplitParagraph:h(ops.OpSplitParagraph),SetParagraphStyle:h(ops.OpSetParagraphStyle),UpdateParagraphStyle:h(ops.OpUpdateParagraphStyle),AddStyle:h(ops.OpAddStyle),RemoveStyle:h(ops.OpRemoveStyle),MoveCursor:h(ops.OpMoveCursor),RemoveCursor:h(ops.OpRemoveCursor),AddAnnotation:h(ops.OpAddAnnotation),RemoveAnnotation:h(ops.OpRemoveAnnotation),UpdateMetadata:h(ops.OpUpdateMetadata),ApplyHyperlink:h(ops.OpApplyHyperlink),
RemoveHyperlink:h(ops.OpRemoveHyperlink)}};ops.OperationRouter=function(){};ops.OperationRouter.prototype.setOperationFactory=function(h){};ops.OperationRouter.prototype.setPlaybackFunction=function(h){};ops.OperationRouter.prototype.push=function(h){};ops.OperationRouter.prototype.close=function(h){};ops.OperationRouter.prototype.subscribe=function(h,l){};ops.OperationRouter.prototype.unsubscribe=function(h,l){};ops.OperationRouter.prototype.hasLocalUnsyncedOps=function(){};
ops.OperationRouter.prototype.hasSessionHostConnection=function(){};ops.OperationRouter.signalProcessingBatchStart="router/batchstart";ops.OperationRouter.signalProcessingBatchEnd="router/batchend";
ops.TrivialOperationRouter=function(){var h=new webodfcore.EventNotifier([ops.OperationRouter.signalProcessingBatchStart,ops.OperationRouter.signalProcessingBatchEnd]),l,d,b=0;this.setOperationFactory=function(b){l=b};this.setPlaybackFunction=function(b){d=b};this.push=function(g){b+=1;h.emit(ops.OperationRouter.signalProcessingBatchStart,{});g.forEach(function(g){g=g.spec();g.timestamp=Date.now();g=l.create(g);g.group="g"+b;d(g)});h.emit(ops.OperationRouter.signalProcessingBatchEnd,{})};this.close=
function(b){b()};this.subscribe=function(b,d){h.subscribe(b,d)};this.unsubscribe=function(b,d){h.unsubscribe(b,d)};this.hasLocalUnsyncedOps=function(){return!1};this.hasSessionHostConnection=function(){return!0}};
ops.Session=function(h){function l(b){g.emit(ops.OdtDocument.signalProcessingBatchStart,b)}function d(b){g.emit(ops.OdtDocument.signalProcessingBatchEnd,b)}var b=new ops.OperationFactory,g=new ops.OdtDocument(h),m=null;this.setOperationFactory=function(d){b=d;m&&m.setOperationFactory(b)};this.setOperationRouter=function(h){m&&(m.unsubscribe(ops.OperationRouter.signalProcessingBatchStart,l),m.unsubscribe(ops.OperationRouter.signalProcessingBatchEnd,d));m=h;m.subscribe(ops.OperationRouter.signalProcessingBatchStart,
l);m.subscribe(ops.OperationRouter.signalProcessingBatchEnd,d);h.setPlaybackFunction(function(b){g.emit(ops.OdtDocument.signalOperationStart,b);return b.execute(g)?(g.emit(ops.OdtDocument.signalOperationEnd,b),!0):!1});h.setOperationFactory(b)};this.getOperationFactory=function(){return b};this.getOdtDocument=function(){return g};this.enqueue=function(b){m.push(b)};this.close=function(b){m.close(function(d){d?b(d):g.close(b)})};this.destroy=function(b){g.destroy(b)};this.setOperationRouter(new ops.TrivialOperationRouter)};
gui.AnnotationController=function(h,l,d){function b(){var a=p.getCursor(d),a=a&&a.getNode(),b=!1;a&&(b=!n.isWithinAnnotation(a,p.getRootNode()));b!==q&&(q=b,e.emit(gui.AnnotationController.annotatableChanged,q))}function g(a){a.getMemberId()===d&&b()}function m(a){a===d&&b()}function r(a){a.getMemberId()===d&&b()}var p=h.getOdtDocument(),q=!1,e=new webodfcore.EventNotifier([gui.AnnotationController.annotatableChanged]),n=odf.OdfUtils,a=webodfcore.StepDirection.NEXT;this.isAnnotatable=function(){return q};
this.addAnnotation=function(){var a=new ops.OpAddAnnotation,b=p.getCursorSelection(d),f=b.length,b=b.position;q&&(0===f?f=void 0:(b=0<=f?b:b+f,f=Math.abs(f)),a.init({memberid:d,position:b,length:f,name:d+Date.now()}),h.enqueue([a]))};this.removeAnnotation=function(c){var b,f;b=p.getMember(d).getProperties().fullName;if(!0!==l.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)||b===n.getAnnotationCreator(c))b=p.convertDomPointToCursorStep(c,0,a),f=p.convertDomPointToCursorStep(c,c.childNodes.length),
c=new ops.OpRemoveAnnotation,c.init({memberid:d,position:b,length:f-b}),f=new ops.OpMoveCursor,f.init({memberid:d,position:0<b?b-1:b,length:0}),h.enqueue([c,f])};this.subscribe=function(a,b){e.subscribe(a,b)};this.unsubscribe=function(a,b){e.unsubscribe(a,b)};this.destroy=function(a){p.unsubscribe(ops.Document.signalCursorAdded,g);p.unsubscribe(ops.Document.signalCursorRemoved,m);p.unsubscribe(ops.Document.signalCursorMoved,r);a()};l.registerConstraint(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN);
p.subscribe(ops.Document.signalCursorAdded,g);p.subscribe(ops.Document.signalCursorRemoved,m);p.subscribe(ops.Document.signalCursorMoved,r);b()};gui.AnnotationController.annotatableChanged="annotatable/changed";
gui.Avatar=function(h,l){var d=this,b,g,m;this.setColor=function(b){g.style.borderColor=b};this.setImageUrl=function(b){d.isVisible()?g.src=b:m=b};this.isVisible=function(){return"block"===b.style.display};this.show=function(){m&&(g.src=m,m=void 0);b.style.display="block"};this.hide=function(){b.style.display="none"};this.markAsFocussed=function(d){d?b.classList.add("active"):b.classList.remove("active")};this.destroy=function(d){h.removeChild(b);d()};(function(){var d=h.ownerDocument;b=d.createElement("div");
g=d.createElement("img");b.appendChild(g);b.style.display=l?"block":"none";b.className="handle";h.appendChild(b)})()};gui.StepInfo=function(){};gui.StepInfo.VisualDirection={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1};gui.StepInfo.prototype.container=function(){};gui.StepInfo.prototype.offset=function(){};gui.VisualStepScanner=function(){};gui.VisualStepScanner.prototype.process=function(h,l,d){};
gui.GuiStepUtils=function(){function h(g){g=d.getContentBounds(g);var h,e=null;if(g)if(g.container.nodeType===Node.TEXT_NODE)h=g.container.ownerDocument.createRange(),h.setStart(g.container,g.startOffset),h.setEnd(g.container,g.endOffset),(e=0<h.getClientRects().length?h.getBoundingClientRect():null)&&" "===g.container.data.substring(g.startOffset,g.endOffset)&&1>=e.width&&(e=null),h.detach();else if(l.isCharacterElement(g.container)||l.isCharacterFrame(g.container))e=b.getBoundingClientRect(g.container);
return e}var l=odf.OdfUtils,d=new odf.StepUtils,b=webodfcore.DomUtils,g=webodfcore.StepDirection.NEXT,m=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT,r=gui.StepInfo.VisualDirection.RIGHT_TO_LEFT;this.getContentRect=h;this.moveToFilteredStep=function(b,d,e){function l(a,b){b.process(w,f,p)&&(a=!0,!q&&b.token&&(q=b.token));return a}var a=d===g,c,k,f,p,q,x=b.snapshot();c=!1;var w;do c=h(b),w={token:b.snapshot(),container:b.container,offset:b.offset,direction:d,visualDirection:d===g?m:r},k=b.nextStep()?
h(b):null,b.restore(w.token),a?(f=c,p=k):(f=k,p=c),c=e.reduce(l,!1);while(!c&&b.advanceStep(d));c||e.forEach(function(a){!q&&a.token&&(q=a.token)});b.restore(q||x);return!!q}};
gui.Caret=function(h,l,d,b){function g(){a.style.opacity="0"===a.style.opacity?"1":"0";t.trigger()}function m(){v.selectNodeContents(f);return v.getBoundingClientRect()}function r(a){return U[a]!==K[a]}function p(){Object.keys(K).forEach(function(a){U[a]=K[a]})}function q(){if(!1===K.isShown||h.getSelectionType()!==ops.OdtCursor.RangeSelection||!b&&!h.getSelectedRange().collapsed)K.visibility="hidden",a.style.visibility="hidden",t.cancel();else if(K.visibility="visible",a.style.visibility="visible",
!1===K.isFocused)a.style.opacity="1",t.cancel();else{if(B||r("visibility"))a.style.opacity="1",t.cancel();t.trigger()}if(H||J){var d;d=h.getNode();var f,e,g=x.getBoundingClientRect(u.getSizer()),q=!1,v=0;d.removeAttributeNS("urn:webodf:names:cursor","caret-sizer-active");if(0<d.getClientRects().length)e=m(),v=e.left-x.getBoundingClientRect(d).left,q=!0;else if(z.setPosition(d,0),e=w.getContentRect(z),!e&&z.nextStep()&&(f=w.getContentRect(z))&&(e=f,q=!0),e||(d.setAttributeNS("urn:webodf:names:cursor",
"caret-sizer-active","true"),e=m(),q=!0),!e)for(runtime.log("WARN: No suitable client rectangle found for visual caret for "+h.getMemberId());d;){if(0<d.getClientRects().length){e=x.getBoundingClientRect(d);q=!0;break}d=d.parentNode}e=x.translateRect(e,g,u.getZoomLevel());d={top:e.top,height:e.height,right:q?e.left:e.right,width:x.adaptRangeDifferenceToZoomLevel(v,u.getZoomLevel())};8>d.height&&(d={top:d.top-(8-d.height)/2,height:8,right:d.right});n.style.height=d.height+"px";n.style.top=d.top+"px";
n.style.left=d.right-d.width+"px";n.style.width=d.width?d.width+"px":"";k&&(d=runtime.getWindow().getComputedStyle(h.getNode(),null),d.font?k.style.font=d.font:(k.style.fontStyle=d.fontStyle,k.style.fontVariant=d.fontVariant,k.style.fontWeight=d.fontWeight,k.style.fontSize=d.fontSize,k.style.lineHeight=d.lineHeight,k.style.fontFamily=d.fontFamily))}K.isShown&&J&&l.scrollIntoView(a.getBoundingClientRect());r("isFocused")&&c.markAsFocussed(K.isFocused);p();H=J=B=!1}function e(a){n.parentNode.removeChild(n);
f.parentNode.removeChild(f);a()}var n,a,c,k,f,v,u=h.getDocument().getCanvas(),x=webodfcore.DomUtils,w=new gui.GuiStepUtils,z,y,t,B=!1,J=!1,H=!1,K={isFocused:!1,isShown:!0,visibility:"hidden"},U={isFocused:!K.isFocused,isShown:!K.isShown,visibility:"hidden"};this.handleUpdate=function(){H=!0;y.trigger()};this.refreshCursorBlinking=function(){B=!0;y.trigger()};this.setFocus=function(){K.isFocused=!0;y.trigger()};this.removeFocus=function(){K.isFocused=!1;y.trigger()};this.show=function(){K.isShown=
!0;y.trigger()};this.hide=function(){K.isShown=!1;y.trigger()};this.setAvatarImageUrl=function(a){c.setImageUrl(a)};this.setColor=function(b){a.style.borderColor=b;c.setColor(b)};this.getCursor=function(){return h};this.getFocusElement=function(){return a};this.toggleHandleVisibility=function(){c.isVisible()?c.hide():c.show()};this.showHandle=function(){c.show()};this.hideHandle=function(){c.hide()};this.setOverlayElement=function(a){k=a;n.appendChild(a);H=!0;y.trigger()};this.ensureVisible=function(){J=
!0;y.trigger()};this.getBoundingClientRect=function(){return x.getBoundingClientRect(n)};this.destroy=function(a){webodfcore.Async.destroyAll([y.destroy,t.destroy,c.destroy,e],a)};(function(){var b=h.getDocument(),e=[b.createRootFilter(h.getMemberId()),b.getPositionFilter()],k=b.getDOMDocument();v=k.createRange();f=k.createElement("span");f.className="webodf-caretSizer";f.textContent="|";h.getNode().appendChild(f);n=k.createElement("div");n.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",
h.getMemberId());n.className="webodf-caretOverlay";a=k.createElement("div");a.className="caret";n.appendChild(a);c=new gui.Avatar(n,d);u.getSizer().appendChild(n);z=b.createStepIterator(h.getNode(),0,e,b.getRootNode());y=webodfcore.Task.createRedrawTask(q);t=webodfcore.Task.createTimeoutTask(g,500);y.triggerImmediate()})()};
odf.TextSerializer=function(){function h(b){var g="",m=l.filter?l.filter.acceptNode(b):NodeFilter.FILTER_ACCEPT,r=b.nodeType,p;if((m===NodeFilter.FILTER_ACCEPT||m===NodeFilter.FILTER_SKIP)&&d.isTextContentContainingNode(b))for(p=b.firstChild;p;)g+=h(p),p=p.nextSibling;m===NodeFilter.FILTER_ACCEPT&&(r===Node.ELEMENT_NODE&&d.isParagraph(b)?g+="\n":r===Node.TEXT_NODE&&b.textContent&&(g+=b.textContent));return g}var l=this,d=odf.OdfUtils;this.filter=null;this.writeToString=function(b){if(!b)return"";
b=h(b);"\n"===b[b.length-1]&&(b=b.substr(0,b.length-1));return b}};gui.MimeDataExporter=function(){var h;this.exportRangeToDataTransfer=function(l,d){var b;b=d.startContainer.ownerDocument.createElement("span");b.appendChild(d.cloneContents());b=h.writeToString(b);try{l.setData("text/plain",b)}catch(g){l.setData("Text",b)}};h=new odf.TextSerializer;h.filter=new odf.OdfNodeFilter};
gui.Clipboard=function(h){this.setDataFromRange=function(l,d){var b,g=l.clipboardData;b=runtime.getWindow();!g&&b&&(g=b.clipboardData);g?(b=!0,h.exportRangeToDataTransfer(g,d),l.preventDefault()):b=!1;return b}};
gui.SessionContext=function(h,l){var d=h.getOdtDocument(),b=odf.OdfUtils;this.isLocalCursorWithinOwnAnnotation=function(){var g=d.getCursor(l),h;if(!g)return!1;h=g&&g.getNode();g=d.getMember(l).getProperties().fullName;return(h=b.getParentAnnotation(h,d.getRootNode()))&&b.getAnnotationCreator(h)===g?!0:!1}};
gui.StyleSummary=function(h){function l(b,d){var l=b+"|"+d,m;g.hasOwnProperty(l)||(m=[],h.forEach(function(e){e=(e=e.styleProperties[b])&&e[d];-1===m.indexOf(e)&&m.push(e)}),g[l]=m);return g[l]}function d(b,d,g){return function(){var h=l(b,d);return g.length>=h.length&&h.every(function(b){return-1!==g.indexOf(b)})}}function b(b,d){var g=l(b,d);return 1===g.length?g[0]:void 0}var g={};this.getPropertyValues=l;this.getCommonValue=b;this.isBold=d("style:text-properties","fo:font-weight",["bold"]);this.isItalic=
d("style:text-properties","fo:font-style",["italic"]);this.hasUnderline=d("style:text-properties","style:text-underline-style",["solid"]);this.hasStrikeThrough=d("style:text-properties","style:text-line-through-style",["solid"]);this.fontSize=function(){var d=b("style:text-properties","fo:font-size");return d&&parseFloat(d)};this.fontName=function(){return b("style:text-properties","style:font-name")};this.isAlignedLeft=d("style:paragraph-properties","fo:text-align",["left","start"]);this.isAlignedCenter=
d("style:paragraph-properties","fo:text-align",["center"]);this.isAlignedRight=d("style:paragraph-properties","fo:text-align",["right","end"]);this.isAlignedJustified=d("style:paragraph-properties","fo:text-align",["justify"]);this.text={isBold:this.isBold,isItalic:this.isItalic,hasUnderline:this.hasUnderline,hasStrikeThrough:this.hasStrikeThrough,fontSize:this.fontSize,fontName:this.fontName};this.paragraph={isAlignedLeft:this.isAlignedLeft,isAlignedCenter:this.isAlignedCenter,isAlignedRight:this.isAlignedRight,
isAlignedJustified:this.isAlignedJustified}};webodfcore.LazyProperty=function(h){var l,d=!1;this.value=function(){d||(l=h(),d=!0);return l};this.reset=function(){d=!1}};
gui.DirectFormattingController=function(h,l,d,b,g,m,r){function p(){return S.value().styleSummary}function q(){return S.value().enabledFeatures}function e(a){var b;a.collapsed?(b=a.startContainer,b.hasChildNodes()&&a.startOffset<b.childNodes.length&&(b=b.childNodes.item(a.startOffset)),a=[b]):a=N.getTextElements(a,!0,!1);return a}function n(){var a=F.getCursor(b),c=a&&a.getSelectedRange(),f;f=[];var k=!0,g={directTextStyling:!0,directParagraphStyling:!0};c&&(f=e(c),0===f.length&&(f=[c.startContainer,
c.endContainer],k=!1),f=F.getFormatting().getAppliedStyles(f));void 0!==f[0]&&X&&(f[0].styleProperties=aa.mergeObjects(f[0].styleProperties,X));!0===l.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(g.directTextStyling=g.directParagraphStyling=d.isLocalCursorWithinOwnAnnotation());g.directTextStyling&&(g.directTextStyling=k&&void 0!==a&&a.getSelectionType()===ops.OdtCursor.RangeSelection);return{enabledFeatures:g,appliedStyles:f,styleSummary:new gui.StyleSummary(f)}}function a(a,b){var c={};Object.keys(a).forEach(function(d){var f=
a[d](),e=b[d]();f!==e&&(c[d]=e)});return c}function c(){var b,c;c=ca.styleSummary;var d=S.value(),f=d.styleSummary,e=ca.enabledFeatures,k=d.enabledFeatures;b=a(c.text,f.text);c=a(c.paragraph,f.paragraph);e=!(k.directTextStyling===e.directTextStyling&&k.directParagraphStyling===e.directParagraphStyling);ca=d;e&&ea.emit(gui.DirectFormattingController.enabledChanged,k);0<Object.keys(b).length&&ea.emit(gui.DirectFormattingController.textStylingChanged,b);0<Object.keys(c).length&&ea.emit(gui.DirectFormattingController.paragraphStylingChanged,
c)}function k(){S.reset();c()}function f(a){("string"===typeof a?a:a.getMemberId())===b&&S.reset()}function v(){S.reset()}function u(a){var c=F.getCursor(b);a=a.paragraphElement;c&&N.getParagraphElement(c.getNode())===a&&S.reset()}function x(a,b){b(!a());return!0}function w(a){if(q().directTextStyling){var c=F.getCursorSelection(b),d={"style:text-properties":a};0!==c.length?(a=new ops.OpApplyDirectStyling,a.init({memberid:b,position:c.position,length:c.length,setProperties:d}),h.enqueue([a])):(X=
aa.mergeObjects(X||{},d),S.reset())}}function z(a,b){var c={};c[a]=b;w(c)}function y(a){a=a.spec();X&&a.memberid===b&&"SplitParagraph"!==a.optype&&(X=null,S.reset())}function t(a){z("fo:font-weight",a?"bold":"normal")}function B(a){z("fo:font-style",a?"italic":"normal")}function J(a){z("style:text-underline-style",a?"solid":"none")}function H(a){z("style:text-line-through-style",a?"solid":"none")}function K(a){if(q().directParagraphStyling){var c=F.getCursor(b).getSelectedRange(),c=N.getParagraphElements(c),
d=F.getFormatting(),f=[],e={},k;c.forEach(function(c){var h=F.convertDomPointToCursorStep(c,0,A),l=c.getAttributeNS(odf.Namespaces.textns,"style-name"),n;c=l?e.hasOwnProperty(l)?e[l]:void 0:k;c||(c=g.generateStyleName(),l?(e[l]=c,n=d.createDerivedStyleObject(l,"paragraph",{})):(k=c,n={}),n=a(n),l=new ops.OpAddStyle,l.init({memberid:b,styleName:c.toString(),styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:n}),f.push(l));l=new ops.OpSetParagraphStyle;l.init({memberid:b,styleName:c.toString(),
position:h});f.push(l)});h.enqueue(f)}}function U(a){K(function(b){return aa.mergeObjects(b,a)})}function L(a){U({"style:paragraph-properties":{"fo:text-align":a}})}function Q(a,b){var c=F.getFormatting().getDefaultTabStopDistance(),d=b["style:paragraph-properties"],f;d&&(d=d["fo:margin-left"],f=N.parseLength(d));return aa.mergeObjects(b,{"style:paragraph-properties":{"fo:margin-left":f&&f.unit===c.unit?f.value+a*c.value+f.unit:a*c.value+c.unit}})}function C(a,b){var c=e(a),c=0===c.length?[a.startContainer]:
c,c=F.getFormatting().getAppliedStyles(c),d=0<c.length?c[0].styleProperties:void 0,f=F.getFormatting().getAppliedStylesForElement(b).styleProperties;if(!d||"text"!==d["style:family"]||!d["style:text-properties"])return!1;if(!f||!f["style:text-properties"])return!0;d=d["style:text-properties"];f=f["style:text-properties"];return!Object.keys(d).every(function(a){return d[a]===f[a]})}function V(){}function O(){return!1}function M(){return!1}var T=this,F=h.getOdtDocument(),aa=new webodfcore.Utils,N=odf.OdfUtils,
ea=new webodfcore.EventNotifier([gui.DirectFormattingController.enabledChanged,gui.DirectFormattingController.textStylingChanged,gui.DirectFormattingController.paragraphStylingChanged]),ba=odf.Namespaces.textns,A=webodfcore.StepDirection.NEXT,X=null,ca,S;this.enabledFeatures=q;this.formatTextSelection=w;this.createCursorStyleOp=function(a,c,d){var f=null,e=X;d&&(e=(d=S.value().appliedStyles[0])&&d.styleProperties);e&&e["style:text-properties"]&&(f=new ops.OpApplyDirectStyling,f.init({memberid:b,position:a,
length:c,setProperties:{"style:text-properties":e["style:text-properties"]}}),X=null,S.reset());return f};this.setBold=t;this.setItalic=B;this.setHasUnderline=J;this.setHasStrikethrough=H;this.setFontSize=function(a){z("fo:font-size",a+"pt")};this.setFontName=function(a){z("style:font-name",a)};this.getAppliedStyles=function(){return S.value().appliedStyles};this.toggleBold=x.bind(T,function(){return p().isBold()},t);this.toggleItalic=x.bind(T,function(){return p().isItalic()},B);this.toggleUnderline=
x.bind(T,function(){return p().hasUnderline()},J);this.toggleStrikethrough=x.bind(T,function(){return p().hasStrikeThrough()},H);this.isBold=function(){return p().isBold()};this.isItalic=function(){return p().isItalic()};this.hasUnderline=function(){return p().hasUnderline()};this.hasStrikeThrough=function(){return p().hasStrikeThrough()};this.fontSize=function(){return p().fontSize()};this.fontName=function(){return p().fontName()};this.isAlignedLeft=function(){return p().isAlignedLeft()};this.isAlignedCenter=
function(){return p().isAlignedCenter()};this.isAlignedRight=function(){return p().isAlignedRight()};this.isAlignedJustified=function(){return p().isAlignedJustified()};this.alignParagraphLeft=function(){L("left");return!0};this.alignParagraphCenter=function(){L("center");return!0};this.alignParagraphRight=function(){L("right");return!0};this.alignParagraphJustified=function(){L("justify");return!0};this.indent=function(){K(Q.bind(null,1));return!0};this.outdent=function(){K(Q.bind(null,-1));return!0};
this.createParagraphStyleOps=function(a){if(!q().directParagraphStyling)return[];var c=F.getCursor(b),d=c.getSelectedRange(),f=[],e,k;c.hasForwardSelection()?(e=c.getAnchorNode(),k=c.getNode()):(e=c.getNode(),k=c.getAnchorNode());c=N.getParagraphElement(k);runtime.assert(!!c,"DirectFormattingController: Cursor outside paragraph");var h=c,l=[F.getPositionFilter(),F.createRootFilter(b)];if(!1!==F.createStepIterator(d.endContainer,d.endOffset,l,h).nextStep())return f;k!==e&&(c=N.getParagraphElement(e));
if(!X&&!C(d,c))return f;d=(d=S.value().appliedStyles[0])&&d.styleProperties;if(!d)return f;if(c=c.getAttributeNS(ba,"style-name"))d={"style:text-properties":d["style:text-properties"]},d=F.getFormatting().createDerivedStyleObject(c,"paragraph",d);e=g.generateStyleName();c=new ops.OpAddStyle;c.init({memberid:b,styleName:e,styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:d});f.push(c);c=new ops.OpSetParagraphStyle;c.init({memberid:b,styleName:e,position:a});f.push(c);return f};this.subscribe=
function(a,c){ea.subscribe(a,c)};this.unsubscribe=function(a,c){ea.unsubscribe(a,c)};this.destroy=function(a){F.unsubscribe(ops.Document.signalCursorAdded,f);F.unsubscribe(ops.Document.signalCursorRemoved,f);F.unsubscribe(ops.Document.signalCursorMoved,f);F.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,v);F.unsubscribe(ops.OdtDocument.signalParagraphChanged,u);F.unsubscribe(ops.OdtDocument.signalOperationEnd,y);F.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,c);l.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,
k);a()};(function(){F.subscribe(ops.Document.signalCursorAdded,f);F.subscribe(ops.Document.signalCursorRemoved,f);F.subscribe(ops.Document.signalCursorMoved,f);F.subscribe(ops.OdtDocument.signalParagraphStyleModified,v);F.subscribe(ops.OdtDocument.signalParagraphChanged,u);F.subscribe(ops.OdtDocument.signalOperationEnd,y);F.subscribe(ops.OdtDocument.signalProcessingBatchEnd,c);l.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,k);S=new webodfcore.LazyProperty(n);ca=S.value();m||(T.formatTextSelection=
V,T.setBold=V,T.setItalic=V,T.setHasUnderline=V,T.setHasStrikethrough=V,T.setFontSize=V,T.setFontName=V,T.toggleBold=M,T.toggleItalic=M,T.toggleUnderline=M,T.toggleStrikethrough=M);r||(T.alignParagraphCenter=O,T.alignParagraphJustified=O,T.alignParagraphLeft=O,T.alignParagraphRight=O,T.createParagraphStyleOps=function(){return[]},T.indent=O,T.outdent=O)})()};gui.DirectFormattingController.enabledChanged="enabled/changed";gui.DirectFormattingController.textStylingChanged="textStyling/changed";
gui.DirectFormattingController.paragraphStylingChanged="paragraphStyling/changed";gui.DirectFormattingController.SelectionInfo=function(){};
gui.KeyboardHandler=function(){function h(b,d){d||(d=l.None);switch(b){case gui.KeyboardHandler.KeyCode.LeftMeta:case gui.KeyboardHandler.KeyCode.RightMeta:case gui.KeyboardHandler.KeyCode.MetaInMozilla:d|=l.Meta;break;case gui.KeyboardHandler.KeyCode.Ctrl:d|=l.Ctrl;break;case gui.KeyboardHandler.KeyCode.Alt:d|=l.Alt;break;case gui.KeyboardHandler.KeyCode.Shift:d|=l.Shift}return b+":"+d}var l=gui.KeyboardHandler.Modifier,d=null,b={};this.setDefault=function(b){d=b};this.bind=function(d,l,r,p){d=h(d,
l);runtime.assert(p||!1===b.hasOwnProperty(d),"tried to overwrite the callback handler of key combo: "+d);b[d]=r};this.unbind=function(d,l){var g=h(d,l);delete b[g]};this.reset=function(){d=null;b={}};this.handleEvent=function(g){var m=g.keyCode,r=l.None;g.metaKey&&(r|=l.Meta);g.ctrlKey&&(r|=l.Ctrl);g.altKey&&(r|=l.Alt);g.shiftKey&&(r|=l.Shift);m=h(m,r);m=b[m];r=!1;m?r=m():null!==d&&(r=d(g));r&&(g.preventDefault?g.preventDefault():g.returnValue=!1)}};
gui.KeyboardHandler.Modifier={None:0,Meta:1,Ctrl:2,Alt:4,CtrlAlt:6,Shift:8,MetaShift:9,CtrlShift:10,AltShift:12};gui.KeyboardHandler.KeyCode={Backspace:8,Tab:9,Clear:12,Enter:13,Shift:16,Ctrl:17,Alt:18,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,MetaInMozilla:224};
gui.HyperlinkClickHandler=function(h,l,d){function b(){var a=h();runtime.assert(!!a.classList,"Document container has no classList element");a.classList.remove("webodf-inactiveLinks")}function g(){var a=h();runtime.assert(!!a.classList,"Document container has no classList element");a.classList.add("webodf-inactiveLinks")}function m(){a.removeEventListener("focus",g,!1);k.forEach(function(a){l.unbind(a.keyCode,a.modifier);d.unbind(a.keyCode,a.modifier)});k.length=0}function r(c){m();if(c!==p.None){a.addEventListener("focus",
g,!1);switch(c){case p.Ctrl:k.push({keyCode:q.Ctrl,modifier:p.None});break;case p.Meta:k.push({keyCode:q.LeftMeta,modifier:p.None}),k.push({keyCode:q.RightMeta,modifier:p.None}),k.push({keyCode:q.MetaInMozilla,modifier:p.None})}k.forEach(function(a){l.bind(a.keyCode,a.modifier,b);d.bind(a.keyCode,a.modifier,g)})}}var p=gui.KeyboardHandler.Modifier,q=gui.KeyboardHandler.KeyCode,e=xmldom.XPath,n=odf.OdfUtils,a=runtime.getWindow(),c=p.None,k=[];runtime.assert(null!==a,"Expected to be run in an environment which has a global window, like a browser.");
this.handleClick=function(b){var d=b.target||b.srcElement,f,k;b.ctrlKey?f=p.Ctrl:b.metaKey&&(f=p.Meta);if(c===p.None||c===f){a:{for(;null!==d;){if(n.isHyperlink(d))break a;if(n.isParagraph(d))break;d=d.parentNode}d=null}d&&(d=n.getHyperlinkTarget(d),""!==d&&("#"===d[0]?(d=d.substring(1),f=h(),k=e.getODFElementsWithXPath(f,"//text:bookmark-start[@text:name='"+d+"']",odf.Namespaces.lookupNamespaceURI),0===k.length&&(k=e.getODFElementsWithXPath(f,"//text:bookmark[@text:name='"+d+"']",odf.Namespaces.lookupNamespaceURI)),
0<k.length&&k[0].scrollIntoView(!0)):/^\s*(javascript|data):/.test(d)?runtime.log("WARN:","potentially malicious URL ignored"):a.open(d),b.preventDefault?b.preventDefault():b.returnValue=!1))}};this.setModifier=function(a){c!==a&&(runtime.assert(a===p.None||a===p.Ctrl||a===p.Meta,"Unsupported KeyboardHandler.Modifier value: "+a),c=a,c!==p.None?g():b(),r(c))};this.getModifier=function(){return c};this.destroy=function(a){g();m();a()}};
gui.EventManager=function(h){function l(a){function c(a,c,b){var d,f=!1;d="on"+c;a.attachEvent&&(a.attachEvent(d,b),f=!0);!f&&a.addEventListener&&(a.addEventListener(c,b,!1),f=!0);f&&!y[c]||!a.hasOwnProperty(d)||(a[d]=b)}function b(a,c,b){var d="on"+c;a.detachEvent&&a.detachEvent(d,b);a.removeEventListener&&a.removeEventListener(c,b,!1);a[d]===b&&(a[d]=null)}function d(c){if(-1===e.indexOf(c)){e.push(c);if(f.filters.every(function(a){return a(c)}))try{k.emit(a,c)}catch(N){runtime.log("Error occurred while processing "+
a+":\n"+N.message+"\n"+N.stack)}runtime.setTimeout(function(){e.splice(e.indexOf(c),1)},0)}}var f=this,e=[],k=new webodfcore.EventNotifier([a]);this.filters=[];this.subscribe=function(c){k.subscribe(a,c)};this.unsubscribe=function(c){k.unsubscribe(a,c)};this.destroy=function(){b(z,a,d);b(H,a,d);b(K,a,d)};t[a]&&c(z,a,d);c(H,a,d);c(K,a,d)}function d(a,c,b){function d(c){b(c,f,function(c){c.type=a;e.emit(a,c)})}var f={},e=new webodfcore.EventNotifier([a]);this.subscribe=function(c){e.subscribe(a,c)};
this.unsubscribe=function(c){e.unsubscribe(a,c)};this.destroy=function(){c.forEach(function(a){U.unsubscribe(a,d)})};(function(){c.forEach(function(a){U.subscribe(a,d)})})()}function b(a){runtime.clearTimeout(a);delete L[a]}function g(a,c){var d=runtime.setTimeout(function(){a();b(d)},c);L[d]=!0;return d}function m(a,c,d){var f=a.touches.length,e=a.touches[0],k=c.timer;"touchmove"===a.type||"touchend"===a.type?k&&b(k):"touchstart"===a.type&&(1!==f?runtime.clearTimeout(k):k=g(function(){d({clientX:e.clientX,
clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,target:a.target||a.srcElement||null,detail:1})},400));c.timer=k}function r(a,c,b){var d=a.touches[0],f=a.target||a.srcElement||null,e=c.target;1!==a.touches.length||"touchend"===a.type?e=null:"touchstart"===a.type&&"webodf-draggable"===f.getAttribute("class")?e=f:"touchmove"===a.type&&e&&(a.preventDefault(),a.stopPropagation(),b({clientX:d.clientX,clientY:d.clientY,pageX:d.pageX,pageY:d.pageY,target:e,detail:1}));c.target=e}function p(a,c,b){var d=a.target||
a.srcElement||null,f=c.dragging;"drag"===a.type?f=!0:"touchend"===a.type&&f&&(f=!1,a=a.changedTouches[0],b({clientX:a.clientX,clientY:a.clientY,pageX:a.pageX,pageY:a.pageY,target:d,detail:1}));c.dragging=f}function q(){K.classList.add("webodf-touchEnabled");U.unsubscribe("touchstart",q)}function e(a){var c=a.scrollX,b=a.scrollY;this.restore=function(){a.scrollX===c&&a.scrollY===b||a.scrollTo(c,b)}}function n(a){var c=a.scrollTop,b=a.scrollLeft;this.restore=function(){if(a.scrollTop!==c||a.scrollLeft!==
b)a.scrollTop=c,a.scrollLeft=b}}function a(a,c){var b=J[a]||B[a]||null;!b&&c&&(b=J[a]=new l(a));return b}function c(c,b){a(c,!0).subscribe(b)}function k(c,b){var d=a(c,!1);d&&d.unsubscribe(b)}function f(){return h.getDOMDocument().activeElement===H}function v(){f()&&H.blur();H.setAttribute("disabled","true")}function u(){H.removeAttribute("disabled")}function x(a){for(var c=[];a;)(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight)&&c.push(new n(a)),a=a.parentNode;c.push(new e(z));return c}
function w(){var a;f()||(a=x(H),u(),H.focus(),a.forEach(function(a){a.restore()}))}var z=runtime.getWindow(),y={beforecut:!0,beforepaste:!0,longpress:!0,drag:!0,dragstop:!0},t={mousedown:!0,mouseup:!0,focus:!0},B={},J={},H,K=h.getCanvas().getElement(),U=this,L={};this.addFilter=function(c,b){a(c,!0).filters.push(b)};this.removeFilter=function(c,b){var d=a(c,!0),f=d.filters.indexOf(b);-1!==f&&d.filters.splice(f,1)};this.subscribe=c;this.unsubscribe=k;this.hasFocus=f;this.focus=w;this.getEventTrap=
function(){return H};this.setEditing=function(a){var c=f();c&&H.blur();a?H.removeAttribute("readOnly"):H.setAttribute("readOnly","true");c&&w()};this.destroy=function(a){k("touchstart",q);Object.keys(L).forEach(function(a){b(parseInt(a,10))});L.length=0;Object.keys(B).forEach(function(a){B[a].destroy()});B={};k("mousedown",v);k("mouseup",u);k("contextmenu",u);Object.keys(J).forEach(function(a){J[a].destroy()});J={};H.parentNode.removeChild(H);a()};(function(){var a=h.getOdfCanvas().getSizer(),b=a.ownerDocument;
runtime.assert(!!z,"EventManager requires a window object to operate correctly");H=b.createElement("textarea");H.id="eventTrap";H.setAttribute("tabindex","-1");H.setAttribute("readOnly","true");H.setAttribute("rows","1");a.appendChild(H);c("mousedown",v);c("mouseup",u);c("contextmenu",u);B.longpress=new d("longpress",["touchstart","touchmove","touchend"],m);B.drag=new d("drag",["touchstart","touchmove","touchend"],r);B.dragstop=new d("dragstop",["drag","touchend"],p);c("touchstart",q)})()};
gui.IOSSafariSupport=function(h){function l(){d.innerHeight!==d.outerHeight&&(b.style.display="none",runtime.requestAnimationFrame(function(){b.style.display="block"}))}var d=runtime.getWindow(),b=h.getEventTrap();this.destroy=function(d){h.unsubscribe("focus",l);b.removeAttribute("autocapitalize");b.style.WebkitTransform="";d()};h.subscribe("focus",l);b.setAttribute("autocapitalize","off");b.style.WebkitTransform="translateX(-10000px)"};
gui.HyperlinkController=function(h,l,d,b){function g(){var b=!0;!0===l.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(b=d.isLocalCursorWithinOwnAnnotation());b!==e&&(e=b,q.emit(gui.HyperlinkController.enabledChanged,e))}function m(d){d.getMemberId()===b&&g()}var r=odf.OdfUtils,p=h.getOdtDocument(),q=new webodfcore.EventNotifier([gui.HyperlinkController.enabledChanged]),e=!1;this.isEnabled=function(){return e};this.subscribe=function(b,a){q.subscribe(b,a)};this.unsubscribe=function(b,a){q.unsubscribe(b,
a)};this.addHyperlink=function(d,a){if(e){var c=p.getCursorSelection(b),k;new ops.OpApplyHyperlink;var f=[];if(0===c.length||a)a=a||d,k=new ops.OpInsertText,k.init({memberid:b,position:c.position,text:a}),c.length=a.length,f.push(k);k=new ops.OpApplyHyperlink;k.init({memberid:b,position:c.position,length:c.length,hyperlink:d});f.push(k);h.enqueue(f)}};this.removeHyperlinks=function(){if(e){var d=p.createPositionIterator(p.getRootNode()),a=p.getCursor(b).getSelectedRange(),c=r.getHyperlinkElements(a),
k=a.collapsed&&1===c.length,f=p.getDOMDocument().createRange(),g=[],l,m;0!==c.length&&(c.forEach(function(a){f.selectNodeContents(a);l=p.convertDomToCursorRange({anchorNode:f.startContainer,anchorOffset:f.startOffset,focusNode:f.endContainer,focusOffset:f.endOffset});m=new ops.OpRemoveHyperlink;m.init({memberid:b,position:l.position,length:l.length});g.push(m)}),k||(k=c[0],-1===a.comparePoint(k,0)&&(f.setStart(k,0),f.setEnd(a.startContainer,a.startOffset),l=p.convertDomToCursorRange({anchorNode:f.startContainer,
anchorOffset:f.startOffset,focusNode:f.endContainer,focusOffset:f.endOffset}),0<l.length&&(m=new ops.OpApplyHyperlink,m.init({memberid:b,position:l.position,length:l.length,hyperlink:r.getHyperlinkTarget(k)}),g.push(m))),c=c[c.length-1],d.moveToEndOfNode(c),d=d.unfilteredDomOffset(),1===a.comparePoint(c,d)&&(f.setStart(a.endContainer,a.endOffset),f.setEnd(c,d),l=p.convertDomToCursorRange({anchorNode:f.startContainer,anchorOffset:f.startOffset,focusNode:f.endContainer,focusOffset:f.endOffset}),0<l.length&&
(m=new ops.OpApplyHyperlink,m.init({memberid:b,position:l.position,length:l.length,hyperlink:r.getHyperlinkTarget(c)}),g.push(m)))),h.enqueue(g),f.detach())}};this.destroy=function(b){p.unsubscribe(ops.Document.signalCursorMoved,m);l.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,g);b()};p.subscribe(ops.Document.signalCursorMoved,m);l.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,g);g()};gui.HyperlinkController.enabledChanged="enabled/changed";
gui.ImageController=function(h,l,d,b,g){function m(){var a=!0;!0===l.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(a=d.isLocalCursorWithinOwnAnnotation());a!==k&&(k=a,c.emit(gui.ImageController.enabledChanged,k))}function r(a){a.getMemberId()===b&&m()}var p={"image/gif":".gif","image/jpeg":".jpg","image/png":".png"},q=odf.Namespaces.textns,e=h.getOdtDocument(),n=odf.OdfUtils,a=e.getFormatting(),c=new webodfcore.EventNotifier([gui.HyperlinkController.enabledChanged]),k=!1;this.isEnabled=function(){return k};
this.subscribe=function(a,b){c.subscribe(a,b)};this.unsubscribe=function(a,b){c.unsubscribe(a,b)};this.insertImage=function(c,d,l,m){if(k){var f=new webodfcore.CSSUnits;runtime.assert(0<l&&0<m,"Both width and height of the image should be greater than 0px.");m={width:l,height:m};if(l=n.getParagraphElement(e.getCursor(b).getNode()).getAttributeNS(q,"style-name")){l=a.getContentSize(l,"paragraph");var r=1,v=1;m.width>l.width&&(r=l.width/m.width);m.height>l.height&&(v=l.height/m.height);l=Math.min(r,
v);m={width:m.width*l,height:m.height*l}}l=f.convert(m.width,"px","cm")+"cm";f=f.convert(m.height,"px","cm")+"cm";v=e.getOdfCanvas().odfContainer().rootElement.styles;m=c.toLowerCase();var r=p.hasOwnProperty(m)?p[m]:null,t;m=[];runtime.assert(null!==r,"Image type is not supported: "+c);r="Pictures/"+g.generateImageName()+r;t=new ops.OpSetBlob;t.init({memberid:b,filename:r,mimetype:c,content:d});m.push(t);a.getStyleElement("Graphics","graphic",[v])||(c=new ops.OpAddStyle,c.init({memberid:b,styleName:"Graphics",
styleFamily:"graphic",isAutomaticStyle:!1,setProperties:{"style:graphic-properties":{"text:anchor-type":"paragraph","svg:x":"0cm","svg:y":"0cm","style:wrap":"dynamic","style:number-wrapped-paragraphs":"no-limit","style:wrap-contour":"false","style:vertical-pos":"top","style:vertical-rel":"paragraph","style:horizontal-pos":"center","style:horizontal-rel":"paragraph"}}}),m.push(c));c=g.generateStyleName();d=new ops.OpAddStyle;d.init({memberid:b,styleName:c,styleFamily:"graphic",isAutomaticStyle:!0,
setProperties:{"style:parent-style-name":"Graphics","style:graphic-properties":{"style:vertical-pos":"top","style:vertical-rel":"baseline","style:horizontal-pos":"center","style:horizontal-rel":"paragraph","fo:background-color":"transparent","style:background-transparency":"100%","style:shadow":"none","style:mirror":"none","fo:clip":"rect(0cm, 0cm, 0cm, 0cm)","draw:luminance":"0%","draw:contrast":"0%","draw:red":"0%","draw:green":"0%","draw:blue":"0%","draw:gamma":"100%","draw:color-inversion":"false",
"draw:image-opacity":"100%","draw:color-mode":"standard"}}});m.push(d);t=new ops.OpInsertImage;t.init({memberid:b,position:e.getCursorPosition(b),filename:r,frameWidth:l,frameHeight:f,frameStyleName:c,frameName:g.generateFrameName()});m.push(t);h.enqueue(m)}};this.destroy=function(a){e.unsubscribe(ops.Document.signalCursorMoved,r);l.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,m);a()};e.subscribe(ops.Document.signalCursorMoved,r);l.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,m);m()};
gui.ImageController.enabledChanged="enabled/changed";
gui.ImageSelector=function(h){function l(){var d=h.getSizer(),l=g.createElement("div");l.id="imageSelector";l.style.borderWidth="1px";d.appendChild(l);b.forEach(function(b){var d=g.createElement("div");d.className=b;l.appendChild(d)});return l}var d=odf.Namespaces.svgns,b="topLeft topRight bottomRight bottomLeft topMiddle rightMiddle bottomMiddle leftMiddle".split(" "),g=h.getElement().ownerDocument,m=!1;this.select=function(b){var p,r,e=g.getElementById("imageSelector");e||(e=l());m=!0;p=e.parentNode;
r=b.getBoundingClientRect();var n=p.getBoundingClientRect(),a=h.getZoomLevel();p=(r.left-n.left)/a-1;r=(r.top-n.top)/a-1;e.style.display="block";e.style.left=p+"px";e.style.top=r+"px";e.style.width=b.getAttributeNS(d,"width");e.style.height=b.getAttributeNS(d,"height")};this.clearSelection=function(){var b;m&&(b=g.getElementById("imageSelector"))&&(b.style.display="none");m=!1};this.isSelectorElement=function(b){var d=g.getElementById("imageSelector");return d?b===d||b.parentNode===d:!1}};
(function(){function h(h){function d(b){r=b.which&&String.fromCharCode(b.which)===l;l=void 0;return!1===r}function b(){r=!1}function g(b){l=b.data;r=!1}var l,r=!1;this.destroy=function(l){h.unsubscribe("textInput",b);h.unsubscribe("compositionend",g);h.removeFilter("keypress",d);l()};h.subscribe("textInput",b);h.subscribe("compositionend",g);h.addFilter("keypress",d)}gui.InputMethodEditor=function(l,d){function b(c){a&&(c?a.getNode().setAttributeNS("urn:webodf:names:cursor","composing","true"):(a.getNode().removeAttributeNS("urn:webodf:names:cursor",
"composing"),f.textContent=""))}function g(){u&&(u=!1,b(!1),w.emit(gui.InputMethodEditor.signalCompositionEnd,{data:x}),x="")}function m(){J||(J=!0,g(),a&&a.getSelectedRange().collapsed?c.value="":c.value=y.writeToString(a.getSelectedRange().cloneContents()),c.setSelectionRange(0,c.value.length),J=!1)}function r(){d.hasFocus()&&v.trigger()}function p(){z=void 0;v.cancel();b(!0);u||w.emit(gui.InputMethodEditor.signalCompositionStart,{data:""})}function q(a){a=z=a.data;u=!0;x+=a;v.trigger()}function e(a){a.data!==
z&&(a=a.data,u=!0,x+=a,v.trigger());z=void 0}function n(){f.textContent=c.value}var a=null,c=d.getEventTrap(),k=c.ownerDocument,f,v,u=!1,x="",w=new webodfcore.EventNotifier([gui.InputMethodEditor.signalCompositionStart,gui.InputMethodEditor.signalCompositionEnd]),z,y,t=[],B,J=!1;this.subscribe=w.subscribe;this.unsubscribe=w.unsubscribe;this.registerCursor=function(c){c.getMemberId()===l&&(a=c,a.getNode().appendChild(f),c.subscribe(ops.OdtCursor.signalCursorUpdated,r),d.subscribe("input",n),d.subscribe("compositionupdate",
n))};this.removeCursor=function(c){a&&c===l&&(a.getNode().removeChild(f),a.unsubscribe(ops.OdtCursor.signalCursorUpdated,r),d.unsubscribe("input",n),d.unsubscribe("compositionupdate",n),a=null)};this.destroy=function(a){d.unsubscribe("compositionstart",p);d.unsubscribe("compositionend",q);d.unsubscribe("textInput",e);d.unsubscribe("keypress",g);d.unsubscribe("focus",m);webodfcore.Async.destroyAll(B,a)};(function(){y=new odf.TextSerializer;y.filter=new odf.OdfNodeFilter;d.subscribe("compositionstart",
p);d.subscribe("compositionend",q);d.subscribe("textInput",e);d.subscribe("keypress",g);d.subscribe("focus",m);t.push(new h(d));B=t.map(function(a){return a.destroy});f=k.createElement("span");f.setAttribute("id","composer");v=webodfcore.Task.createTimeoutTask(m,1);B.push(v.destroy)})()};gui.InputMethodEditor.signalCompositionStart="input/compositionstart";gui.InputMethodEditor.signalCompositionEnd="input/compositionend"})();
gui.MetadataController=function(h,l){function d(b){m.emit(gui.MetadataController.signalMetadataChanged,b)}function b(b){var d=-1===r.indexOf(b);d||runtime.log("Setting "+b+" is restricted.");return d}var g=h.getOdtDocument(),m=new webodfcore.EventNotifier([gui.MetadataController.signalMetadataChanged]),r=["dc:creator","dc:date","meta:editing-cycles","meta:editing-duration","meta:document-statistic"];this.setMetadata=function(d,g){var e={},m="",a;d&&Object.keys(d).filter(b).forEach(function(a){e[a]=
d[a]});g&&(m=g.filter(b).join(","));if(0<m.length||0<Object.keys(e).length)a=new ops.OpUpdateMetadata,a.init({memberid:l,setProperties:e,removedProperties:0<m.length?{attributes:m}:null}),h.enqueue([a])};this.getMetadata=function(b){var d;runtime.assert("string"===typeof b,"Property must be a string");d=b.split(":");runtime.assert(2===d.length,"Property must be a namespace-prefixed string");b=odf.Namespaces.lookupNamespaceURI(d[0]);runtime.assert(!!b,"Prefix must be for an ODF namespace.");return g.getOdfCanvas().odfContainer().getMetadata(b,
d[1])};this.subscribe=function(b,d){m.subscribe(b,d)};this.unsubscribe=function(b,d){m.unsubscribe(b,d)};this.destroy=function(b){g.unsubscribe(ops.OdtDocument.signalMetadataUpdated,d);b()};g.subscribe(ops.OdtDocument.signalMetadataUpdated,d)};gui.MetadataController.signalMetadataChanged="metadata/changed";
gui.PasteController=function(h,l,d,b){function g(){p=!0===l.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?d.isLocalCursorWithinOwnAnnotation():!0}function m(a){a.getMemberId()===b&&g()}var r=h.getOdtDocument(),p=!1,q=odf.Namespaces.textns,e=webodfcore.StepDirection.NEXT,n=odf.OdfUtils;this.isEnabled=function(){return p};this.paste=function(a){if(p){var c=r.getCursorPosition(b),d=r.getCursor(b).getNode(),d=n.getParagraphElement(d),f=d.getAttributeNS(q,"style-name")||"",g=c,l=[],m=r.convertDomPointToCursorStep(d,
0,e);a.replace(/\r/g,"").split("\n").forEach(function(a){var c=new ops.OpInsertText,d=new ops.OpSplitParagraph;c.init({memberid:b,position:g,text:a,moveCursor:!0});l.push(c);g+=a.length;d.init({memberid:b,position:g,paragraphStyleName:f,sourceParagraphPosition:m,moveCursor:!0});l.push(d);m=g+=1});l.pop();h.enqueue(l)}};this.destroy=function(a){r.unsubscribe(ops.Document.signalCursorMoved,m);l.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,g);a()};r.subscribe(ops.Document.signalCursorMoved,m);
l.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,g);g()};gui.ClosestXOffsetScanner=function(h){function l(b){return null!==b&&void 0!==g?Math.abs(b-h)>g:!1}function d(b){null!==b&&!1===l(b)&&(g=Math.abs(b-h))}var b=this,g,m=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT;this.token=void 0;this.process=function(g,h,q){var e,n;g.visualDirection===m?(e=h&&h.right,n=q&&q.left):(e=h&&h.left,n=q&&q.right);if(l(e)||l(n))return!0;if(h||q)d(e),d(n),b.token=g.token;return!1}};
gui.LineBoundaryScanner=function(){var h=this,l=null;this.token=void 0;this.process=function(d,b,g){var m;if(m=g)if(l){m=Math.min(l.bottom-l.top,g.bottom-g.top);var r=Math.max(l.top,g.top),p=Math.min(l.bottom,g.bottom);m=.4>=(0<m?(p-r)/m:0)}else m=!1;!b||g&&!m||(h.token=d.token);if(m)return!0;l=(d=l)&&b?{left:Math.min(d.left,b.left),right:Math.max(d.right,b.right),top:Math.min(d.top,b.top),bottom:Math.min(d.bottom,b.bottom)}:d||b;return!1}};
gui.ParagraphBoundaryScanner=function(){var h=this,l=!1,d,b=odf.OdfUtils;this.token=void 0;this.process=function(g){var m=b.getParagraphElement(g.container());l||(d=m,l=!0);if(d!==m)return!0;h.token=g.token;return!1}};
odf.WordBoundaryFilter=function(h,l){function d(a,b,c){for(var d=null,f=h.getRootNode(),e;a!==f&&null!==a&&null===d;)e=0>b?a.previousSibling:a.nextSibling,c(e)===NodeFilter.FILTER_ACCEPT&&(d=e),a=a.parentNode;return d}function b(a,b){var c;return null===a?k.NO_NEIGHBOUR:r.isCharacterElement(a)?k.SPACE_CHAR:a.nodeType===g||r.isTextSpan(a)||r.isHyperlink(a)?(c=a.textContent.charAt(b()),q.test(c)?k.SPACE_CHAR:p.test(c)?k.PUNCTUATION_CHAR:k.WORD_CHAR):k.OTHER}var g=Node.TEXT_NODE,m=Node.ELEMENT_NODE,
r=odf.OdfUtils,p=/[!-#%-*,-\/:-;?-@\[-\]_{}\u00a1\u00ab\u00b7\u00bb\u00bf;\u00b7\u055a-\u055f\u0589-\u058a\u05be\u05c0\u05c3\u05c6\u05f3-\u05f4\u0609-\u060a\u060c-\u060d\u061b\u061e-\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0964-\u0965\u0970\u0df4\u0e4f\u0e5a-\u0e5b\u0f04-\u0f12\u0f3a-\u0f3d\u0f85\u0fd0-\u0fd4\u104a-\u104f\u10fb\u1361-\u1368\u166d-\u166e\u169b-\u169c\u16eb-\u16ed\u1735-\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u180a\u1944-\u1945\u19de-\u19df\u1a1e-\u1a1f\u1b5a-\u1b60\u1c3b-\u1c3f\u1c7e-\u1c7f\u2000-\u206e\u207d-\u207e\u208d-\u208e\u3008-\u3009\u2768-\u2775\u27c5-\u27c6\u27e6-\u27ef\u2983-\u2998\u29d8-\u29db\u29fc-\u29fd\u2cf9-\u2cfc\u2cfe-\u2cff\u2e00-\u2e7e\u3000-\u303f\u30a0\u30fb\ua60d-\ua60f\ua673\ua67e\ua874-\ua877\ua8ce-\ua8cf\ua92e-\ua92f\ua95f\uaa5c-\uaa5f\ufd3e-\ufd3f\ufe10-\ufe19\ufe30-\ufe52\ufe54-\ufe61\ufe63\ufe68\ufe6a-\ufe6b\uff01-\uff03\uff05-\uff0a\uff0c-\uff0f\uff1a-\uff1b\uff1f-\uff20\uff3b-\uff3d\uff3f\uff5b\uff5d\uff5f-\uff65]|\ud800[\udd00-\udd01\udf9f\udfd0]|\ud802[\udd1f\udd3f\ude50-\ude58]|\ud809[\udc00-\udc7e]/,
q=/\s/,e=webodfcore.PositionFilter.FilterResult.FILTER_ACCEPT,n=webodfcore.PositionFilter.FilterResult.FILTER_REJECT,a=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,c=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,k={NO_NEIGHBOUR:0,SPACE_CHAR:1,PUNCTUATION_CHAR:2,WORD_CHAR:3,OTHER:4};this.acceptPosition=function(f){var g=f.container(),h=f.leftNode(),p=f.rightNode(),r=f.unfilteredDomOffset,q=function(){return f.unfilteredDomOffset()-1};g.nodeType===m&&(null===p&&(p=d(g,1,f.getNodeFilter())),
null===h&&(h=d(g,-1,f.getNodeFilter())));g!==p&&(r=function(){return 0});g!==h&&null!==h&&(q=function(){return h.textContent.length-1});g=b(h,q);p=b(p,r);return g===k.WORD_CHAR&&p===k.WORD_CHAR||g===k.PUNCTUATION_CHAR&&p===k.PUNCTUATION_CHAR||l===a&&g!==k.NO_NEIGHBOUR&&p===k.SPACE_CHAR||l===c&&g===k.SPACE_CHAR&&p!==k.NO_NEIGHBOUR?n:e}};odf.WordBoundaryFilter.IncludeWhitespace={None:0,TRAILING:1,LEADING:2};
gui.SelectionController=function(h,l){function d(a){var b=a.spec();if(a.isEdit||b.memberid===l)J=void 0,H.cancel()}function b(){var a=u.getCursor(l).getNode();return u.createStepIterator(a,0,[z,t],u.getRootElement(a))}function g(a,b,c){c=new odf.WordBoundaryFilter(u,c);var d=u.getRootElement(a)||u.getRootNode(),f=u.createRootFilter(d);return u.createStepIterator(a,b,[z,f,c],d)}function m(a,b){return b?{anchorNode:a.startContainer,anchorOffset:a.startOffset,focusNode:a.endContainer,focusOffset:a.endOffset}:
{anchorNode:a.endContainer,anchorOffset:a.endOffset,focusNode:a.startContainer,focusOffset:a.startOffset}}function r(a,b,c){var d=new ops.OpMoveCursor;d.init({memberid:l,position:a,length:b||0,selectionType:c});return d}function p(a,b,c){var d;d=u.getCursor(l);d=m(d.getSelectedRange(),d.hasForwardSelection());d.focusNode=a;d.focusOffset=b;c||(d.anchorNode=d.focusNode,d.anchorOffset=d.focusOffset);a=u.convertDomToCursorRange(d);h.enqueue([r(a.position,a.length)])}function q(a){var b;b=g(a.startContainer,
a.startOffset,K);b.roundToPreviousStep()&&a.setStart(b.container(),b.offset());b=g(a.endContainer,a.endOffset,U);b.roundToNextStep()&&a.setEnd(b.container(),b.offset())}function e(a){var b=w.getParagraphElements(a),c=b[0],b=b[b.length-1];c&&a.setStart(c,0);b&&(w.isParagraph(a.endContainer)&&0===a.endOffset?a.setEndBefore(b):a.setEnd(b,b.childNodes.length))}function n(a,b,c,d){var f,e;d?(f=c.startContainer,e=c.startOffset):(f=c.endContainer,e=c.endOffset);x.containsNode(a,f)||(e=0>x.comparePoints(a,
0,f,e)?0:a.childNodes.length,f=a);a=u.createStepIterator(f,e,b,w.getParagraphElement(f)||a);a.roundToClosestStep()||runtime.assert(!1,"No step found in requested range");d?c.setStart(a.container(),a.offset()):c.setEnd(a.container(),a.offset())}function a(a,c){var d=b();d.advanceStep(a)&&p(d.container(),d.offset(),c)}function c(a,c){var d,f=J,e=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];void 0===f&&B&&(f=B());isNaN(f)||(d=b(),y.moveToFilteredStep(d,a,e)&&d.advanceStep(a)&&(e=[new gui.ClosestXOffsetScanner(f),
new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner],y.moveToFilteredStep(d,a,e)&&(p(d.container(),d.offset(),c),J=f,H.restart())))}function k(a,c){var d=b(),f=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];y.moveToFilteredStep(d,a,f)&&p(d.container(),d.offset(),c)}function f(a,b){var c=u.getCursor(l),c=m(c.getSelectedRange(),c.hasForwardSelection()),c=g(c.focusNode,c.focusOffset,K);c.advanceStep(a)&&p(c.container(),c.offset(),b)}function v(a,b,c){var d=u.getCursor(l),d=m(d.getSelectedRange(),
d.hasForwardSelection()),f=u.getRootElement(d.focusNode);runtime.assert(!!f,"SelectionController: Cursor outside root");d=u.createStepIterator(d.focusNode,d.focusOffset,[z,t],f);d.roundToClosestStep();d.advanceStep(a)&&(c=c(d.container()))&&(a===L?(d.setPosition(c,0),a=d.roundToNextStep()):(d.setPosition(c,c.childNodes.length),a=d.roundToPreviousStep()),a&&p(d.container(),d.offset(),b))}var u=h.getOdtDocument(),x=webodfcore.DomUtils,w=odf.OdfUtils,z=u.getPositionFilter(),y=new gui.GuiStepUtils,t=
u.createRootFilter(l),B=null,J,H,K=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,U=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,L=webodfcore.StepDirection.PREVIOUS,Q=webodfcore.StepDirection.NEXT;this.selectionToRange=function(a){var c=0<=x.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset),b=a.focusNode.ownerDocument.createRange();c?(b.setStart(a.anchorNode,a.anchorOffset),b.setEnd(a.focusNode,a.focusOffset)):(b.setStart(a.focusNode,a.focusOffset),b.setEnd(a.anchorNode,
a.anchorOffset));return{range:b,hasForwardSelection:c}};this.rangeToSelection=m;this.selectImage=function(a){var c=u.getRootElement(a),b=u.createRootFilter(c),c=u.createStepIterator(a,0,[b,u.getPositionFilter()],c),d;c.roundToPreviousStep()||runtime.assert(!1,"No walkable position before frame");b=c.container();d=c.offset();c.setPosition(a,a.childNodes.length);c.roundToNextStep()||runtime.assert(!1,"No walkable position after frame");a=u.convertDomToCursorRange({anchorNode:b,anchorOffset:d,focusNode:c.container(),
focusOffset:c.offset()});a=r(a.position,a.length,ops.OdtCursor.RegionSelection);h.enqueue([a])};this.expandToWordBoundaries=q;this.expandToParagraphBoundaries=e;this.selectRange=function(a,c,b){var d=u.getOdfCanvas().getElement(),f,k=[z];f=x.containsNode(d,a.startContainer);d=x.containsNode(d,a.endContainer);if(f||d)if(f&&d&&(2===b?q(a):3<=b&&e(a)),(b=c?u.getRootElement(a.startContainer):u.getRootElement(a.endContainer))||(b=u.getRootNode()),k.push(u.createRootFilter(b)),n(b,k,a,!0),n(b,k,a,!1),a=
m(a,c),c=u.convertDomToCursorRange(a),a=u.getCursorSelection(l),c.position!==a.position||c.length!==a.length)a=r(c.position,c.length,ops.OdtCursor.RangeSelection),h.enqueue([a])};this.moveCursorToLeft=function(){a(L,!1);return!0};this.moveCursorToRight=function(){a(Q,!1);return!0};this.extendSelectionToLeft=function(){a(L,!0);return!0};this.extendSelectionToRight=function(){a(Q,!0);return!0};this.setCaretXPositionLocator=function(a){B=a};this.moveCursorUp=function(){c(L,!1);return!0};this.moveCursorDown=
function(){c(Q,!1);return!0};this.extendSelectionUp=function(){c(L,!0);return!0};this.extendSelectionDown=function(){c(Q,!0);return!0};this.moveCursorBeforeWord=function(){f(L,!1);return!0};this.moveCursorPastWord=function(){f(Q,!1);return!0};this.extendSelectionBeforeWord=function(){f(L,!0);return!0};this.extendSelectionPastWord=function(){f(Q,!0);return!0};this.moveCursorToLineStart=function(){k(L,!1);return!0};this.moveCursorToLineEnd=function(){k(Q,!1);return!0};this.extendSelectionToLineStart=
function(){k(L,!0);return!0};this.extendSelectionToLineEnd=function(){k(Q,!0);return!0};this.extendSelectionToParagraphStart=function(){v(L,!0,w.getParagraphElement);return!0};this.extendSelectionToParagraphEnd=function(){v(Q,!0,w.getParagraphElement);return!0};this.moveCursorToParagraphStart=function(){v(L,!1,w.getParagraphElement);return!0};this.moveCursorToParagraphEnd=function(){v(Q,!1,w.getParagraphElement);return!0};this.moveCursorToDocumentStart=function(){v(L,!1,u.getRootElement);return!0};
this.moveCursorToDocumentEnd=function(){v(Q,!1,u.getRootElement);return!0};this.extendSelectionToDocumentStart=function(){v(L,!0,u.getRootElement);return!0};this.extendSelectionToDocumentEnd=function(){v(Q,!0,u.getRootElement);return!0};this.extendSelectionToEntireDocument=function(){var a=u.getCursor(l),a=u.getRootElement(a.getNode()),c,b,d;runtime.assert(!!a,"SelectionController: Cursor outside root");d=u.createStepIterator(a,0,[z,t],a);d.roundToClosestStep();c=d.container();b=d.offset();d.setPosition(a,
a.childNodes.length);d.roundToClosestStep();a=u.convertDomToCursorRange({anchorNode:c,anchorOffset:b,focusNode:d.container(),focusOffset:d.offset()});h.enqueue([r(a.position,a.length)]);return!0};this.destroy=function(a){u.unsubscribe(ops.OdtDocument.signalOperationStart,d);webodfcore.Async.destroyAll([H.destroy],a)};(function(){H=webodfcore.Task.createTimeoutTask(function(){J=void 0},2E3);u.subscribe(ops.OdtDocument.signalOperationStart,d)})()};
gui.TextController=function(h,l,d,b,g,m){function r(){v=!0===l.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?d.isLocalCursorWithinOwnAnnotation():!0}function p(a){a.getMemberId()===b&&r()}function q(a,b,d){var f=[c.getPositionFilter()];d&&f.push(c.createRootFilter(a.startContainer));d=c.createStepIterator(a.startContainer,a.startOffset,f,b);d.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range start");b=c.convertDomPointToCursorStep(d.container(),d.offset());
a.collapsed?a=b:(d.setPosition(a.endContainer,a.endOffset),d.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range end"),a=c.convertDomPointToCursorStep(d.container(),d.offset()));return{position:b,length:a-b}}function e(a){var c,d,e,g=k.getParagraphElements(a),h=a.cloneRange(),l=[];c=g[0];1<g.length&&(k.hasNoODFContent(c)&&(c=g[g.length-1]),d=c.getAttributeNS(odf.Namespaces.textns,"style-name")||"");g.forEach(function(c,k){var g,m;h.setStart(c,0);h.collapse(!0);
g=q(h,c,!1).position;0<k&&(m=new ops.OpMergeParagraph,m.init({memberid:b,paragraphStyleName:d,destinationStartPosition:e,sourceStartPosition:g,moveCursor:1===k}),l.unshift(m));e=g;h.selectNodeContents(c);if(g=f.rangeIntersection(h,a))g=q(g,c,!0),0<g.length&&(m=new ops.OpRemoveText,m.init({memberid:b,position:g.position,length:g.length}),l.unshift(m))});return l}function n(a){0>a.length&&(a.position+=a.length,a.length=-a.length);return a}function a(a){if(!v)return!1;var d,f=c.getCursor(b).getSelectedRange().cloneRange(),
k=n(c.getCursorSelection(b)),g;if(0===k.length){k=void 0;d=c.getCursor(b).getNode();g=c.getRootElement(d);var l=[c.getPositionFilter(),c.createRootFilter(g)];g=c.createStepIterator(d,0,l,g);g.roundToClosestStep()&&(a?g.nextStep():g.previousStep())&&(k=n(c.convertDomToCursorRange({anchorNode:d,anchorOffset:0,focusNode:g.container(),focusOffset:g.offset()})),a?(f.setStart(d,0),f.setEnd(g.container(),g.offset())):(f.setStart(g.container(),g.offset()),f.setEnd(d,0)))}k&&h.enqueue(e(f));return void 0!==
k}var c=h.getOdtDocument(),k=odf.OdfUtils,f=webodfcore.DomUtils,v=!1,u=odf.Namespaces.textns,x=webodfcore.StepDirection.NEXT;this.isEnabled=function(){return v};this.enqueueParagraphSplittingOps=function(){if(!v)return!1;var a=c.getCursor(b),d=a.getSelectedRange(),f=n(c.getCursorSelection(b)),g=[],a=k.getParagraphElement(a.getNode()),l=a.getAttributeNS(u,"style-name")||"";0<f.length&&(g=g.concat(e(d)));d=new ops.OpSplitParagraph;d.init({memberid:b,position:f.position,paragraphStyleName:l,sourceParagraphPosition:c.convertDomPointToCursorStep(a,
0,x),moveCursor:!0});g.push(d);m&&(f=m(f.position+1),g=g.concat(f));h.enqueue(g);return!0};this.removeTextByBackspaceKey=function(){return a(!1)};this.removeTextByDeleteKey=function(){return a(!0)};this.removeCurrentSelection=function(){if(!v)return!1;var a=c.getCursor(b).getSelectedRange();h.enqueue(e(a));return!0};this.insertText=function(a){if(v){var d=c.getCursor(b).getSelectedRange(),f=n(c.getCursorSelection(b)),k=[],l=!1;0<f.length&&(k=k.concat(e(d)),l=!0);d=new ops.OpInsertText;d.init({memberid:b,
position:f.position,text:a,moveCursor:!0});k.push(d);g&&(a=g(f.position,a.length,l))&&k.push(a);h.enqueue(k)}};this.destroy=function(a){c.unsubscribe(ops.Document.signalCursorMoved,p);l.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r);a()};c.subscribe(ops.Document.signalCursorMoved,p);l.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r);r()};gui.UndoManager=function(){};gui.UndoManager.prototype.subscribe=function(h,l){};gui.UndoManager.prototype.unsubscribe=function(h,l){};
gui.UndoManager.prototype.setDocument=function(h){};gui.UndoManager.prototype.setInitialState=function(){};gui.UndoManager.prototype.initialize=function(){};gui.UndoManager.prototype.purgeInitialState=function(){};gui.UndoManager.prototype.setPlaybackFunction=function(h){};gui.UndoManager.prototype.hasUndoStates=function(){};gui.UndoManager.prototype.hasRedoStates=function(){};gui.UndoManager.prototype.moveForward=function(h){};gui.UndoManager.prototype.moveBackward=function(h){};
gui.UndoManager.prototype.onOperationExecuted=function(h){};gui.UndoManager.prototype.isDocumentModified=function(){};gui.UndoManager.prototype.setDocumentModified=function(h){};gui.UndoManager.signalUndoStackChanged="undoStackChanged";gui.UndoManager.signalUndoStateCreated="undoStateCreated";gui.UndoManager.signalUndoStateModified="undoStateModified";gui.UndoManager.signalDocumentModifiedChanged="documentModifiedChanged";
gui.SessionControllerOptions=function(){this.annotationsEnabled=this.directParagraphStylingEnabled=this.directTextStylingEnabled=!1};
(function(){var h=webodfcore.PositionFilter.FilterResult.FILTER_ACCEPT;gui.SessionController=function(l,d,b,g){function m(a,c){var b=M.getDOMDocument(),d=null;b.caretRangeFromPoint?(b=b.caretRangeFromPoint(a,c),d={container:b.startContainer,offset:b.startOffset}):b.caretPositionFromPoint&&(b=b.caretPositionFromPoint(a,c))&&b.offsetNode&&(d={container:b.offsetNode,offset:b.offset});return d}function r(a){var c=M.getCursor(d).getSelectedRange();c.collapsed?a.preventDefault():ba.setDataFromRange(a,c)?
da.removeCurrentSelection():runtime.log("Cut operation failed")}function p(){return!1!==M.getCursor(d).getSelectedRange().collapsed}function q(a){var c=M.getCursor(d).getSelectedRange();c.collapsed?a.preventDefault():ba.setDataFromRange(a,c)||runtime.log("Copy operation failed")}function e(a){var c;O.clipboardData&&O.clipboardData.getData?c=O.clipboardData.getData("Text"):a.clipboardData&&a.clipboardData.getData&&(c=a.clipboardData.getData("text/plain"));c&&(da.removeCurrentSelection(),fa.paste(c));
a.preventDefault?a.preventDefault():a.returnValue=!1}function n(){return!1}function a(a){if(P)P.onOperationExecuted(a)}function c(a){M.emit(ops.OdtDocument.signalUndoStackChanged,a)}function k(){var a;return P?(a=I.hasFocus(),P.moveBackward(1),a&&I.focus(),!0):!1}function f(){var a;return P?(a=I.hasFocus(),P.moveForward(1),a&&I.focus(),!0):!1}function v(a){var c=M.getCursor(d).getSelectedRange(),f=(a.target||a.srcElement||null).getAttribute("end");c&&f&&(a=m(a.clientX,a.clientY))&&(ia.setUnfilteredPosition(a.container,
a.offset),Y.acceptPosition(ia)===h&&(c=c.cloneRange(),"left"===f?c.setStart(ia.container(),ia.unfilteredDomOffset()):c.setEnd(ia.container(),ia.unfilteredDomOffset()),b.setSelectedRange(c,"right"===f),M.emit(ops.Document.signalCursorMoved,b)))}function u(){R.selectRange(b.getSelectedRange(),b.hasForwardSelection(),1)}function x(){var a=O.getSelection(),c=0<a.rangeCount&&R.selectionToRange(a);S&&c&&(D=!0,la.clearSelection(),ia.setUnfilteredPosition(a.focusNode,a.focusOffset),Y.acceptPosition(ia)===
h&&(2===oa?R.expandToWordBoundaries(c.range):3<=oa&&R.expandToParagraphBoundaries(c.range),b.setSelectedRange(c.range,c.hasForwardSelection),M.emit(ops.Document.signalCursorMoved,b)))}function w(a){var c=a.target||a.srcElement||null,b=M.getCursor(d);if(S=null!==c&&aa.containsNode(M.getOdfCanvas().getElement(),c))D=!1,c=M.getRootElement(c)||M.getRootNode(),Y=M.createRootFilter(c),oa=0===a.button?a.detail:0,b&&a.shiftKey?O.getSelection().collapse(b.getAnchorNode(),0):(a=O.getSelection(),c=b.getSelectedRange(),
a.extend?b.hasForwardSelection()?(a.collapse(c.startContainer,c.startOffset),a.extend(c.endContainer,c.endOffset)):(a.collapse(c.endContainer,c.endOffset),a.extend(c.startContainer,c.startOffset)):(a.removeAllRanges(),a.addRange(c.cloneRange()))),1<oa&&x()}function z(a){var c=M.getRootElement(a),b=M.createRootFilter(c),c=M.createStepIterator(a,0,[b,M.getPositionFilter()],c);c.setPosition(a,a.childNodes.length);return c.roundToNextStep()?{container:c.container(),offset:c.offset()}:null}function y(a){var c;
c=(c=O.getSelection())?{anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}:null;var b=O.getSelection().isCollapsed,d,f;c.anchorNode||c.focusNode||!(d=m(a.clientX,a.clientY))||(c.anchorNode=d.container,c.anchorOffset=d.offset,c.focusNode=c.anchorNode,c.focusOffset=c.anchorOffset);if(N.isImage(c.focusNode)&&0===c.focusOffset&&N.isCharacterFrame(c.focusNode.parentNode)){if(f=c.focusNode.parentNode,d=f.getBoundingClientRect(),a.clientX>d.left&&(d=z(f)))c.focusNode=
d.container,c.focusOffset=d.offset,b&&(c.anchorNode=c.focusNode,c.anchorOffset=c.focusOffset)}else N.isImage(c.focusNode.firstChild)&&1===c.focusOffset&&N.isCharacterFrame(c.focusNode)&&(d=z(c.focusNode))&&(c.anchorNode=c.focusNode=d.container,c.anchorOffset=c.focusOffset=d.offset);c.anchorNode&&c.focusNode&&(c=R.selectionToRange(c),R.selectRange(c.range,c.hasForwardSelection,0===a.button?a.detail:0));I.focus()}function t(a){var c;if(c=m(a.clientX,a.clientY))a=c.container,c=c.offset,a={anchorNode:a,
anchorOffset:c,focusNode:a,focusOffset:c},a=R.selectionToRange(a),R.selectRange(a.range,a.hasForwardSelection,2),I.focus()}function B(a){var c=a.target||a.srcElement||null,d,f,e;ma.processRequests();S&&(N.isImage(c)&&N.isCharacterFrame(c.parentNode)&&O.getSelection().isCollapsed?(R.selectImage(c.parentNode),I.focus()):la.isSelectorElement(c)?I.focus():D?(c=b.getSelectedRange(),f=c.collapsed,N.isImage(c.endContainer)&&0===c.endOffset&&N.isCharacterFrame(c.endContainer.parentNode)&&(e=c.endContainer.parentNode,
e=z(e))&&(c.setEnd(e.container,e.offset),f&&c.collapse(!1)),R.selectRange(c,b.hasForwardSelection(),0===a.button?a.detail:0),I.focus()):ua?y(a):(d=aa.cloneEvent(a),W=runtime.setTimeout(function(){y(d)},0)),oa=0,D=S=!1)}function J(a){var c=M.getCursor(d).getSelectedRange();c.collapsed||ea.exportRangeToDataTransfer(a.dataTransfer,c)}function H(){S&&I.focus();oa=0;D=S=!1}function K(a){B(a)}function U(a){var c=a.target||a.srcElement||null;"annotationRemoveButton"===c.className?(runtime.assert(ha,"Remove buttons are displayed on annotations while annotation editing is disabled in the controller."),
a=c.parentNode.getElementsByTagNameNS(odf.Namespaces.officens,"annotation").item(0),ja.removeAnnotation(a),I.focus()):"webodf-draggable"!==c.getAttribute("class")&&B(a)}function L(a){(a=a.data)&&(-1===a.indexOf("\n")?da.insertText(a):fa.paste(a))}function Q(a){return function(){a();return!0}}function C(a){return function(c){return M.getCursor(d).getSelectionType()===ops.OdtCursor.RangeSelection?a(c):!0}}function V(c){I.unsubscribe("keydown",A.handleEvent);I.unsubscribe("keypress",X.handleEvent);I.unsubscribe("keyup",
ca.handleEvent);I.unsubscribe("copy",q);I.unsubscribe("mousedown",w);I.unsubscribe("mousemove",ma.trigger);I.unsubscribe("mouseup",U);I.unsubscribe("contextmenu",K);I.unsubscribe("dragstart",J);I.unsubscribe("dragend",H);I.unsubscribe("click",pa.handleClick);I.unsubscribe("longpress",t);I.unsubscribe("drag",v);I.unsubscribe("dragstop",u);M.unsubscribe(ops.OdtDocument.signalOperationEnd,na.trigger);M.unsubscribe(ops.Document.signalCursorAdded,ka.registerCursor);M.unsubscribe(ops.Document.signalCursorRemoved,
ka.removeCursor);M.unsubscribe(ops.OdtDocument.signalOperationEnd,a);c()}var O=runtime.getWindow(),M=l.getOdtDocument(),T=new gui.SessionConstraints,F=new gui.SessionContext(l,d),aa=webodfcore.DomUtils,N=odf.OdfUtils,ea=new gui.MimeDataExporter,ba=new gui.Clipboard(ea),A=new gui.KeyboardHandler,X=new gui.KeyboardHandler,ca=new gui.KeyboardHandler,S=!1,ga=new odf.ObjectNameGenerator(M.getOdfCanvas().odfContainer(),d),D=!1,Y=null,W,P=null,I=new gui.EventManager(M),ha=g.annotationsEnabled,ja=new gui.AnnotationController(l,
T,d),Z=new gui.DirectFormattingController(l,T,F,d,ga,g.directTextStylingEnabled,g.directParagraphStylingEnabled),da=new gui.TextController(l,T,F,d,Z.createCursorStyleOp,Z.createParagraphStyleOps),qa=new gui.ImageController(l,T,F,d,ga),la=new gui.ImageSelector(M.getOdfCanvas()),ia=M.createPositionIterator(M.getRootNode()),ma,na,fa=new gui.PasteController(l,T,F,d),ka=new gui.InputMethodEditor(d,I),oa=0,pa=new gui.HyperlinkClickHandler(M.getOdfCanvas().getElement,A,ca),ta=new gui.HyperlinkController(l,
T,F,d),R=new gui.SelectionController(l,d),va=new gui.MetadataController(l,d),E=gui.KeyboardHandler.Modifier,G=gui.KeyboardHandler.KeyCode,ra=-1!==O.navigator.appVersion.toLowerCase().indexOf("mac"),ua=-1!==["iPad","iPod","iPhone"].indexOf(O.navigator.platform),sa;runtime.assert(null!==O,"Expected to be run in an environment which has a global window, like a browser.");this.undo=k;this.redo=f;this.insertLocalCursor=function(){runtime.assert(void 0===l.getOdtDocument().getCursor(d),"Inserting local cursor a second time.");
var a=new ops.OpAddCursor;a.init({memberid:d});l.enqueue([a]);I.focus()};this.removeLocalCursor=function(){runtime.assert(void 0!==l.getOdtDocument().getCursor(d),"Removing local cursor without inserting before.");var a=new ops.OpRemoveCursor;a.init({memberid:d});l.enqueue([a])};this.startEditing=function(){ka.subscribe(gui.InputMethodEditor.signalCompositionStart,da.removeCurrentSelection);ka.subscribe(gui.InputMethodEditor.signalCompositionEnd,L);I.subscribe("beforecut",p);I.subscribe("cut",r);
I.subscribe("beforepaste",n);I.subscribe("paste",e);P&&P.initialize();I.setEditing(!0);pa.setModifier(ra?E.Meta:E.Ctrl);A.bind(G.Backspace,E.None,Q(da.removeTextByBackspaceKey),!0);A.bind(G.Delete,E.None,da.removeTextByDeleteKey);A.bind(G.Tab,E.None,C(function(){da.insertText("\t");return!0}));ra?(A.bind(G.Clear,E.None,da.removeCurrentSelection),A.bind(G.B,E.Meta,C(Z.toggleBold)),A.bind(G.I,E.Meta,C(Z.toggleItalic)),A.bind(G.U,E.Meta,C(Z.toggleUnderline)),A.bind(G.L,E.MetaShift,C(Z.alignParagraphLeft)),
A.bind(G.E,E.MetaShift,C(Z.alignParagraphCenter)),A.bind(G.R,E.MetaShift,C(Z.alignParagraphRight)),A.bind(G.J,E.MetaShift,C(Z.alignParagraphJustified)),ha&&A.bind(G.C,E.MetaShift,ja.addAnnotation),A.bind(G.Z,E.Meta,k),A.bind(G.Z,E.MetaShift,f)):(A.bind(G.B,E.Ctrl,C(Z.toggleBold)),A.bind(G.I,E.Ctrl,C(Z.toggleItalic)),A.bind(G.U,E.Ctrl,C(Z.toggleUnderline)),A.bind(G.L,E.CtrlShift,C(Z.alignParagraphLeft)),A.bind(G.E,E.CtrlShift,C(Z.alignParagraphCenter)),A.bind(G.R,E.CtrlShift,C(Z.alignParagraphRight)),
A.bind(G.J,E.CtrlShift,C(Z.alignParagraphJustified)),ha&&A.bind(G.C,E.CtrlAlt,ja.addAnnotation),A.bind(G.Z,E.Ctrl,k),A.bind(G.Z,E.CtrlShift,f));X.setDefault(C(function(a){var c;c=null===a.which||void 0===a.which?String.fromCharCode(a.keyCode):0!==a.which&&0!==a.charCode?String.fromCharCode(a.which):null;return!c||a.altKey||a.ctrlKey||a.metaKey?!1:(da.insertText(c),!0)}));X.bind(G.Enter,E.None,C(da.enqueueParagraphSplittingOps))};this.endEditing=function(){ka.unsubscribe(gui.InputMethodEditor.signalCompositionStart,
da.removeCurrentSelection);ka.unsubscribe(gui.InputMethodEditor.signalCompositionEnd,L);I.unsubscribe("cut",r);I.unsubscribe("beforecut",p);I.unsubscribe("paste",e);I.unsubscribe("beforepaste",n);I.setEditing(!1);pa.setModifier(E.None);A.bind(G.Backspace,E.None,function(){return!0},!0);A.unbind(G.Delete,E.None);A.unbind(G.Tab,E.None);ra?(A.unbind(G.Clear,E.None),A.unbind(G.B,E.Meta),A.unbind(G.I,E.Meta),A.unbind(G.U,E.Meta),A.unbind(G.L,E.MetaShift),A.unbind(G.E,E.MetaShift),A.unbind(G.R,E.MetaShift),
A.unbind(G.J,E.MetaShift),ha&&A.unbind(G.C,E.MetaShift),A.unbind(G.Z,E.Meta),A.unbind(G.Z,E.MetaShift)):(A.unbind(G.B,E.Ctrl),A.unbind(G.I,E.Ctrl),A.unbind(G.U,E.Ctrl),A.unbind(G.L,E.CtrlShift),A.unbind(G.E,E.CtrlShift),A.unbind(G.R,E.CtrlShift),A.unbind(G.J,E.CtrlShift),ha&&A.unbind(G.C,E.CtrlAlt),A.unbind(G.Z,E.Ctrl),A.unbind(G.Z,E.CtrlShift));X.setDefault(null);X.unbind(G.Enter,E.None)};this.getInputMemberId=function(){return d};this.getSession=function(){return l};this.getSessionConstraints=function(){return T};
this.setUndoManager=function(a){P&&P.unsubscribe(gui.UndoManager.signalUndoStackChanged,c);if(P=a)P.setDocument(M),P.setPlaybackFunction(l.enqueue),P.subscribe(gui.UndoManager.signalUndoStackChanged,c)};this.getUndoManager=function(){return P};this.getMetadataController=function(){return va};this.getAnnotationController=function(){return ja};this.getDirectFormattingController=function(){return Z};this.getHyperlinkClickHandler=function(){return pa};this.getHyperlinkController=function(){return ta};
this.getImageController=function(){return qa};this.getSelectionController=function(){return R};this.getTextController=function(){return da};this.getEventManager=function(){return I};this.getKeyboardHandlers=function(){return{keydown:A,keypress:X}};this.destroy=function(a){var c=[ma.destroy,na.destroy,Z.destroy,ka.destroy,I.destroy,pa.destroy,ta.destroy,va.destroy,R.destroy,da.destroy,V];sa&&c.unshift(sa.destroy);runtime.clearTimeout(W);webodfcore.Async.destroyAll(c,a)};ma=webodfcore.Task.createRedrawTask(x);
na=webodfcore.Task.createRedrawTask(function(){var a=M.getCursor(d);if(a&&a.getSelectionType()===ops.OdtCursor.RegionSelection&&(a=N.getImageElements(a.getSelectedRange())[0])){la.select(a.parentNode);return}la.clearSelection()});A.bind(G.Left,E.None,C(R.moveCursorToLeft));A.bind(G.Right,E.None,C(R.moveCursorToRight));A.bind(G.Up,E.None,C(R.moveCursorUp));A.bind(G.Down,E.None,C(R.moveCursorDown));A.bind(G.Left,E.Shift,C(R.extendSelectionToLeft));A.bind(G.Right,E.Shift,C(R.extendSelectionToRight));
A.bind(G.Up,E.Shift,C(R.extendSelectionUp));A.bind(G.Down,E.Shift,C(R.extendSelectionDown));A.bind(G.Home,E.None,C(R.moveCursorToLineStart));A.bind(G.End,E.None,C(R.moveCursorToLineEnd));A.bind(G.Home,E.Ctrl,C(R.moveCursorToDocumentStart));A.bind(G.End,E.Ctrl,C(R.moveCursorToDocumentEnd));A.bind(G.Home,E.Shift,C(R.extendSelectionToLineStart));A.bind(G.End,E.Shift,C(R.extendSelectionToLineEnd));A.bind(G.Up,E.CtrlShift,C(R.extendSelectionToParagraphStart));A.bind(G.Down,E.CtrlShift,C(R.extendSelectionToParagraphEnd));
A.bind(G.Home,E.CtrlShift,C(R.extendSelectionToDocumentStart));A.bind(G.End,E.CtrlShift,C(R.extendSelectionToDocumentEnd));ra?(A.bind(G.Left,E.Alt,C(R.moveCursorBeforeWord)),A.bind(G.Right,E.Alt,C(R.moveCursorPastWord)),A.bind(G.Left,E.Meta,C(R.moveCursorToLineStart)),A.bind(G.Right,E.Meta,C(R.moveCursorToLineEnd)),A.bind(G.Home,E.Meta,C(R.moveCursorToDocumentStart)),A.bind(G.End,E.Meta,C(R.moveCursorToDocumentEnd)),A.bind(G.Left,E.AltShift,C(R.extendSelectionBeforeWord)),A.bind(G.Right,E.AltShift,
C(R.extendSelectionPastWord)),A.bind(G.Left,E.MetaShift,C(R.extendSelectionToLineStart)),A.bind(G.Right,E.MetaShift,C(R.extendSelectionToLineEnd)),A.bind(G.Up,E.AltShift,C(R.extendSelectionToParagraphStart)),A.bind(G.Down,E.AltShift,C(R.extendSelectionToParagraphEnd)),A.bind(G.Up,E.MetaShift,C(R.extendSelectionToDocumentStart)),A.bind(G.Down,E.MetaShift,C(R.extendSelectionToDocumentEnd)),A.bind(G.A,E.Meta,C(R.extendSelectionToEntireDocument))):(A.bind(G.Left,E.Ctrl,C(R.moveCursorBeforeWord)),A.bind(G.Right,
E.Ctrl,C(R.moveCursorPastWord)),A.bind(G.Left,E.CtrlShift,C(R.extendSelectionBeforeWord)),A.bind(G.Right,E.CtrlShift,C(R.extendSelectionPastWord)),A.bind(G.A,E.Ctrl,C(R.extendSelectionToEntireDocument)));ua&&(sa=new gui.IOSSafariSupport(I));I.subscribe("keydown",A.handleEvent);I.subscribe("keypress",X.handleEvent);I.subscribe("keyup",ca.handleEvent);I.subscribe("copy",q);I.subscribe("mousedown",w);I.subscribe("mousemove",ma.trigger);I.subscribe("mouseup",U);I.subscribe("contextmenu",K);I.subscribe("dragstart",
J);I.subscribe("dragend",H);I.subscribe("click",pa.handleClick);I.subscribe("longpress",t);I.subscribe("drag",v);I.subscribe("dragstop",u);M.subscribe(ops.OdtDocument.signalOperationEnd,na.trigger);M.subscribe(ops.Document.signalCursorAdded,ka.registerCursor);M.subscribe(ops.Document.signalCursorRemoved,ka.removeCursor);M.subscribe(ops.OdtDocument.signalOperationEnd,a)}})();
gui.CaretManager=function(h,l){function d(b){return m.hasOwnProperty(b)?m[b]:null}function b(){return Object.keys(m).map(function(b){return m[b]})}function g(b){var d=m[b];d&&(delete m[b],b===h.getInputMemberId()?(p.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,d.ensureVisible),p.unsubscribe(ops.Document.signalCursorMoved,d.refreshCursorBlinking),q.unsubscribe("compositionupdate",d.handleUpdate),q.unsubscribe("compositionend",d.handleUpdate),q.unsubscribe("focus",d.setFocus),q.unsubscribe("blur",
d.removeFocus),r.removeEventListener("focus",d.show,!1),r.removeEventListener("blur",d.hide,!1)):p.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,d.handleUpdate),d.destroy(function(){}))}var m={},r=runtime.getWindow(),p=h.getSession().getOdtDocument(),q=h.getEventManager();this.registerCursor=function(b,d,a){var c=b.getMemberId();b=new gui.Caret(b,l,d,a);m[c]=b;c===h.getInputMemberId()?(runtime.log("Starting to track input on new cursor of "+c),p.subscribe(ops.OdtDocument.signalProcessingBatchEnd,
b.ensureVisible),p.subscribe(ops.Document.signalCursorMoved,b.refreshCursorBlinking),q.subscribe("compositionupdate",b.handleUpdate),q.subscribe("compositionend",b.handleUpdate),q.subscribe("focus",b.setFocus),q.subscribe("blur",b.removeFocus),r.addEventListener("focus",b.show,!1),r.addEventListener("blur",b.hide,!1),b.setOverlayElement(q.getEventTrap())):p.subscribe(ops.OdtDocument.signalProcessingBatchEnd,b.handleUpdate);return b};this.getCaret=d;this.getCarets=b;this.destroy=function(d){var e=
b().map(function(a){return a.destroy});h.getSelectionController().setCaretXPositionLocator(null);p.unsubscribe(ops.Document.signalCursorRemoved,g);m={};webodfcore.Async.destroyAll(e,d)};h.getSelectionController().setCaretXPositionLocator(function(){var b=d(h.getInputMemberId()),g;b&&(g=b.getBoundingClientRect());return g?g.right:void 0});p.subscribe(ops.Document.signalCursorRemoved,g)};
gui.EditInfoHandle=function(h){var l=[],d,b=h.ownerDocument,g=b.documentElement.namespaceURI;this.setEdits=function(h){l=h;var m,p,q,e;webodfcore.DomUtils.removeAllChildNodes(d);for(h=0;h<l.length;h+=1)m=b.createElementNS(g,"div"),m.className="editInfo",p=b.createElementNS(g,"span"),p.className="editInfoColor",p.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",l[h].memberid),q=b.createElementNS(g,"span"),q.className="editInfoAuthor",q.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",
l[h].memberid),e=b.createElementNS(g,"span"),e.className="editInfoTime",e.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",l[h].memberid),e.appendChild(b.createTextNode(l[h].time.toString())),m.appendChild(p),m.appendChild(q),m.appendChild(e),d.appendChild(m)};this.show=function(){d.style.display="block"};this.hide=function(){d.style.display="none"};this.destroy=function(b){h.removeChild(d);b()};d=b.createElementNS(g,"div");d.setAttribute("class","editInfoHandle");d.style.display="none";
h.appendChild(d)};
ops.EditInfo=function(h,l){function d(){var b=[],d;for(d in g)g.hasOwnProperty(d)&&b.push({memberid:d,time:g[d].time});b.sort(function(b,d){return b.time-d.time});return b}var b,g={};this.getNode=function(){return b};this.getOdtDocument=function(){return l};this.getEdits=function(){return g};this.getSortedEdits=function(){return d()};this.addEdit=function(b,d){g[b]={time:d}};this.clearEdits=function(){g={}};this.destroy=function(d){h.parentNode&&h.removeChild(b);d()};b=l.getDOMDocument().createElementNS("urn:webodf:names:editinfo","editinfo");
h.insertBefore(b,h.firstChild)};
gui.EditInfoMarker=function(h,l){function d(b,a){return runtime.setTimeout(function(){r.style.opacity=b},a)}var b=this,g,m,r,p,q,e;this.addEdit=function(b,a){var c=Date.now()-a;h.addEdit(b,a);m.setEdits(h.getSortedEdits());r.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",b);runtime.clearTimeout(q);runtime.clearTimeout(e);1E4>c?(p=d(1,0),q=d(.5,1E4-c),e=d(.2,2E4-c)):1E4<=c&&2E4>c?(p=d(.5,0),e=d(.2,2E4-c)):p=d(.2,0)};this.getEdits=function(){return h.getEdits()};this.clearEdits=function(){h.clearEdits();
m.setEdits([]);r.hasAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")&&r.removeAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")};this.getEditInfo=function(){return h};this.show=function(){r.style.display="block"};this.hide=function(){b.hideHandle();r.style.display="none"};this.showHandle=function(){m.show()};this.hideHandle=function(){m.hide()};this.destroy=function(b){runtime.clearTimeout(p);runtime.clearTimeout(q);runtime.clearTimeout(e);g.removeChild(r);m.destroy(function(a){a?
b(a):h.destroy(b)})};(function(){var d=h.getOdtDocument().getDOMDocument();r=d.createElementNS(d.documentElement.namespaceURI,"div");r.setAttribute("class","editInfoMarker");r.onmouseover=function(){b.showHandle()};r.onmouseout=function(){b.hideHandle()};g=h.getNode();g.appendChild(r);m=new gui.EditInfoHandle(g);l||b.hide()})()};
gui.HyperlinkTooltipView=function(h,l){var d=webodfcore.DomUtils,b=odf.OdfUtils,g=runtime.getWindow(),m,r,p;runtime.assert(null!==g,"Expected to be run in an environment which has a global window, like a browser.");this.showTooltip=function(q){var e=q.target||q.srcElement,n=h.getSizer(),a=h.getZoomLevel(),c;a:{for(;e;){if(b.isHyperlink(e))break a;if(b.isParagraph(e)||b.isInlineRoot(e))break;e=e.parentNode}e=null}if(e){d.containsNode(n,p)||n.appendChild(p);c=r;var k;switch(l()){case gui.KeyboardHandler.Modifier.Ctrl:k=
runtime.tr("Ctrl-click to follow link");break;case gui.KeyboardHandler.Modifier.Meta:k=runtime.tr("\u2318-click to follow link");break;default:k=""}c.textContent=k;m.textContent=b.getHyperlinkTarget(e);p.style.display="block";c=g.innerWidth-p.offsetWidth-15;e=q.clientX>c?c:q.clientX+15;c=g.innerHeight-p.offsetHeight-10;q=q.clientY>c?c:q.clientY+10;n=n.getBoundingClientRect();e=(e-n.left)/a;q=(q-n.top)/a;p.style.left=e+"px";p.style.top=q+"px"}};this.hideTooltip=function(){p.style.display="none"};this.destroy=
function(b){p.parentNode&&p.parentNode.removeChild(p);b()};(function(){var b=h.getElement().ownerDocument;m=b.createElement("span");r=b.createElement("span");m.className="webodf-hyperlinkTooltipLink";r.className="webodf-hyperlinkTooltipText";p=b.createElement("div");p.className="webodf-hyperlinkTooltip";p.appendChild(m);p.appendChild(r);h.getElement().appendChild(p)})()};
gui.OdfFieldView=function(h){function l(){var b=odf.OdfSchema.getFields().map(function(b){return b.replace(":","|")}),d=b.join(",\n")+"\n{ background-color: #D0D0D0; }\n",b=b.map(function(b){return b+":empty::after"}).join(",\n")+"\n{ content:' '; white-space: pre; }\n";return d+"\n"+b}var d,b=h.getElement().ownerDocument;this.showFieldHighlight=function(){d.appendChild(b.createTextNode(l()))};this.hideFieldHighlight=function(){for(var b=d.sheet,h=b.cssRules;h.length;)b.deleteRule(h.length-1)};this.destroy=
function(b){d.parentNode&&d.parentNode.removeChild(d);b()};d=function(){var d=b.getElementsByTagName("head").item(0),h=b.createElement("style"),l="";h.type="text/css";h.media="screen, print, handheld, projection";odf.Namespaces.forEachPrefix(function(b,d){l+="@namespace "+b+" url("+d+");\n"});h.appendChild(b.createTextNode(l));d.appendChild(h);return h}()};
gui.ShadowCursor=function(h){var l=h.getDOMDocument().createRange(),d=!0;this.removeFromDocument=function(){};this.getMemberId=function(){return gui.ShadowCursor.ShadowCursorMemberId};this.getSelectedRange=function(){return l};this.setSelectedRange=function(b,g){l=b;d=!1!==g};this.hasForwardSelection=function(){return d};this.getDocument=function(){return h};this.getSelectionType=function(){return ops.OdtCursor.RangeSelection};l.setStart(h.getRootNode(),0)};gui.ShadowCursor.ShadowCursorMemberId="";
gui.SelectionView=function(h){};gui.SelectionView.prototype.rerender=function(){};gui.SelectionView.prototype.show=function(){};gui.SelectionView.prototype.hide=function(){};gui.SelectionView.prototype.destroy=function(h){};
gui.SelectionViewManager=function(h){function l(){return Object.keys(d).map(function(b){return d[b]})}var d={};this.getSelectionView=function(b){return d.hasOwnProperty(b)?d[b]:null};this.getSelectionViews=l;this.removeSelectionView=function(b){d.hasOwnProperty(b)&&(d[b].destroy(function(){}),delete d[b])};this.hideSelectionView=function(b){d.hasOwnProperty(b)&&d[b].hide()};this.showSelectionView=function(b){d.hasOwnProperty(b)&&d[b].show()};this.rerenderSelectionViews=function(){Object.keys(d).forEach(function(b){d[b].rerender()})};
this.registerCursor=function(b,g){var l=b.getMemberId(),r=new h(b);g?r.show():r.hide();return d[l]=r};this.destroy=function(b){function d(g,l){l?b(l):g<h.length?h[g].destroy(function(b){d(g+1,b)}):b()}var h=l();d(0,void 0)}};gui.SessionViewOptions=function(){this.caretBlinksOnRangeSelect=this.caretAvatarsInitiallyVisible=this.editInfoMarkersInitiallyVisible=!0};
(function(){function h(h,d){return void 0!==h?!!h:d}gui.SessionView=function(l,d,b,g,m,r){function p(a){a.memberId===d&&J.getViewport().scrollIntoView(a.annotation.getBoundingClientRect())}function q(){var a=document.getElementsByTagName("head").item(0),c=document.createElement("style");c.type="text/css";c.media="screen, print, handheld, projection";a.appendChild(c);return c}function e(a,c,b){function f(c,b,d){b=c+'[editinfo|memberid="'+a+'"]'+d+b;a:{var f=z.firstChild;for(c=c+'[editinfo|memberid="'+
a+'"]'+d+"{";f;){if(f.nodeType===Node.TEXT_NODE&&0===f.data.indexOf(c)){c=f;break a}f=f.nextSibling}c=null}c?c.data=b:z.appendChild(document.createTextNode(b))}f("div.editInfoMarker","{ background-color: "+b+"; }","");f("span.editInfoColor","{ background-color: "+b+"; }","");f("span.editInfoAuthor",'{ content: "'+c+'"; }',":before");f("dc|creator","{ background-color: "+b+"; }","");f(".webodf-selectionOverlay","{ fill: "+b+"; stroke: "+b+";}","");a===d&&(f(".webodf-touchEnabled .webodf-selectionOverlay",
"{ display: block; }"," > .webodf-draggable"),a=gui.ShadowCursor.ShadowCursorMemberId,f(".webodf-selectionOverlay","{ fill: "+b+"; stroke: "+b+";}",""),f(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable"))}function n(a){var c,b;for(b in t)t.hasOwnProperty(b)&&(c=t[b],a?c.show():c.hide())}function a(a){m.getCarets().forEach(function(c){a?c.showHandle():c.hideHandle()})}function c(a){var c=a.getMemberId();a=a.getProperties();e(c,a.fullName,a.color)}function k(a){var c=
a.getMemberId(),d=b.getOdtDocument().getMember(c).getProperties();m.registerCursor(a,U,L);r.registerCursor(a,!0);if(a=m.getCaret(c))a.setAvatarImageUrl(d.imageUrl),a.setColor(d.color);runtime.log("+++ View here +++ eagerly created an Caret for '"+c+"'! +++")}function f(a){a=a.getMemberId();var c=r.getSelectionView(d),b=r.getSelectionView(gui.ShadowCursor.ShadowCursorMemberId),f=m.getCaret(d);a===d?(b.hide(),c&&c.show(),f&&f.show()):a===gui.ShadowCursor.ShadowCursorMemberId&&(b.show(),c&&c.hide(),
f&&f.hide())}function v(a){r.removeSelectionView(a)}function u(a){var c=a.paragraphElement,d=a.memberId;a=a.timeStamp;var f,e,k=c.getElementsByTagNameNS("urn:webodf:names:editinfo","editinfo").item(0);k?(e=k.getAttributeNS("urn:webodf:names:editinfo","id"),f=t[e]):(e=Math.random().toString(),f=new ops.EditInfo(c,b.getOdtDocument()),f=new gui.EditInfoMarker(f,K),k=c.getElementsByTagNameNS("urn:webodf:names:editinfo","editinfo").item(0),k.setAttributeNS("urn:webodf:names:editinfo","id",e),t[e]=f);f.addEdit(d,
new Date(a));H.trigger()}function x(){var a;y.hasChildNodes()&&webodfcore.DomUtils.removeAllChildNodes(y);!0===g.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)&&(a=b.getOdtDocument().getMember(d))&&(a=a.getProperties().fullName,y.appendChild(document.createTextNode(".annotationWrapper:not([creator = '"+a+"']) .annotationRemoveButton { display: none; }")))}function w(a){var b=Object.keys(t).map(function(a){return t[a]});B.unsubscribe(ops.Document.signalMemberAdded,c);B.unsubscribe(ops.Document.signalMemberUpdated,
c);B.unsubscribe(ops.Document.signalCursorAdded,k);B.unsubscribe(ops.Document.signalCursorRemoved,v);B.unsubscribe(ops.OdtDocument.signalParagraphChanged,u);B.unsubscribe(ops.Document.signalCursorMoved,f);B.unsubscribe(ops.OdtDocument.signalParagraphChanged,r.rerenderSelectionViews);B.unsubscribe(ops.OdtDocument.signalTableAdded,r.rerenderSelectionViews);B.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,r.rerenderSelectionViews);g.unsubscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,
x);B.unsubscribe(ops.Document.signalMemberAdded,x);B.unsubscribe(ops.Document.signalMemberUpdated,x);z.parentNode.removeChild(z);y.parentNode.removeChild(y);(function O(c,d){d?a(d):c<b.length?b[c].destroy(function(a){O(c+1,a)}):a()})(0,void 0)}var z,y,t={},B,J,H,K=h(l.editInfoMarkersInitiallyVisible,!0),U=h(l.caretAvatarsInitiallyVisible,!0),L=h(l.caretBlinksOnRangeSelect,!0);this.showEditInfoMarkers=function(){K||(K=!0,n(K))};this.hideEditInfoMarkers=function(){K&&(K=!1,n(K))};this.showCaretAvatars=
function(){U||(U=!0,a(U))};this.hideCaretAvatars=function(){U&&(U=!1,a(U))};this.getSession=function(){return b};this.getCaret=function(a){return m.getCaret(a)};this.destroy=function(a){var c=[H.destroy,w];B.unsubscribe(ops.OdtDocument.signalAnnotationAdded,p);webodfcore.Async.destroyAll(c,a)};B=b.getOdtDocument();J=B.getOdfCanvas();B.subscribe(ops.OdtDocument.signalAnnotationAdded,p);B.subscribe(ops.Document.signalMemberAdded,c);B.subscribe(ops.Document.signalMemberUpdated,c);B.subscribe(ops.Document.signalCursorAdded,
k);B.subscribe(ops.Document.signalCursorRemoved,v);B.subscribe(ops.OdtDocument.signalParagraphChanged,u);B.subscribe(ops.Document.signalCursorMoved,f);B.subscribe(ops.OdtDocument.signalParagraphChanged,r.rerenderSelectionViews);B.subscribe(ops.OdtDocument.signalTableAdded,r.rerenderSelectionViews);B.subscribe(ops.OdtDocument.signalParagraphStyleModified,r.rerenderSelectionViews);g.subscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,x);B.subscribe(ops.Document.signalMemberAdded,x);B.subscribe(ops.Document.signalMemberUpdated,
x);z=q();z.appendChild(document.createTextNode("@namespace editinfo url(urn:webodf:names:editinfo);"));z.appendChild(document.createTextNode("@namespace dc url(http://purl.org/dc/elements/1.1/);"));y=q();x();H=webodfcore.Task.createRedrawTask(function(){var a=J.getAnnotationViewManager();a&&(a.rehighlightAnnotations(),B.fixCursorPositions())})}})();
gui.SvgSelectionView=function(h){function l(){var a=c.getRootNode();k!==a&&(k=a,f=c.getCanvas().getSizer(),f.appendChild(u),u.setAttribute("class","webodf-selectionOverlay"),w.setAttribute("class","webodf-draggable"),z.setAttribute("class","webodf-draggable"),w.setAttribute("end","left"),z.setAttribute("end","right"),w.setAttribute("r",8),z.setAttribute("r",8),u.appendChild(x),u.appendChild(w),u.appendChild(z))}function d(a){a=a.getBoundingClientRect();return!(!a||0===a.height)}function b(a){var c=
y.getTextElements(a,!0,!1),b=a.cloneRange(),f=a.cloneRange();a=a.cloneRange();if(!c.length)return null;var e;a:{e=0;var k=c[e],g=b.startContainer===k?b.startOffset:0,h=g;b.setStart(k,g);for(b.setEnd(k,h);!d(b);){if(k.nodeType===Node.ELEMENT_NODE&&h<k.childNodes.length)h=k.childNodes.length;else if(k.nodeType===Node.TEXT_NODE&&h<k.length)h+=1;else if(c[e])k=c[e],e+=1,g=h=0;else{e=!1;break a}b.setStart(k,g);b.setEnd(k,h)}e=!0}if(!e)return null;a:{e=c.length-1;k=c[e];h=g=f.endContainer===k?f.endOffset:
k.nodeType===Node.TEXT_NODE?k.length:k.childNodes.length;f.setStart(k,g);for(f.setEnd(k,h);!d(f);){if(k.nodeType===Node.ELEMENT_NODE&&0<g)g=0;else if(k.nodeType===Node.TEXT_NODE&&0<g)--g;else if(c[e])k=c[e],--e,g=h=k.length||k.childNodes.length;else{c=!1;break a}f.setStart(k,g);f.setEnd(k,h)}c=!0}if(!c)return null;a.setStart(b.startContainer,b.startOffset);a.setEnd(f.endContainer,f.endOffset);return{firstRange:b,lastRange:f,fillerRange:a}}function g(a,c){var b={};b.top=Math.min(a.top,c.top);b.left=
Math.min(a.left,c.left);b.right=Math.max(a.right,c.right);b.bottom=Math.max(a.bottom,c.bottom);b.width=b.right-b.left;b.height=b.bottom-b.top;return b}function m(a,c){c&&0<c.width&&0<c.height&&(a=a?g(a,c):c);return a}function r(a){function b(a){H.setUnfilteredPosition(a,0);return x.acceptNode(a)===K&&u.acceptPosition(H)===K?K:U}function d(a){var c=null;b(a)===K&&(c=t.getBoundingClientRect(a));return c}var f=a.commonAncestorContainer,e=a.startContainer,k=a.endContainer,g=a.startOffset,h=a.endOffset,
l,n,p=null,r,q=v.createRange(),u,x=new odf.OdfNodeFilter,w;if(e===f||k===f)return q=a.cloneRange(),p=q.getBoundingClientRect(),q.detach(),p;for(a=e;a.parentNode!==f;)a=a.parentNode;for(n=k;n.parentNode!==f;)n=n.parentNode;u=c.createRootFilter(e);for(f=a.nextSibling;f&&f!==n;)r=d(f),p=m(p,r),f=f.nextSibling;if(y.isParagraph(a))p=m(p,t.getBoundingClientRect(a));else if(a.nodeType===Node.TEXT_NODE)f=a,q.setStart(f,g),q.setEnd(f,f===n?h:f.length),r=q.getBoundingClientRect(),p=m(p,r);else for(w=v.createTreeWalker(a,
NodeFilter.SHOW_TEXT,b,!1),f=w.currentNode=e;f&&f!==k;)q.setStart(f,g),q.setEnd(f,f.length),r=q.getBoundingClientRect(),p=m(p,r),l=f,g=0,f=w.nextNode();l||(l=e);if(y.isParagraph(n))p=m(p,t.getBoundingClientRect(n));else if(n.nodeType===Node.TEXT_NODE)f=n,q.setStart(f,f===a?g:0),q.setEnd(f,h),r=q.getBoundingClientRect(),p=m(p,r);else for(w=v.createTreeWalker(n,NodeFilter.SHOW_TEXT,b,!1),f=w.currentNode=k;f&&f!==l;)if(q.setStart(f,0),q.setEnd(f,h),r=q.getBoundingClientRect(),p=m(p,r),f=w.previousNode())h=
f.length;return p}function p(a,c){var b=a.getBoundingClientRect(),d={width:0};d.top=b.top;d.bottom=b.bottom;d.height=b.height;d.left=d.right=c?b.right:b.left;return d}function q(){var a=h.getSelectedRange(),c;if(c=J&&h.getSelectionType()===ops.OdtCursor.RangeSelection&&!a.collapsed){l();var d=t.getBoundingClientRect(f),e=B.getZoomLevel(),a=b(a),k,m,n,q,v,y;if(a){c=a.firstRange;k=a.lastRange;m=a.fillerRange;n=t.translateRect(p(c,!1),d,e);v=t.translateRect(p(k,!0),d,e);q=(q=r(m))?t.translateRect(q,
d,e):g(n,v);y=q.left;q=n.left+Math.max(0,q.width-(n.left-q.left));d=Math.min(n.top,v.top);e=v.top+v.height;y=[{x:n.left,y:d+n.height},{x:n.left,y:d},{x:q,y:d},{x:q,y:e-v.height},{x:v.right,y:e-v.height},{x:v.right,y:e},{x:y,y:e},{x:y,y:d+n.height},{x:n.left,y:d+n.height}];q="";var H;for(H=0;H<y.length;H+=1)q+=y[H].x+","+y[H].y+" ";x.setAttribute("points",q);w.setAttribute("cx",n.left);w.setAttribute("cy",d+n.height/2);z.setAttribute("cx",v.right);z.setAttribute("cy",e-v.height/2);c.detach();k.detach();
m.detach()}c=!!a}u.style.display=c?"block":"none"}function e(a){J&&a===h&&L.trigger()}function n(a){a=8/a;w.setAttribute("r",a);z.setAttribute("r",a)}function a(a){f.removeChild(u);f.classList.remove("webodf-virtualSelections");h.getDocument().unsubscribe(ops.Document.signalCursorMoved,e);B.unsubscribe(gui.ZoomHelper.signalZoomChanged,n);a()}var c=h.getDocument(),k,f,v=c.getDOMDocument(),u=v.createElementNS("http://www.w3.org/2000/svg","svg"),x=v.createElementNS("http://www.w3.org/2000/svg","polygon"),
w=v.createElementNS("http://www.w3.org/2000/svg","circle"),z=v.createElementNS("http://www.w3.org/2000/svg","circle"),y=odf.OdfUtils,t=webodfcore.DomUtils,B=c.getCanvas().getZoomHelper(),J=!0,H=h.getDocument().createPositionIterator(c.getRootNode()),K=NodeFilter.FILTER_ACCEPT,U=NodeFilter.FILTER_REJECT,L;this.rerender=function(){J&&L.trigger()};this.show=function(){J=!0;L.trigger()};this.hide=function(){J=!1;L.trigger()};this.destroy=function(c){webodfcore.Async.destroyAll([L.destroy,a],c)};(function(){var a=
h.getMemberId();L=webodfcore.Task.createRedrawTask(q);l();u.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",a);f.classList.add("webodf-virtualSelections");h.getDocument().subscribe(ops.Document.signalCursorMoved,e);B.subscribe(gui.ZoomHelper.signalZoomChanged,n);n(B.getZoomLevel())})()};
gui.UndoStateRules=function(){function h(b,d){var g=b.length;this.previous=function(){for(--g;0<=g;--g)if(d(b[g]))return b[g];return null}}function l(b){b=b.spec();var d;b.hasOwnProperty("position")&&(d=b.position);return d}function d(b){return b.isEdit}function b(b,d,h){if(!h)return h=l(b)-l(d),0===h||1===Math.abs(h);b=l(b);d=l(d);h=l(h);return b-d===d-h}this.isEditOperation=d;this.isPartOfOperationSet=function(g,l){var m=void 0!==g.group,p;if(!g.isEdit||0===l.length)return!0;p=l[l.length-1];if(m&&
g.group===p.group)return!0;a:switch(g.spec().optype){case "RemoveText":case "InsertText":p=!0;break a;default:p=!1}if(p&&l.some(d)){if(m){var q;m=g.spec().optype;p=new h(l,d);var e=p.previous(),n=null,a,c;runtime.assert(!!e,"No edit operations found in state");c=e.group;runtime.assert(void 0!==c,"Operation has no group");for(a=1;e&&e.group===c;){if(m===e.spec().optype){q=e;break}e=p.previous()}if(q){for(e=p.previous();e;){if(e.group!==c){if(2===a)break;c=e.group;a+=1}if(m===e.spec().optype){n=e;break}e=
p.previous()}q=b(g,q,n)}else q=!1;return q}q=g.spec().optype;m=new h(l,d);p=m.previous();runtime.assert(!!p,"No edit operations found in state");q=q===p.spec().optype?b(g,p,m.previous()):!1;return q}return!1}};
(function(){function h(b,d){this.mainId=void 0!==b?b:-1;this.subId=void 0!==d?d:-1}function l(b,g,l){function m(d,a){return d+(b.isEditOperation(a)?1:0)}var p,q,e;this.addOperation=function(d){b.isEditOperation(d)&&(e+=1);q.push(d)};this.isNextStateId=function(b){return b.mainId===p&&b.subId===e};this.getNextStateId=function(){return new h(p,e)};this.getOperations=function(){return q};p=d+=1;q=g||[];e=g&&l?g.reduce(m,0):0}var d=0;gui.TrivialUndoManager=function(b){function d(){return!0!==y.isNextStateId(z)}
function m(a){a=a.getOperations();0<a.length&&(K=!0,x(a),K=!1)}function r(){J.emit(gui.UndoManager.signalUndoStackChanged,{undoAvailable:k.hasUndoStates(),redoAvailable:k.hasRedoStates()})}function p(a){var c=d();a!==c&&J.emit(gui.UndoManager.signalDocumentModifiedChanged,c)}function q(){y!==u&&y!==t[t.length-1]&&t.push(y)}function e(a){var c=a.previousSibling||a.nextSibling;a.parentNode.removeChild(a);f.normalizeTextNodes(c)}function n(a){return Object.keys(a).map(function(c){return a[c]})}function a(a){function c(a){var c=
a.spec();if(f[c.memberid])switch(c.optype){case "AddCursor":b[c.memberid]||(b[c.memberid]=a,delete f[c.memberid],--e);break;case "MoveCursor":d[c.memberid]||(d[c.memberid]=a)}}var b={},d={},f={},e,k;k=a.pop();w.getMemberIds().forEach(function(a){f[a]=!0});for(e=Object.keys(f).length;k&&0<e;)k=k.getOperations(),k.reverse(),k.forEach(c),k=a.pop();return new l(H,n(b).concat(n(d)))}function c(){var c=d(),b=v=w.cloneDocumentElement();f.getElementsByTagNameNS(b,"urn:webodf:names:cursor","cursor").forEach(e);
f.getElementsByTagNameNS(b,"urn:webodf:names:cursor","anchor").forEach(e);q();y=u=a([u].concat(t));t.length=0;B.length=0;c||(z=y.getNextStateId());r();p(c)}var k=this,f=webodfcore.DomUtils,v,u,x,w,z,y,t=[],B=[],J=new webodfcore.EventNotifier([gui.UndoManager.signalUndoStackChanged,gui.UndoManager.signalUndoStateCreated,gui.UndoManager.signalUndoStateModified,gui.UndoManager.signalDocumentModifiedChanged,gui.TrivialUndoManager.signalDocumentRootReplaced]),H=b||new gui.UndoStateRules,K=!1;this.subscribe=
function(a,c){J.subscribe(a,c)};this.unsubscribe=function(a,c){J.unsubscribe(a,c)};this.isDocumentModified=d;this.setDocumentModified=function(a){d()!==a&&(z=a?new h:y.getNextStateId(),J.emit(gui.UndoManager.signalDocumentModifiedChanged,a))};this.hasUndoStates=function(){return 0<t.length};this.hasRedoStates=function(){return 0<B.length};this.setDocument=function(a){w=a};this.purgeInitialState=function(){var a=d();t.length=0;B.length=0;y=u=new l(H);z=y.getNextStateId();v=null;r();p(a)};this.setInitialState=
c;this.initialize=function(){v||c()};this.setPlaybackFunction=function(a){x=a};this.onOperationExecuted=function(a){if(!K){var c=d();H.isEditOperation(a)&&(y===u||0<B.length)||!H.isPartOfOperationSet(a,y.getOperations())?(B.length=0,q(),y=new l(H,[a],!0),t.push(y),J.emit(gui.UndoManager.signalUndoStateCreated,{operations:y.getOperations()}),r()):(y.addOperation(a),J.emit(gui.UndoManager.signalUndoStateModified,{operations:y.getOperations()}));p(c)}};this.moveForward=function(a){for(var c=0,b=d(),
f;a&&B.length;)f=B.pop(),t.push(f),m(f),--a,c+=1;c&&(y=t[t.length-1],r(),p(b));return c};this.moveBackward=function(a){for(var c=0,b=d();a&&t.length;)B.push(t.pop()),--a,c+=1;c&&(w.getMemberIds().forEach(function(a){w.hasCursor(a)&&w.removeCursor(a)}),w.setDocumentElement(v.cloneNode(!0)),J.emit(gui.TrivialUndoManager.signalDocumentRootReplaced,{}),m(u),t.forEach(m),y=t[t.length-1]||u,r(),p(b));return c};y=u=new l(H);z=y.getNextStateId()};gui.TrivialUndoManager.signalDocumentRootReplaced="documentRootReplaced"})();
odf.GraphicProperties=function(h,l,d){var b=this,g=odf.Namespaces.stylens,m=odf.Namespaces.svgns;this.verticalPos=function(){return b.data.value("verticalPos")};this.verticalRel=function(){return b.data.value("verticalRel")};this.horizontalPos=function(){return b.data.value("horizontalPos")};this.horizontalRel=function(){return b.data.value("horizontalRel")};this.strokeWidth=function(){return b.data.value("strokeWidth")};b.data=new odf.LazyStyleProperties(void 0===d?void 0:d.data,{verticalPos:function(){var b=
h.getAttributeNS(g,"vertical-pos");return""===b?void 0:b},verticalRel:function(){var b=h.getAttributeNS(g,"vertical-rel");return""===b?void 0:b},horizontalPos:function(){var b=h.getAttributeNS(g,"horizontal-pos");return""===b?void 0:b},horizontalRel:function(){var b=h.getAttributeNS(g,"horizontal-rel");return""===b?void 0:b},strokeWidth:function(){var b=h.getAttributeNS(m,"stroke-width");return l.parseLength(b)}})};
odf.ComputedGraphicProperties=function(){var h;this.setGraphicProperties=function(l){h=l};this.verticalPos=function(){return h&&h.verticalPos()||"from-top"};this.verticalRel=function(){return h&&h.verticalRel()||"page"};this.horizontalPos=function(){return h&&h.horizontalPos()||"from-left"};this.horizontalRel=function(){return h&&h.horizontalRel()||"page"}};
odf.PageLayoutProperties=function(h,l,d){var b=this,g=odf.Namespaces.fons;this.pageHeight=function(){return b.data.value("pageHeight")||1123};this.pageWidth=function(){return b.data.value("pageWidth")||794};b.data=new odf.LazyStyleProperties(void 0===d?void 0:d.data,{pageHeight:function(){var b;h&&(b=h.getAttributeNS(g,"page-height"),b=l.parseLength(b));return b},pageWidth:function(){var b;h&&(b=h.getAttributeNS(g,"page-width"),b=l.parseLength(b));return b}})};
odf.PageLayout=function(h,l,d){var b=null;h&&(b=l.getPropertiesElement("page-layout-properties",h));this.pageLayout=new odf.PageLayoutProperties(b,l,d&&d.pageLayout)};odf.PageLayoutCache=function(){};odf.PageLayoutCache.prototype.getPageLayout=function(h){};odf.PageLayoutCache.prototype.getDefaultPageLayout=function(){};
odf.ParagraphProperties=function(h,l,d){var b=this,g=odf.Namespaces.fons;this.marginTop=function(){return b.data.value("marginTop")};b.data=new odf.LazyStyleProperties(void 0===d?void 0:d.data,{marginTop:function(){var b=h.getAttributeNS(g,"margin-top");return l.parsePositiveLengthOrPercent(b,"marginTop",d&&d.data)}})};
odf.ComputedParagraphProperties=function(){var h={},l=[];this.setStyleChain=function(d){l=d;h={}};this.marginTop=function(){var d,b;if(h.hasOwnProperty("marginTop"))d=h.marginTop;else{for(b=0;void 0===d&&b<l.length;b+=1)d=l[b].marginTop();h.marginTop=d}return d||0}};
odf.TextProperties=function(h,l,d){var b=this,g=odf.Namespaces.fons;this.fontSize=function(){return b.data.value("fontSize")};b.data=new odf.LazyStyleProperties(void 0===d?void 0:d.data,{fontSize:function(){var b=h.getAttributeNS(g,"font-size");return l.parsePositiveLengthOrPercent(b,"fontSize",d&&d.data)}})};
odf.ComputedTextProperties=function(){var h={},l=[];this.setStyleChain=function(d){l=d;h={}};this.fontSize=function(){var d,b;if(h.hasOwnProperty("fontSize"))d=h.fontSize;else{for(b=0;void 0===d&&b<l.length;b+=1)d=l[b].fontSize();h.fontSize=d}return d||12}};odf.MasterPage=function(h,l){var d;h?(d=h.getAttributeNS(odf.Namespaces.stylens,"page-layout-name"),this.pageLayout=l.getPageLayout(d)):this.pageLayout=l.getDefaultPageLayout()};odf.MasterPageCache=function(){};
odf.MasterPageCache.prototype.getMasterPage=function(h){};
odf.StylePileEntry=function(h,l,d,b){this.masterPage=function(){var b=h.getAttributeNS(odf.Namespaces.stylens,"master-page-name"),l=null;b&&(l=d.getMasterPage(b));return l};(function(d){var g=h.getAttributeNS(odf.Namespaces.stylens,"family"),r=null;if("graphic"===g||"chart"===g)d.graphic=void 0===b?void 0:b.graphic,r=l.getPropertiesElement("graphic-properties",h,r),null!==r&&(d.graphic=new odf.GraphicProperties(r,l,d.graphic));if("paragraph"===g||"table-cell"===g||"graphic"===g||"presentation"===
g||"chart"===g)d.paragraph=void 0===b?void 0:b.paragraph,r=l.getPropertiesElement("paragraph-properties",h,r),null!==r&&(d.paragraph=new odf.ParagraphProperties(r,l,d.paragraph));if("text"===g||"paragraph"===g||"table-cell"===g||"graphic"===g||"presentation"===g||"chart"===g)d.text=void 0===b?void 0:b.text,r=l.getPropertiesElement("text-properties",h,r),null!==r&&(d.text=new odf.TextProperties(r,l,d.text))})(this)};
odf.StylePile=function(h,l){function d(d,a){var c,k;d.hasAttributeNS(b,"parent-style-name")&&(k=d.getAttributeNS(b,"parent-style-name"),-1===a.indexOf(k)&&(c=e(k,a)));return new odf.StylePileEntry(d,h,l,c)}var b=odf.Namespaces.stylens,g={},m={},r,p={},q={},e;e=function(b,a){var c=p[b],e;!c&&(e=g[b])&&(a.push(b),c=d(e,a),p[b]=c);return c};this.getStyle=function(b){var a=q[b]||p[b],c,e=[];a||(c=m[b],c||(c=g[b])&&e.push(b),c&&(a=d(c,e)));return a};this.addCommonStyle=function(d){var a;d.hasAttributeNS(b,
"name")&&(a=d.getAttributeNS(b,"name"),g.hasOwnProperty(a)||(g[a]=d))};this.addAutomaticStyle=function(d){var a;d.hasAttributeNS(b,"name")&&(a=d.getAttributeNS(b,"name"),m.hasOwnProperty(a)||(m[a]=d))};this.setDefaultStyle=function(b){void 0===r&&(r=d(b,[]))};this.getDefaultStyle=function(){return r}};odf.ComputedGraphicStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties;this.graphic=new odf.ComputedGraphicProperties};
odf.ComputedParagraphStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties};odf.ComputedTextStyle=function(){this.text=new odf.ComputedTextProperties};
odf.StyleCache=function(h){function l(a,c,b,d){c=b.getAttributeNS(c,"class-names");var f;if(c)for(c=c.split(" "),f=0;f<c.length;f+=1)if(b=c[f])d.push(a),d.push(b)}function d(a,c){var b=u.getStyleName("paragraph",a);void 0!==b&&(c.push("paragraph"),c.push(b));a.namespaceURI!==f||"h"!==a.localName&&"p"!==a.localName||l("paragraph",f,a,c);return c}function b(a,c,b){var d=[],f,e,k,g;for(f=0;f<a.length;f+=2)k=a[f],g=a[f+1],k=p[k],g=k.getStyle(g),void 0!==g&&(g=g[c],void 0!==g&&g!==e&&(d.push(g),e=g));
k=p[b];if(g=k.getDefaultStyle())g=g[c],void 0!==g&&g!==e&&d.push(g);return d}function g(a,c){var b=u.getStyleName("text",a),e=a.parentNode;void 0!==b&&(c.push("text"),c.push(b));"span"===a.localName&&a.namespaceURI===f&&l("text",f,a,c);if(!e||e===h)return c;e.namespaceURI!==f||"p"!==e.localName&&"h"!==e.localName?g(e,c):d(e,c);return c}function m(a){a=a.getAttributeNS(v,"family");return p[a]}var r=this,p,q,e,n,a,c,k,f=odf.Namespaces.textns,v=odf.Namespaces.stylens,u=new odf.StyleInfo,x=new odf.StyleParseUtils,
w,z,y,t,B,J;this.getComputedGraphicStyle=function(a){var c=[];a=u.getStyleName("graphic",a);void 0!==a&&(c.push("graphic"),c.push(a));a=c.join("/");var d=n[a];runtime.assert(0===c.length%2,"Invalid style chain.");void 0===d&&(d=new odf.ComputedGraphicStyle,d.graphic.setGraphicProperties(b(c,"graphic","graphic")[0]),d.text.setStyleChain(b(c,"text","graphic")),d.paragraph.setStyleChain(b(c,"paragraph","graphic")),n[a]=d);return d};this.getComputedParagraphStyle=function(a){a=d(a,[]);var c=a.join("/"),
f=e[c];runtime.assert(0===a.length%2,"Invalid style chain.");void 0===f&&(f=new odf.ComputedParagraphStyle,f.text.setStyleChain(b(a,"text","paragraph")),f.paragraph.setStyleChain(b(a,"paragraph","paragraph")),e[c]=f);return f};this.getComputedTextStyle=function(a){a=g(a,[]);var c=a.join("/"),d=q[c];runtime.assert(0===a.length%2,"Invalid style chain.");void 0===d&&(d=new odf.ComputedTextStyle,d.text.setStyleChain(b(a,"text","text")),q[c]=d);return d};this.getPageLayout=function(a){var c=J[a];c||((c=
B[a])?(c=new odf.PageLayout(c,x,t),J[a]=c):c=t);return c};this.getDefaultPageLayout=function(){return t};this.getMasterPage=function(a){var c=z[a];void 0===c&&((c=w[a])?(c=new odf.MasterPage(c,r),z[a]=c):c=null);return c};this.getDefaultMasterPage=function(){return y};this.update=function(){var b,d,f=null,g=null;q={};e={};n={};w={};z={};J={};B={};a=new odf.StylePile(x,r);c=new odf.StylePile(x,r);k=new odf.StylePile(x,r);p={text:a,paragraph:c,graphic:k};for(b=h.styles.firstElementChild;b;)b.namespaceURI===
v&&((d=m(b))?"style"===b.localName?d.addCommonStyle(b):"default-style"===b.localName&&d.setDefaultStyle(b):"default-page-layout"===b.localName&&(f=b)),b=b.nextElementSibling;t=new odf.PageLayout(f,x);for(b=h.automaticStyles.firstElementChild;b;)b.namespaceURI===v&&((d=m(b))&&"style"===b.localName?d.addAutomaticStyle(b):"page-layout"===b.localName&&(B[b.getAttributeNS(v,"name")]=b)),b=b.nextElementSibling;for(b=h.masterStyles.firstElementChild;b;)b.namespaceURI===v&&"master-page"===b.localName&&(g=
g||b,d=b,f=d.getAttributeNS(v,"name"),0<f.length&&!w.hasOwnProperty(f)&&(w[f]=d)),b=b.nextElementSibling;y=new odf.MasterPage(g,r)}};
ops.OperationTransformMatrix=function(){function h(a){a.position+=a.length;a.length*=-1}function l(a){var c=0>a.length;c&&h(a);return c}function d(a,c){function b(b){a[b]===c&&d.push(b)}var d=[];a&&["style:parent-style-name","style:next-style-name"].forEach(b);return d}function b(a,c){function b(b){a[b]===c&&delete a[b]}a&&["style:parent-style-name","style:next-style-name"].forEach(b)}function g(a){var c={};Object.keys(a).forEach(function(b){c[b]="object"===typeof a[b]?g(a[b]):a[b]});return c}function m(a,
c,b,d){var f,e=!1,k=!1,g,h=[];d&&d.attributes&&(h=d.attributes.split(","));a&&(b||0<h.length)&&Object.keys(a).forEach(function(c){var d=a[c],f;"object"!==typeof d&&(b&&(f=b[c]),void 0!==f?(delete a[c],k=!0,f===d&&(delete b[c],e=!0)):-1!==h.indexOf(c)&&(delete a[c],k=!0))});if(c&&c.attributes&&(b||0<h.length)){g=c.attributes.split(",");for(d=0;d<g.length;d+=1)if(f=g[d],b&&void 0!==b[f]||h&&-1!==h.indexOf(f))g.splice(d,1),--d,k=!0;0<g.length?c.attributes=g.join(","):delete c.attributes}return{majorChanged:e,
minorChanged:k}}function r(a){for(var c in a)if(a.hasOwnProperty(c))return!0;return!1}function p(a){for(var c in a)if(a.hasOwnProperty(c)&&("attributes"!==c||0<a.attributes.length))return!0;return!1}function q(a,c,b,d,e){var f=a?a[e]:null,k=c?c[e]:null,g=b?b[e]:null,h=d?d[e]:null,l;l=m(f,k,g,h);f&&!r(f)&&delete a[e];k&&!p(k)&&delete c[e];g&&!r(g)&&delete b[e];h&&!p(h)&&delete d[e];return l}function e(a,c){return{opSpecsA:[a],opSpecsB:[c]}}var n;n={AddAnnotation:{AddAnnotation:function(a,c,b){var d;
a.position<c.position?(d=a,b=c):c.position<a.position?(d=c,b=a):(d=b?a:c,b=b?c:a);b.position<d.position+d.length&&(d.length+=2);b.position+=2;return{opSpecsA:[a],opSpecsB:[c]}},AddCursor:e,AddMember:e,AddStyle:e,ApplyDirectStyling:function(a,c){a.position<=c.position?c.position+=2:a.position<=c.position+c.length&&(c.length+=2);return{opSpecsA:[a],opSpecsB:[c]}},InsertText:function(a,c){c.position<=a.position?a.position+=c.text.length:(void 0!==a.length&&c.position<=a.position+a.length&&(a.length+=
c.text.length),c.position+=2);return{opSpecsA:[a],opSpecsB:[c]}},MergeParagraph:function(a,c){c.sourceStartPosition<=a.position?--a.position:(void 0!==a.length&&c.sourceStartPosition<=a.position+a.length&&--a.length,c.sourceStartPosition+=2,a.position<c.destinationStartPosition&&(c.destinationStartPosition+=2));return{opSpecsA:[a],opSpecsB:[c]}},MoveCursor:function(a,c){var b=l(c);a.position<c.position?c.position+=2:a.position<c.position+c.length&&(c.length+=2);b&&h(c);return{opSpecsA:[a],opSpecsB:[c]}},
RemoveAnnotation:function(a,c){a.position<c.position?(c.position<a.position+a.length&&(a.length-=c.length+2),c.position+=2):a.position-=c.length+2;return{opSpecsA:[a],opSpecsB:[c]}},RemoveCursor:e,RemoveMember:e,RemoveStyle:e,RemoveText:function(a,c){var b=c.position,d=c.position+c.length,e,g=[a],h=[c];a.position<=c.position?c.position+=2:a.position<d&&(c.length=a.position-c.position,e={optype:"RemoveText",memberid:c.memberid,timestamp:c.timestamp,position:a.position+2,length:d-a.position},h.unshift(e));
c.position+c.length<=a.position?(a.position-=c.length,void 0!==a.length&&e&&(a.length=e.length>=a.length?0:a.length-e.length)):void 0!==a.length&&(e=a.position+a.length,d<=e?a.length-=c.length:b<e&&(a.length=b-a.position));return{opSpecsA:g,opSpecsB:h}},SetParagraphStyle:function(a,c){a.position<c.position&&(c.position+=2);return{opSpecsA:[a],opSpecsB:[c]}},SplitParagraph:function(a,c){a.position<c.sourceParagraphPosition&&(c.sourceParagraphPosition+=2);c.position<=a.position?a.position+=1:(void 0!==
a.length&&c.position<=a.position+a.length&&(a.length+=1),c.position+=2);return{opSpecsA:[a],opSpecsB:[c]}},UpdateMember:e,UpdateMetadata:e,UpdateParagraphStyle:e},AddCursor:{AddCursor:e,AddMember:e,AddStyle:e,ApplyDirectStyling:e,InsertText:e,MergeParagraph:e,MoveCursor:e,RemoveAnnotation:e,RemoveCursor:e,RemoveMember:e,RemoveStyle:e,RemoveText:e,SetParagraphStyle:e,SplitParagraph:e,UpdateMember:e,UpdateMetadata:e,UpdateParagraphStyle:e},AddMember:{AddStyle:e,ApplyDirectStyling:e,InsertText:e,MergeParagraph:e,
MoveCursor:e,RemoveAnnotation:e,RemoveCursor:e,RemoveStyle:e,RemoveText:e,SetParagraphStyle:e,SplitParagraph:e,UpdateMetadata:e,UpdateParagraphStyle:e},AddStyle:{AddStyle:e,ApplyDirectStyling:e,InsertText:e,MergeParagraph:e,MoveCursor:e,RemoveAnnotation:e,RemoveCursor:e,RemoveMember:e,RemoveStyle:function(a,c){var e,f=[a],g=[c];a.styleFamily===c.styleFamily&&(e=d(a.setProperties,c.styleName),0<e.length&&(e={optype:"UpdateParagraphStyle",memberid:c.memberid,timestamp:c.timestamp,styleName:a.styleName,
removedProperties:{attributes:e.join(",")}},g.unshift(e)),b(a.setProperties,c.styleName));return{opSpecsA:f,opSpecsB:g}},RemoveText:e,SetParagraphStyle:e,SplitParagraph:e,UpdateMember:e,UpdateMetadata:e,UpdateParagraphStyle:e},ApplyDirectStyling:{ApplyDirectStyling:function(a,c,b){var d,e,k,h,l,m,n,p;h=[a];k=[c];if(!(a.position+a.length<=c.position||a.position>=c.position+c.length)){d=b?a:c;e=b?c:a;if(a.position!==c.position||a.length!==c.length)m=g(d),n=g(e);c=q(e.setProperties,null,d.setProperties,
null,"style:text-properties");if(c.majorChanged||c.minorChanged)k=[],a=[],h=d.position+d.length,l=e.position+e.length,e.position<d.position?c.minorChanged&&(p=g(n),p.length=d.position-e.position,a.push(p),e.position=d.position,e.length=l-e.position):d.position<e.position&&c.majorChanged&&(p=g(m),p.length=e.position-d.position,k.push(p),d.position=e.position,d.length=h-d.position),l>h?c.minorChanged&&(m=n,m.position=h,m.length=l-h,a.push(m),e.length=h-e.position):h>l&&c.majorChanged&&(m.position=l,
m.length=h-l,k.push(m),d.length=l-d.position),d.setProperties&&r(d.setProperties)&&k.push(d),e.setProperties&&r(e.setProperties)&&a.push(e),b?(h=k,k=a):h=a}return{opSpecsA:h,opSpecsB:k}},InsertText:function(a,c){c.position<=a.position?a.position+=c.text.length:c.position<=a.position+a.length&&(a.length+=c.text.length);return{opSpecsA:[a],opSpecsB:[c]}},MergeParagraph:function(a,c){var b=a.position,d=a.position+a.length;b>=c.sourceStartPosition&&--b;d>=c.sourceStartPosition&&--d;a.position=b;a.length=
d-b;return{opSpecsA:[a],opSpecsB:[c]}},MoveCursor:e,RemoveAnnotation:function(a,c){var b=a.position,d=a.position+a.length,e=c.position+c.length,g=[a],h=[c];c.position<=b&&d<=e?g=[]:(e<b&&(b-=c.length+2),e<d&&(d-=c.length+2),a.position=b,a.length=d-b);return{opSpecsA:g,opSpecsB:h}},RemoveCursor:e,RemoveMember:e,RemoveStyle:e,RemoveText:function(a,b){var c=a.position+a.length,d=b.position+b.length,e=[a],g=[b];d<=a.position?a.position-=b.length:b.position<c&&(a.position<b.position?a.length=d<c?a.length-
b.length:b.position-a.position:(a.position=b.position,d<c?a.length=c-d:e=[]));return{opSpecsA:e,opSpecsB:g}},SetParagraphStyle:e,SplitParagraph:function(a,b){b.position<a.position?a.position+=1:b.position<a.position+a.length&&(a.length+=1);return{opSpecsA:[a],opSpecsB:[b]}},UpdateMember:e,UpdateMetadata:e,UpdateParagraphStyle:e},InsertText:{InsertText:function(a,b,d){a.position<b.position?b.position+=a.text.length:a.position>b.position?a.position+=b.text.length:d?b.position+=a.text.length:a.position+=
b.text.length;return{opSpecsA:[a],opSpecsB:[b]}},MergeParagraph:function(a,b){a.position>=b.sourceStartPosition?--a.position:(a.position<b.sourceStartPosition&&(b.sourceStartPosition+=a.text.length),a.position<b.destinationStartPosition&&(b.destinationStartPosition+=a.text.length));return{opSpecsA:[a],opSpecsB:[b]}},MoveCursor:function(a,b){var c=l(b);a.position<b.position?b.position+=a.text.length:a.position<b.position+b.length&&(b.length+=a.text.length);c&&h(b);return{opSpecsA:[a],opSpecsB:[b]}},
RemoveAnnotation:function(a,b){var c=a.position,d=b.position+b.length,e=[a],g=[b];b.position<=c&&c<=d?(e=[],b.length+=a.text.length):d<a.position?a.position-=b.length+2:b.position+=a.text.length;return{opSpecsA:e,opSpecsB:g}},RemoveCursor:e,RemoveMember:e,RemoveStyle:e,RemoveText:function(a,b){var c;c=b.position+b.length;var d=[a],e=[b];c<=a.position?a.position-=b.length:a.position<=b.position?b.position+=a.text.length:(b.length=a.position-b.position,c={optype:"RemoveText",memberid:b.memberid,timestamp:b.timestamp,
position:a.position+a.text.length,length:c-a.position},e.unshift(c),a.position=b.position);return{opSpecsA:d,opSpecsB:e}},SetParagraphStyle:function(a,b){b.position>a.position&&(b.position+=a.text.length);return{opSpecsA:[a],opSpecsB:[b]}},SplitParagraph:function(a,b){a.position<b.sourceParagraphPosition&&(b.sourceParagraphPosition+=a.text.length);a.position<=b.position?b.position+=a.text.length:a.position+=1;return{opSpecsA:[a],opSpecsB:[b]}},UpdateMember:e,UpdateMetadata:e,UpdateParagraphStyle:e},
MergeParagraph:{MergeParagraph:function(a,b,d){var c=[a],e=[b],g;a.destinationStartPosition===b.destinationStartPosition?(c=[],e=[],a.moveCursor&&(g={optype:"MoveCursor",memberid:a.memberid,timestamp:a.timestamp,position:a.sourceStartPosition-1},c.push(g)),b.moveCursor&&(g={optype:"MoveCursor",memberid:b.memberid,timestamp:b.timestamp,position:b.sourceStartPosition-1},e.push(g)),a=d?a:b,a={optype:"SetParagraphStyle",memberid:a.memberid,timestamp:a.timestamp,position:a.destinationStartPosition,styleName:a.paragraphStyleName},
d?c.push(a):e.push(a)):b.sourceStartPosition===a.destinationStartPosition?(a.destinationStartPosition=b.destinationStartPosition,--a.sourceStartPosition,a.paragraphStyleName=b.paragraphStyleName):a.sourceStartPosition===b.destinationStartPosition?(b.destinationStartPosition=a.destinationStartPosition,--b.sourceStartPosition,b.paragraphStyleName=a.paragraphStyleName):a.destinationStartPosition<b.destinationStartPosition?(--b.destinationStartPosition,--b.sourceStartPosition):(--a.destinationStartPosition,
--a.sourceStartPosition);return{opSpecsA:c,opSpecsB:e}},MoveCursor:function(a,b){var c=b.position,d=b.position+b.length,e=Math.min(c,d),c=Math.max(c,d);e>=a.sourceStartPosition&&--e;c>=a.sourceStartPosition&&--c;0<=b.length?(b.position=e,b.length=c-e):(b.position=c,b.length=e-c);return{opSpecsA:[a],opSpecsB:[b]}},RemoveAnnotation:function(a,b){var c=b.position+b.length,d=[a],e=[b];b.position<=a.destinationStartPosition&&a.sourceStartPosition<=c?(d=[],--b.length):a.sourceStartPosition<b.position?--b.position:
(c<a.destinationStartPosition&&(a.destinationStartPosition-=b.length+2),c<a.sourceStartPosition&&(a.sourceStartPosition-=b.length+2));return{opSpecsA:d,opSpecsB:e}},RemoveCursor:e,RemoveMember:e,RemoveStyle:e,RemoveText:function(a,b){b.position>=a.sourceStartPosition?--b.position:(b.position<a.destinationStartPosition&&(a.destinationStartPosition-=b.length),b.position<a.sourceStartPosition&&(a.sourceStartPosition-=b.length));return{opSpecsA:[a],opSpecsB:[b]}},SetParagraphStyle:function(a,b){var c=
[a],d=[b];if(b.position>a.sourceStartPosition)--b.position;else if(b.position===a.destinationStartPosition||b.position===a.sourceStartPosition)b.position=a.destinationStartPosition,a.paragraphStyleName=b.styleName;return{opSpecsA:c,opSpecsB:d}},SplitParagraph:function(a,b){var c,d=[a],e=[b];b.position<a.destinationStartPosition?(a.destinationStartPosition+=1,a.sourceStartPosition+=1):b.position>=a.destinationStartPosition&&b.position<a.sourceStartPosition?(b.paragraphStyleName=a.paragraphStyleName,
c={optype:"SetParagraphStyle",memberid:a.memberid,timestamp:a.timestamp,position:a.destinationStartPosition,styleName:a.paragraphStyleName},d.push(c),b.position===a.sourceStartPosition-1&&a.moveCursor&&(c={optype:"MoveCursor",memberid:a.memberid,timestamp:a.timestamp,position:b.position,length:0},d.push(c)),a.destinationStartPosition=b.position+1,a.sourceStartPosition+=1):b.position>=a.sourceStartPosition&&(--b.position,--b.sourceParagraphPosition);return{opSpecsA:d,opSpecsB:e}},UpdateMember:e,UpdateMetadata:e,
UpdateParagraphStyle:e},MoveCursor:{MoveCursor:e,RemoveAnnotation:function(a,b){var c=l(a),d=a.position+a.length,e=b.position+b.length;b.position<=a.position&&d<=e?(a.position=b.position-1,a.length=0):(e<a.position?a.position-=b.length+2:e<d&&(a.length-=b.length+2),c&&h(a));return{opSpecsA:[a],opSpecsB:[b]}},RemoveCursor:function(a,b){return{opSpecsA:a.memberid===b.memberid?[]:[a],opSpecsB:[b]}},RemoveMember:e,RemoveStyle:e,RemoveText:function(a,b){var c=l(a),d=a.position+a.length,e=b.position+b.length;
e<=a.position?a.position-=b.length:b.position<d&&(a.position<b.position?a.length=e<d?a.length-b.length:b.position-a.position:(a.position=b.position,a.length=e<d?d-e:0));c&&h(a);return{opSpecsA:[a],opSpecsB:[b]}},SetParagraphStyle:e,SplitParagraph:function(a,b){var c=l(a);b.position<a.position?a.position+=1:b.position<a.position+a.length&&(a.length+=1);c&&h(a);return{opSpecsA:[a],opSpecsB:[b]}},UpdateMember:e,UpdateMetadata:e,UpdateParagraphStyle:e},RemoveAnnotation:{RemoveAnnotation:function(a,b){var c=
[a],d=[b];a.position===b.position&&a.length===b.length?(c=[],d=[]):a.position<b.position?b.position-=a.length+2:a.position-=b.length+2;return{opSpecsA:c,opSpecsB:d}},RemoveCursor:e,RemoveMember:e,RemoveStyle:e,RemoveText:function(a,b){var c=a.position+a.length,d=b.position+b.length,e=[a],g=[b];a.position<=b.position&&d<=c?(g=[],a.length-=b.length):d<a.position?a.position-=b.length:b.position<a.position?(a.position=b.position+1,b.length-=a.length+2):b.position-=a.length+2;return{opSpecsA:e,opSpecsB:g}},
SetParagraphStyle:function(a,b){var c=b.position,d=a.position+a.length,e=[a],g=[b];a.position<=c&&c<=d?g=[]:d<c&&(b.position-=a.length+2);return{opSpecsA:e,opSpecsB:g}},SplitParagraph:function(a,b){var c=b.position,d=a.position+a.length,e=[a],g=[b];a.position<=c&&c<=d?(g=[],a.length+=1):(d<b.sourceParagraphPosition&&(b.sourceParagraphPosition-=a.length+2),d<c?b.position-=a.length+2:a.position+=1);return{opSpecsA:e,opSpecsB:g}},UpdateMember:e,UpdateMetadata:e,UpdateParagraphStyle:e},RemoveCursor:{RemoveCursor:function(a,
b){var c=a.memberid===b.memberid;return{opSpecsA:c?[]:[a],opSpecsB:c?[]:[b]}},RemoveMember:e,RemoveStyle:e,RemoveText:e,SetParagraphStyle:e,SplitParagraph:e,UpdateMember:e,UpdateMetadata:e,UpdateParagraphStyle:e},RemoveMember:{RemoveStyle:e,RemoveText:e,SetParagraphStyle:e,SplitParagraph:e,UpdateMetadata:e,UpdateParagraphStyle:e},RemoveStyle:{RemoveStyle:function(a,b){var c=a.styleName===b.styleName&&a.styleFamily===b.styleFamily;return{opSpecsA:c?[]:[a],opSpecsB:c?[]:[b]}},RemoveText:e,SetParagraphStyle:function(a,
b){var c,d=[a],e=[b];"paragraph"===a.styleFamily&&a.styleName===b.styleName&&(c={optype:"SetParagraphStyle",memberid:a.memberid,timestamp:a.timestamp,position:b.position,styleName:""},d.unshift(c),b.styleName="");return{opSpecsA:d,opSpecsB:e}},SplitParagraph:e,UpdateMember:e,UpdateMetadata:e,UpdateParagraphStyle:function(a,c){var e,f=[a],g=[c];"paragraph"===a.styleFamily&&(e=d(c.setProperties,a.styleName),0<e.length&&(e={optype:"UpdateParagraphStyle",memberid:a.memberid,timestamp:a.timestamp,styleName:c.styleName,
removedProperties:{attributes:e.join(",")}},f.unshift(e)),a.styleName===c.styleName?g=[]:b(c.setProperties,a.styleName));return{opSpecsA:f,opSpecsB:g}}},RemoveText:{RemoveText:function(a,b){var c=a.position+a.length,d=b.position+b.length,e=[a],g=[b];d<=a.position?a.position-=b.length:c<=b.position?b.position-=a.length:b.position<c&&(a.position<b.position?(a.length=d<c?a.length-b.length:b.position-a.position,c<d?(b.position=a.position,b.length=d-c):g=[]):(c<d?b.length-=a.length:b.position<a.position?
b.length=a.position-b.position:g=[],d<c?(a.position=b.position,a.length=c-d):e=[]));return{opSpecsA:e,opSpecsB:g}},SetParagraphStyle:function(a,b){a.position<b.position&&(b.position-=a.length);return{opSpecsA:[a],opSpecsB:[b]}},SplitParagraph:function(a,b){var c=a.position+a.length,d=[a],e=[b];b.position<=a.position?a.position+=1:b.position<c&&(a.length=b.position-a.position,c={optype:"RemoveText",memberid:a.memberid,timestamp:a.timestamp,position:b.position+1,length:c-b.position},d.unshift(c));a.position+
a.length<=b.position?b.position-=a.length:a.position<b.position&&(b.position=a.position);a.position+a.length<b.sourceParagraphPosition&&(b.sourceParagraphPosition-=a.length);return{opSpecsA:d,opSpecsB:e}},UpdateMember:e,UpdateMetadata:e,UpdateParagraphStyle:e},SetParagraphStyle:{SetParagraphStyle:function(a,b,d){a.position===b.position&&(d?b.styleName=a.styleName:a.styleName=b.styleName);return{opSpecsA:[a],opSpecsB:[b]}},SplitParagraph:function(a,b){var c=[a],d=[b],e;a.position>b.position?a.position+=
1:a.position===b.sourceParagraphPosition&&(b.paragraphStyleName=a.styleName,e=g(a),e.position=b.position+1,c.push(e));return{opSpecsA:c,opSpecsB:d}},UpdateMember:e,UpdateMetadata:e,UpdateParagraphStyle:e},SplitParagraph:{SplitParagraph:function(a,b,d){var c,e;a.position<b.position?c=!0:b.position<a.position?e=!0:a.position===b.position&&(d?c=!0:e=!0);c?(b.position+=1,b.sourceParagraphPosition=a.position<b.sourceParagraphPosition?b.sourceParagraphPosition+1:a.position+1):e&&(a.position+=1,a.sourceParagraphPosition=
b.position<b.sourceParagraphPosition?a.sourceParagraphPosition+1:b.position+1);return{opSpecsA:[a],opSpecsB:[b]}},UpdateMember:e,UpdateMetadata:e,UpdateParagraphStyle:e},UpdateMember:{UpdateMetadata:e,UpdateParagraphStyle:e},UpdateMetadata:{UpdateMetadata:function(a,b,d){var c,e=[a],g=[b];c=d?a:b;a=d?b:a;m(a.setProperties||null,a.removedProperties||null,c.setProperties||null,c.removedProperties||null);c.setProperties&&r(c.setProperties)||c.removedProperties&&p(c.removedProperties)||(d?e=[]:g=[]);
a.setProperties&&r(a.setProperties)||a.removedProperties&&p(a.removedProperties)||(d?g=[]:e=[]);return{opSpecsA:e,opSpecsB:g}},UpdateParagraphStyle:e},UpdateParagraphStyle:{UpdateParagraphStyle:function(a,b,d){var c,e=[a],g=[b];a.styleName===b.styleName&&(c=d?a:b,a=d?b:a,q(a.setProperties,a.removedProperties,c.setProperties,c.removedProperties,"style:paragraph-properties"),q(a.setProperties,a.removedProperties,c.setProperties,c.removedProperties,"style:text-properties"),m(a.setProperties||null,a.removedProperties||
null,c.setProperties||null,c.removedProperties||null),c.setProperties&&r(c.setProperties)||c.removedProperties&&p(c.removedProperties)||(d?e=[]:g=[]),a.setProperties&&r(a.setProperties)||a.removedProperties&&p(a.removedProperties)||(d?g=[]:e=[]));return{opSpecsA:e,opSpecsB:g}}}};this.passUnchanged=e;this.extendTransformations=function(a){Object.keys(a).forEach(function(b){var c=a[b],d,e=n.hasOwnProperty(b);runtime.log((e?"Extending":"Adding")+" map for optypeA: "+b);e||(n[b]={});d=n[b];Object.keys(c).forEach(function(a){var e=
d.hasOwnProperty(a);runtime.assert(b<=a,"Wrong order:"+b+", "+a);runtime.log("  "+(e?"Overwriting":"Adding")+" entry for optypeB: "+a);d[a]=c[a]})})};this.transformOpspecVsOpspec=function(a,b){var c=a.optype<=b.optype,d;runtime.log("Crosstransforming:");runtime.log(runtime.toJson(a));runtime.log(runtime.toJson(b));c||(d=a,a=b,b=d);(d=(d=n[a.optype])&&d[b.optype])?(d=d(a,b,!c),c||null===d||(d={opSpecsA:d.opSpecsB,opSpecsB:d.opSpecsA})):d=null;runtime.log("result:");d?(runtime.log(runtime.toJson(d.opSpecsA)),
runtime.log(runtime.toJson(d.opSpecsB))):runtime.log("null");return d}};
ops.OperationTransformer=function(){function h(d,b){for(var g,m,r=[],p=[];0<d.length&&b;){g=d.shift();g=l.transformOpspecVsOpspec(g,b);if(!g)return null;r=r.concat(g.opSpecsA);if(0===g.opSpecsB.length){r=r.concat(d);b=null;break}for(;1<g.opSpecsB.length;){m=h(d,g.opSpecsB.shift());if(!m)return null;p=p.concat(m.opSpecsB);d=m.opSpecsA}b=g.opSpecsB.pop()}b&&p.push(b);return{opSpecsA:r,opSpecsB:p}}var l=new ops.OperationTransformMatrix;this.getOperationTransformMatrix=function(){return l};this.transform=
function(d,b){for(var g,l=[];0<b.length;){g=h(d,b.shift());if(!g)return null;d=g.opSpecsA;l=l.concat(g.opSpecsB)}return{opSpecsA:d,opSpecsB:l}}};
webodfcore.EventSubscriptions=function(){function h(b,g,h){b.subscribe(g,h);d.push({eventSource:b,eventid:g,callback:h})}function l(){var h=[];d.forEach(function(b){b.eventSource.unsubscribe(b.eventid,b.callback)});d.length=0;Object.keys(g).forEach(function(b){g[b].forEach(function(b){h.push(b.task.destroy)});delete g[b]});webodfcore.Async.destroyAll(h,function(){});b=new webodfcore.EventNotifier}var d=[],b=new webodfcore.EventNotifier,g={},m=0;this.addSubscription=h;this.addFrameSubscription=function(d,
l,q){var e,n,a,c;g.hasOwnProperty(l)||(g[l]=[]);a=g[l];for(c=0;c<a.length;c+=1)if(a[c].eventSource===d){e=a[c];break}e||(n="s"+m,m+=1,b.register(n),e={frameEventId:n,eventSource:d,task:webodfcore.Task.createRedrawTask(function(){b.emit(n,void 0)})},a.push(e),h(d,l,e.task.trigger));b.subscribe(e.frameEventId,q)};this.unsubscribeAll=l;this.destroy=function(b){l();b()}};var webodf_css='@namespace draw url(urn:oasis:names:tc:opendocument:xmlns:drawing:1.0);@namespace fo url(urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0);@namespace office url(urn:oasis:names:tc:opendocument:xmlns:office:1.0);@namespace presentation url(urn:oasis:names:tc:opendocument:xmlns:presentation:1.0);@namespace style url(urn:oasis:names:tc:opendocument:xmlns:style:1.0);@namespace svg url(urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0);@namespace table url(urn:oasis:names:tc:opendocument:xmlns:table:1.0);@namespace text url(urn:oasis:names:tc:opendocument:xmlns:text:1.0);@namespace webodfhelper url(urn:webodf:names:helper);@namespace cursor url(urn:webodf:names:cursor);@namespace editinfo url(urn:webodf:names:editinfo);@namespace annotation url(urn:webodf:names:annotation);@namespace dc url(http://purl.org/dc/elements/1.1/);@namespace svgns url(http://www.w3.org/2000/svg);office|document > *, office|document-content > * {display: none;}office|body, office|document {display: inline-block;position: relative;}text|p, text|h {display: block;padding: 0;margin: 0;line-height: normal;position: relative;}text|p::after, text|h::after {content: "\\200B";white-space: pre;}*[webodfhelper|containsparagraphanchor] {position: relative;}text|s {white-space: pre;}text|tab {display: inline;white-space: pre;}text|tracked-changes {display: none;}office|binary-data {display: none;}office|text {display: block;text-align: left;overflow: visible;word-wrap: break-word;}office|text::selection {background: transparent;}.webodf-virtualSelections *::selection {background: transparent;}.webodf-virtualSelections *::-moz-selection {background: transparent;}office|text * draw|text-box {display: block;border: 1px solid #d3d3d3;}office|text draw|frame {z-index: 1;}office|spreadsheet {display: block;border-collapse: collapse;empty-cells: show;font-family: sans-serif;font-size: 10pt;text-align: left;page-break-inside: avoid;overflow: hidden;}office|presentation {display: inline-block;text-align: left;}#shadowContent {display: inline-block;text-align: left;}draw|page {display: block;position: relative;overflow: hidden;}presentation|notes, presentation|footer-decl, presentation|date-time-decl {display: none;}@media print {draw|page {border: 1pt solid black;page-break-inside: avoid;}presentation|notes {}}office|spreadsheet text|p {border: 0px;padding: 1px;margin: 0px;}office|spreadsheet table|table {margin: 3px;}office|spreadsheet table|table:after {}office|spreadsheet table|table-row {counter-increment: row;}office|spreadsheet table|table-row:before {width: 3em;background: #cccccc;border: 1px solid black;text-align: center;content: counter(row);display: table-cell;}office|spreadsheet table|table-cell {border: 1px solid #cccccc;}table|table {display: table;}draw|frame table|table {width: 100%;height: 100%;background: white;}table|table-header-rows {display: table-header-group;}table|table-row {display: table-row;}table|table-column {display: table-column;}table|table-cell {width: 0.889in;display: table-cell;word-break: break-all;}draw|frame {display: block;}draw|image {display: block;width: 100%;height: 100%;top: 0px;left: 0px;background-repeat: no-repeat;background-size: 100% 100%;-moz-background-size: 100% 100%;}draw|frame > draw|image:nth-of-type(n+2) {display: none;}text|list:before {display: none;content:"";}text|list {display: block;}text|list-item {display: block;}text|number {display:none;}text|a {color: blue;text-decoration: underline;cursor: pointer;}.webodf-inactiveLinks text|a {cursor: text;}text|note-citation {vertical-align: super;font-size: smaller;}text|note-body {display: none;}text|note:hover text|note-citation {background: #dddddd;}text|note:hover text|note-body {display: block;left:1em;max-width: 80%;position: absolute;background: #ffffaa;}text|bibliography-source {display: none;}svg|title, svg|desc {display: none;}video {width: 100%;height: 100%}cursor|anchor {display: none;}cursor|cursor {display: none;}.webodf-caretOverlay {position: absolute;top: 5%;height: 1em;z-index: 10;padding-left: 1px;pointer-events: none;}.webodf-caretOverlay .caret {position: absolute;border-left: 2px solid black;top: 0;bottom: 0;right: 0;}.webodf-caretOverlay .handle {position: absolute;margin-top: 5px;padding-top: 3px;margin-left: auto;margin-right: auto;width: 64px;height: 68px;border-radius: 5px;opacity: 0.3;text-align: center;background-color: black;box-shadow: 0px 0px 5px rgb(90, 90, 90);border: 1px solid black;top: -85px;right: -32px;}.webodf-caretOverlay .handle > img {box-shadow: 0px 0px 5px rgb(90, 90, 90) inset;background-color: rgb(200, 200, 200);border-radius: 5px;border: 2px solid;height: 60px;width: 60px;display: block;margin: auto;}.webodf-caretOverlay .handle.active {opacity: 0.8;}.webodf-caretOverlay .handle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 43%;}.webodf-caretSizer {display: inline-block;width: 0;visibility: hidden;}#eventTrap {display: block;position: absolute;bottom: 0;left: 0;outline: none;opacity: 0;color: rgba(255, 255, 255, 0);pointer-events: none;white-space: pre;overflow: hidden;}cursor|cursor > #composer {text-decoration: underline;}cursor|cursor[cursor|caret-sizer-active="true"],cursor|cursor[cursor|composing="true"] {display: inline;}editinfo|editinfo {display: inline-block;}.editInfoMarker {position: absolute;width: 10px;height: 100%;left: -20px;opacity: 0.8;top: 0;border-radius: 5px;background-color: transparent;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);}.editInfoMarker:hover {box-shadow: 0px 0px 8px rgba(0, 0, 0, 1);}.editInfoHandle {position: absolute;background-color: black;padding: 5px;border-radius: 5px;opacity: 0.8;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);bottom: 100%;margin-bottom: 10px;z-index: 3;left: -25px;}.editInfoHandle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 5px;}.editInfo {font-family: sans-serif;font-weight: normal;font-style: normal;text-decoration: none;color: white;width: 100%;height: 12pt;}.editInfoColor {float: left;width: 10pt;height: 10pt;border: 1px solid white;}.editInfoAuthor {float: left;margin-left: 5pt;font-size: 10pt;text-align: left;height: 12pt;line-height: 12pt;}.editInfoTime {float: right;margin-left: 30pt;font-size: 8pt;font-style: italic;color: yellow;height: 12pt;line-height: 12pt;}.annotationWrapper {display: inline;position: relative;}.annotationRemoveButton:before {content: "\u00d7";color: white;padding: 5px;line-height: 1em;}.annotationRemoveButton {width: 20px;height: 20px;border-radius: 10px;background-color: black;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);position: absolute;top: -10px;left: -10px;z-index: 3;text-align: center;font-family: sans-serif;font-style: normal;font-weight: normal;text-decoration: none;font-size: 15px;}.annotationRemoveButton:hover {cursor: pointer;box-shadow: 0px 0px 5px rgba(0, 0, 0, 1);}.annotationNote {width: 4cm;position: absolute;display: inline;z-index: 10;top: 0;}.annotationNote > office|annotation {display: block;text-align: left;}.annotationConnector {position: absolute;display: inline;top: 0;z-index: 2;border-top: 1px dashed brown;}.annotationConnector.angular {-moz-transform-origin: left top;-webkit-transform-origin: left top;-ms-transform-origin: left top;transform-origin: left top;}.annotationConnector.horizontal {left: 0;}.annotationConnector.horizontal:before {content: "";display: inline;position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: brown transparent transparent transparent;top: -1px;left: -5px;}office|annotation {width: 100%;height: 100%;display: none;background: rgb(198, 238, 184);background: -moz-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -webkit-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -o-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -ms-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: linear-gradient(180deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);box-shadow: 0 3px 4px -3px #ccc;}office|annotation > dc|creator {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;color: white;background-color: brown;padding: 4px;}office|annotation > dc|date {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;border: 4px solid transparent;color: black;}office|annotation > text|list {display: block;padding: 5px;}office|annotation text|p {font-size: 10pt;color: black;font-weight: normal;font-style: normal;text-decoration: none;font-family: sans-serif;}#annotationsPane {background-color: #EAEAEA;width: 4cm;height: 100%;display: none;position: absolute;outline: 1px solid #ccc;}.webodf-annotationHighlight {background-color: yellow;position: relative;}.webodf-selectionOverlay {position: absolute;pointer-events: none;top: 0;left: 0;top: 0;left: 0;width: 100%;height: 100%;z-index: 15;}.webodf-selectionOverlay > polygon {fill-opacity: 0.3;stroke-opacity: 0.8;stroke-width: 1;fill-rule: evenodd;}.webodf-selectionOverlay > .webodf-draggable {fill-opacity: 0.8;stroke-opacity: 0;stroke-width: 8;pointer-events: all;display: none;-moz-transform-origin: center center;-webkit-transform-origin: center center;-ms-transform-origin: center center;transform-origin: center center;}#imageSelector {display: none;position: absolute;border-style: solid;border-color: black;}#imageSelector > div {width: 5px;height: 5px;display: block;position: absolute;border: 1px solid black;background-color: #ffffff;}#imageSelector > .topLeft {top: -4px;left: -4px;}#imageSelector > .topRight {top: -4px;right: -4px;}#imageSelector > .bottomRight {right: -4px;bottom: -4px;}#imageSelector > .bottomLeft {bottom: -4px;left: -4px;}#imageSelector > .topMiddle {top: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .rightMiddle {top: 50%;right: -4px;margin-top: -2.5px;}#imageSelector > .bottomMiddle {bottom: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .leftMiddle {top: 50%;left: -4px;margin-top: -2.5px;}div.webodf-customScrollbars::-webkit-scrollbar{width: 8px;height: 8px;background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-track{background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-thumb{background-color: #444;border-radius: 4px;}.webodf-hyperlinkTooltip {display: none;color: white;background-color: black;border-radius: 5px;box-shadow: 2px 2px 5px gray;padding: 3px;position: absolute;max-width: 210px;text-align: left;word-break: break-all;z-index: 16;}.webodf-hyperlinkTooltipText {display: block;font-weight: bold;}';/*

 @licstart
JSZip - A Javascript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2014 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/master/LICENSE
 @licend
*/
!function(e){var globalScope=typeof window!=="undefined"?window:typeof global!=="undefined"?global:{},externs=globalScope.externs||(globalScope.externs={});externs.JSZip=e()}(function(){var define,module,exports;if(define||module||exports)console.log("");return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'");}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=
t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){var _keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";exports.encode=function(input,utf8){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=(chr1&3)<<
4|chr2>>4;enc3=(chr2&15)<<2|chr3>>6;enc4=chr3&63;if(isNaN(chr2))enc3=enc4=64;else if(isNaN(chr3))enc4=64;output=output+_keyStr.charAt(enc1)+_keyStr.charAt(enc2)+_keyStr.charAt(enc3)+_keyStr.charAt(enc4)}return output};exports.decode=function(input,utf8){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=_keyStr.indexOf(input.charAt(i++));enc2=_keyStr.indexOf(input.charAt(i++));enc3=_keyStr.indexOf(input.charAt(i++));
enc4=_keyStr.indexOf(input.charAt(i++));chr1=enc1<<2|enc2>>4;chr2=(enc2&15)<<4|enc3>>2;chr3=(enc3&3)<<6|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64)output=output+String.fromCharCode(chr2);if(enc4!=64)output=output+String.fromCharCode(chr3)}return output}},{}],2:[function(_dereq_,module,exports){function CompressedObject(){this.compressedSize=0;this.uncompressedSize=0;this.crc32=0;this.compressionMethod=null;this.compressedContent=null}CompressedObject.prototype={getContent:function(){return null},
getCompressedContent:function(){return null}};module.exports=CompressedObject},{}],3:[function(_dereq_,module,exports){exports.STORE={magic:"\x00\x00",compress:function(content){return content},uncompress:function(content){return content},compressInputType:null,uncompressInputType:null};exports.DEFLATE=_dereq_("./flate")},{"./flate":8}],4:[function(_dereq_,module,exports){var utils=_dereq_("./utils");var table=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,
2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,
671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,
3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,
426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,
3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,
3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];module.exports=function crc32(input,crc){if(typeof input==="undefined"||!input.length)return 0;var isArray=utils.getTypeOf(input)!=="string";if(typeof crc=="undefined")crc=0;var x=0;var y=0;var b=0;crc=crc^-1;for(var i=0,iTop=input.length;i<iTop;i++){b=isArray?input[i]:input.charCodeAt(i);y=(crc^b)&255;x=table[y];crc=crc>>>8^x}return crc^-1}},{"./utils":21}],5:[function(_dereq_,
module,exports){var utils=_dereq_("./utils");function DataReader(data){this.data=null;this.length=0;this.index=0}DataReader.prototype={checkOffset:function(offset){this.checkIndex(this.index+offset)},checkIndex:function(newIndex){if(this.length<newIndex||newIndex<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+newIndex+"). Corrupted zip ?");},setIndex:function(newIndex){this.checkIndex(newIndex);this.index=newIndex},skip:function(n){this.setIndex(this.index+
n)},byteAt:function(i){},readInt:function(size){var result=0,i;this.checkOffset(size);for(i=this.index+size-1;i>=this.index;i--)result=(result<<8)+this.byteAt(i);this.index+=size;return result},readString:function(size){return utils.transformTo("string",this.readData(size))},readData:function(size){},lastIndexOfSignature:function(sig){},readDate:function(){var dostime=this.readInt(4);return new Date((dostime>>25&127)+1980,(dostime>>21&15)-1,dostime>>16&31,dostime>>11&31,dostime>>5&63,(dostime&31)<<
1)}};module.exports=DataReader},{"./utils":21}],6:[function(_dereq_,module,exports){exports.base64=false;exports.binary=false;exports.dir=false;exports.createFolders=false;exports.date=null;exports.compression=null;exports.comment=null},{}],7:[function(_dereq_,module,exports){var utils=_dereq_("./utils");exports.string2binary=function(str){return utils.string2binary(str)};exports.string2Uint8Array=function(str){return utils.transformTo("uint8array",str)};exports.uint8Array2String=function(array){return utils.transformTo("string",
array)};exports.string2Blob=function(str){var buffer=utils.transformTo("arraybuffer",str);return utils.arrayBuffer2Blob(buffer)};exports.arrayBuffer2Blob=function(buffer){return utils.arrayBuffer2Blob(buffer)};exports.transformTo=function(outputType,input){return utils.transformTo(outputType,input)};exports.getTypeOf=function(input){return utils.getTypeOf(input)};exports.checkSupport=function(type){return utils.checkSupport(type)};exports.MAX_VALUE_16BITS=utils.MAX_VALUE_16BITS;exports.MAX_VALUE_32BITS=
utils.MAX_VALUE_32BITS;exports.pretty=function(str){return utils.pretty(str)};exports.findCompression=function(compressionMethod){return utils.findCompression(compressionMethod)};exports.isRegExp=function(object){return utils.isRegExp(object)}},{"./utils":21}],8:[function(_dereq_,module,exports){var USE_TYPEDARRAY=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Uint32Array!=="undefined";var pako=_dereq_("pako");exports.uncompressInputType=USE_TYPEDARRAY?"uint8array":"array";
exports.compressInputType=USE_TYPEDARRAY?"uint8array":"array";exports.magic="\b\x00";exports.compress=function(input){return pako.deflateRaw(input)};exports.uncompress=function(input){return pako.inflateRaw(input)}},{"pako":24}],9:[function(_dereq_,module,exports){var base64=_dereq_("./base64");function JSZip(data,options){if(!(this instanceof JSZip))return new JSZip(data,options);this.files={};this.comment=null;this.root="";if(data)this.load(data,options);this.clone=function(){var newObj=new JSZip;
for(var i in this)if(typeof this[i]!=="function")newObj[i]=this[i];return newObj}}JSZip.prototype=_dereq_("./object");JSZip.prototype.load=_dereq_("./load");JSZip.support=_dereq_("./support");JSZip.defaults=_dereq_("./defaults");JSZip.utils=_dereq_("./deprecatedPublicUtils");JSZip.base64={encode:function(input){return base64.encode(input)},decode:function(input){return base64.decode(input)}};JSZip.compressions=_dereq_("./compressions");module.exports=JSZip},{"./base64":1,"./compressions":3,"./defaults":6,
"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(_dereq_,module,exports){var base64=_dereq_("./base64");var ZipEntries=_dereq_("./zipEntries");module.exports=function(data,options){var files,zipEntries,i,input;options=options||{};if(options.base64)data=base64.decode(data);zipEntries=new ZipEntries(data,options);files=zipEntries.files;for(i=0;i<files.length;i++){input=files[i];this.file(input.fileName,input.decompressed,{binary:true,optimizedBinaryString:true,date:input.date,
dir:input.dir,comment:input.fileComment.length?input.fileComment:null,createFolders:options.createFolders})}if(zipEntries.zipComment.length)this.comment=zipEntries.zipComment;return this}},{"./base64":1,"./zipEntries":22}],11:[function(_dereq_,module,exports){(function(Buffer){module.exports=function(data,encoding){return new Buffer(data,encoding)};module.exports.test=function(b){return Buffer.isBuffer(b)}}).call(this,typeof Buffer!=="undefined"?Buffer:undefined)},{}],12:[function(_dereq_,module,
exports){var Uint8ArrayReader=_dereq_("./uint8ArrayReader");function NodeBufferReader(data){this.data=data;this.length=this.data.length;this.index=0}NodeBufferReader.prototype=new Uint8ArrayReader;NodeBufferReader.prototype.readData=function(size){this.checkOffset(size);var result=this.data.slice(this.index,this.index+size);this.index+=size;return result};module.exports=NodeBufferReader},{"./uint8ArrayReader":18}],13:[function(_dereq_,module,exports){var support=_dereq_("./support");var utils=_dereq_("./utils");
var crc32=_dereq_("./crc32");var signature=_dereq_("./signature");var defaults=_dereq_("./defaults");var base64=_dereq_("./base64");var compressions=_dereq_("./compressions");var CompressedObject=_dereq_("./compressedObject");var nodeBuffer=_dereq_("./nodeBuffer");var utf8=_dereq_("./utf8");var StringWriter=_dereq_("./stringWriter");var Uint8ArrayWriter=_dereq_("./uint8ArrayWriter");var getRawData=function(file){if(file._data instanceof CompressedObject){file._data=file._data.getContent();file.options.binary=
true;file.options.base64=false;if(utils.getTypeOf(file._data)==="uint8array"){var copy=file._data;file._data=new Uint8Array(copy.length);if(copy.length!==0)file._data.set(copy,0)}}return file._data};var getBinaryData=function(file){var result=getRawData(file),type=utils.getTypeOf(result);if(type==="string"){if(!file.options.binary)if(support.nodebuffer)return nodeBuffer(result,"utf-8");return file.asBinary()}return result};var dataToString=function(asUTF8){var result=getRawData(this);if(result===
null||typeof result==="undefined")return"";if(this.options.base64)result=base64.decode(result);if(asUTF8&&this.options.binary)result=out.utf8decode(result);else result=utils.transformTo("string",result);if(!asUTF8&&!this.options.binary)result=utils.transformTo("string",out.utf8encode(result));return result};var ZipObject=function(name,data,options){this.name=name;this.dir=options.dir;this.date=options.date;this.comment=options.comment;this._data=data;this.options=options;this._initialMetadata={dir:options.dir,
date:options.date}};ZipObject.prototype={asText:function(){return dataToString.call(this,true)},asBinary:function(){return dataToString.call(this,false)},asNodeBuffer:function(){var result=getBinaryData(this);return utils.transformTo("nodebuffer",result)},asUint8Array:function(){var result=getBinaryData(this);return utils.transformTo("uint8array",result)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var decToHex=function(dec,bytes){var hex="",i;for(i=0;i<bytes;i++){hex+=String.fromCharCode(dec&
255);dec=dec>>>8}return hex};var extend=function(){var result={},i,attr;for(i=0;i<arguments.length;i++)for(attr in arguments[i])if(arguments[i].hasOwnProperty(attr)&&typeof result[attr]==="undefined")result[attr]=arguments[i][attr];return result};var prepareFileAttrs=function(o){o=o||{};if(o.base64===true&&(o.binary===null||o.binary===undefined))o.binary=true;o=extend(o,defaults);o.date=o.date||new Date;if(o.compression!==null)o.compression=o.compression.toUpperCase();return o};var fileAdd=function(name,
data,o){var dataType=utils.getTypeOf(data),parent;o=prepareFileAttrs(o);if(o.createFolders&&(parent=parentFolder(name)))folderAdd.call(this,parent,true);if(o.dir||data===null||typeof data==="undefined"){o.base64=false;o.binary=false;data=null}else if(dataType==="string"){if(o.binary&&!o.base64)if(o.optimizedBinaryString!==true)data=utils.string2binary(data)}else{o.base64=false;o.binary=true;if(!dataType&&!(data instanceof CompressedObject))throw new Error("The data of '"+name+"' is in an unsupported format !");
if(dataType==="arraybuffer")data=utils.transformTo("uint8array",data)}var object=new ZipObject(name,data,o);this.files[name]=object;return object};var parentFolder=function(path){if(path.slice(-1)=="/")path=path.substring(0,path.length-1);var lastSlash=path.lastIndexOf("/");return lastSlash>0?path.substring(0,lastSlash):""};var folderAdd=function(name,createFolders){if(name.slice(-1)!="/")name+="/";createFolders=typeof createFolders!=="undefined"?createFolders:false;if(!this.files[name])fileAdd.call(this,
name,null,{dir:true,createFolders:createFolders});return this.files[name]};var generateCompressedObjectFrom=function(file,compression){var result=new CompressedObject,content;if(file._data instanceof CompressedObject){result.uncompressedSize=file._data.uncompressedSize;result.crc32=file._data.crc32;if(result.uncompressedSize===0||file.dir){compression=compressions["STORE"];result.compressedContent="";result.crc32=0}else if(file._data.compressionMethod===compression.magic)result.compressedContent=
file._data.getCompressedContent();else{content=file._data.getContent();result.compressedContent=compression.compress(utils.transformTo(compression.compressInputType,content))}}else{content=getBinaryData(file);if(!content||content.length===0||file.dir){compression=compressions["STORE"];content=""}result.uncompressedSize=content.length;result.crc32=crc32(content);result.compressedContent=compression.compress(utils.transformTo(compression.compressInputType,content))}result.compressedSize=result.compressedContent.length;
result.compressionMethod=compression.magic;return result};var generateZipParts=function(name,file,compressedObject,offset){var utfEncodedFileName=utils.transformTo("string",utf8.utf8encode(file.name)),comment=file.comment||"",utfEncodedComment=utils.transformTo("string",utf8.utf8encode(comment)),useUTF8ForFileName=utfEncodedFileName.length!==file.name.length,useUTF8ForComment=utfEncodedComment.length!==comment.length,o=file.options,dosTime,dosDate,extraFields="",unicodePathExtraField="",unicodeCommentExtraField=
"",dir,date;if(file._initialMetadata.dir!==file.dir)dir=file.dir;else dir=o.dir;if(file._initialMetadata.date!==file.date)date=file.date;else date=o.date;dosTime=date.getHours();dosTime=dosTime<<6;dosTime=dosTime|date.getMinutes();dosTime=dosTime<<5;dosTime=dosTime|date.getSeconds()/2;dosDate=date.getFullYear()-1980;dosDate=dosDate<<4;dosDate=dosDate|date.getMonth()+1;dosDate=dosDate<<5;dosDate=dosDate|date.getDate();if(useUTF8ForFileName){unicodePathExtraField=decToHex(1,1)+decToHex(crc32(utfEncodedFileName),
4)+utfEncodedFileName;extraFields+="up"+decToHex(unicodePathExtraField.length,2)+unicodePathExtraField}if(useUTF8ForComment){unicodeCommentExtraField=decToHex(1,1)+decToHex(this.crc32(utfEncodedComment),4)+utfEncodedComment;extraFields+="uc"+decToHex(unicodeCommentExtraField.length,2)+unicodeCommentExtraField}var header="";header+="\n\x00";header+=useUTF8ForFileName||useUTF8ForComment?"\x00\b":"\x00\x00";header+=compressedObject.compressionMethod;header+=decToHex(dosTime,2);header+=decToHex(dosDate,
2);header+=decToHex(compressedObject.crc32,4);header+=decToHex(compressedObject.compressedSize,4);header+=decToHex(compressedObject.uncompressedSize,4);header+=decToHex(utfEncodedFileName.length,2);header+=decToHex(extraFields.length,2);var fileRecord=signature.LOCAL_FILE_HEADER+header+utfEncodedFileName+extraFields;var dirRecord=signature.CENTRAL_FILE_HEADER+"\u0014\x00"+header+decToHex(utfEncodedComment.length,2)+"\x00\x00"+"\x00\x00"+(dir===true?"\u0010\x00\x00\x00":"\x00\x00\x00\x00")+decToHex(offset,
4)+utfEncodedFileName+extraFields+utfEncodedComment;return{fileRecord:fileRecord,dirRecord:dirRecord,compressedObject:compressedObject}};var out={load:function(stream,options){throw new Error("Load method is not defined. Is the file jszip-load.js included ?");},filter:function(search){var result=[],filename,relativePath,file,fileClone;for(filename in this.files){if(!this.files.hasOwnProperty(filename))continue;file=this.files[filename];fileClone=new ZipObject(file.name,file._data,extend(file.options));
relativePath=filename.slice(this.root.length,filename.length);if(filename.slice(0,this.root.length)===this.root&&search(relativePath,fileClone))result.push(fileClone)}return result},file:function(name,data,o){if(arguments.length===1)if(utils.isRegExp(name)){var regexp=name;return this.filter(function(relativePath,file){return!file.dir&&regexp.test(relativePath)})}else return this.filter(function(relativePath,file){return!file.dir&&relativePath===name})[0]||null;else{name=this.root+name;fileAdd.call(this,
name,data,o)}return this},folder:function(arg){if(!arg)return this;if(utils.isRegExp(arg))return this.filter(function(relativePath,file){return file.dir&&arg.test(relativePath)});var name=this.root+arg;var newFolder=folderAdd.call(this,name);var ret=this.clone();ret.root=newFolder.name;return ret},remove:function(name){name=this.root+name;var file=this.files[name];if(!file){if(name.slice(-1)!="/")name+="/";file=this.files[name]}if(file&&!file.dir)delete this.files[name];else{var kids=this.filter(function(relativePath,
file){return file.name.slice(0,name.length)===name});for(var i=0;i<kids.length;i++)delete this.files[kids[i].name]}return this},generate:function(options){options=extend(options||{},{base64:true,compression:"STORE",type:"base64",comment:null});utils.checkSupport(options.type);var zipData=[],localDirLength=0,centralDirLength=0,writer,i,utfEncodedComment=utils.transformTo("string",this.utf8encode(options.comment||this.comment||""));for(var name in this.files){if(!this.files.hasOwnProperty(name))continue;
var file=this.files[name];var compressionName=file.options.compression||options.compression.toUpperCase();var compression=compressions[compressionName];if(!compression)throw new Error(compressionName+" is not a valid compression method !");var compressedObject=generateCompressedObjectFrom.call(this,file,compression);var zipPart=generateZipParts.call(this,name,file,compressedObject,localDirLength);localDirLength+=zipPart.fileRecord.length+compressedObject.compressedSize;centralDirLength+=zipPart.dirRecord.length;
zipData.push(zipPart)}var dirEnd="";dirEnd=signature.CENTRAL_DIRECTORY_END+"\x00\x00"+"\x00\x00"+decToHex(zipData.length,2)+decToHex(zipData.length,2)+decToHex(centralDirLength,4)+decToHex(localDirLength,4)+decToHex(utfEncodedComment.length,2)+utfEncodedComment;var typeName=options.type.toLowerCase();if(typeName==="uint8array"||typeName==="arraybuffer"||typeName==="blob"||typeName==="nodebuffer")writer=new Uint8ArrayWriter(localDirLength+centralDirLength+dirEnd.length);else writer=new StringWriter(localDirLength+
centralDirLength+dirEnd.length);for(i=0;i<zipData.length;i++){writer.append(zipData[i].fileRecord);writer.append(zipData[i].compressedObject.compressedContent)}for(i=0;i<zipData.length;i++)writer.append(zipData[i].dirRecord);writer.append(dirEnd);var zip=writer.finalize();switch(options.type.toLowerCase()){case "uint8array":case "arraybuffer":case "nodebuffer":return utils.transformTo(options.type.toLowerCase(),zip);case "blob":return utils.arrayBuffer2Blob(utils.transformTo("arraybuffer",zip));case "base64":return options.base64?
base64.encode(zip):zip;default:return zip}},crc32:function(input,crc){return crc32(input,crc)},utf8encode:function(string){return utils.transformTo("string",utf8.utf8encode(string))},utf8decode:function(input){return utf8.utf8decode(input)}};module.exports=out},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(_dereq_,module,exports){exports.LOCAL_FILE_HEADER=
"PK\u0003\u0004";exports.CENTRAL_FILE_HEADER="PK\u0001\u0002";exports.CENTRAL_DIRECTORY_END="PK\u0005\u0006";exports.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\u0006\u0007";exports.ZIP64_CENTRAL_DIRECTORY_END="PK\u0006\u0006";exports.DATA_DESCRIPTOR="PK\u0007\b"},{}],15:[function(_dereq_,module,exports){var DataReader=_dereq_("./dataReader");var utils=_dereq_("./utils");function StringReader(data,optimizedBinaryString){this.data=data;if(!optimizedBinaryString)this.data=utils.string2binary(this.data);this.length=
this.data.length;this.index=0}StringReader.prototype=new DataReader;StringReader.prototype.byteAt=function(i){return this.data.charCodeAt(i)};StringReader.prototype.lastIndexOfSignature=function(sig){return this.data.lastIndexOf(sig)};StringReader.prototype.readData=function(size){this.checkOffset(size);var result=this.data.slice(this.index,this.index+size);this.index+=size;return result};module.exports=StringReader},{"./dataReader":5,"./utils":21}],16:[function(_dereq_,module,exports){var utils=
_dereq_("./utils");var StringWriter=function(){this.data=[]};StringWriter.prototype={append:function(input){input=utils.transformTo("string",input);this.data.push(input)},finalize:function(){return this.data.join("")}};module.exports=StringWriter},{"./utils":21}],17:[function(_dereq_,module,exports){(function(Buffer){exports.base64=true;exports.array=true;exports.string=true;exports.arraybuffer=typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined";exports.nodebuffer=typeof Buffer!=="undefined";
exports.uint8array=typeof Uint8Array!=="undefined";if(typeof ArrayBuffer==="undefined")exports.blob=false;else{var buffer=new ArrayBuffer(0);try{exports.blob=(new Blob([buffer],{type:"application/zip"})).size===0}catch(e$0){try{var Builder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;var builder=new Builder;builder.append(buffer);exports.blob=builder.getBlob("application/zip").size===0}catch(e){exports.blob=false}}}}).call(this,typeof Buffer!=="undefined"?
Buffer:undefined)},{}],18:[function(_dereq_,module,exports){var DataReader=_dereq_("./dataReader");function Uint8ArrayReader(data){if(data){this.data=data;this.length=this.data.length;this.index=0}}Uint8ArrayReader.prototype=new DataReader;Uint8ArrayReader.prototype.byteAt=function(i){return this.data[i]};Uint8ArrayReader.prototype.lastIndexOfSignature=function(sig){var sig0=sig.charCodeAt(0),sig1=sig.charCodeAt(1),sig2=sig.charCodeAt(2),sig3=sig.charCodeAt(3);for(var i=this.length-4;i>=0;--i)if(this.data[i]===
sig0&&this.data[i+1]===sig1&&this.data[i+2]===sig2&&this.data[i+3]===sig3)return i;return-1};Uint8ArrayReader.prototype.readData=function(size){this.checkOffset(size);if(size===0)return new Uint8Array(0);var result=this.data.subarray(this.index,this.index+size);this.index+=size;return result};module.exports=Uint8ArrayReader},{"./dataReader":5}],19:[function(_dereq_,module,exports){var utils=_dereq_("./utils");var Uint8ArrayWriter=function(length){this.data=new Uint8Array(length);this.index=0};Uint8ArrayWriter.prototype=
{append:function(input){if(input.length!==0){input=utils.transformTo("uint8array",input);this.data.set(input,this.index);this.index+=input.length}},finalize:function(){return this.data}};module.exports=Uint8ArrayWriter},{"./utils":21}],20:[function(_dereq_,module,exports){var utils=_dereq_("./utils");var support=_dereq_("./support");var nodeBuffer=_dereq_("./nodeBuffer");var _utf8len=new Array(256);for(var i=0;i<256;i++)_utf8len[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;_utf8len[254]=_utf8len[254]=
1;var string2buf=function(str){var buf,c,c2,m_pos,i,str_len=str.length,buf_len=0;for(m_pos=0;m_pos<str_len;m_pos++){c=str.charCodeAt(m_pos);if((c&64512)===55296&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+1);if((c2&64512)===56320){c=65536+(c-55296<<10)+(c2-56320);m_pos++}}buf_len+=c<128?1:c<2048?2:c<65536?3:4}if(support.uint8array)buf=new Uint8Array(buf_len);else buf=new Array(buf_len);for(i=0,m_pos=0;i<buf_len;m_pos++){c=str.charCodeAt(m_pos);if((c&64512)===55296&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+
1);if((c2&64512)===56320){c=65536+(c-55296<<10)+(c2-56320);m_pos++}}if(c<128)buf[i++]=c;else if(c<2048){buf[i++]=192|c>>>6;buf[i++]=128|c&63}else if(c<65536){buf[i++]=224|c>>>12;buf[i++]=128|c>>>6&63;buf[i++]=128|c&63}else{buf[i++]=240|c>>>18;buf[i++]=128|c>>>12&63;buf[i++]=128|c>>>6&63;buf[i++]=128|c&63}}return buf};var utf8border=function(buf,max){var pos;max=max||buf.length;if(max>buf.length)max=buf.length;pos=max-1;while(pos>=0&&(buf[pos]&192)===128)pos--;if(pos<0)return max;if(pos===0)return max;
return pos+_utf8len[buf[pos]]>max?pos:max};var buf2string=function(buf){var i,out,c,c_len;var len=buf.length;var utf16buf=new Array(len*2);for(out=0,i=0;i<len;){c=buf[i++];if(c<128){utf16buf[out++]=c;continue}c_len=_utf8len[c];if(c_len>4){utf16buf[out++]=65533;i+=c_len-1;continue}c&=c_len===2?31:c_len===3?15:7;while(c_len>1&&i<len){c=c<<6|buf[i++]&63;c_len--}if(c_len>1){utf16buf[out++]=65533;continue}if(c<65536)utf16buf[out++]=c;else{c-=65536;utf16buf[out++]=55296|c>>10&1023;utf16buf[out++]=56320|
c&1023}}if(utf16buf.length!==out)if(utf16buf.subarray)utf16buf=utf16buf.subarray(0,out);else utf16buf.length=out;return utils.applyFromCharCode(utf16buf)};exports.utf8encode=function utf8encode(str){if(support.nodebuffer)return nodeBuffer(str,"utf-8");return string2buf(str)};exports.utf8decode=function utf8decode(buf){if(support.nodebuffer)return utils.transformTo("nodebuffer",buf).toString("utf-8");buf=utils.transformTo(support.uint8array?"uint8array":"array",buf);var result=[],k=0,len=buf.length,
chunk=65536;while(k<len){var nextBoundary=utf8border(buf,Math.min(k+chunk,len));if(support.uint8array)result.push(buf2string(buf.subarray(k,nextBoundary)));else result.push(buf2string(buf.slice(k,nextBoundary)));k=nextBoundary}return result.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(_dereq_,module,exports){var support=_dereq_("./support");var compressions=_dereq_("./compressions");var nodeBuffer=_dereq_("./nodeBuffer");exports.string2binary=function(str){var result="";
for(var i=0;i<str.length;i++)result+=String.fromCharCode(str.charCodeAt(i)&255);return result};exports.arrayBuffer2Blob=function(buffer){exports.checkSupport("blob");try{return new Blob([buffer],{type:"application/zip"})}catch(e$1){try{var Builder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;var builder=new Builder;builder.append(buffer);return builder.getBlob("application/zip")}catch(e){throw new Error("Bug : can't construct the Blob.");}}};function identity(input){return input}
function stringToArrayLike(str,array){for(var i=0;i<str.length;++i)array[i]=str.charCodeAt(i)&255;return array}function arrayLikeToString(array){var chunk=65536;var result=[],len=array.length,type=exports.getTypeOf(array),k=0,canUseApply=true;try{switch(type){case "uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case "nodebuffer":String.fromCharCode.apply(null,nodeBuffer(0));break}}catch(e){canUseApply=false}if(!canUseApply){var resultStr="";for(var i=0;i<array.length;i++)resultStr+=
String.fromCharCode(array[i]);return resultStr}while(k<len&&chunk>1)try{if(type==="array"||type==="nodebuffer")result.push(String.fromCharCode.apply(null,array.slice(k,Math.min(k+chunk,len))));else result.push(String.fromCharCode.apply(null,array.subarray(k,Math.min(k+chunk,len))));k+=chunk}catch(e$2){chunk=Math.floor(chunk/2)}return result.join("")}exports.applyFromCharCode=arrayLikeToString;function arrayLikeToArrayLike(arrayFrom,arrayTo){for(var i=0;i<arrayFrom.length;i++)arrayTo[i]=arrayFrom[i];
return arrayTo}var transform={};transform["string"]={"string":identity,"array":function(input){return stringToArrayLike(input,new Array(input.length))},"arraybuffer":function(input){return transform["string"]["uint8array"](input).buffer},"uint8array":function(input){return stringToArrayLike(input,new Uint8Array(input.length))},"nodebuffer":function(input){return stringToArrayLike(input,nodeBuffer(input.length))}};transform["array"]={"string":arrayLikeToString,"array":identity,"arraybuffer":function(input){return(new Uint8Array(input)).buffer},
"uint8array":function(input){return new Uint8Array(input)},"nodebuffer":function(input){return nodeBuffer(input)}};transform["arraybuffer"]={"string":function(input){return arrayLikeToString(new Uint8Array(input))},"array":function(input){return arrayLikeToArrayLike(new Uint8Array(input),new Array(input.byteLength))},"arraybuffer":identity,"uint8array":function(input){return new Uint8Array(input)},"nodebuffer":function(input){return nodeBuffer(new Uint8Array(input))}};transform["uint8array"]={"string":arrayLikeToString,
"array":function(input){return arrayLikeToArrayLike(input,new Array(input.length))},"arraybuffer":function(input){return input.buffer},"uint8array":identity,"nodebuffer":function(input){return nodeBuffer(input)}};transform["nodebuffer"]={"string":arrayLikeToString,"array":function(input){return arrayLikeToArrayLike(input,new Array(input.length))},"arraybuffer":function(input){return transform["nodebuffer"]["uint8array"](input).buffer},"uint8array":function(input){return arrayLikeToArrayLike(input,
new Uint8Array(input.length))},"nodebuffer":identity};exports.transformTo=function(outputType,input){if(!input)input="";if(!outputType)return input;exports.checkSupport(outputType);var inputType=exports.getTypeOf(input);var result=transform[inputType][outputType](input);return result};exports.getTypeOf=function(input){if(typeof input==="string")return"string";if(Object.prototype.toString.call(input)==="[object Array]")return"array";if(support.nodebuffer&&nodeBuffer.test(input))return"nodebuffer";
if(support.uint8array&&input instanceof Uint8Array)return"uint8array";if(support.arraybuffer&&input instanceof ArrayBuffer)return"arraybuffer"};exports.checkSupport=function(type){var supported=support[type.toLowerCase()];if(!supported)throw new Error(type+" is not supported by this browser");};exports.MAX_VALUE_16BITS=65535;exports.MAX_VALUE_32BITS=-1;exports.pretty=function(str){var res="",code,i;for(i=0;i<(str||"").length;i++){code=str.charCodeAt(i);res+="\\x"+(code<16?"0":"")+code.toString(16).toUpperCase()}return res};
exports.findCompression=function(compressionMethod){for(var method in compressions){if(!compressions.hasOwnProperty(method))continue;if(compressions[method].magic===compressionMethod)return compressions[method]}return null};exports.isRegExp=function(object){return Object.prototype.toString.call(object)==="[object RegExp]"}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(_dereq_,module,exports){var StringReader=_dereq_("./stringReader");var NodeBufferReader=_dereq_("./nodeBufferReader");
var Uint8ArrayReader=_dereq_("./uint8ArrayReader");var utils=_dereq_("./utils");var sig=_dereq_("./signature");var ZipEntry=_dereq_("./zipEntry");var support=_dereq_("./support");var jszipProto=_dereq_("./object");function ZipEntries(data,loadOptions){this.files=[];this.loadOptions=loadOptions;if(data)this.load(data)}ZipEntries.prototype={checkSignature:function(expectedSignature){var signature=this.reader.readString(4);if(signature!==expectedSignature)throw new Error("Corrupted zip or bug : unexpected signature "+
"("+utils.pretty(signature)+", expected "+utils.pretty(expectedSignature)+")");},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2);this.diskWithCentralDirStart=this.reader.readInt(2);this.centralDirRecordsOnThisDisk=this.reader.readInt(2);this.centralDirRecords=this.reader.readInt(2);this.centralDirSize=this.reader.readInt(4);this.centralDirOffset=this.reader.readInt(4);this.zipCommentLength=this.reader.readInt(2);this.zipComment=this.reader.readString(this.zipCommentLength);
this.zipComment=jszipProto.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8);this.versionMadeBy=this.reader.readString(2);this.versionNeeded=this.reader.readInt(2);this.diskNumber=this.reader.readInt(4);this.diskWithCentralDirStart=this.reader.readInt(4);this.centralDirRecordsOnThisDisk=this.reader.readInt(8);this.centralDirRecords=this.reader.readInt(8);this.centralDirSize=this.reader.readInt(8);this.centralDirOffset=this.reader.readInt(8);
this.zip64ExtensibleData={};var extraDataSize=this.zip64EndOfCentralSize-44,index=0,extraFieldId,extraFieldLength,extraFieldValue;while(index<extraDataSize){extraFieldId=this.reader.readInt(2);extraFieldLength=this.reader.readInt(4);extraFieldValue=this.reader.readString(extraFieldLength);this.zip64ExtensibleData[extraFieldId]={id:extraFieldId,length:extraFieldLength,value:extraFieldValue}}},readBlockZip64EndOfCentralLocator:function(){this.diskWithZip64CentralDirStart=this.reader.readInt(4);this.relativeOffsetEndOfZip64CentralDir=
this.reader.readInt(8);this.disksCount=this.reader.readInt(4);if(this.disksCount>1)throw new Error("Multi-volumes zip are not supported");},readLocalFiles:function(){var i,file;for(i=0;i<this.files.length;i++){file=this.files[i];this.reader.setIndex(file.localHeaderOffset);this.checkSignature(sig.LOCAL_FILE_HEADER);file.readLocalPart(this.reader);file.handleUTF8()}},readCentralDir:function(){var file;this.reader.setIndex(this.centralDirOffset);while(this.reader.readString(4)===sig.CENTRAL_FILE_HEADER){file=
new ZipEntry({zip64:this.zip64},this.loadOptions);file.readCentralPart(this.reader);this.files.push(file)}},readEndOfCentral:function(){var offset=this.reader.lastIndexOfSignature(sig.CENTRAL_DIRECTORY_END);if(offset===-1)throw new Error("Corrupted zip : can't find end of central directory");this.reader.setIndex(offset);this.checkSignature(sig.CENTRAL_DIRECTORY_END);this.readBlockEndOfCentral();if(this.diskNumber===utils.MAX_VALUE_16BITS||this.diskWithCentralDirStart===utils.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===
utils.MAX_VALUE_16BITS||this.centralDirRecords===utils.MAX_VALUE_16BITS||this.centralDirSize===utils.MAX_VALUE_32BITS||this.centralDirOffset===utils.MAX_VALUE_32BITS){this.zip64=true;offset=this.reader.lastIndexOfSignature(sig.ZIP64_CENTRAL_DIRECTORY_LOCATOR);if(offset===-1)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(offset);this.checkSignature(sig.ZIP64_CENTRAL_DIRECTORY_LOCATOR);this.readBlockZip64EndOfCentralLocator();this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir);
this.checkSignature(sig.ZIP64_CENTRAL_DIRECTORY_END);this.readBlockZip64EndOfCentral()}},prepareReader:function(data){var type=utils.getTypeOf(data);if(type==="string"&&!support.uint8array)this.reader=new StringReader(data,this.loadOptions.optimizedBinaryString);else if(type==="nodebuffer")this.reader=new NodeBufferReader(data);else this.reader=new Uint8ArrayReader(utils.transformTo("uint8array",data))},load:function(data){this.prepareReader(data);this.readEndOfCentral();this.readCentralDir();this.readLocalFiles()}};
module.exports=ZipEntries},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(_dereq_,module,exports){var StringReader=_dereq_("./stringReader");var utils=_dereq_("./utils");var CompressedObject=_dereq_("./compressedObject");var jszipProto=_dereq_("./object");function ZipEntry(options,loadOptions){this.options=options;this.loadOptions=loadOptions}ZipEntry.prototype={isEncrypted:function(){return(this.bitFlag&
1)===1},useUTF8:function(){return(this.bitFlag&2048)===2048},prepareCompressedContent:function(reader,from,length){return function(){var previousIndex=reader.index;reader.setIndex(from);var compressedFileData=reader.readData(length);reader.setIndex(previousIndex);return compressedFileData}},prepareContent:function(reader,from,length,compression,uncompressedSize){return function(){var compressedFileData=utils.transformTo(compression.uncompressInputType,this.getCompressedContent());var uncompressedFileData=
compression.uncompress(compressedFileData);if(uncompressedFileData.length!==uncompressedSize)throw new Error("Bug : uncompressed data size mismatch");return uncompressedFileData}},readLocalPart:function(reader){var compression,localExtraFieldsLength;reader.skip(22);this.fileNameLength=reader.readInt(2);localExtraFieldsLength=reader.readInt(2);this.fileName=reader.readString(this.fileNameLength);reader.skip(localExtraFieldsLength);if(this.compressedSize==-1||this.uncompressedSize==-1)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory "+
"(compressedSize == -1 || uncompressedSize == -1)");compression=utils.findCompression(this.compressionMethod);if(compression===null)throw new Error("Corrupted zip : compression "+utils.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");this.decompressed=new CompressedObject;this.decompressed.compressedSize=this.compressedSize;this.decompressed.uncompressedSize=this.uncompressedSize;this.decompressed.crc32=this.crc32;this.decompressed.compressionMethod=this.compressionMethod;
this.decompressed.getCompressedContent=this.prepareCompressedContent(reader,reader.index,this.compressedSize,compression);this.decompressed.getContent=this.prepareContent(reader,reader.index,this.compressedSize,compression,this.uncompressedSize);if(this.loadOptions.checkCRC32){this.decompressed=utils.transformTo("string",this.decompressed.getContent());if(jszipProto.crc32(this.decompressed)!==this.crc32)throw new Error("Corrupted zip : CRC32 mismatch");}},readCentralPart:function(reader){this.versionMadeBy=
reader.readString(2);this.versionNeeded=reader.readInt(2);this.bitFlag=reader.readInt(2);this.compressionMethod=reader.readString(2);this.date=reader.readDate();this.crc32=reader.readInt(4);this.compressedSize=reader.readInt(4);this.uncompressedSize=reader.readInt(4);this.fileNameLength=reader.readInt(2);this.extraFieldsLength=reader.readInt(2);this.fileCommentLength=reader.readInt(2);this.diskNumberStart=reader.readInt(2);this.internalFileAttributes=reader.readInt(2);this.externalFileAttributes=
reader.readInt(4);this.localHeaderOffset=reader.readInt(4);if(this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=reader.readString(this.fileNameLength);this.readExtraFields(reader);this.parseZIP64ExtraField(reader);this.fileComment=reader.readString(this.fileCommentLength);this.dir=this.externalFileAttributes&16?true:false},parseZIP64ExtraField:function(reader){if(!this.extraFields[1])return;var extraReader=new StringReader(this.extraFields[1].value);if(this.uncompressedSize===
utils.MAX_VALUE_32BITS)this.uncompressedSize=extraReader.readInt(8);if(this.compressedSize===utils.MAX_VALUE_32BITS)this.compressedSize=extraReader.readInt(8);if(this.localHeaderOffset===utils.MAX_VALUE_32BITS)this.localHeaderOffset=extraReader.readInt(8);if(this.diskNumberStart===utils.MAX_VALUE_32BITS)this.diskNumberStart=extraReader.readInt(4)},readExtraFields:function(reader){var start=reader.index,extraFieldId,extraFieldLength,extraFieldValue;this.extraFields=this.extraFields||{};while(reader.index<
start+this.extraFieldsLength){extraFieldId=reader.readInt(2);extraFieldLength=reader.readInt(2);extraFieldValue=reader.readString(extraFieldLength);this.extraFields[extraFieldId]={id:extraFieldId,length:extraFieldLength,value:extraFieldValue}}},handleUTF8:function(){if(this.useUTF8()){this.fileName=jszipProto.utf8decode(this.fileName);this.fileComment=jszipProto.utf8decode(this.fileComment)}else{var upath=this.findExtraFieldUnicodePath();if(upath!==null)this.fileName=upath;var ucomment=this.findExtraFieldUnicodeComment();
if(ucomment!==null)this.fileComment=ucomment}},findExtraFieldUnicodePath:function(){var upathField=this.extraFields[28789];if(upathField){var extraReader=new StringReader(upathField.value);if(extraReader.readInt(1)!==1)return null;if(jszipProto.crc32(this.fileName)!==extraReader.readInt(4))return null;return jszipProto.utf8decode(extraReader.readString(upathField.length-5))}return null},findExtraFieldUnicodeComment:function(){var ucommentField=this.extraFields[25461];if(ucommentField){var extraReader=
new StringReader(ucommentField.value);if(extraReader.readInt(1)!==1)return null;if(jszipProto.crc32(this.fileComment)!==extraReader.readInt(4))return null;return jszipProto.utf8decode(extraReader.readString(ucommentField.length-5))}return null}};module.exports=ZipEntry},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(_dereq_,module,exports){var assign=_dereq_("./lib/utils/common").assign;var deflate=_dereq_("./lib/deflate");var inflate=_dereq_("./lib/inflate");
var constants=_dereq_("./lib/zlib/constants");var pako={};assign(pako,deflate,inflate,constants);module.exports=pako},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(_dereq_,module,exports){var zlib_deflate=_dereq_("./zlib/deflate.js");var utils=_dereq_("./utils/common");var strings=_dereq_("./utils/strings");var msg=_dereq_("./zlib/messages");var zstream=_dereq_("./zlib/zstream");var Z_NO_FLUSH=0;var Z_FINISH=4;var Z_OK=0;var Z_STREAM_END=1;
var Z_DEFAULT_COMPRESSION=-1;var Z_DEFAULT_STRATEGY=0;var Z_DEFLATED=8;var Deflate=function(options){this.options=utils.assign({level:Z_DEFAULT_COMPRESSION,method:Z_DEFLATED,chunkSize:16384,windowBits:15,memLevel:8,strategy:Z_DEFAULT_STRATEGY,to:""},options||{});var opt=this.options;if(opt.raw&&opt.windowBits>0)opt.windowBits=-opt.windowBits;else if(opt.gzip&&opt.windowBits>0&&opt.windowBits<16)opt.windowBits+=16;this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new zstream;this.strm.avail_out=
0;var status=zlib_deflate.deflateInit2(this.strm,opt.level,opt.method,opt.windowBits,opt.memLevel,opt.strategy);if(status!==Z_OK)throw new Error(msg[status]);if(opt.header)zlib_deflate.deflateSetHeader(this.strm,opt.header)};Deflate.prototype.push=function(data,mode){var strm=this.strm;var chunkSize=this.options.chunkSize;var status,_mode;if(this.ended)return false;_mode=mode===~~mode?mode:mode===true?Z_FINISH:Z_NO_FLUSH;if(typeof data==="string")strm.input=strings.string2buf(data);else strm.input=
data;strm.next_in=0;strm.avail_in=strm.input.length;do{if(strm.avail_out===0){strm.output=new utils.Buf8(chunkSize);strm.next_out=0;strm.avail_out=chunkSize}status=zlib_deflate.deflate(strm,_mode);if(status!==Z_STREAM_END&&status!==Z_OK){this.onEnd(status);this.ended=true;return false}if(strm.avail_out===0||strm.avail_in===0&&_mode===Z_FINISH)if(this.options.to==="string")this.onData(strings.buf2binstring(utils.shrinkBuf(strm.output,strm.next_out)));else this.onData(utils.shrinkBuf(strm.output,strm.next_out))}while((strm.avail_in>
0||strm.avail_out===0)&&status!==Z_STREAM_END);if(_mode===Z_FINISH){status=zlib_deflate.deflateEnd(this.strm);this.onEnd(status);this.ended=true;return status===Z_OK}return true};Deflate.prototype.onData=function(chunk){this.chunks.push(chunk)};Deflate.prototype.onEnd=function(status){if(status===Z_OK)if(this.options.to==="string")this.result=this.chunks.join("");else this.result=utils.flattenChunks(this.chunks);this.chunks=[];this.err=status;this.msg=this.strm.msg};function deflate(input,options){var deflator=
new Deflate(options);deflator.push(input,true);if(deflator.err)throw deflator.msg;return deflator.result}function deflateRaw(input,options){options=options||{};options.raw=true;return deflate(input,options)}function gzip(input,options){options=options||{};options.gzip=true;return deflate(input,options)}exports.Deflate=Deflate;exports.deflate=deflate;exports.deflateRaw=deflateRaw;exports.gzip=gzip},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],
26:[function(_dereq_,module,exports){var zlib_inflate=_dereq_("./zlib/inflate.js");var utils=_dereq_("./utils/common");var strings=_dereq_("./utils/strings");var c=_dereq_("./zlib/constants");var msg=_dereq_("./zlib/messages");var zstream=_dereq_("./zlib/zstream");var gzheader=_dereq_("./zlib/gzheader");var Inflate=function(options){this.options=utils.assign({chunkSize:16384,windowBits:0,to:""},options||{});var opt=this.options;if(opt.raw&&opt.windowBits>=0&&opt.windowBits<16){opt.windowBits=-opt.windowBits;
if(opt.windowBits===0)opt.windowBits=-15}if(opt.windowBits>=0&&opt.windowBits<16&&!(options&&options.windowBits))opt.windowBits+=32;if(opt.windowBits>15&&opt.windowBits<48)if((opt.windowBits&15)===0)opt.windowBits|=15;this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new zstream;this.strm.avail_out=0;var status=zlib_inflate.inflateInit2(this.strm,opt.windowBits);if(status!==c.Z_OK)throw new Error(msg[status]);this.header=new gzheader;zlib_inflate.inflateGetHeader(this.strm,this.header)};
Inflate.prototype.push=function(data,mode){var strm=this.strm;var chunkSize=this.options.chunkSize;var status,_mode;var next_out_utf8,tail,utf8str;if(this.ended)return false;_mode=mode===~~mode?mode:mode===true?c.Z_FINISH:c.Z_NO_FLUSH;if(typeof data==="string")strm.input=strings.binstring2buf(data);else strm.input=data;strm.next_in=0;strm.avail_in=strm.input.length;do{if(strm.avail_out===0){strm.output=new utils.Buf8(chunkSize);strm.next_out=0;strm.avail_out=chunkSize}status=zlib_inflate.inflate(strm,
c.Z_NO_FLUSH);if(status!==c.Z_STREAM_END&&status!==c.Z_OK){this.onEnd(status);this.ended=true;return false}if(strm.next_out)if(strm.avail_out===0||status===c.Z_STREAM_END||strm.avail_in===0&&_mode===c.Z_FINISH)if(this.options.to==="string"){next_out_utf8=strings.utf8border(strm.output,strm.next_out);tail=strm.next_out-next_out_utf8;utf8str=strings.buf2string(strm.output,next_out_utf8);strm.next_out=tail;strm.avail_out=chunkSize-tail;if(tail)utils.arraySet(strm.output,strm.output,next_out_utf8,tail,
0);this.onData(utf8str)}else this.onData(utils.shrinkBuf(strm.output,strm.next_out))}while(strm.avail_in>0&&status!==c.Z_STREAM_END);if(status===c.Z_STREAM_END)_mode=c.Z_FINISH;if(_mode===c.Z_FINISH){status=zlib_inflate.inflateEnd(this.strm);this.onEnd(status);this.ended=true;return status===c.Z_OK}return true};Inflate.prototype.onData=function(chunk){this.chunks.push(chunk)};Inflate.prototype.onEnd=function(status){if(status===c.Z_OK)if(this.options.to==="string")this.result=this.chunks.join("");
else this.result=utils.flattenChunks(this.chunks);this.chunks=[];this.err=status;this.msg=this.strm.msg};function inflate(input,options){var inflator=new Inflate(options);inflator.push(input,true);if(inflator.err)throw inflator.msg;return inflator.result}function inflateRaw(input,options){options=options||{};options.raw=true;return inflate(input,options)}exports.Inflate=Inflate;exports.inflate=inflate;exports.inflateRaw=inflateRaw;exports.ungzip=inflate},{"./utils/common":27,"./utils/strings":28,
"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(_dereq_,module,exports){var TYPED_OK=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Int32Array!=="undefined";exports.assign=function(obj){var sources=Array.prototype.slice.call(arguments,1);while(sources.length){var source=sources.shift();if(!source)continue;if(typeof source!=="object")throw new TypeError(source+"must be non-object");for(var p in source)if(source.hasOwnProperty(p))obj[p]=
source[p]}return obj};exports.shrinkBuf=function(buf,size){if(buf.length===size)return buf;if(buf.subarray)return buf.subarray(0,size);buf.length=size;return buf};var fnTyped={arraySet:function(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray){dest.set(src.subarray(src_offs,src_offs+len),dest_offs);return}for(var i=0;i<len;i++)dest[dest_offs+i]=src[src_offs+i]},flattenChunks:function(chunks){var i,l,len,pos,chunk,result;len=0;for(i=0,l=chunks.length;i<l;i++)len+=chunks[i].length;result=
new Uint8Array(len);pos=0;for(i=0,l=chunks.length;i<l;i++){chunk=chunks[i];result.set(chunk,pos);pos+=chunk.length}return result}};var fnUntyped={arraySet:function(dest,src,src_offs,len,dest_offs){for(var i=0;i<len;i++)dest[dest_offs+i]=src[src_offs+i]},flattenChunks:function(chunks){return[].concat.apply([],chunks)}};exports.setTyped=function(on){if(on){exports.Buf8=Uint8Array;exports.Buf16=Uint16Array;exports.Buf32=Int32Array;exports.assign(exports,fnTyped)}else{exports.Buf8=Array;exports.Buf16=
Array;exports.Buf32=Array;exports.assign(exports,fnUntyped)}};exports.setTyped(TYPED_OK)},{}],28:[function(_dereq_,module,exports){var utils=_dereq_("./common");var STR_APPLY_OK=true;var STR_APPLY_UIA_OK=true;try{String.fromCharCode.apply(null,[0])}catch(__){STR_APPLY_OK=false}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(__$3){STR_APPLY_UIA_OK=false}var _utf8len=new utils.Buf8(256);for(var i=0;i<256;i++)_utf8len[i]=i>=252?6:i>=248?5:i>=240?4:i>=224?3:i>=192?2:1;_utf8len[254]=_utf8len[254]=
1;exports.string2buf=function(str){var buf,c,c2,m_pos,i,str_len=str.length,buf_len=0;for(m_pos=0;m_pos<str_len;m_pos++){c=str.charCodeAt(m_pos);if((c&64512)===55296&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+1);if((c2&64512)===56320){c=65536+(c-55296<<10)+(c2-56320);m_pos++}}buf_len+=c<128?1:c<2048?2:c<65536?3:4}buf=new utils.Buf8(buf_len);for(i=0,m_pos=0;i<buf_len;m_pos++){c=str.charCodeAt(m_pos);if((c&64512)===55296&&m_pos+1<str_len){c2=str.charCodeAt(m_pos+1);if((c2&64512)===56320){c=65536+(c-55296<<
10)+(c2-56320);m_pos++}}if(c<128)buf[i++]=c;else if(c<2048){buf[i++]=192|c>>>6;buf[i++]=128|c&63}else if(c<65536){buf[i++]=224|c>>>12;buf[i++]=128|c>>>6&63;buf[i++]=128|c&63}else{buf[i++]=240|c>>>18;buf[i++]=128|c>>>12&63;buf[i++]=128|c>>>6&63;buf[i++]=128|c&63}}return buf};function buf2binstring(buf,len){if(len<65537)if(buf.subarray&&STR_APPLY_UIA_OK||!buf.subarray&&STR_APPLY_OK)return String.fromCharCode.apply(null,utils.shrinkBuf(buf,len));var result="";for(var i=0;i<len;i++)result+=String.fromCharCode(buf[i]);
return result}exports.buf2binstring=function(buf){return buf2binstring(buf,buf.length)};exports.binstring2buf=function(str){var buf=new utils.Buf8(str.length);for(var i=0,len=buf.length;i<len;i++)buf[i]=str.charCodeAt(i);return buf};exports.buf2string=function(buf,max){var i,out,c,c_len;var len=max||buf.length;var utf16buf=new Array(len*2);for(out=0,i=0;i<len;){c=buf[i++];if(c<128){utf16buf[out++]=c;continue}c_len=_utf8len[c];if(c_len>4){utf16buf[out++]=65533;i+=c_len-1;continue}c&=c_len===2?31:c_len===
3?15:7;while(c_len>1&&i<len){c=c<<6|buf[i++]&63;c_len--}if(c_len>1){utf16buf[out++]=65533;continue}if(c<65536)utf16buf[out++]=c;else{c-=65536;utf16buf[out++]=55296|c>>10&1023;utf16buf[out++]=56320|c&1023}}return buf2binstring(utf16buf,out)};exports.utf8border=function(buf,max){var pos;max=max||buf.length;if(max>buf.length)max=buf.length;pos=max-1;while(pos>=0&&(buf[pos]&192)===128)pos--;if(pos<0)return max;if(pos===0)return max;return pos+_utf8len[buf[pos]]>max?pos:max}},{"./common":27}],29:[function(_dereq_,
module,exports){function adler32(adler,buf,len,pos){var s1=adler&65535|0,s2=adler>>>16&65535|0,n=0;while(len!==0){n=len>2E3?2E3:len;len-=n;do{s1=s1+buf[pos++]|0;s2=s2+s1|0}while(--n);s1%=65521;s2%=65521}return s1|s2<<16|0}module.exports=adler32},{}],30:[function(_dereq_,module,exports){module.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,
Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(_dereq_,module,exports){function makeTable(){var c,table=[];for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++)c=c&1?3988292384^c>>>1:c>>>1;table[n]=c}return table}var crcTable=makeTable();function crc32(crc,buf,len,pos){var t=crcTable,end=pos+len;crc=crc^-1;for(var i=pos;i<end;i++)crc=crc>>>8^t[(crc^buf[i])&255];
return crc^-1}module.exports=crc32},{}],32:[function(_dereq_,module,exports){var utils=_dereq_("../utils/common");var trees=_dereq_("./trees");var adler32=_dereq_("./adler32");var crc32=_dereq_("./crc32");var msg=_dereq_("./messages");var Z_NO_FLUSH=0;var Z_PARTIAL_FLUSH=1;var Z_FULL_FLUSH=3;var Z_FINISH=4;var Z_BLOCK=5;var Z_OK=0;var Z_STREAM_END=1;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_BUF_ERROR=-5;var Z_DEFAULT_COMPRESSION=-1;var Z_FILTERED=1;var Z_HUFFMAN_ONLY=2;var Z_RLE=3;var Z_FIXED=
4;var Z_DEFAULT_STRATEGY=0;var Z_UNKNOWN=2;var Z_DEFLATED=8;var MAX_MEM_LEVEL=9;var MAX_WBITS=15;var DEF_MEM_LEVEL=8;var LENGTH_CODES=29;var LITERALS=256;var L_CODES=LITERALS+1+LENGTH_CODES;var D_CODES=30;var BL_CODES=19;var HEAP_SIZE=2*L_CODES+1;var MAX_BITS=15;var MIN_MATCH=3;var MAX_MATCH=258;var MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1;var PRESET_DICT=32;var INIT_STATE=42;var EXTRA_STATE=69;var NAME_STATE=73;var COMMENT_STATE=91;var HCRC_STATE=103;var BUSY_STATE=113;var FINISH_STATE=666;var BS_NEED_MORE=
1;var BS_BLOCK_DONE=2;var BS_FINISH_STARTED=3;var BS_FINISH_DONE=4;var OS_CODE=3;function err(strm,errorCode){strm.msg=msg[errorCode];return errorCode}function rank(f){return(f<<1)-(f>4?9:0)}function zero(buf){var len=buf.length;while(--len>=0)buf[len]=0}function flush_pending(strm){var s=strm.state;var len=s.pending;if(len>strm.avail_out)len=strm.avail_out;if(len===0)return;utils.arraySet(strm.output,s.pending_buf,s.pending_out,len,strm.next_out);strm.next_out+=len;s.pending_out+=len;strm.total_out+=
len;strm.avail_out-=len;s.pending-=len;if(s.pending===0)s.pending_out=0}function flush_block_only(s,last){trees._tr_flush_block(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,last);s.block_start=s.strstart;flush_pending(s.strm)}function put_byte(s,b){s.pending_buf[s.pending++]=b}function putShortMSB(s,b){s.pending_buf[s.pending++]=b>>>8&255;s.pending_buf[s.pending++]=b&255}function read_buf(strm,buf,start,size){var len=strm.avail_in;if(len>size)len=size;if(len===0)return 0;strm.avail_in-=
len;utils.arraySet(buf,strm.input,strm.next_in,len,start);if(strm.state.wrap===1)strm.adler=adler32(strm.adler,buf,len,start);else if(strm.state.wrap===2)strm.adler=crc32(strm.adler,buf,len,start);strm.next_in+=len;strm.total_in+=len;return len}function longest_match(s,cur_match){var chain_length=s.max_chain_length;var scan=s.strstart;var match;var len;var best_len=s.prev_length;var nice_match=s.nice_match;var limit=s.strstart>s.w_size-MIN_LOOKAHEAD?s.strstart-(s.w_size-MIN_LOOKAHEAD):0;var _win=
s.window;var wmask=s.w_mask;var prev=s.prev;var strend=s.strstart+MAX_MATCH;var scan_end1=_win[scan+best_len-1];var scan_end=_win[scan+best_len];if(s.prev_length>=s.good_match)chain_length>>=2;if(nice_match>s.lookahead)nice_match=s.lookahead;do{match=cur_match;if(_win[match+best_len]!==scan_end||_win[match+best_len-1]!==scan_end1||_win[match]!==_win[scan]||_win[++match]!==_win[scan+1])continue;scan+=2;match++;do;while(_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&
_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&scan<strend);len=MAX_MATCH-(strend-scan);scan=strend-MAX_MATCH;if(len>best_len){s.match_start=cur_match;best_len=len;if(len>=nice_match)break;scan_end1=_win[scan+best_len-1];scan_end=_win[scan+best_len]}}while((cur_match=prev[cur_match&wmask])>limit&&--chain_length!==0);if(best_len<=s.lookahead)return best_len;return s.lookahead}function fill_window(s){var _w_size=
s.w_size;var p,n,m,more,str;do{more=s.window_size-s.lookahead-s.strstart;if(s.strstart>=_w_size+(_w_size-MIN_LOOKAHEAD)){utils.arraySet(s.window,s.window,_w_size,_w_size,0);s.match_start-=_w_size;s.strstart-=_w_size;s.block_start-=_w_size;n=s.hash_size;p=n;do{m=s.head[--p];s.head[p]=m>=_w_size?m-_w_size:0}while(--n);n=_w_size;p=n;do{m=s.prev[--p];s.prev[p]=m>=_w_size?m-_w_size:0}while(--n);more+=_w_size}if(s.strm.avail_in===0)break;n=read_buf(s.strm,s.window,s.strstart+s.lookahead,more);s.lookahead+=
n;if(s.lookahead+s.insert>=MIN_MATCH){str=s.strstart-s.insert;s.ins_h=s.window[str];s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+1])&s.hash_mask;while(s.insert){s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH-1])&s.hash_mask;s.prev[str&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=str;str++;s.insert--;if(s.lookahead+s.insert<MIN_MATCH)break}}}while(s.lookahead<MIN_LOOKAHEAD&&s.strm.avail_in!==0)}function deflate_stored(s,flush){var max_block_size=65535;if(max_block_size>s.pending_buf_size-5)max_block_size=
s.pending_buf_size-5;for(;;){if(s.lookahead<=1){fill_window(s);if(s.lookahead===0&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(s.lookahead===0)break}s.strstart+=s.lookahead;s.lookahead=0;var max_start=s.block_start+max_block_size;if(s.strstart===0||s.strstart>=max_start){s.lookahead=s.strstart-max_start;s.strstart=max_start;flush_block_only(s,false);if(s.strm.avail_out===0)return BS_NEED_MORE}if(s.strstart-s.block_start>=s.w_size-MIN_LOOKAHEAD){flush_block_only(s,false);if(s.strm.avail_out===0)return BS_NEED_MORE}}s.insert=
0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0)return BS_FINISH_STARTED;return BS_FINISH_DONE}if(s.strstart>s.block_start){flush_block_only(s,false);if(s.strm.avail_out===0)return BS_NEED_MORE}return BS_NEED_MORE}function deflate_fast(s,flush){var hash_head;var bflush;for(;;){if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(s.lookahead===0)break}hash_head=0;if(s.lookahead>=MIN_MATCH){s.ins_h=(s.ins_h<<s.hash_shift^
s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}if(hash_head!==0&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD)s.match_length=longest_match(s,hash_head);if(s.match_length>=MIN_MATCH){bflush=trees._tr_tally(s,s.strstart-s.match_start,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;if(s.match_length<=s.max_lazy_match&&s.lookahead>=MIN_MATCH){s.match_length--;do{s.strstart++;s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+
MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}while(--s.match_length!==0);s.strstart++}else{s.strstart+=s.match_length;s.match_length=0;s.ins_h=s.window[s.strstart];s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+1])&s.hash_mask}}else{bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++}if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0)return BS_NEED_MORE}}s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-
1;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0)return BS_FINISH_STARTED;return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0)return BS_NEED_MORE}return BS_BLOCK_DONE}function deflate_slow(s,flush){var hash_head;var bflush;var max_insert;for(;;){if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(s.lookahead===0)break}hash_head=0;if(s.lookahead>=MIN_MATCH){s.ins_h=(s.ins_h<<s.hash_shift^
s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}s.prev_length=s.match_length;s.prev_match=s.match_start;s.match_length=MIN_MATCH-1;if(hash_head!==0&&s.prev_length<s.max_lazy_match&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD){s.match_length=longest_match(s,hash_head);if(s.match_length<=5&&(s.strategy===Z_FILTERED||s.match_length===MIN_MATCH&&s.strstart-s.match_start>4096))s.match_length=MIN_MATCH-1}if(s.prev_length>=MIN_MATCH&&
s.match_length<=s.prev_length){max_insert=s.strstart+s.lookahead-MIN_MATCH;bflush=trees._tr_tally(s,s.strstart-1-s.prev_match,s.prev_length-MIN_MATCH);s.lookahead-=s.prev_length-1;s.prev_length-=2;do if(++s.strstart<=max_insert){s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}while(--s.prev_length!==0);s.match_available=0;s.match_length=MIN_MATCH-1;s.strstart++;if(bflush){flush_block_only(s,
false);if(s.strm.avail_out===0)return BS_NEED_MORE}}else if(s.match_available){bflush=trees._tr_tally(s,0,s.window[s.strstart-1]);if(bflush)flush_block_only(s,false);s.strstart++;s.lookahead--;if(s.strm.avail_out===0)return BS_NEED_MORE}else{s.match_available=1;s.strstart++;s.lookahead--}}if(s.match_available){bflush=trees._tr_tally(s,0,s.window[s.strstart-1]);s.match_available=0}s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===
0)return BS_FINISH_STARTED;return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0)return BS_NEED_MORE}return BS_BLOCK_DONE}function deflate_rle(s,flush){var bflush;var prev;var scan,strend;var _win=s.window;for(;;){if(s.lookahead<=MAX_MATCH){fill_window(s);if(s.lookahead<=MAX_MATCH&&flush===Z_NO_FLUSH)return BS_NEED_MORE;if(s.lookahead===0)break}s.match_length=0;if(s.lookahead>=MIN_MATCH&&s.strstart>0){scan=s.strstart-1;prev=_win[scan];if(prev===_win[++scan]&&prev===
_win[++scan]&&prev===_win[++scan]){strend=s.strstart+MAX_MATCH;do;while(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&scan<strend);s.match_length=MAX_MATCH-(strend-scan);if(s.match_length>s.lookahead)s.match_length=s.lookahead}}if(s.match_length>=MIN_MATCH){bflush=trees._tr_tally(s,1,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;s.strstart+=s.match_length;s.match_length=
0}else{bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++}if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0)return BS_NEED_MORE}}s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0)return BS_FINISH_STARTED;return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0)return BS_NEED_MORE}return BS_BLOCK_DONE}function deflate_huff(s,flush){var bflush;for(;;){if(s.lookahead===0){fill_window(s);if(s.lookahead===
0){if(flush===Z_NO_FLUSH)return BS_NEED_MORE;break}}s.match_length=0;bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++;if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0)return BS_NEED_MORE}}s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0)return BS_FINISH_STARTED;return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0)return BS_NEED_MORE}return BS_BLOCK_DONE}var Config=function(good_length,max_lazy,
nice_length,max_chain,func){this.good_length=good_length;this.max_lazy=max_lazy;this.nice_length=nice_length;this.max_chain=max_chain;this.func=func};var configuration_table;configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,
1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];function lm_init(s){s.window_size=2*s.w_size;zero(s.head);s.max_lazy_match=configuration_table[s.level].max_lazy;s.good_match=configuration_table[s.level].good_length;s.nice_match=configuration_table[s.level].nice_length;s.max_chain_length=configuration_table[s.level].max_chain;s.strstart=0;s.block_start=0;s.lookahead=0;s.insert=0;s.match_length=s.prev_length=MIN_MATCH-1;s.match_available=0;s.ins_h=0}function DeflateState(){this.strm=null;
this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=Z_DEFLATED;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;
this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new utils.Buf16(HEAP_SIZE*2);this.dyn_dtree=new utils.Buf16((2*D_CODES+1)*2);this.bl_tree=new utils.Buf16((2*BL_CODES+1)*2);zero(this.dyn_ltree);zero(this.dyn_dtree);zero(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new utils.Buf16(MAX_BITS+1);this.heap=new utils.Buf16(2*L_CODES+1);zero(this.heap);this.heap_len=0;this.heap_max=
0;this.depth=new utils.Buf16(2*L_CODES+1);zero(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}function deflateResetKeep(strm){var s;if(!strm||!strm.state)return err(strm,Z_STREAM_ERROR);strm.total_in=strm.total_out=0;strm.data_type=Z_UNKNOWN;s=strm.state;s.pending=0;s.pending_out=0;if(s.wrap<0)s.wrap=-s.wrap;s.status=s.wrap?INIT_STATE:BUSY_STATE;strm.adler=s.wrap===2?0:1;s.last_flush=
Z_NO_FLUSH;trees._tr_init(s);return Z_OK}function deflateReset(strm){var ret=deflateResetKeep(strm);if(ret===Z_OK)lm_init(strm.state);return ret}function deflateSetHeader(strm,head){if(!strm||!strm.state)return Z_STREAM_ERROR;if(strm.state.wrap!==2)return Z_STREAM_ERROR;strm.state.gzhead=head;return Z_OK}function deflateInit2(strm,level,method,windowBits,memLevel,strategy){if(!strm)return Z_STREAM_ERROR;var wrap=1;if(level===Z_DEFAULT_COMPRESSION)level=6;if(windowBits<0){wrap=0;windowBits=-windowBits}else if(windowBits>
15){wrap=2;windowBits-=16}if(memLevel<1||memLevel>MAX_MEM_LEVEL||method!==Z_DEFLATED||windowBits<8||windowBits>15||level<0||level>9||strategy<0||strategy>Z_FIXED)return err(strm,Z_STREAM_ERROR);if(windowBits===8)windowBits=9;var s=new DeflateState;strm.state=s;s.strm=strm;s.wrap=wrap;s.gzhead=null;s.w_bits=windowBits;s.w_size=1<<s.w_bits;s.w_mask=s.w_size-1;s.hash_bits=memLevel+7;s.hash_size=1<<s.hash_bits;s.hash_mask=s.hash_size-1;s.hash_shift=~~((s.hash_bits+MIN_MATCH-1)/MIN_MATCH);s.window=new utils.Buf8(s.w_size*
2);s.head=new utils.Buf16(s.hash_size);s.prev=new utils.Buf16(s.w_size);s.lit_bufsize=1<<memLevel+6;s.pending_buf_size=s.lit_bufsize*4;s.pending_buf=new utils.Buf8(s.pending_buf_size);s.d_buf=s.lit_bufsize>>1;s.l_buf=(1+2)*s.lit_bufsize;s.level=level;s.strategy=strategy;s.method=method;return deflateReset(strm)}function deflateInit(strm,level){return deflateInit2(strm,level,Z_DEFLATED,MAX_WBITS,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY)}function deflate(strm,flush){var old_flush,s;var beg,val;if(!strm||!strm.state||
flush>Z_BLOCK||flush<0)return strm?err(strm,Z_STREAM_ERROR):Z_STREAM_ERROR;s=strm.state;if(!strm.output||!strm.input&&strm.avail_in!==0||s.status===FINISH_STATE&&flush!==Z_FINISH)return err(strm,strm.avail_out===0?Z_BUF_ERROR:Z_STREAM_ERROR);s.strm=strm;old_flush=s.last_flush;s.last_flush=flush;if(s.status===INIT_STATE)if(s.wrap===2){strm.adler=0;put_byte(s,31);put_byte(s,139);put_byte(s,8);if(!s.gzhead){put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,s.level===9?
2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0);put_byte(s,OS_CODE);s.status=BUSY_STATE}else{put_byte(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(!s.gzhead.extra?0:4)+(!s.gzhead.name?0:8)+(!s.gzhead.comment?0:16));put_byte(s,s.gzhead.time&255);put_byte(s,s.gzhead.time>>8&255);put_byte(s,s.gzhead.time>>16&255);put_byte(s,s.gzhead.time>>24&255);put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0);put_byte(s,s.gzhead.os&255);if(s.gzhead.extra&&s.gzhead.extra.length){put_byte(s,s.gzhead.extra.length&
255);put_byte(s,s.gzhead.extra.length>>8&255)}if(s.gzhead.hcrc)strm.adler=crc32(strm.adler,s.pending_buf,s.pending,0);s.gzindex=0;s.status=EXTRA_STATE}}else{var header=Z_DEFLATED+(s.w_bits-8<<4)<<8;var level_flags=-1;if(s.strategy>=Z_HUFFMAN_ONLY||s.level<2)level_flags=0;else if(s.level<6)level_flags=1;else if(s.level===6)level_flags=2;else level_flags=3;header|=level_flags<<6;if(s.strstart!==0)header|=PRESET_DICT;header+=31-header%31;s.status=BUSY_STATE;putShortMSB(s,header);if(s.strstart!==0){putShortMSB(s,
strm.adler>>>16);putShortMSB(s,strm.adler&65535)}strm.adler=1}if(s.status===EXTRA_STATE)if(s.gzhead.extra){beg=s.pending;while(s.gzindex<(s.gzhead.extra.length&65535)){if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg)strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg);flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size)break}put_byte(s,s.gzhead.extra[s.gzindex]&255);s.gzindex++}if(s.gzhead.hcrc&&s.pending>beg)strm.adler=crc32(strm.adler,s.pending_buf,s.pending-
beg,beg);if(s.gzindex===s.gzhead.extra.length){s.gzindex=0;s.status=NAME_STATE}}else s.status=NAME_STATE;if(s.status===NAME_STATE)if(s.gzhead.name){beg=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg)strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg);flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break}}if(s.gzindex<s.gzhead.name.length)val=s.gzhead.name.charCodeAt(s.gzindex++)&255;else val=0;put_byte(s,val)}while(val!==0);if(s.gzhead.hcrc&&
s.pending>beg)strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg);if(val===0){s.gzindex=0;s.status=COMMENT_STATE}}else s.status=COMMENT_STATE;if(s.status===COMMENT_STATE)if(s.gzhead.comment){beg=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg)strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg);flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break}}if(s.gzindex<s.gzhead.comment.length)val=s.gzhead.comment.charCodeAt(s.gzindex++)&
255;else val=0;put_byte(s,val)}while(val!==0);if(s.gzhead.hcrc&&s.pending>beg)strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg);if(val===0)s.status=HCRC_STATE}else s.status=HCRC_STATE;if(s.status===HCRC_STATE)if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size)flush_pending(strm);if(s.pending+2<=s.pending_buf_size){put_byte(s,strm.adler&255);put_byte(s,strm.adler>>8&255);strm.adler=0;s.status=BUSY_STATE}}else s.status=BUSY_STATE;if(s.pending!==0){flush_pending(strm);if(strm.avail_out===
0){s.last_flush=-1;return Z_OK}}else if(strm.avail_in===0&&rank(flush)<=rank(old_flush)&&flush!==Z_FINISH)return err(strm,Z_BUF_ERROR);if(s.status===FINISH_STATE&&strm.avail_in!==0)return err(strm,Z_BUF_ERROR);if(strm.avail_in!==0||s.lookahead!==0||flush!==Z_NO_FLUSH&&s.status!==FINISH_STATE){var bstate=s.strategy===Z_HUFFMAN_ONLY?deflate_huff(s,flush):s.strategy===Z_RLE?deflate_rle(s,flush):configuration_table[s.level].func(s,flush);if(bstate===BS_FINISH_STARTED||bstate===BS_FINISH_DONE)s.status=
FINISH_STATE;if(bstate===BS_NEED_MORE||bstate===BS_FINISH_STARTED){if(strm.avail_out===0)s.last_flush=-1;return Z_OK}if(bstate===BS_BLOCK_DONE){if(flush===Z_PARTIAL_FLUSH)trees._tr_align(s);else if(flush!==Z_BLOCK){trees._tr_stored_block(s,0,0,false);if(flush===Z_FULL_FLUSH){zero(s.head);if(s.lookahead===0){s.strstart=0;s.block_start=0;s.insert=0}}}flush_pending(strm);if(strm.avail_out===0){s.last_flush=-1;return Z_OK}}}if(flush!==Z_FINISH)return Z_OK;if(s.wrap<=0)return Z_STREAM_END;if(s.wrap===
2){put_byte(s,strm.adler&255);put_byte(s,strm.adler>>8&255);put_byte(s,strm.adler>>16&255);put_byte(s,strm.adler>>24&255);put_byte(s,strm.total_in&255);put_byte(s,strm.total_in>>8&255);put_byte(s,strm.total_in>>16&255);put_byte(s,strm.total_in>>24&255)}else{putShortMSB(s,strm.adler>>>16);putShortMSB(s,strm.adler&65535)}flush_pending(strm);if(s.wrap>0)s.wrap=-s.wrap;return s.pending!==0?Z_OK:Z_STREAM_END}function deflateEnd(strm){var status;if(!strm||!strm.state)return Z_STREAM_ERROR;status=strm.state.status;
if(status!==INIT_STATE&&status!==EXTRA_STATE&&status!==NAME_STATE&&status!==COMMENT_STATE&&status!==HCRC_STATE&&status!==BUSY_STATE&&status!==FINISH_STATE)return err(strm,Z_STREAM_ERROR);strm.state=null;return status===BUSY_STATE?err(strm,Z_DATA_ERROR):Z_OK}exports.deflateInit=deflateInit;exports.deflateInit2=deflateInit2;exports.deflateReset=deflateReset;exports.deflateResetKeep=deflateResetKeep;exports.deflateSetHeader=deflateSetHeader;exports.deflate=deflate;exports.deflateEnd=deflateEnd;exports.deflateInfo=
"pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(_dereq_,module,exports){function GZheader(){this.text=0;this.time=0;this.xflags=0;this.os=0;this.extra=null;this.extra_len=0;this.name="";this.comment="";this.hcrc=0;this.done=false}module.exports=GZheader},{}],34:[function(_dereq_,module,exports){var BAD=30;var TYPE=12;module.exports=function inflate_fast(strm,start){var state;var _in;var last;var _out;var beg;var end;
var dmax;var wsize;var whave;var wnext;var window;var hold;var bits;var lcode;var dcode;var lmask;var dmask;var here;var op;var len;var dist;var from;var from_source;var input,output;state=strm.state;_in=strm.next_in;input=strm.input;last=_in+(strm.avail_in-5);_out=strm.next_out;output=strm.output;beg=_out-(start-strm.avail_out);end=_out+(strm.avail_out-257);dmax=state.dmax;wsize=state.wsize;whave=state.whave;wnext=state.wnext;window=state.window;hold=state.hold;bits=state.bits;lcode=state.lencode;
dcode=state.distcode;lmask=(1<<state.lenbits)-1;dmask=(1<<state.distbits)-1;top:do{if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=lcode[hold&lmask];dolen:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op===0)output[_out++]=here&65535;else if(op&16){len=here&65535;op&=15;if(op){if(bits<op){hold+=input[_in++]<<bits;bits+=8}len+=hold&(1<<op)-1;hold>>>=op;bits-=op}if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=dcode[hold&
dmask];dodist:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op&16){dist=here&65535;op&=15;if(bits<op){hold+=input[_in++]<<bits;bits+=8;if(bits<op){hold+=input[_in++]<<bits;bits+=8}}dist+=hold&(1<<op)-1;if(dist>dmax){strm.msg="invalid distance too far back";state.mode=BAD;break top}hold>>>=op;bits-=op;op=_out-beg;if(dist>op){op=dist-op;if(op>whave)if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD;break top}from=0;from_source=window;if(wnext===0){from+=wsize-op;if(op<
len){len-=op;do output[_out++]=window[from++];while(--op);from=_out-dist;from_source=output}}else if(wnext<op){from+=wsize+wnext-op;op-=wnext;if(op<len){len-=op;do output[_out++]=window[from++];while(--op);from=0;if(wnext<len){op=wnext;len-=op;do output[_out++]=window[from++];while(--op);from=_out-dist;from_source=output}}}else{from+=wnext-op;if(op<len){len-=op;do output[_out++]=window[from++];while(--op);from=_out-dist;from_source=output}}while(len>2){output[_out++]=from_source[from++];output[_out++]=
from_source[from++];output[_out++]=from_source[from++];len-=3}if(len){output[_out++]=from_source[from++];if(len>1)output[_out++]=from_source[from++]}}else{from=_out-dist;do{output[_out++]=output[from++];output[_out++]=output[from++];output[_out++]=output[from++];len-=3}while(len>2);if(len){output[_out++]=output[from++];if(len>1)output[_out++]=output[from++]}}}else if((op&64)===0){here=dcode[(here&65535)+(hold&(1<<op)-1)];continue dodist}else{strm.msg="invalid distance code";state.mode=BAD;break top}break}}else if((op&
64)===0){here=lcode[(here&65535)+(hold&(1<<op)-1)];continue dolen}else if(op&32){state.mode=TYPE;break top}else{strm.msg="invalid literal/length code";state.mode=BAD;break top}break}}while(_in<last&&_out<end);len=bits>>3;_in-=len;bits-=len<<3;hold&=(1<<bits)-1;strm.next_in=_in;strm.next_out=_out;strm.avail_in=_in<last?5+(last-_in):5-(_in-last);strm.avail_out=_out<end?257+(end-_out):257-(_out-end);state.hold=hold;state.bits=bits;return}},{}],35:[function(_dereq_,module,exports){var utils=_dereq_("../utils/common");
var adler32=_dereq_("./adler32");var crc32=_dereq_("./crc32");var inflate_fast=_dereq_("./inffast");var inflate_table=_dereq_("./inftrees");var CODES=0;var LENS=1;var DISTS=2;var Z_FINISH=4;var Z_BLOCK=5;var Z_TREES=6;var Z_OK=0;var Z_STREAM_END=1;var Z_NEED_DICT=2;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_MEM_ERROR=-4;var Z_BUF_ERROR=-5;var Z_DEFLATED=8;var HEAD=1;var FLAGS=2;var TIME=3;var OS=4;var EXLEN=5;var EXTRA=6;var NAME=7;var COMMENT=8;var HCRC=9;var DICTID=10;var DICT=11;var TYPE=
12;var TYPEDO=13;var STORED=14;var COPY_=15;var COPY=16;var TABLE=17;var LENLENS=18;var CODELENS=19;var LEN_=20;var LEN=21;var LENEXT=22;var DIST=23;var DISTEXT=24;var MATCH=25;var LIT=26;var CHECK=27;var LENGTH=28;var DONE=29;var BAD=30;var MEM=31;var SYNC=32;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var MAX_WBITS=15;var DEF_WBITS=MAX_WBITS;function ZSWAP32(q){return(q>>>24&255)+(q>>>8&65280)+((q&65280)<<8)+((q&255)<<24)}function InflateState(){this.mode=0;this.last=false;this.wrap=0;this.havedict=
false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new utils.Buf16(320);this.work=new utils.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}function inflateResetKeep(strm){var state;
if(!strm||!strm.state)return Z_STREAM_ERROR;state=strm.state;strm.total_in=strm.total_out=state.total=0;strm.msg="";if(state.wrap)strm.adler=state.wrap&1;state.mode=HEAD;state.last=0;state.havedict=0;state.dmax=32768;state.head=null;state.hold=0;state.bits=0;state.lencode=state.lendyn=new utils.Buf32(ENOUGH_LENS);state.distcode=state.distdyn=new utils.Buf32(ENOUGH_DISTS);state.sane=1;state.back=-1;return Z_OK}function inflateReset(strm){var state;if(!strm||!strm.state)return Z_STREAM_ERROR;state=
strm.state;state.wsize=0;state.whave=0;state.wnext=0;return inflateResetKeep(strm)}function inflateReset2(strm,windowBits){var wrap;var state;if(!strm||!strm.state)return Z_STREAM_ERROR;state=strm.state;if(windowBits<0){wrap=0;windowBits=-windowBits}else{wrap=(windowBits>>4)+1;if(windowBits<48)windowBits&=15}if(windowBits&&(windowBits<8||windowBits>15))return Z_STREAM_ERROR;if(state.window!==null&&state.wbits!==windowBits)state.window=null;state.wrap=wrap;state.wbits=windowBits;return inflateReset(strm)}
function inflateInit2(strm,windowBits){var ret;var state;if(!strm)return Z_STREAM_ERROR;state=new InflateState;strm.state=state;state.window=null;ret=inflateReset2(strm,windowBits);if(ret!==Z_OK)strm.state=null;return ret}function inflateInit(strm){return inflateInit2(strm,DEF_WBITS)}var virgin=true;var lenfix,distfix;function fixedtables(state){if(virgin){var sym;lenfix=new utils.Buf32(512);distfix=new utils.Buf32(32);sym=0;while(sym<144)state.lens[sym++]=8;while(sym<256)state.lens[sym++]=9;while(sym<
280)state.lens[sym++]=7;while(sym<288)state.lens[sym++]=8;inflate_table(LENS,state.lens,0,288,lenfix,0,state.work,{bits:9});sym=0;while(sym<32)state.lens[sym++]=5;inflate_table(DISTS,state.lens,0,32,distfix,0,state.work,{bits:5});virgin=false}state.lencode=lenfix;state.lenbits=9;state.distcode=distfix;state.distbits=5}function updatewindow(strm,src,end,copy){var dist;var state=strm.state;if(state.window===null){state.wsize=1<<state.wbits;state.wnext=0;state.whave=0;state.window=new utils.Buf8(state.wsize)}if(copy>=
state.wsize){utils.arraySet(state.window,src,end-state.wsize,state.wsize,0);state.wnext=0;state.whave=state.wsize}else{dist=state.wsize-state.wnext;if(dist>copy)dist=copy;utils.arraySet(state.window,src,end-copy,dist,state.wnext);copy-=dist;if(copy){utils.arraySet(state.window,src,end-copy,copy,0);state.wnext=copy;state.whave=state.wsize}else{state.wnext+=dist;if(state.wnext===state.wsize)state.wnext=0;if(state.whave<state.wsize)state.whave+=dist}}return 0}function inflate(strm,flush){var state;var input,
output;var next;var put;var have,left;var hold;var bits;var _in,_out;var copy;var from;var from_source;var here=0;var here_bits,here_op,here_val;var last_bits,last_op,last_val;var len;var ret;var hbuf=new utils.Buf8(4);var opts;var n;var order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||!strm.input&&strm.avail_in!==0)return Z_STREAM_ERROR;state=strm.state;if(state.mode===TYPE)state.mode=TYPEDO;put=strm.next_out;output=strm.output;left=strm.avail_out;next=
strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;_in=have;_out=left;ret=Z_OK;inf_leave:for(;;)switch(state.mode){case HEAD:if(state.wrap===0){state.mode=TYPEDO;break}while(bits<16){if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}if(state.wrap&2&&hold===35615){state.check=0;hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0);hold=0;bits=0;state.mode=FLAGS;break}state.flags=0;if(state.head)state.head.done=false;if(!(state.wrap&
1)||(((hold&255)<<8)+(hold>>8))%31){strm.msg="incorrect header check";state.mode=BAD;break}if((hold&15)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}hold>>>=4;bits-=4;len=(hold&15)+8;if(state.wbits===0)state.wbits=len;else if(len>state.wbits){strm.msg="invalid window size";state.mode=BAD;break}state.dmax=1<<len;strm.adler=state.check=1;state.mode=hold&512?DICTID:TYPE;hold=0;bits=0;break;case FLAGS:while(bits<16){if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;
bits+=8}state.flags=hold;if((state.flags&255)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}if(state.flags&57344){strm.msg="unknown header flags set";state.mode=BAD;break}if(state.head)state.head.text=hold>>8&1;if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=TIME;case TIME:while(bits<32){if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}if(state.head)state.head.time=hold;if(state.flags&
512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;hbuf[2]=hold>>>16&255;hbuf[3]=hold>>>24&255;state.check=crc32(state.check,hbuf,4,0)}hold=0;bits=0;state.mode=OS;case OS:while(bits<16){if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}if(state.head){state.head.xflags=hold&255;state.head.os=hold>>8}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=EXLEN;case EXLEN:if(state.flags&1024){while(bits<16){if(have===0)break inf_leave;
have--;hold+=input[next++]<<bits;bits+=8}state.length=hold;if(state.head)state.head.extra_len=hold;if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0}else if(state.head)state.head.extra=null;state.mode=EXTRA;case EXTRA:if(state.flags&1024){copy=state.length;if(copy>have)copy=have;if(copy){if(state.head){len=state.head.extra_len-state.length;if(!state.head.extra)state.head.extra=new Array(state.head.extra_len);utils.arraySet(state.head.extra,
input,next,copy,len)}if(state.flags&512)state.check=crc32(state.check,input,copy,next);have-=copy;next+=copy;state.length-=copy}if(state.length)break inf_leave}state.length=0;state.mode=NAME;case NAME:if(state.flags&2048){if(have===0)break inf_leave;copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536)state.head.name+=String.fromCharCode(len)}while(len&&copy<have);if(state.flags&512)state.check=crc32(state.check,input,copy,next);have-=copy;next+=copy;if(len)break inf_leave}else if(state.head)state.head.name=
null;state.length=0;state.mode=COMMENT;case COMMENT:if(state.flags&4096){if(have===0)break inf_leave;copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536)state.head.comment+=String.fromCharCode(len)}while(len&&copy<have);if(state.flags&512)state.check=crc32(state.check,input,copy,next);have-=copy;next+=copy;if(len)break inf_leave}else if(state.head)state.head.comment=null;state.mode=HCRC;case HCRC:if(state.flags&512){while(bits<16){if(have===0)break inf_leave;have--;hold+=input[next++]<<
bits;bits+=8}if(hold!==(state.check&65535)){strm.msg="header crc mismatch";state.mode=BAD;break}hold=0;bits=0}if(state.head){state.head.hcrc=state.flags>>9&1;state.head.done=true}strm.adler=state.check=0;state.mode=TYPE;break;case DICTID:while(bits<32){if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}strm.adler=state.check=ZSWAP32(hold);hold=0;bits=0;state.mode=DICT;case DICT:if(state.havedict===0){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=
hold;state.bits=bits;return Z_NEED_DICT}strm.adler=state.check=1;state.mode=TYPE;case TYPE:if(flush===Z_BLOCK||flush===Z_TREES)break inf_leave;case TYPEDO:if(state.last){hold>>>=bits&7;bits-=bits&7;state.mode=CHECK;break}while(bits<3){if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}state.last=hold&1;hold>>>=1;bits-=1;switch(hold&3){case 0:state.mode=STORED;break;case 1:fixedtables(state);state.mode=LEN_;if(flush===Z_TREES){hold>>>=2;bits-=2;break inf_leave}break;case 2:state.mode=
TABLE;break;case 3:strm.msg="invalid block type";state.mode=BAD}hold>>>=2;bits-=2;break;case STORED:hold>>>=bits&7;bits-=bits&7;while(bits<32){if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}if((hold&65535)!==(hold>>>16^65535)){strm.msg="invalid stored block lengths";state.mode=BAD;break}state.length=hold&65535;hold=0;bits=0;state.mode=COPY_;if(flush===Z_TREES)break inf_leave;case COPY_:state.mode=COPY;case COPY:copy=state.length;if(copy){if(copy>have)copy=have;if(copy>left)copy=
left;if(copy===0)break inf_leave;utils.arraySet(output,input,next,copy,put);have-=copy;next+=copy;left-=copy;put+=copy;state.length-=copy;break}state.mode=TYPE;break;case TABLE:while(bits<14){if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}state.nlen=(hold&31)+257;hold>>>=5;bits-=5;state.ndist=(hold&31)+1;hold>>>=5;bits-=5;state.ncode=(hold&15)+4;hold>>>=4;bits-=4;if(state.nlen>286||state.ndist>30){strm.msg="too many length or distance symbols";state.mode=BAD;break}state.have=
0;state.mode=LENLENS;case LENLENS:while(state.have<state.ncode){while(bits<3){if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}state.lens[order[state.have++]]=hold&7;hold>>>=3;bits-=3}while(state.have<19)state.lens[order[state.have++]]=0;state.lencode=state.lendyn;state.lenbits=7;opts={bits:state.lenbits};ret=inflate_table(CODES,state.lens,0,19,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid code lengths set";state.mode=BAD;break}state.have=0;
state.mode=CODELENS;case CODELENS:while(state.have<state.nlen+state.ndist){for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits)break;if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}if(here_val<16){hold>>>=here_bits;bits-=here_bits;state.lens[state.have++]=here_val}else{if(here_val===16){n=here_bits+2;while(bits<n){if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;
bits-=here_bits;if(state.have===0){strm.msg="invalid bit length repeat";state.mode=BAD;break}len=state.lens[state.have-1];copy=3+(hold&3);hold>>>=2;bits-=2}else if(here_val===17){n=here_bits+3;while(bits<n){if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=3+(hold&7);hold>>>=3;bits-=3}else{n=here_bits+7;while(bits<n){if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=11+(hold&
127);hold>>>=7;bits-=7}if(state.have+copy>state.nlen+state.ndist){strm.msg="invalid bit length repeat";state.mode=BAD;break}while(copy--)state.lens[state.have++]=len}}if(state.mode===BAD)break;if(state.lens[256]===0){strm.msg="invalid code -- missing end-of-block";state.mode=BAD;break}state.lenbits=9;opts={bits:state.lenbits};ret=inflate_table(LENS,state.lens,0,state.nlen,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid literal/lengths set";state.mode=BAD;break}state.distbits=
6;state.distcode=state.distdyn;opts={bits:state.distbits};ret=inflate_table(DISTS,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts);state.distbits=opts.bits;if(ret){strm.msg="invalid distances set";state.mode=BAD;break}state.mode=LEN_;if(flush===Z_TREES)break inf_leave;case LEN_:state.mode=LEN;case LEN:if(have>=6&&left>=258){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;inflate_fast(strm,_out);put=strm.next_out;output=
strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;if(state.mode===TYPE)state.back=-1;break}state.back=0;for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits)break;if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}if(here_op&&(here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.lencode[last_val+
((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits)break;if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;state.length=here_val;if(here_op===0){state.mode=LIT;break}if(here_op&32){state.back=-1;state.mode=TYPE;break}if(here_op&64){strm.msg="invalid literal/length code";state.mode=BAD;
break}state.extra=here_op&15;state.mode=LENEXT;case LENEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}state.length+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}state.was=state.length;state.mode=DIST;case DIST:for(;;){here=state.distcode[hold&(1<<state.distbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits)break;if(have===0)break inf_leave;have--;hold+=
input[next++]<<bits;bits+=8}if((here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.distcode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits)break;if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;if(here_op&64){strm.msg="invalid distance code";
state.mode=BAD;break}state.offset=here_val;state.extra=here_op&15;state.mode=DISTEXT;case DISTEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}state.offset+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}if(state.offset>state.dmax){strm.msg="invalid distance too far back";state.mode=BAD;break}state.mode=MATCH;case MATCH:if(left===0)break inf_leave;copy=_out-left;if(state.offset>copy){copy=state.offset-
copy;if(copy>state.whave)if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD;break}if(copy>state.wnext){copy-=state.wnext;from=state.wsize-copy}else from=state.wnext-copy;if(copy>state.length)copy=state.length;from_source=state.window}else{from_source=output;from=put-state.offset;copy=state.length}if(copy>left)copy=left;left-=copy;state.length-=copy;do output[put++]=from_source[from++];while(--copy);if(state.length===0)state.mode=LEN;break;case LIT:if(left===0)break inf_leave;output[put++]=
state.length;left--;state.mode=LEN;break;case CHECK:if(state.wrap){while(bits<32){if(have===0)break inf_leave;have--;hold|=input[next++]<<bits;bits+=8}_out-=left;strm.total_out+=_out;state.total+=_out;if(_out)strm.adler=state.check=state.flags?crc32(state.check,output,_out,put-_out):adler32(state.check,output,_out,put-_out);_out=left;if((state.flags?hold:ZSWAP32(hold))!==state.check){strm.msg="incorrect data check";state.mode=BAD;break}hold=0;bits=0}state.mode=LENGTH;case LENGTH:if(state.wrap&&state.flags){while(bits<
32){if(have===0)break inf_leave;have--;hold+=input[next++]<<bits;bits+=8}if(hold!==(state.total&4294967295)){strm.msg="incorrect length check";state.mode=BAD;break}hold=0;bits=0}state.mode=DONE;case DONE:ret=Z_STREAM_END;break inf_leave;case BAD:ret=Z_DATA_ERROR;break inf_leave;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR}strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;if(state.wsize||_out!==strm.avail_out&&state.mode<
BAD&&(state.mode<CHECK||flush!==Z_FINISH))if(updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out)){state.mode=MEM;return Z_MEM_ERROR}_in-=strm.avail_in;_out-=strm.avail_out;strm.total_in+=_in;strm.total_out+=_out;state.total+=_out;if(state.wrap&&_out)strm.adler=state.check=state.flags?crc32(state.check,output,_out,strm.next_out-_out):adler32(state.check,output,_out,strm.next_out-_out);strm.data_type=state.bits+(state.last?64:0)+(state.mode===TYPE?128:0)+(state.mode===LEN_||state.mode===
COPY_?256:0);if((_in===0&&_out===0||flush===Z_FINISH)&&ret===Z_OK)ret=Z_BUF_ERROR;return ret}function inflateEnd(strm){if(!strm||!strm.state)return Z_STREAM_ERROR;var state=strm.state;if(state.window)state.window=null;strm.state=null;return Z_OK}function inflateGetHeader(strm,head){var state;if(!strm||!strm.state)return Z_STREAM_ERROR;state=strm.state;if((state.wrap&2)===0)return Z_STREAM_ERROR;state.head=head;head.done=false;return Z_OK}exports.inflateReset=inflateReset;exports.inflateReset2=inflateReset2;
exports.inflateResetKeep=inflateResetKeep;exports.inflateInit=inflateInit;exports.inflateInit2=inflateInit2;exports.inflate=inflate;exports.inflateEnd=inflateEnd;exports.inflateGetHeader=inflateGetHeader;exports.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(_dereq_,module,exports){var utils=_dereq_("../utils/common");var MAXBITS=15;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var CODES=0;var LENS=1;var DISTS=
2;var lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];var lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];var dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module.exports=function inflate_table(type,lens,lens_index,
codes,table,table_index,work,opts){var bits=opts.bits;var len=0;var sym=0;var min=0,max=0;var root=0;var curr=0;var drop=0;var left=0;var used=0;var huff=0;var incr;var fill;var low;var mask;var next;var base=null;var base_index=0;var end;var count=new utils.Buf16(MAXBITS+1);var offs=new utils.Buf16(MAXBITS+1);var extra=null;var extra_index=0;var here_bits,here_op,here_val;for(len=0;len<=MAXBITS;len++)count[len]=0;for(sym=0;sym<codes;sym++)count[lens[lens_index+sym]]++;root=bits;for(max=MAXBITS;max>=
1;max--)if(count[max]!==0)break;if(root>max)root=max;if(max===0){table[table_index++]=1<<24|64<<16|0;table[table_index++]=1<<24|64<<16|0;opts.bits=1;return 0}for(min=1;min<max;min++)if(count[min]!==0)break;if(root<min)root=min;left=1;for(len=1;len<=MAXBITS;len++){left<<=1;left-=count[len];if(left<0)return-1}if(left>0&&(type===CODES||max!==1))return-1;offs[1]=0;for(len=1;len<MAXBITS;len++)offs[len+1]=offs[len]+count[len];for(sym=0;sym<codes;sym++)if(lens[lens_index+sym]!==0)work[offs[lens[lens_index+
sym]]++]=sym;if(type===CODES){base=extra=work;end=19}else if(type===LENS){base=lbase;base_index-=257;extra=lext;extra_index-=257;end=256}else{base=dbase;extra=dext;end=-1}huff=0;sym=0;len=min;next=table_index;curr=root;drop=0;low=-1;used=1<<root;mask=used-1;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS)return 1;var i=0;for(;;){i++;here_bits=len-drop;if(work[sym]<end){here_op=0;here_val=work[sym]}else if(work[sym]>end){here_op=extra[extra_index+work[sym]];here_val=base[base_index+
work[sym]]}else{here_op=32+64;here_val=0}incr=1<<len-drop;fill=1<<curr;min=fill;do{fill-=incr;table[next+(huff>>drop)+fill]=here_bits<<24|here_op<<16|here_val|0}while(fill!==0);incr=1<<len-1;while(huff&incr)incr>>=1;if(incr!==0){huff&=incr-1;huff+=incr}else huff=0;sym++;if(--count[len]===0){if(len===max)break;len=lens[lens_index+work[sym]]}if(len>root&&(huff&mask)!==low){if(drop===0)drop=root;next+=min;curr=len-drop;left=1<<curr;while(curr+drop<max){left-=count[curr+drop];if(left<=0)break;curr++;
left<<=1}used+=1<<curr;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS)return 1;low=huff&mask;table[low]=root<<24|curr<<16|next-table_index|0}}if(huff!==0)table[next+huff]=len-drop<<24|64<<16|0;opts.bits=root;return 0}},{"../utils/common":27}],37:[function(_dereq_,module,exports){module.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(_dereq_,
module,exports){var utils=_dereq_("../utils/common");var Z_FIXED=4;var Z_BINARY=0;var Z_TEXT=1;var Z_UNKNOWN=2;function zero(buf){var len=buf.length;while(--len>=0)buf[len]=0}var STORED_BLOCK=0;var STATIC_TREES=1;var DYN_TREES=2;var MIN_MATCH=3;var MAX_MATCH=258;var LENGTH_CODES=29;var LITERALS=256;var L_CODES=LITERALS+1+LENGTH_CODES;var D_CODES=30;var BL_CODES=19;var HEAP_SIZE=2*L_CODES+1;var MAX_BITS=15;var Buf_size=16;var MAX_BL_BITS=7;var END_BLOCK=256;var REP_3_6=16;var REPZ_3_10=17;var REPZ_11_138=
18;var extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];var extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];var bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var DIST_CODE_LEN=512;var static_ltree=new Array((L_CODES+2)*2);zero(static_ltree);var static_dtree=new Array(D_CODES*2);zero(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero(_dist_code);var _length_code=new Array(MAX_MATCH-
MIN_MATCH+1);zero(_length_code);var base_length=new Array(LENGTH_CODES);zero(base_length);var base_dist=new Array(D_CODES);zero(base_dist);var StaticTreeDesc=function(static_tree,extra_bits,extra_base,elems,max_length){this.static_tree=static_tree;this.extra_bits=extra_bits;this.extra_base=extra_base;this.elems=elems;this.max_length=max_length;this.has_stree=static_tree&&static_tree.length};var static_l_desc;var static_d_desc;var static_bl_desc;var TreeDesc=function(dyn_tree,stat_desc){this.dyn_tree=
dyn_tree;this.max_code=0;this.stat_desc=stat_desc};function d_code(dist){return dist<256?_dist_code[dist]:_dist_code[256+(dist>>>7)]}function put_short(s,w){s.pending_buf[s.pending++]=w&255;s.pending_buf[s.pending++]=w>>>8&255}function send_bits(s,value,length){if(s.bi_valid>Buf_size-length){s.bi_buf|=value<<s.bi_valid&65535;put_short(s,s.bi_buf);s.bi_buf=value>>Buf_size-s.bi_valid;s.bi_valid+=length-Buf_size}else{s.bi_buf|=value<<s.bi_valid&65535;s.bi_valid+=length}}function send_code(s,c,tree){send_bits(s,
tree[c*2],tree[c*2+1])}function bi_reverse(code,len){var res=0;do{res|=code&1;code>>>=1;res<<=1}while(--len>0);return res>>>1}function bi_flush(s){if(s.bi_valid===16){put_short(s,s.bi_buf);s.bi_buf=0;s.bi_valid=0}else if(s.bi_valid>=8){s.pending_buf[s.pending++]=s.bi_buf&255;s.bi_buf>>=8;s.bi_valid-=8}}function gen_bitlen(s,desc){var tree=desc.dyn_tree;var max_code=desc.max_code;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var extra=desc.stat_desc.extra_bits;var base=
desc.stat_desc.extra_base;var max_length=desc.stat_desc.max_length;var h;var n,m;var bits;var xbits;var f;var overflow=0;for(bits=0;bits<=MAX_BITS;bits++)s.bl_count[bits]=0;tree[s.heap[s.heap_max]*2+1]=0;for(h=s.heap_max+1;h<HEAP_SIZE;h++){n=s.heap[h];bits=tree[tree[n*2+1]*2+1]+1;if(bits>max_length){bits=max_length;overflow++}tree[n*2+1]=bits;if(n>max_code)continue;s.bl_count[bits]++;xbits=0;if(n>=base)xbits=extra[n-base];f=tree[n*2];s.opt_len+=f*(bits+xbits);if(has_stree)s.static_len+=f*(stree[n*
2+1]+xbits)}if(overflow===0)return;do{bits=max_length-1;while(s.bl_count[bits]===0)bits--;s.bl_count[bits]--;s.bl_count[bits+1]+=2;s.bl_count[max_length]--;overflow-=2}while(overflow>0);for(bits=max_length;bits!==0;bits--){n=s.bl_count[bits];while(n!==0){m=s.heap[--h];if(m>max_code)continue;if(tree[m*2+1]!==bits){s.opt_len+=(bits-tree[m*2+1])*tree[m*2];tree[m*2+1]=bits}n--}}}function gen_codes(tree,max_code,bl_count){var next_code=new Array(MAX_BITS+1);var code=0;var bits;var n;for(bits=1;bits<=MAX_BITS;bits++)next_code[bits]=
code=code+bl_count[bits-1]<<1;for(n=0;n<=max_code;n++){var len=tree[n*2+1];if(len===0)continue;tree[n*2]=bi_reverse(next_code[len]++,len)}}function tr_static_init(){var n;var bits;var length;var code;var dist;var bl_count=new Array(MAX_BITS+1);length=0;for(code=0;code<LENGTH_CODES-1;code++){base_length[code]=length;for(n=0;n<1<<extra_lbits[code];n++)_length_code[length++]=code}_length_code[length-1]=code;dist=0;for(code=0;code<16;code++){base_dist[code]=dist;for(n=0;n<1<<extra_dbits[code];n++)_dist_code[dist++]=
code}dist>>=7;for(;code<D_CODES;code++){base_dist[code]=dist<<7;for(n=0;n<1<<extra_dbits[code]-7;n++)_dist_code[256+dist++]=code}for(bits=0;bits<=MAX_BITS;bits++)bl_count[bits]=0;n=0;while(n<=143){static_ltree[n*2+1]=8;n++;bl_count[8]++}while(n<=255){static_ltree[n*2+1]=9;n++;bl_count[9]++}while(n<=279){static_ltree[n*2+1]=7;n++;bl_count[7]++}while(n<=287){static_ltree[n*2+1]=8;n++;bl_count[8]++}gen_codes(static_ltree,L_CODES+1,bl_count);for(n=0;n<D_CODES;n++){static_dtree[n*2+1]=5;static_dtree[n*
2]=bi_reverse(n,5)}static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS+1,L_CODES,MAX_BITS);static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES,MAX_BITS);static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES,MAX_BL_BITS)}function init_block(s){var n;for(n=0;n<L_CODES;n++)s.dyn_ltree[n*2]=0;for(n=0;n<D_CODES;n++)s.dyn_dtree[n*2]=0;for(n=0;n<BL_CODES;n++)s.bl_tree[n*2]=0;s.dyn_ltree[END_BLOCK*2]=1;s.opt_len=s.static_len=0;s.last_lit=s.matches=0}function bi_windup(s){if(s.bi_valid>
8)put_short(s,s.bi_buf);else if(s.bi_valid>0)s.pending_buf[s.pending++]=s.bi_buf;s.bi_buf=0;s.bi_valid=0}function copy_block(s,buf,len,header){bi_windup(s);if(header){put_short(s,len);put_short(s,~len)}utils.arraySet(s.pending_buf,s.window,buf,len,s.pending);s.pending+=len}function smaller(tree,n,m,depth){var _n2=n*2;var _m2=m*2;return tree[_n2]<tree[_m2]||tree[_n2]===tree[_m2]&&depth[n]<=depth[m]}function pqdownheap(s,tree,k){var v=s.heap[k];var j=k<<1;while(j<=s.heap_len){if(j<s.heap_len&&smaller(tree,
s.heap[j+1],s.heap[j],s.depth))j++;if(smaller(tree,v,s.heap[j],s.depth))break;s.heap[k]=s.heap[j];k=j;j<<=1}s.heap[k]=v}function compress_block(s,ltree,dtree){var dist;var lc;var lx=0;var code;var extra;if(s.last_lit!==0){do{dist=s.pending_buf[s.d_buf+lx*2]<<8|s.pending_buf[s.d_buf+lx*2+1];lc=s.pending_buf[s.l_buf+lx];lx++;if(dist===0)send_code(s,lc,ltree);else{code=_length_code[lc];send_code(s,code+LITERALS+1,ltree);extra=extra_lbits[code];if(extra!==0){lc-=base_length[code];send_bits(s,lc,extra)}dist--;
code=d_code(dist);send_code(s,code,dtree);extra=extra_dbits[code];if(extra!==0){dist-=base_dist[code];send_bits(s,dist,extra)}}}while(lx<s.last_lit)}send_code(s,END_BLOCK,ltree)}function build_tree(s,desc){var tree=desc.dyn_tree;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var elems=desc.stat_desc.elems;var n,m;var max_code=-1;var node;s.heap_len=0;s.heap_max=HEAP_SIZE;for(n=0;n<elems;n++)if(tree[n*2]!==0){s.heap[++s.heap_len]=max_code=n;s.depth[n]=0}else tree[n*2+1]=
0;while(s.heap_len<2){node=s.heap[++s.heap_len]=max_code<2?++max_code:0;tree[node*2]=1;s.depth[node]=0;s.opt_len--;if(has_stree)s.static_len-=stree[node*2+1]}desc.max_code=max_code;for(n=s.heap_len>>1;n>=1;n--)pqdownheap(s,tree,n);node=elems;do{n=s.heap[1];s.heap[1]=s.heap[s.heap_len--];pqdownheap(s,tree,1);m=s.heap[1];s.heap[--s.heap_max]=n;s.heap[--s.heap_max]=m;tree[node*2]=tree[n*2]+tree[m*2];s.depth[node]=(s.depth[n]>=s.depth[m]?s.depth[n]:s.depth[m])+1;tree[n*2+1]=tree[m*2+1]=node;s.heap[1]=
node++;pqdownheap(s,tree,1)}while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1];gen_bitlen(s,desc);gen_codes(tree,max_code,s.bl_count)}function scan_tree(s,tree,max_code){var n;var prevlen=-1;var curlen;var nextlen=tree[0*2+1];var count=0;var max_count=7;var min_count=4;if(nextlen===0){max_count=138;min_count=3}tree[(max_code+1)*2+1]=65535;for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[(n+1)*2+1];if(++count<max_count&&curlen===nextlen)continue;else if(count<min_count)s.bl_tree[curlen*2]+=count;
else if(curlen!==0){if(curlen!==prevlen)s.bl_tree[curlen*2]++;s.bl_tree[REP_3_6*2]++}else if(count<=10)s.bl_tree[REPZ_3_10*2]++;else s.bl_tree[REPZ_11_138*2]++;count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3}else if(curlen===nextlen){max_count=6;min_count=3}else{max_count=7;min_count=4}}}function send_tree(s,tree,max_code){var n;var prevlen=-1;var curlen;var nextlen=tree[0*2+1];var count=0;var max_count=7;var min_count=4;if(nextlen===0){max_count=138;min_count=3}for(n=0;n<=max_code;n++){curlen=
nextlen;nextlen=tree[(n+1)*2+1];if(++count<max_count&&curlen===nextlen)continue;else if(count<min_count){do send_code(s,curlen,s.bl_tree);while(--count!==0)}else if(curlen!==0){if(curlen!==prevlen){send_code(s,curlen,s.bl_tree);count--}send_code(s,REP_3_6,s.bl_tree);send_bits(s,count-3,2)}else if(count<=10){send_code(s,REPZ_3_10,s.bl_tree);send_bits(s,count-3,3)}else{send_code(s,REPZ_11_138,s.bl_tree);send_bits(s,count-11,7)}count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3}else if(curlen===
nextlen){max_count=6;min_count=3}else{max_count=7;min_count=4}}}function build_bl_tree(s){var max_blindex;scan_tree(s,s.dyn_ltree,s.l_desc.max_code);scan_tree(s,s.dyn_dtree,s.d_desc.max_code);build_tree(s,s.bl_desc);for(max_blindex=BL_CODES-1;max_blindex>=3;max_blindex--)if(s.bl_tree[bl_order[max_blindex]*2+1]!==0)break;s.opt_len+=3*(max_blindex+1)+5+5+4;return max_blindex}function send_all_trees(s,lcodes,dcodes,blcodes){var rank;send_bits(s,lcodes-257,5);send_bits(s,dcodes-1,5);send_bits(s,blcodes-
4,4);for(rank=0;rank<blcodes;rank++)send_bits(s,s.bl_tree[bl_order[rank]*2+1],3);send_tree(s,s.dyn_ltree,lcodes-1);send_tree(s,s.dyn_dtree,dcodes-1)}function detect_data_type(s){var black_mask=4093624447;var n;for(n=0;n<=31;n++,black_mask>>>=1)if(black_mask&1&&s.dyn_ltree[n*2]!==0)return Z_BINARY;if(s.dyn_ltree[9*2]!==0||s.dyn_ltree[10*2]!==0||s.dyn_ltree[13*2]!==0)return Z_TEXT;for(n=32;n<LITERALS;n++)if(s.dyn_ltree[n*2]!==0)return Z_TEXT;return Z_BINARY}var static_init_done=false;function _tr_init(s){if(!static_init_done){tr_static_init();
static_init_done=true}s.l_desc=new TreeDesc(s.dyn_ltree,static_l_desc);s.d_desc=new TreeDesc(s.dyn_dtree,static_d_desc);s.bl_desc=new TreeDesc(s.bl_tree,static_bl_desc);s.bi_buf=0;s.bi_valid=0;init_block(s)}function _tr_stored_block(s,buf,stored_len,last){send_bits(s,(STORED_BLOCK<<1)+(last?1:0),3);copy_block(s,buf,stored_len,true)}function _tr_align(s){send_bits(s,STATIC_TREES<<1,3);send_code(s,END_BLOCK,static_ltree);bi_flush(s)}function _tr_flush_block(s,buf,stored_len,last){var opt_lenb,static_lenb;
var max_blindex=0;if(s.level>0){if(s.strm.data_type===Z_UNKNOWN)s.strm.data_type=detect_data_type(s);build_tree(s,s.l_desc);build_tree(s,s.d_desc);max_blindex=build_bl_tree(s);opt_lenb=s.opt_len+3+7>>>3;static_lenb=s.static_len+3+7>>>3;if(static_lenb<=opt_lenb)opt_lenb=static_lenb}else opt_lenb=static_lenb=stored_len+5;if(stored_len+4<=opt_lenb&&buf!==-1)_tr_stored_block(s,buf,stored_len,last);else if(s.strategy===Z_FIXED||static_lenb===opt_lenb){send_bits(s,(STATIC_TREES<<1)+(last?1:0),3);compress_block(s,
static_ltree,static_dtree)}else{send_bits(s,(DYN_TREES<<1)+(last?1:0),3);send_all_trees(s,s.l_desc.max_code+1,s.d_desc.max_code+1,max_blindex+1);compress_block(s,s.dyn_ltree,s.dyn_dtree)}init_block(s);if(last)bi_windup(s)}function _tr_tally(s,dist,lc){s.pending_buf[s.d_buf+s.last_lit*2]=dist>>>8&255;s.pending_buf[s.d_buf+s.last_lit*2+1]=dist&255;s.pending_buf[s.l_buf+s.last_lit]=lc&255;s.last_lit++;if(dist===0)s.dyn_ltree[lc*2]++;else{s.matches++;dist--;s.dyn_ltree[(_length_code[lc]+LITERALS+1)*2]++;
s.dyn_dtree[d_code(dist)*2]++}return s.last_lit===s.lit_bufsize-1}exports._tr_init=_tr_init;exports._tr_stored_block=_tr_stored_block;exports._tr_flush_block=_tr_flush_block;exports._tr_tally=_tr_tally;exports._tr_align=_tr_align},{"../utils/common":27}],39:[function(_dereq_,module,exports){function ZStream(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}module.exports=
ZStream},{}]},{},[9])(9)});
