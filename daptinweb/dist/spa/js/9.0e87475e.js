(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[9],{"37f3":function(e,t,n){"use strict";var o=n("5d40"),a=n.n(o);a.a},"5d40":function(e,t,n){},caf4:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page-container",[e.document?n("q-dialog",{model:{value:e.showSharingBox,callback:function(t){e.showSharingBox=t},expression:"showSharingBox"}},[n("q-card",{staticStyle:{"min-width":"33vw",width:"43vw"}},[n("q-item",[n("q-item-section",{attrs:{avatar:""}},[n("q-avatar",[n("q-icon",{attrs:{name:"fas fa-link",size:"1.8em"}})],1)],1),n("q-item-section",[n("span",{staticClass:"text-h6"},[e._v("Share")])])],1),n("q-separator"),n("q-card-section",[n("q-btn-toggle",{attrs:{options:[{value:2097027,label:"Enable"},{value:16289,label:"Disable"}]},on:{input:function(t){return e.saveDocument()}},model:{value:e.document.permission,callback:function(t){e.$set(e.document,"permission",t)},expression:"document.permission"}})],1),2097027===e.document.permission?n("q-card-section",[n("span",{staticClass:"text-bold"},[e._v("Sharing by link")])]):e._e(),2097027===e.document.permission?n("q-card-section",[n("q-input",{attrs:{readonly:"",value:e.endpoint()+"/#/apps/spreadsheet/"+e.document.reference_id}})],1):e._e()],1)],1):e._e(),n("q-header",{staticClass:"bg-white text-black",attrs:{elevated:""}},[n("q-bar",[n("q-btn-group",{attrs:{flat:""}},[n("q-btn",{attrs:{flat:"",label:"File"}},[n("q-menu",[n("q-list",{staticStyle:{"min-width":"100px"},attrs:{dense:""}},[n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.newDocument()}}},[n("q-item-section",[e._v("New")])],1),n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$router.push("/apps/files")}}},[n("q-item-section",[e._v("Open")])],1),n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.saveDocument()}}},[n("q-item-section",[e._v("Save")])],1),n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$router.back()}}},[n("q-item-section",[e._v("Close")])],1)],1)],1)],1)],1),n("q-space"),n("q-btn",{staticClass:"text-primary",attrs:{flat:"",label:"Share"},on:{click:function(t){e.showSharingBox=!0}}}),null!==e.decodedAuthToken()?n("q-btn",{staticClass:"profile-image",attrs:{size:"0.8em",flat:"",icon:"img:"+e.decodedAuthToken().picture}},[n("q-menu",[n("div",{staticClass:"row no-wrap q-pa-md"},[n("div",{staticClass:"column items-center"},[n("q-avatar",{attrs:{size:"72px"}},[n("img",{attrs:{src:e.decodedAuthToken().picture}})]),n("div",{staticClass:"text-subtitle1 q-mt-md q-mb-xs"},[e._v(e._s(e.decodedAuthToken().name))]),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"black",label:"Logout",push:"",size:"sm"},on:{click:function(t){return e.logout()}}})],1)])])],1):e._e()],1)],1),n("q-page",[n("div",{staticStyle:{margin:"0px",padding:"0px",position:"absolute",width:"100%",height:"calc(100% + 28px)",left:"0px",top:"-28px"},attrs:{id:"luckysheet"}}),n("q-dialog",{model:{value:e.newNameDialog,callback:function(t){e.newNameDialog=t},expression:"newNameDialog"}},[n("q-card",{staticStyle:{"min-width":"400px"}},[n("q-card-section",[n("q-input",{attrs:{label:"New file name"},model:{value:e.newName,callback:function(t){e.newName=t},expression:"newName"}})],1),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{attrs:{label:"Cancel"},on:{click:function(t){e.newNameDialog=!1}}}),n("q-btn",{attrs:{label:"Create"},on:{click:function(t){return e.newDocument()}}})],1)],1)],1)],1)],1)},a=[],c=(n("8e6e"),n("8a81"),n("ac6a"),n("cadf"),n("456d"),n("aef6"),n("9523")),i=n.n(c),s=(n("6b54"),n("06db"),n("28a5"),n("a481"),n("2f62")),l=n("c4e3"),r=n.n(l);function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t,n){var o;return function(){var a=this,c=arguments,i=function(){o=null,n||e.apply(a,c)},s=n&&!o;clearTimeout(o),o=setTimeout(i,t),s&&e.apply(a,c)}}function p(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)})))}function h(e){return decodeURIComponent(atob(e).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))}var f={name:"SpreadsheetEditorApp",data:function(){return d(d({file:null},Object(s["c"])(["decodedAuthToken","endpoint"])),{},{saveDebounced:null,showSharingBox:!1,contents:"",loading:!0,newNameDialog:!1,newName:null,document:null,containerId:"id-"+(new Date).getMilliseconds(),screenWidth:(window.screen.width<1200?window.screen.width:1200)+"px"})},watch:{contents:function(e,t){this.loading||(console.log("Contents changed",arguments),null===this.saveDebounced&&(this.saveDebounced=m(this.saveDocument,3e3,!0)),this.saveDebounced())}},methods:d({logout:function(){this.$emit("logout")},loadEditor:function(){var e=this;setTimeout((function(){console.log("Create sheet");var t={container:"luckysheet",showinfobar:!1,title:e.document?e.document.document_name:"New document",userInfo:null!==e.decodedAuthToken()?e.decodedAuthToken().email:"Anonymous"};if(console.log("l",luckysheet),luckysheet.destroy(),e.contents.length>0)try{console.log("set string data",e.contents);var n=e.contents;n&&(n=JSON.parse(n)),n&&(t.data=n),console.log("set sheet data",n),luckysheet.create(t)}catch(o){console.log("Failed to parse data",o),luckysheet.create(t)}else console.log("Else just create"),luckysheet.create(t);null!==e.decodedAuthToken()&&setInterval((function(){e.loading=!1;var t=luckysheet.getluckysheetfile();if(t){t=t.map((function(e){return e.celldata=luckysheet.getGridData(e.data),e}));var n=JSON.stringify(t);e.contents=n,window.localStorage.setItem("d",n)}}),1e4)}),300)},saveDocumentState:function(){var e=this,t=luckysheet.toJson();console.log("sheet json",t),e.contents=JSON.stringify(t),window.localStorage.setItem("d",e.contents)},newDocument:function(){var e=this;if(this.newNameDialog)if(this.newName){this.newName.endsWith(".dsheet")||(this.newName=this.newName+".dsheet");var t=null;t=this.newName,this.document={document_name:t,document_extension:"html",mime_type:"text/html",document_path:localStorage.getItem("_last_current_path")||"/"},this.file={contents:e.contents,name:t,type:"text/json"},this.newName=null,this.newNameDialog=!1,this.document.document_content=[this.file]}else this.$q.notify({message:"Please enter a name"});else this.newNameDialog=!0},saveDocument:function(){var e=this;if(console.log("save document",this.document,this.contents),this.document){if(null!==this.decodedAuthToken()){this.document.tableName="document";var t=new r.a;t.file("contents_encoded.json",p(this.contents)),t.generateAsync({type:"base64"}).then((function(t){e.document.document_content[0].contents="data:application/dspreadsheet,"+t,e.document.reference_id?(2097027===e.document.permission&&e.loadData({tableName:"world",params:{query:JSON.stringify([{column:"table_name",operator:"is",value:"document"}]),page:{size:1}}}).then((function(t){console.log("Document",t);var n=t.data[0];n.permission!==e.document.permission&&e.updateRow({tableName:"world",id:n.reference_id,permission:e.document.permission}).then((function(e){console.log("Updated permission")})).catch((function(t){console.log("Failed to get table document",t),e.$q.notify({message:"Failed to check table permissions, share link might not be working"})}))})).catch((function(t){console.log("Failed to get table document",t),e.$q.notify({message:"Failed to check table permissions, share link might not be working"})})),e.updateRow(e.document).then((function(e){console.log("Document saved",e)})).catch((function(t){console.log("errer",t),e.$q.notify({message:"We are offline, changes are not being stored"})}))):e.createRow(e.document).then((function(t){e.document=t.data,console.log("Spreadsheet created",t),e.$router.push("/apps/spreadsheet/"+e.document.reference_id)})).catch((function(t){console.log("eror",t),e.$q.notify({message:"We are offline, changes are not being stored"})}))}))}}else this.newNameDialog=!0}},Object(s["b"])(["loadData","updateRow","createRow"])),mounted:function(){var e=this,t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","/statics/luckysheet/plugins/js/plugin.js"),document.getElementsByTagName("head")[0].appendChild(t);var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src","/statics/luckysheet/luckysheet.umd.js"),document.getElementsByTagName("head")[0].appendChild(n),n.onload=function(){console.log("lucky loaded"),e.containerId="id-"+(new Date).getMilliseconds();var t=e.$route.params.documentId;if(console.log("Mounted FilesApp",e.containerId,e.$route.params.documentId),"new"===t)return e.file={contents:"",name:"New file.html"},e.contents=e.file.contents,void e.loadEditor();e.loadData({tableName:"document",params:{query:JSON.stringify([{column:"reference_id",operator:"is",value:t}]),included_relations:"document_content"}}).then((function(t){if(console.log("Loaded document",t.data),null===t.data||t.data.length<1)return e.file={contents:"",name:"New file.html",path:localStorage.getItem("_last_current_path")||"/"},void e.loadEditor();e.document=t.data[0],e.document.document_content?e.file=e.document.document_content[0]:(e.file={contents:btoa(""),name:e.document.document_name,type:"application/x-ddocument",path:localStorage.getItem("_last_current_path")||"/"},e.document.document_content=[e.file]),r.a.loadAsync(atob(e.file.contents)).then((function(t){t.file("contents_encoded.json").async("string").then((function(t){console.log("Loaded file: ",t),e.contents=h(t),e.loadEditor()})).catch((function(t){console.log("Failed to open contents.html",t),e.loadEditor()}))})).catch((function(t){console.log("Failed to load zip file",t),e.loadEditor()}))}))}}},g=f,b=(n("37f3"),n("2877")),w=n("09e3"),v=n("24e8"),y=n("f09f"),k=n("66e5"),q=n("4074"),_=n("cb32"),N=n("0016"),D=n("eb85"),S=n("a370"),x=n("6a67"),O=n("27f9"),j=n("e359"),C=n("d847"),A=n("e7a9"),Q=n("9c40"),I=n("4e73"),E=n("1c1c"),T=n("2c91"),$=n("9989"),P=n("4b7e"),B=n("4d5a"),F=n("7f67"),J=n("eebe"),R=n.n(J),z=Object(b["a"])(g,o,a,!1,null,null,null);t["default"]=z.exports;R()(z,"components",{QPageContainer:w["a"],QDialog:v["a"],QCard:y["a"],QItem:k["a"],QItemSection:q["a"],QAvatar:_["a"],QIcon:N["a"],QSeparator:D["a"],QCardSection:S["a"],QBtnToggle:x["a"],QInput:O["a"],QHeader:j["a"],QBar:C["a"],QBtnGroup:A["a"],QBtn:Q["a"],QMenu:I["a"],QList:E["a"],QSpace:T["a"],QPage:$["a"],QCardActions:P["a"],QLayout:B["a"]}),R()(z,"directives",{ClosePopup:F["a"]})}}]);